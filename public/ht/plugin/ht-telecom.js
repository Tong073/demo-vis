!function(I,x){"use strict";var E=ht.AlarmSeverity=function(k,Q,$,p,l){this.value=k,this.name=Q,this.nickName=$,this.color=p,this.displayName=l};ht.Default.def("ht.AlarmSeverity",x,{toString:function(){return this.displayName||this.name}}),function(){E.severities=new ht.List,E._vm={},E._nm={},E._cp=function(G,u){if(G&&u){var q=G.value-u.value;return q>0?1:0>q?-1:0}return G&&!u?1:!G&&u?-1:0},E.each=function(s,Z){E.severities.each(s,Z)},E.getSortFunction=function(){return E._cp},E.setSortFunction=function(T){E._cp=T,E.severities.sort(T)},E.add=function(Z,e,o,d,f){var v=new E(Z,e,o,d,f);return E._vm[Z]=v,E._nm[e]=v,E.severities.add(v),E.severities.sort(E._cp),v},E.remove=function(m){var i=E._nm[m];return i&&(delete E._nm[m],delete E._vm[i.value],E.severities.remove(i)),i},E.CRITICAL=E.add(500,"Critical","C","#FF0000"),E.MAJOR=E.add(400,"Major","M","#FFA000"),E.MINOR=E.add(300,"Minor","m","#FFFF00"),E.WARNING=E.add(200,"Warning","W","#00FFFF"),E.INDETERMINATE=E.add(100,"Indeterminate","N","#C800FF"),E.CLEARED=E.add(0,"Cleared","R","#00FF00"),E.isClearedAlarmSeverity=function(D){return D?0===D.value:!1},E.getByName=function(J){return E._nm[J]},E.getByValue=function(m){return E._vm[m]},E.clear=function(){E.severities.clear(),E._vm={},E._nm={}},E.compare=function(u,A){return E._cp(u,A)}}();var B=ht.AlarmState=function(N){this._d=N,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",x,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var K=null;for(var T in this._am)T=E.getByName(T),E.isClearedAlarmSeverity(T)||0!==this.getAcknowledgedAlarmCount(T)&&(K=K?E.compare(K,T)>0?K:T:T);this._haa=K},_c2:function(){var Y=null;for(var M in this._nm)M=E.getByName(M),E.isClearedAlarmSeverity(M)||0!==this.getNewAlarmCount(M)&&(Y=Y?E.compare(Y,M)>0?Y:M:M);this._hna=Y},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var X in this._nm)if(X=E.getByName(X),!E.isClearedAlarmSeverity(X)&&0!==this.getNewAlarmCount(X)&&E.compare(this._hna,X)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var R=this._haa,j=this._hna,$=this._ps;this._hoa=R,E.compare(j,this._hoa)>0&&(this._hoa=j),E.compare($,this._hoa)>0&&(this._hoa=$)},_c5:function(){var F=this._haa,k=this._hna;this._hta=F,E.compare(k,this._hta)>0&&(this._hta=k)},increaseAcknowledgedAlarm:function(o,a){if(0!==a){a=a||1;var m=this._am[o.name]||0;m+=a,this._am[o.name]=m,this._f()}},increaseNewAlarm:function(k,$){if(0!==$){$=$||1;var t=this._nm[k.name]||0;t+=$,this._nm[k.name]=t,this._f()}},decreaseAcknowledgedAlarm:function(g,S){if(0!==S){S||(S=1);var l=this._am[g.name]||0;if(l-=S,0>l)throw"Alarm count can not be negative";this._am[g.name]=l,this._f()}},decreaseNewAlarm:function(v,J){if(0!==J){J||(J=1);var r=this._nm[v.name]||0;if(r-=J,0>r)throw"Alarm count can not be negative";this._nm[v.name]=r,this._f()}},acknowledgeAlarm:function(l){this.decreaseNewAlarm(l,1),this.increaseAcknowledgedAlarm(l,1)},acknowledgeAllAlarms:function(V){if(V){var k=this.getNewAlarmCount(V);this.decreaseNewAlarm(V,k),this.increaseAcknowledgedAlarm(V,k)}else for(var T in this._nm)this.acknowledgeAllAlarms(E.getByName(T))},_c6:function(){this._aac=0;for(var f in this._am)f=E.getByName(f),this._aac+=this.getAcknowledgedAlarmCount(f)},getAcknowledgedAlarmCount:function(l){return l?this._am[l.name]||0:this._aac},getAlarmCount:function(W){return this.getAcknowledgedAlarmCount(W)+this.getNewAlarmCount(W)},_c7:function(){this._nac=0;for(var m in this._nm)this._nac+=this.getNewAlarmCount(E.getByName(m))},getNewAlarmCount:function(C){return C?this._nm[C.name]||0:this._nac},setNewAlarmCount:function(Z,C){this._nm[Z.name]=C,this._f()},removeAllNewAlarms:function(w){w?delete this._nm[w]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(Z,g){this._am[Z.name]=g,this._f()},removeAllAcknowledgedAlarms:function(c){c?delete this._am[c.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(F){if(this._ep||(F=null),this._ps!==F){var i=this._ps;this._ps=F,this._f(),this._d.fp("propagateSeverity",i,F)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(U){var I=this._ep;this._ep=U,this._d.fp("enablePropagation",I,U)&&(U||this.setPropagateSeverity(null))}});var _=ht.AlarmStatePropagator=function(c){this._dataModel=c,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",x,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(S){this._enable!==S&&(this._enable=S,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(J){this.propagate(J)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(O){O.data&&this.propagate(O.data)},handleDataPropertyChange:function(a){if("alarmState"===a.property||"enablePropagation"===a.property)this.propagate(a.data);else if("parent"===a.property){var m=a.oldValue;m&&this.propagate(m),this.propagate(a.data)}},propagate:function(g){g&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(g),this._isPropagating=!1)},propagateToTop:function(q){for(this.propagateToParent(null,q);q&&q.getParent();)this.propagateToParent(q,q.getParent()),q=q.getParent()},propagateToParent:function(Y,e){var Q=null;e.getChildren().each(function(T){var O=T.getAlarmState().getHighestOverallAlarmSeverity();E.compare(O,Q)>0&&(Q=O)}),e.getAlarmState().setPropagateSeverity(Q)}}),ht.AlarmStateStatistics=function(O){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(O)},ht.Default.def("ht.AlarmStateStatistics",x,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(O){var r=this._dataModel;r!==O&&(r&&(r.umd(this.handleDataPropertyChange,this),r.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=O,this.reset(),O.md(this.handleDataPropertyChange,this),O.mm(this.handleDataModelChange,this),this.fp("dataModel",r,O))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function($){"alarmState"===$.property&&(this.increase($.data),this.fireAlarmStateChange())},handleDataModelChange:function(g){"add"===g.kind?(this.increase(g.data),this.fireAlarmStateChange()):"remove"===g.kind?(this.decrease(g.data),this.fireAlarmStateChange()):"clear"===g.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,E.each(function(C){var G=this.getSumInfo(C);this.sumAcked+=G.ackedCount,this.sumNew+=G.newCount,this.sumTotal+=G.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(e){if(!e)return this.sumNew;var G=this.getSumInfo(e);return G.newCount},getAcknowledgedAlarmCount:function(A){if(!A)return this.sumAcked;var u=this.getSumInfo(A);return u.ackedCount},getTotalAlarmCount:function(m){if(!m)return this.sumTotal;var j=this.getSumInfo(m);return j.totalCount},getSumInfo:function(U){var z=this.severtiyMap[U.name];return z||(z={},z.newCount=0,z.ackedCount=0,z.totalCount=0,this.severtiyMap[U.name]=z),z},decrease:function(p){var X=this.dataMap[p.getId()];X&&(delete this.dataMap[p.getId()],E.each(function(S){var J=X[S.name],L=this.getSumInfo(S);L.newCount=L.newCount-J.newCount,L.ackedCount=L.ackedCount-J.ackedCount,L.totalCount=L.totalCount-J.totalCount},this))},increase:function(K){if(this.decrease(K),!this._filterFunc||this._filterFunc(K)){var q={},u=K.getAlarmState();this.dataMap[K.getId()]=q,E.each(function(K){var h={};h.newCount=u.getNewAlarmCount(K),h.ackedCount=u.getAcknowledgedAlarmCount(K),h.totalCount=u.getAlarmCount(K),q[K.name]=h;var F=this.getSumInfo(K);F.newCount=F.newCount+h.newCount,F.ackedCount=F.ackedCount+h.ackedCount,F.totalCount=F.totalCount+h.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(i){var U=this._filterFunc;this._filterFunc=i,this.reset(),this.fp("filterFunc",U,i)},getFilterFunc:function(){return this._filterFunc}});var J=ht.Data.prototype;J.getAlarmState=function(){return this._alarmState||(this._alarmState=new B(this))},J=ht.DataModel.prototype,J.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},J.setEnableAlarmStatePropagator=function(O){O!=this.isEnableAlarmStatePropagator()&&(O?(this._alarmStatePropagator=new _(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},J=ht.graph.GraphView.prototype,J.getNote2=function(B){var i=B.getAlarmState().getHighestNewAlarmSeverity();if(i){var F=B.getAlarmState().getNewAlarmCount(i)+i.nickName;return B.getAlarmState().hasLessSevereNewAlarms()&&(F+="+"),F}return B.s("note2")},J.getNote2Background=function(D){var n=D.getAlarmState().getHighestNewAlarmSeverity();return n?n.color:D.s("note2.background")},J.getBodyColor=function(G){var e=G.getAlarmState().getHighestNativeAlarmSeverity();return e?e.color:G.s("body.color")},J.getBorderColor=function(v){var b=v.getAlarmState().getPropagateSeverity();return b?b.color:v.s("border.color")},J=ht.widget.TreeView.prototype,J.getBorderColor=function(f){var z=f.getAlarmState().getPropagateSeverity();return z?z.color:f.s("border.color")},J.getIcon=function(C){return C.getIcon()?"__alarmIcon__":null},J=ht.widget.TreeTableView.prototype,J.getBorderColor=function(N){var v=N.getAlarmState().getPropagateSeverity();return v?v.color:N.s("border.color")},J.getIcon=function(G){return G.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(V){return V.getIcon()}},color:{func:function(W){var r=W.getAlarmState().getHighestNativeAlarmSeverity();return r?r.color:W.s("body.color")}},rect:[0,0,16,16]}]});var S=ht.Style;S["note2.expanded"]=!0,S["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);