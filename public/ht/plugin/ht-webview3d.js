!function(c){"use strict";function m(r){var j,n,p,Z,x,O,h,U=[],f=0;j=$.createDiv(!0);var l=r.getView();l.insertBefore(j,r.getCanvas()),n=t.Default.createDiv(),n.style.WebkitTransformStyle="preserve-3d",n.style.MozTransformStyle="preserve-3d",n.style.transformStyle="preserve-3d",j.appendChild(n),[{event:"mousedown",style:"none"},{event:"mouseup",style:"auto"},{event:"touchstart",style:"none"},{event:"touchend",style:"auto"}].forEach(function(Q){var U=Q.style;g.addEventListener(l,Q.event,function(){r.isDragProtectForWebView()&&(j.style.pointerEvents=U)})}),this.updateWebView=function(){if(r.getWidth()&&r.getHeight()){var k=r.getCanvas(),e=1*k.style.width.slice(0,-2),o=1*k.style.height.slice(0,-2);(U[0]!==e||U[1]!==o)&&(U[0]=e,U[1]=o,j.style.width=e+"px",j.style.height=o+"px",n.style.width=e+"px",n.style.height=o+"px");var E=r._projectMatrix[5]*U[1]/2;E!==p&&(p=E,j.style.WebkitPerspective=p+"px",j.style.MozPerspective=p+"px",j.style.perspective=p+"px"),O="translateZ("+p+"px)"+T(r._viewMatrix);var V=O+"translate("+U[0]/2+"px,"+U[1]/2+"px)";Z===V||x||(n.style.WebkitTransform=V,n.style.MozTransform=V,n.style.transform=V,Z=V),f++,h=!1,r.dm().each(function(P){P.isWebView&&K(P)});for(var q,A=n.children,F=[],a=0,S=A.length;S>a;a++)q=A[a],q._isHtWebView&&q._renderCookie!==f&&F.push(q);F.length&&F.forEach(function(j){n.removeChild(j)})}};var u=new Array(16),K=function(k){var N=k.getAttach();if(N){var l=r.isVisible(k);if(l&&N.parentNode!==n?n.appendChild(N):!l&&N.parentNode&&$.removeHTML(N),l){N._renderCookie=f,h=!0;var K=k.getFinalScale3d(),c=k._prefrenceSize;c&&c[0]?c[1]||(c[1]=c[0]/K[0]*K[1]):c=[K[0],K[1]],N.style.width=c[0]+"px",N.style.height=c[1]+"px";var D=1/c[0],w=1/c[1],V=1,p=k.mat;u[0]=p[0]*D,u[1]=p[1]*D,u[2]=p[2]*D,u[3]=p[3]*D,u[4]=p[4]*w,u[5]=p[5]*w,u[6]=p[6]*w,u[7]=p[7]*w,u[8]=p[8]*V,u[9]=p[9]*V,u[10]=p[10]*V,u[11]=p[11]*V,u[12]=p[12],u[13]=p[13],u[14]=p[14],u[15]=p[15];var E=C(u,x?"translate("+U[0]/2+"px,"+U[1]/2+"px)"+O:""),I=N.$a2;I!==E&&(N.$a2=E,N.style.WebkitTransform=E,N.style.MozTransform=E,N.style.transform=E)}}}}function b(Z){return Math.abs(Z)<1e-10?0:Z}function T(R){var C=R;return"matrix3d("+b(C[0])+","+b(-C[1])+","+b(C[2])+","+b(C[3])+","+b(C[4])+","+b(-C[5])+","+b(C[6])+","+b(C[7])+","+b(C[8])+","+b(-C[9])+","+b(C[10])+","+b(C[11])+","+b(C[12])+","+b(-C[13])+","+b(C[14])+","+b(C[15])+")"}function C(P,a){var w=P,o="matrix3d("+b(w[0])+","+b(w[1])+","+b(w[2])+","+b(w[3])+","+b(-w[4])+","+b(-w[5])+","+b(-w[6])+","+b(-w[7])+","+b(w[8])+","+b(w[9])+","+b(w[10])+","+b(w[11])+","+b(w[12])+","+b(w[13])+","+b(w[14])+","+b(w[15])+")";return"translate(-50%,-50%)"+(a||"")+o}var M="ht",t=c[M],$=t.Default,g=$.getInternal(),J=g.superCall,y=t.graph3d.Graph3dView,l=y.prototype.validateImpl;y.prototype.validateImpl=function(){l.call(this);var w=this._webViewRenderer;w||(w=this._webViewRenderer=new m(this)),w.updateWebView()},y.prototype.isDragProtectForWebView=function(){return this._dragProtectForWebView},y.prototype.setDragProtectForWebView=function(t){this._dragProtectForWebView=t};var L=t.WebView3d=function(){var E=this;J(L,E),E.s({shape3d:"billboard","shape3d.reverse.flip":!0})},k=[1,1,1,1],K=[0,0,0,0];$.def(M+"."+"WebView3d",t.Node,{ms_ac:["attach"],isWebView:!0,attachDOM:function(m,W,Y){if(!m)return this.detachDOM();if("string"==typeof m){var d=document.createElement("iframe");d.src=m,m=d}var r=m.style;r.position="absolute",r.border=0,r.outline=0,r.padding=0,r.margin=0,m._isHtWebView=!0,this.setAttach(m),this._prefrenceSize=[W,Y],this.s("shape3d.blend",K)},detachDOM:function(){this.setAttach(null),this.s("shape3d.blend",this.getBgColor())},setBgColor:function(a){this.a("defaultBgColor",a),this.getAttach()||this.s("shape3d.blend",a)},getBgColor:function(){return this.a("defaultBgColor")||k}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);