!function(_,M,u){"use strict";var T=_.ht;T.Astar={},function(v){var M=v();_.AStar=M.astar,_.AStar.Graph=M.Graph}(function(){function o(z){for(var H=z,P=[];H.parent;)P.unshift(H),H=H.parent;return P}function M(){return new T(function(i){return i.f})}function W(e,s){s=s||{},this.nodes=[],this.diagonal=!!s.diagonal,this.grid=[];for(var W=0;W<e.length;W++){this.grid[W]=[];for(var N=0,y=e[W];N<y.length;N++){var b=new c(W,N,y[N]);this.grid[W][N]=b,this.nodes.push(b)}}this.$13x()}function c(a,f,T){this.x=a,this.y=f,this.weight=T}function T(f){this.content=[],this.scoreFunction=f}var O={search:function(B,N,Y,b){B.$6x(),b=b||{};var u=b.heuristic;u||(u=B.diagonal?O.$4x.diagonal:O.$4x.manhattan);var C=b.closest||!1,G=b.punish,c=M(),S=N;for(N.h=u(N,Y),B.$7x(N),c.push(N);c.size()>0;){var j=c.pop();if(j===Y)return o(j);j.closed=!0;for(var X=B.neighbors(j),t=0,U=X.length;U>t;++t){var v=X[t];if(!v.closed&&!v.$9x()){var $=j.g+v.getCost(j,G),H=v.visited;(!H||$<v.g)&&(v.visited=!0,v.parent=j,v.h=v.h||u(v,Y),v.g=$,v.f=v.g+v.h,B.$7x(v),C&&(v.h<S.h||v.h===S.h&&v.g<S.g)&&(S=v),H?c.$10x(v):c.push(v))}}}return C?o(S):[]},$4x:{manhattan:function(X,D){var J=Math.abs(D.x-X.x),B=Math.abs(D.y-X.y);return J+B},diagonal:function(t,y){var C=1,x=Math.sqrt(2),u=Math.abs(y.x-t.x),J=Math.abs(y.y-t.y);return C*(u+J)+(x-2*C)*Math.min(u,J)}},$5x:function(o){o.f=0,o.g=0,o.h=0,o.visited=!1,o.closed=!1,o.parent=null}};return W.prototype.$13x=function(){this.dirtyNodes=[];for(var l=0;l<this.nodes.length;l++)O.$5x(this.nodes[l])},W.prototype.$6x=function(){for(var G=0;G<this.dirtyNodes.length;G++)O.$5x(this.dirtyNodes[G]);this.dirtyNodes=[]},W.prototype.$7x=function(Q){this.dirtyNodes.push(Q)},W.prototype.neighbors=function(J){var M=[],s=J.x,E=J.y,S=this.grid;return S[s-1]&&S[s-1][E]&&M.push(S[s-1][E]),S[s+1]&&S[s+1][E]&&M.push(S[s+1][E]),S[s]&&S[s][E-1]&&M.push(S[s][E-1]),S[s]&&S[s][E+1]&&M.push(S[s][E+1]),this.diagonal&&(S[s-1]&&S[s-1][E-1]&&M.push(S[s-1][E-1]),S[s+1]&&S[s+1][E-1]&&M.push(S[s+1][E-1]),S[s-1]&&S[s-1][E+1]&&M.push(S[s-1][E+1]),S[s+1]&&S[s+1][E+1]&&M.push(S[s+1][E+1])),M},W.prototype.toString=function(){for(var R=[],d=this.grid,x=0;x<d.length;x++){for(var L=[],U=d[x],N=0;N<U.length;N++)L.push(U[N].weight);R.push(L.join(" "))}return R.join("\n")},c.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},c.prototype.getCost=function(l,G){var H;if(H=l&&l.x!=this.x&&l.y!=this.y?1.41421*this.weight:this.weight,G){var _=l;if(!_)return H;var A=_.parent;if(!A)return H;if(Math.abs(A.x+this.x-2*_.x)>1e-5)return H+G;if(Math.abs(A.y+this.y-2*_.y)>1e-5)return H+G}return H},c.prototype.$9x=function(){return 0===this.weight},T.prototype={push:function(z){this.content.push(z),this.$11x(this.content.length-1)},pop:function(){var Y=this.content[0],b=this.content.pop();return this.content.length>0&&(this.content[0]=b,this.$12x(0)),Y},remove:function(Q){var h=this.content.indexOf(Q),O=this.content.pop();h!==this.content.length-1&&(this.content[h]=O,this.scoreFunction(O)<this.scoreFunction(Q)?this.$11x(h):this.$12x(h))},size:function(){return this.content.length},$10x:function(l){this.$11x(this.content.indexOf(l))},$11x:function(h){for(var v=this.content[h];h>0;){var W=(h+1>>1)-1,F=this.content[W];if(!(this.scoreFunction(v)<this.scoreFunction(F)))break;this.content[W]=v,this.content[h]=F,h=W}},$12x:function(t){for(var _=this.content.length,U=this.content[t],r=this.scoreFunction(U);;){var l,C=t+1<<1,K=C-1,F=null;if(_>K){var Y=this.content[K];l=this.scoreFunction(Y),r>l&&(F=K)}if(_>C){var o=this.content[C],k=this.scoreFunction(o);(null===F?r:l)>k&&(F=C)}if(null===F)break;this.content[t]=this.content[F],this.content[F]=U,t=F}}},{astar:O,Graph:W}});var J=T.Astar.Finder=function($,w){var U=this;U.gv=$,U.$13x(w),U.refreshMap()};J.prototype={},J.prototype.constructor=J,M.defineProperties(J.prototype,{_debugInfo:{get:function(){return this.gv._astarDebugInfo},set:function(x){this.gv._astarDebugInfo=x}}}),J.prototype.$13x=function(C){var X=this,J=X.$14x={};C=C||{};var N=C.gridSize||10;J.gridSizeX=C.gridSizeX||N,J.gridSizeY=C.gridSizeY||N,J.rect=C.rect,J.filter=C.filter,J.extendBlocks=C.extendBlocks||3,J.fastOverlap=C.fastOverlap===u?!0:C.fastOverlap,J.nodeRectExtend=C.nodeRectExtend||0,J.diagonal=C.diagonal===u?!0:C.diagonal,J.turnPunish=C.turnPunish===u?.1:C.turnPunish,J.simplify=C.simplify===u?!0:C.simplify,J.toGridCenter=C.toGridCenter===u?!1:C.toGridCenter,J.closest=C.closest===u?!0:C.closest},J.prototype.refreshMap=function(){var A,g=this,q=g.$14x,u=q.gridSizeX,y=q.gridSizeY,D=q.extendBlocks;q.rect?A=q.rect:(A=g.$15x(),T.Default.grow(A,u*D,y*D)),T.Default.grow(A,u,y);var V=Math.floor(A.x/u)*u,r=Math.floor(A.y/y)*y,W=Math.ceil(A.width/u),L=Math.ceil(A.height/y),p=W*u,J=L*y;g.$16x={x:V,y:r,w:p,h:J,gridX:u,gridY:y,xLen:W,yLen:L},g.$17x(),g.$21x()},J.prototype.$15x=function(){var $=this.gv;if($ instanceof T.graph.GraphView)return $.getContentRect();var X,f=T.Default.unionRect;return $.dm().each(function(P){$.isVisible(P)&&P.getRect&&(X=f(X,P.getRect()))}),X},J.prototype.$17x=function(){var a,K,C,_,S=this,g=S.$16x,j=g.xLen,h=g.yLen;for(a=new Array(j),C=0;j>C;C++)for(a[C]=K=new Array(h),_=h;_--;)K[_]=1;var D=S.$14x.filter;for(S.gv.dm().each(function(F){D&&D(F)===!1||(!S._debugInfo||F!==S._debugInfo.grid&&F!=S._debugInfo.path)&&S.$1cw(a,F)}),C=0;j>C;C++)a[C][0]=1,a[C][h-1]=1;for(_=0;h>_;_++)a[0][_]=1,a[j-1][_]=1;S.grid=a;var V=new AStar.Graph(a,{diagonal:S.$14x.diagonal});S.graph=V},J.prototype.$18x=function(I,A,n,Y,H,p,F,j){var B=this.$19x,W=B(n-I,H-F,Y-A,p-j);if(1e-6>=W&&W>=-1e-6)return!1;var S=B(H-I,H-F,p-A,p-j)/W;if(0>S||S>1)return!1;var P=B(n-I,H-I,Y-A,p-A)/W;return 0>P||P>1?!1:!0},J.prototype.$19x=function(O,p,m,o){return O*o-p*m},J.prototype.$1aw=function(a,H,u,L){for(var C=[-(H[1]-a[1]),H[0]-a[0]],n=C[0]*(u[0]-a[0])+C[1]*(u[1]-a[1])>=0,B=0,W=L.length;W>B;B+=2)if(C[0]*(L[B]-a[0])+C[1]*(L[B+1]-a[1])>=0===n)return!1;return!0},J.prototype.$1bw=function(d,j){for(var I,f,K=this,p=0,v=d.length;v>p;p+=2)if(I=p===v-2?0:p+2,f=I===v-2?0:I+2,K.$1aw([d[p],d[p+1]],[d[I],d[I+1]],[d[f],d[f+1]],j))return!1;for(var p=0,v=j.length;v>p;p+=2)if(I=p===v-2?0:p+2,f=I===v-2?0:I+2,K.$1aw([j[p],j[p+1]],[j[I],j[I+1]],[j[f],j[f+1]],d))return!1;return!0},J.prototype.$1cw=function(W,b){if(b.getRect){var o=this,B=b.getRect();T.Default.grow(B,o.$14x.nodeRectExtend);var A,z,O,Q,h,k,C,F,V,q,$,R=o.$1dw({x:B.x,y:B.y}),H=o.$1dw({x:B.x+B.width,y:B.y+B.height}),x=o.$14x.fastOverlap;if(!x){var I=b.getCorners();C=[],I.forEach(function(l){C.push(l.x,l.y)}),q=o.$14x.gridSizeX/2,$=o.$14x.gridSizeY/2}for(z=Math.max(0,R.x),O=Math.min(H.x,W.length-1),h=Math.max(0,R.y),k=Math.min(H.y,W.length?W[0].length-1:-1),A=z;O>=A;A++)for(Q=h;k>=Q;Q++)if(x)W[A][Q]=0;else{V=o.$1ew({x:A,y:Q});var l=V.x-q,J=V.x+q,g=V.y-$,s=V.y+$;F=[l,g,l,s,J,s,J,g],o.$1bw(C,F)&&(W[A][Q]=0)}}},J.prototype.$1dw=function(R,h){var r=this,z=r.$16x,O=(R.x-z.x)/z.gridX,J=(R.y-z.y)/z.gridY;return h!==!1&&(O=Math.round(O),J=Math.round(J)),{x:O,y:J}},J.prototype.$1ew=function(w){var r=this,v=r.$16x;return{x:w.x*v.gridX+v.x,y:w.y*v.gridY+v.y}},J.prototype.$1fw=function(P){var x=this,R=x.$16x,t=R.xLen,p=R.yLen;if(P.x>=0&&P.x<t&&P.y>=0&&P.y<p)return P;var C={x:P.x,y:P.y};return C.x<0?C.x=0:C.x>=t&&(C.x=t-1),C.y<0?C.y=0:C.y>=p&&(C.y=p-1),C},J.prototype.findPath=function(u,l){var S,v,b,P,j=this,k=j.$1dw(u),i=j.$1dw(l);if(b=j.$1fw(k),P=j.$1fw(i),b!==k&&P!==i){var n=j.$16x,R=n.x-n.gridX/2,f=n.y-n.gridY/2,Z=R+n.gridX*n.xLen,t=f+n.gridY*n.yLen;if(!(j.$18x(u.x,u.y,l.x,l.y,R,f,Z,f)||j.$18x(u.x,u.y,l.x,l.y,Z,f,Z,t)||j.$18x(u.x,u.y,l.x,l.y,Z,t,R,t)||j.$18x(u.x,u.y,l.x,l.y,R,t,R,f)))return[u,l]}b!==k&&(S=!0,k=b),P!==i&&(v=!0,i=P);var X=j.graph.grid[k.x][k.y],s=j.graph.grid[i.x][i.y],J=AStar.search(j.graph,X,s,{closest:j.$14x.closest,punish:j.$14x.turnPunish});if(!J||!J.length)return null;var F=[];F.push(u),S&&F.push(j.$1ew(J[0]));for(var G=1,x=J.length;x-1>G;G++)F.push(j.$1ew(J[G]));if(v)F.push(j.$1ew(J[x-1])),F.push(l);else{var d=J[x-1];i.x!==d.x||i.y!==d.y||j.$14x.toGridCenter?F.push(j.$1ew(d)):F.push(l)}return j.$14x.simplify&&(F=j.simplifyPath(F)),j.$20x=F,j.$21x(),F},J.prototype.debugOn=function(K){this.debugFlag=!0,this.debugSettings=K||{},this.$21x()},J.prototype.simplifyPath=function(E){var H=E.length;if(2>=H)return E;var $,x,W=[E[0],E[1]],z=W[0],Y=W[1],j=1e-5;for($=2;H>$;$++)x=E[$],Math.abs((Y.x-z.x)*(x.y-z.y)-(Y.y-z.y)*(x.x-z.x))<j?Y=W[W.length-1]=x:(z=Y,Y=x,W.push(x));return W},J.prototype.$21x=function(){var r=this;if(r.$22x(),this.debugFlag){var t=r.grid;if(t){var G,k=r.gv;if(r.debugSettings.$16x!==!1){G=[];for(var v,A,c,I,U,p=[],o=r.$14x.gridSizeX/2,w=r.$14x.gridSizeY/2,K=t.length,P=K?t[0].length:0,i=1;K-1>i;i++)for(var _=1;P-1>_;_++)t[i][_]||(v=r.$1ew({x:i,y:_}),A=v.x-o,c=v.x+o,I=v.y-w,U=v.y+w,G.push({x:A,y:I},{x:A,y:U},{x:c,y:U},{x:c,y:I}),p.push(1,2,2,2,5));var y=new T.Shape;y.s("shape.border.color","rgba(50, 50, 50, 0.2)"),y.s("shape.border.width",1),y.s("shape.background","rgba(200, 50, 100, 0.2)"),y.s("2d.editable",!1),y.s("2d.selectable",!1),y.setPoints(G),y.setSegments(p),r._debugInfo={grid:y},k.dm().add(y)}r.debugSettings.path!==!1&&(G=new T.Shape,r.$20x&&(G.setPoints(r.$20x),G.s("shape.border.color","red"),G.s("shape.border.width",1),G.s("2d.editable",!1),G.s("2d.selectable",!1),G.s("shape.background",null),r._debugInfo||(r._debugInfo={}),r._debugInfo.path=G,k.dm().add(G)))}}},J.prototype.debugOff=function(){this.debugFlag=!1,this.$22x()},J.prototype.$22x=function(){var n=this;if(n._debugInfo){var z=n._debugInfo.grid,e=n._debugInfo.path,$=n.gv;z&&$.dm().remove(z),e&&$.dm().remove(e),n._debugInfo=null}}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);