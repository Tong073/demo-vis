!function(S){"use strict";var d=S.ht,F=d.Default,T=F.getInternal(),_=T.ui(),$=null,p="__segmentLengths",b="__lineTotalLength",x="__linePoints",q="__distance0",E="flow.count",v="flow.step",u="flow.element.max",J="flow.element.count",O="flow.element.min",j="flow.element.space",G="flow.element.autorotate",H="flow.element.background",y="flow.element.shadow.max",B="flow.element.shadow.min",U="flow.element.shadow.begincolor",N="flow.element.shadow.endcolor",r="flow.element.shadow.visible",X="flow.element.image",s="flow",C=d.Math.Vector2,M=new C;new C,new C,d.List;var W=d.Default._edgeProtectMethod,I=W.getStraightLinePoints,i=function(a,L){for(var c=[],V=a.length,I=0;V>I;I++){var J=a[I];J._as&&(J=J._as);for(var t=J[0],Q=1;Q<J.length;Q++)c.push([t,J[Q]]),t=J[Q]}for(var P=[],I=0;I<c.length;I++){var X=R(c[I][0],c[I][1],L);P.push(X)}return{distance:P,segments:c}},w=function(d,g,q){if(d){for(var U,A=i(d,g),o=A.distance,K=A.segments,e=1/0,n=null,S=0,D=o.length;D>S;S++){var x=o[S];x.z<e&&(U=S,e=x.z,n=x)}if(null==q&&(q=.1),n.z<q){for(var P=0,t=0;U>=t;t++)P+=F.getDistance(K[t][0],U>t?K[t][1]:n);return P}}},R=function(h,K,U){var o=h.x,a=h.y,Q=K.x,j=K.y,M=U.x,f=U.y,T=Q-o,E=j-a,r=Math.sqrt(T*T+E*E),R=T/r,O=E/r,F=(-o+M)*R+(-a+f)*O,N={x:o+F*R,y:a+F*O};return N.x>=Math.min(h.x,K.x)&&N.x<=Math.max(h.x,K.x)&&N.y>=Math.min(h.y,K.y)&&N.y<=Math.max(h.y,K.y)||(N.x=Math.abs(N.x-h.x)<Math.abs(N.x-K.x)?h.x:K.x,N.y=Math.abs(N.y-h.y)<Math.abs(N.y-K.y)?h.y:K.y),T=M-N.x,E=f-N.y,N.z=Math.sqrt(T*T+E*E),N},L=function(b,z){if(b){var p=i(b,z).distance,m=1/0,c=null;return p.forEach(function(r){r.z<m&&(m=r.z,c=r)}),c}},K=W.calculateLineLength,e=W.calcSegmentIndexByDistance,k=W.calculatePointAlongLine,n=function(Q,O,r){if(!Q)return r;if(0===O){var Z=Q[0][0],v=Q[0][1];return r+Math.atan2(v.y-Z.y,v.x-Z.x)}if(100===O){Q=Q[Q.length-1];var Z=Q[Q.length-2],v=Q[Q.length-1];return r+Math.atan2(v.y-Z.y,v.x-Z.x)}for(var H=0,B=[],$=Q.length,S=0;$>S;S++){var F=Q[S],q=K(F);H+=q,B.push(q)}for(var z=H*O/100,_=e(z,B),M=0,A=0;_>A;A++)M+=B[A];z-=M;for(var G=k(Q[_],z),T=Q[_],n=0,P=0,p=0;p<T.length-1;p++){var f=T[p],C=T[p+1],j=C.x-f.x,J=C.y-f.y,U=Math.sqrt(j*j+J*J);if(n+=U,n>z){P=p;break}}var W=T[P];return r+Math.atan2(G.y-W.y,G.x-W.x)},D=function(Z){var N=0;if(Z)if(Array.isArray(Z[0]))for(var B=Z.length,q=0;B>q;q++){var k=Z[q],p=K(k);N+=p}else N=K(Z);return N},g=function(G,y,l,b){return M.set(y,l).rotateAround(null,b),G?{x:G.x+M.x,y:G.y+M.y}:{x:M.x,y:M.y}},Y=function(s){var j=s._data,$=I(s);if($){j.s("flow.reverse")&&($.reverse(),$.forEach(function(e){e.reverse()}));for(var M=0,U=[],z=$.length,Q=0;z>Q;Q++){var Y=$[Q],T=K(Y);M+=T,U.push(T)}if(j[p]=U,j[b]=M,j[x]=$,j instanceof d.Edge){var c=F.unionPoint($),a=c.x+c.width/2,m=c.y+c.height/2;j.$10e={x:a,y:m}}V(s,!0)}},m=W.getPercentPosition,V=function(K,h){var r=K._data,M=r[b],o=r.s(E),k=r.s(v),c=0,Q=r[p],C=r.s(u),w=r.s(O),D=r.s(J),m=(C-w)/(D-1),L=[];if(Q){if(1===D)L.push(C);else if(2===D)L.push(C),L.push(w);else{if(!(D>2))return;L.push(C);for(var i=D-2;i>0;i--)L.push(w+m*i);L.push(w)}var I=0,z=0;L.forEach(function($){D-1>I&&(z+=r.getFlowElementSpace($)),I++}),z+=(C+w)/2,c=(M-o*z+z)/o;var A=K[q];for(null==A&&(A=0),h||(A+=k);A>M+z;){var H=K._overCount;H?H++:H=1,H>=o&&(H=null),K._overCount=H,r.s("flow.autoreverse")?H?A-=c+z:(A=0,r.s("flow.reverse",!r.s("flow.reverse"))):A-=c+z}K[q]=A}},z="prototype",f=d.graph.GraphView[z],A=d.Data[z],t=_.DataUI[z],h=_.ShapeUI[z],l=_.EdgeUI[z],c=d.DataModel[z],Z=d.Style;Z[u]==$&&(Z[u]=7),Z[O]==$&&(Z[O]=0),Z[E]==$&&(Z[E]=1),Z[v]==$&&(Z[v]=3),Z[J]==$&&(Z[J]=10),Z[j]==$&&(Z[j]=3.5),Z[G]==$&&(Z[G]=!1),Z[H]==$&&(Z[H]="rgba(255, 255, 114, 0.4)"),Z[U]==$&&(Z[U]="rgba(255, 255, 0, 0.3)"),Z[N]==$&&(Z[N]="rgba(255, 255, 0, 0)"),Z[r]==$&&(Z[r]=1),Z[y]==$&&(Z[y]=22),Z[B]==$&&(Z[B]=4),f.calculatePointLength=function(G,Q,z){var B=this.getDataUI(G),Y=I(B);return w(Y,Q,z)},F.calculatePointLength=function(e,q,c,H){var s=I($,e,q);return w(s,c,H)},F.calculateClosestPointOnLine=R,f.calculateClosestPoint=function(V,y){var H=this.getDataUI(V),w=I(H);return L(w,y)},F.calculateClosestPoint=function(l,J,P){var A=I($,l,J);return L(A,P)},f.getPercentAngle=function(d,f){var P=this.getDataUI(d),Z=I(P);return d.getRotation?d.getRotation():0,n(Z,f,d.getRotation?d.getRotation():0)},F.getPercentAngle=function(m,Y,x){var o=I($,m,Y);return n(o,x,0)},f.calculateLength=function(_){var J=this.getDataUI(_),L=I(J);return D(L)},F.calculateLength=function(y,O){var B=I($,y,O);return D(B)},f.getPercentPosition=function(F,e){var K=this.getDataUI(F),l=I(K);return m(l,e)},F.getPercentPositionOnPoints=function(r,G,d){var k=I($,r,G);return m(k,d)};var a=function(J){var L=J.data,q=this.dm();if(L&&"add"===J.kind){var g=q.$3e;g&&L.s(s)&&g.indexOf(L)<0&&g.push(L)}"clear"===J.kind&&(q.$3e=[])},o=function(i){var C=i.property,m=i.data,E=i.newValue,u=this.dm().$3e;if(u&&"s:flow"===C)if(E)u.indexOf(m)<0&&u.push(m);else for(var G=u.length,p=0;G>p;p++)if(u[p]===m){u.splice(p,1);break}},P=f.setDataModel;f.setDataModel=function(G){var p=this,k=p._dataModel;if(k!==G){k&&(k.umm(a,p),k.umd(o,p),k.$3e=[]),G.mm(a,p),G.md(o,p);var I=G.$3e=[];G.each(function(e){e.s(s)&&I.indexOf(e)<0&&I.push(e)}),P.call(p,G)}},A.getFlowElementSpace=function(){return this.s(j)};var Q=function(W){var A=this,I=A._data,o=I[b],H=I[p],c=I[x],r=I.s(E),w=0,j=A[q],L=I.s(u),v=I.s(O),s=I.s(J),D=I.s(B),Y=I.s(y),m=I.s(G),F=(Y-D)/(s-1),_=(L-v)/(s-1),h=I.getRotation?I.getRotation():0,K=I.getPosition?I.p():I.$10e,X=[],N=[];if(j!=$){if(1===s)X.push(L);else if(2===s)X.push(L),X.push(v);else{if(!(s>2))return;X.push(L);for(var S=s-2;S>0;S--)X.push(v+_*S);X.push(v)}if(1===s)N.push(Y);else if(2===s)N.push(Y),N.push(D);else{if(!(s>2))return;N.push(Y);for(var S=s-2;S>0;S--)N.push(D+F*S);N.push(D)}var n=0,f=0;X.forEach(function(X){s-1>n&&(f+=I.getFlowElementSpace(X)),n++}),f+=(L+v)/2,w=(o-r*f+f)/r,W.save();for(var S=0;r>S;S++){var i=j,M=0,Z=A._overCount,t=0;I.s("flow.autoreverse")&&Z&&Z>r-(S+1)||(i-=S*(w+f),n=0,X.forEach(function(T){var u=i-M;if(u>=0&&o>u){var Z=!0,B=e(u,H);t=0;for(var f=0;B>f;f++)t+=H[f];if(u-=t,Z){var C=k(c[B],u),F=h;if(m){for(var $=c[B],Y=0,y=0,J=0;J<$.length-1;J++){var x=$[J],r=$[J+1],s=r.x-x.x,V=r.y-x.y,b=Math.sqrt(s*s+V*V);if(Y+=b,Y>u){y=J;break}}var R=$[y];F+=Math.atan2(C.y-R.y,C.x-R.x)}h&&(C=g(K,C.x-K.x,C.y-K.y,h)),A.$5e(W,C,T,N[n],F)}}M+=I.getFlowElementSpace(X[n]),n++}))}W.restore()}},Wo=l._80o;l._80o=function(Y){Wo.call(this,Y);var J=this,U=J._data,a=J.gv;U.s(s)&&a.$7e!=$&&Q.call(J,Y)};var dl=h._80o;h._80o=function(l){dl.call(this,l);var R=this,K=R._data,i=R.gv;K.s(s)&&i.$7e!=$&&Q.call(R,l)};var oi=l._79o,Lg=h._79o,og=function(){var i=this,_=i._data,Q=_.s(u),X=!1,j=$;if(i._6I||(X=!0),j=_ instanceof d.Edge?oi.call(i):Lg.call(i),_.s(s)&&X){var M=_.s(y),v=_.s(r);v&&M>Q&&(Q=M),Q>0&&F.grow(j,Math.ceil(Q/2)),Y(i)}return!_.s(s)&&X&&(_[p]=_[b]=_[x]=i[q]=$),j};h._79o=og,l._79o=og,t.$5e=function(n,R,o,u,I){var v=this,s=v._data,C=v.gv,G=s.s(H),k=s.s(U),L=s.s(N),Y=s.s(r),c=C.$8e,E=s.s(X);if(c==$&&(c=C.$8e={}),n.beginPath(),E!=$){var m=F.getImage(E),P=o/2;n.translate(R.x,R.y),n.rotate(I),n.translate(-R.x,-R.y),F.drawImage(n,m,R.x-P,R.y-P,o,o,s),n.translate(R.x,R.y),n.rotate(-I),n.translate(-R.x,-R.y)}else if(C.__flowBatch){var B=C.__flowBatchGroup;B||(B=C.__flowBatchGroup={});var W=[R.x,R.y,o/2];B[G]?B[G].push(W):B[G]=[W]}else n.fillStyle=G,n.arc(R.x,R.y,o/2,0,2*Math.PI,!0),n.fill();if(Y){var Z=22,i=Z+"_"+k+"_"+L,e=c[i];if(e==$){var d=document.createElement("canvas");T.setCanvas(d,Z,Z);var h=d.getContext("2d"),b=Z/2,S=b,V=b;T.translateAndScale(h,0,0,1),h.beginPath();var t=h.createRadialGradient(S,V,0,S,S,b);t.addColorStop(0,k),t.addColorStop(1,L),h.fillStyle=t,h.arc(S,V,b,0,2*Math.PI,!0),h.fill(),e=c[i]=d}var P=u/2;F.drawImage(n,e,R.x-P,R.y-P,u,u,s)}},f.$9e=function(){var D=this,N=D.dm().$3e;D._24I,N.forEach(function(j){D._24I[j._id]=j}),D.iv()};var kg=c.prepareRemove;c.prepareRemove=function(q){kg.call(this,q);var z=q._dataModel,f=z.$3e;if(f)for(var Y=f.length,g=0;Y>g;g++)if(f[g]===q){f.splice(g,1);break}},f.setFlowInterval=function(b){var o=this,X=o.$11e;o.$11e=b,o.fp("flowInterval",X,b),o.$7e!=$&&(clearInterval(o.$7e),delete o.$7e,o.enableFlow(b))},f.getFlowInterval=function(){return this.$11e},f.enableFlow=function(F){var A=this,P=A.dm(),p=P.$3e;A.$7e==$&&(p.forEach(function(J){var u=A.getDataUI(J);Y(u)}),A.$7e=setInterval(function(){P.$3e.forEach(function(O){V(A.getDataUI(O))}),A.$9e()},F||A.$11e||50))},f.disableFlow=function(){var g=this;clearInterval(g.$7e),delete g.$7e;var V=g.dm().$3e;V&&g.$9e()};var vp=function(){this.__flowBatchGroup={}},zf=function(U){var _=this.__flowBatchGroup;if(_){U.save();for(var l in _){U.fillStyle=l,U.beginPath();var V=_[l];V.forEach(function(L){U.moveTo(L[0],L[1]),U.arc(L[0],L[1],L[2],0,2*Math.PI,!0)}),U.fill()}U.restore()}};f.setFlowBatch=function(C){var Z=this;!!Z.__flowBatch!=!!C&&(Z.__flowBatch=C,C?(Z.addBottomPainter(vp),Z.addTopPainter(zf)):(Z.removeBottomPainter(vp),Z.removeTopPainter(zf)))}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);