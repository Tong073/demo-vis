!function(V,T,z){"use strict";function O(K,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");K.prototype=T.create(e&&e.prototype,{constructor:{value:K,writable:!0,configurable:!0}}),e&&nh(K,e)}function A(e){var K=T.prototype.toString.call(e);return"Array]"===K.substring(K.length-6)}function u(q,T,L,k,K,x){T=T||[],L=L||[],k=k||[];try{T.push(q);var B=Function.apply(0,T);return L[L.length]="return "+B,Function.apply(0,L).apply(0,k)}catch(F){return x&&x(F),K}}function x(M){var Q={};return{get:function(o){if(Q[o]!==z)return Q[o];var O;switch(o){case"WEBGL_depth_texture":O=M.getExtension("WEBGL_depth_texture")||M.getExtension("MOZ_WEBGL_depth_texture")||M.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":O=M.getExtension("EXT_texture_filter_anisotropic")||M.getExtension("MOZ_EXT_texture_filter_anisotropic")||M.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":O=M.getExtension("WEBGL_compressed_texture_s3tc")||M.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||M.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":O=M.getExtension("WEBGL_compressed_texture_pvrtc")||M.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":O=M.getExtension("WEBGL_compressed_texture_etc1");break;default:O=M.getExtension(o)}return Q[o]=O,O}}}function s(T,C,A){function X(){if(D!==z)return D;var d=C.get("EXT_texture_filter_anisotropic");return D=null!==d?T.getParameter(d.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}function e(N){if("highp"===N){if(T.getShaderPrecisionFormat(T.VERTEX_SHADER,T.HIGH_FLOAT).precision>0&&T.getShaderPrecisionFormat(T.FRAGMENT_SHADER,T.HIGH_FLOAT).precision>0)return"highp";N="mediump"}return"mediump"===N&&T.getShaderPrecisionFormat(T.VERTEX_SHADER,T.MEDIUM_FLOAT).precision>0&&T.getShaderPrecisionFormat(T.FRAGMENT_SHADER,T.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var D;A=A||{};var b="undefined"!=typeof WebGL2RenderingContext&&T instanceof WebGL2RenderingContext,i=A.precision!==z?A.precision:"highp",f=e(i);f!==i&&(console.warn("WebGL:",i,"not supported, using",f,"instead."),i=f);var Z,P=A.logarithmicDepthBuffer===!0,y=T.getParameter(T.MAX_TEXTURE_IMAGE_UNITS),x=T.getParameter(T.MAX_VERTEX_TEXTURE_IMAGE_UNITS),a=T.getParameter(T.MAX_TEXTURE_SIZE),j=T.getParameter(T.MAX_CUBE_MAP_TEXTURE_SIZE),u=T.getParameter(T.MAX_VERTEX_ATTRIBS),Q=T.getParameter(T.MAX_VERTEX_UNIFORM_VECTORS),w=T.getParameter(T.MAX_VARYING_VECTORS),c=T.getParameter(T.MAX_FRAGMENT_UNIFORM_VECTORS),Y=x>0,G=b||!!C.get("OES_texture_float"),U=(b||!!C.get("OES_element_index_uint"))&&"undefined"!=typeof Uint32Array,L=Y&&G,W=b?T.getParameter(T.MAX_SAMPLES):0,g=!1;return b?g=!0:(Z=C.get("ANGLE_instanced_arrays"))&&(g=!0,T.vertexAttribDivisor=function(O,u){return Z.vertexAttribDivisorANGLE(O,u)},T.drawElementsInstanced=function(h,O,o,W,N){return Z.drawElementsInstancedANGLE(h,O,o,W,N)},T.drawArraysInstanced=function(x,r,F,u){return Z.drawArraysInstancedANGLE(x,r,F,u)}),{getMaxAnisotropy:X,getMaxPrecision:e,precision:i,logarithmicDepthBuffer:P,maxTextures:y,maxVertexTextures:x,maxTextureSize:a,maxCubemapSize:j,maxAttributes:u,maxVertexUniforms:Q,maxVaryings:w,maxFragmentUniforms:c,vertexTextures:Y,floatFragmentTextures:G,elementTypeUint:U,floatVertexTextures:L,maxSamples:W,instancedArray:g}}function K(Q,A){return Q.z!==A.z?A.z-Q.z:Q.id-A.id}var G="ht";if(!V[G]){!function(){Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),V.performance&&V.performance.now||function(){var A=Date.now();V.performance||(V.performance={}),V.performance.now=function(){return Date.now()-A}}();for(var K=Date.now(),W=16,$=["ms","moz","webkit","o"],E=0;E<$.length&&!V.requestAnimationFrame;++E)V.requestAnimationFrame=V[$[E]+"RequestAnimationFrame"],V.cancelAnimationFrame=V[$[E]+"CancelAnimationFrame"]||V[$[E]+"CancelRequestAnimationFrame"];V.requestAnimationFrame||(V.requestAnimationFrame=function(g){var b=Date.now(),e=W+K-b;return 0>e&&(e=0),K=b,V.setTimeout(function(){K=Date.now(),g(performance.now())},e)}),V.cancelAnimationFrame||(V.cancelAnimationFrame=function(M){return V.clearTimeout(M)}),T.assign===z&&(T.assign=function(j){if(j===z||null===j)throw new TypeError("Cannot convert undefined or null to object");for(var K=T(j),O=1;O<arguments.length;O++){var S=arguments[O];if(S!==z&&null!==S)for(var R in S)T.prototype.hasOwnProperty.call(S,R)&&(K[R]=S[R])}return K}),V.btoa===z&&(V.btoa=function(w){for(var M,k,u=String(w),L=0,x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",N="";u.charAt(0|L)||(x="=",L%1);N+=x.charAt(63&M>>8-8*(L%1))){if(k=u.charCodeAt(L+=.75),k>255)throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");M=M<<8|k}return N})}();var l,J,g,q,S=V.location,e=S&&V.document,I=null,D=z,B=V[G]={},y=V[G+"config"],R=B.Default=y&&y.Default||{},c=B.Style=y&&y.Style||{},h=B.Attr=y&&y.Attr||{},w=function(){return!0},Z=function(){return!1},d=function(q){return q},P=function(E){return!E},r=B.Color=y&&y.Color||{},b=B.IsGetter=y&&y.IsGetter||{};!function(){var u=!1;try{var w=T.defineProperty({},"passive",{get:function(){return u=!0,z}});S&&(g=l=S)&&V.addEventListener("test",w,w),S&&(q=J=S)&&V.removeEventListener("test",w,w)}catch(s){u=!1}R.passiveSupported=u}();var N,t,Q,v,E=R.passiveSupported,M=R.eventListenerOptionsFalse=E?{passive:!1,capture:!1}:!1,Y=R.eventListenerOptionsTrue=E?{passive:!1,capture:!0}:!0,j=function(O,c,h,P){O.addEventListener(c,h,P?Y:M)},W=function(h,R,I,D){h.removeEventListener(R,I,D?Y:M)},U=Math,H=U.round,C=U.floor,$=U.ceil,a=U.sqrt,o=U.max,X=U.min,i=U.abs,F=U.cos,p=U.acos,k=U.sin,m=U.pow,n=U.asin,_=U.exp,L=U.PI,f=2*L,pk=L/2,Le=U.tan,Wd=U.atan2,Mp=U.random,Ze=U.log,Fg=function(V,q,w){return Math.max(q,Math.min(w,V))},fn=m(2,1),Kk=!1,ip=V.parseInt||global.parseInt,og="2022-9-15",on=S&&(V.navigator?V.navigator.platform.indexOf("Win")>-1:!1),Tp=function(_){return _*_},hl=S&&V.setTimeout,xq=S&&V.clearTimeout,_r=S&&(V.navigator?V.navigator.userAgent.toLowerCase():""),Ub=function(w){return w.test(_r)},po=Ub(/msie/),dq=Ub(/msie/)||Ub(/trident/),Bp=Ub(/msie 10/),wm=Ub(/edge/),Ci=Ub(/firefox/),dn=Ub(/mac/),Jf=Ub(/mscAndroid/),gj=R.isTouchable===z?on?!1:e?"ontouchend"in e:!1:R.isTouchable,Oc="default",lo="single",He="multiple",Uj="front",Xo="back",xi="left",Dd="right",Vh="top",dd="bottom",Nq="center",Cc="eye",hi="middle",Yr="east",mj="west",lr="north",xj="none",Mq="px",bg="absolute",Qf="border",fh="triangle",fk="rect",Zl="circle",Rl="cylinder",$l="shape",Pf="items",bb="normal",Ib="remove",jr="clear",xo="width",jc="height",Uo="ingroup",oo="check",Wc="uncheck",Tq="radio",mf="radioOn",ik="radioOff",vr="points",tq="values",ep="series",Qk="body",sm="label",zl="label2",Si="note",bl="note2",Vp="icons",pf="labelFont",Zc="labelColor",Ar="labelSelectColor",yg="note.expanded",wq="note2.expanded",pi="edge.expanded",Sd="edge.points",bq="edge.type",zh="rotation",dm="hidden",nb="visible",$d="tuv",md="no",Op="draw",Eg="select",Oe="currentSubGraph",Gr="selectBackground",Il="autoMakeVisible",vs="autoHideScrollBar",Nr="scrollBarColor",Pk="scrollBarSize",rk="indent",Fm="rowHeight",yf="columnLineColor",im="rowLineColor",xl="columnLineVisible",gc="rowLineVisible",mm="visibleFunc",Kh="expandIcon",Ld="collapseIcon",rr="checkMode",Ai="sortFunc",sq="editable",Yl="batchEditable",Ed="tristate",en="asc",wd="desc",qo="position",Aq="__",Tl="elevation",Pc="children",_h="translateX",Gp="translateY",Bb="dataModel",ll="maxSize",xh="enc",Ph="state",tr=xh+"o"+"de",_p="shape3d",Go="shape3d.resolution",io="shape3d.visible",cg="shape3d.from.visible",Rd="shape3d.to.visible",eq="shape3d.top.visible",qp="shape3d.bottom.visible",ji="repeat.uv.length",Yd="serializeValue",Xm="deserializeValue",ws="centerUniform",gm="uniform",Fb="rgba(255,255,255,0)",cn="style",kr="attr",Rh="field",Oh="string",gq="boolean",_b="color",ni="int",Vj="number",ub="ew-resize",pj="ns-resize",Tr="pointer",Lc="auto",Bj="mousedown",ho="mousemove",ec="mouseup",wl="mouseout",ls="touchstart",vj="touchmove",qd="touchend",Qi="keydown",Di="keyup",ye=["DOMMouseScroll","mousewheel"],Im=Ci?ye[0]:ye[1],Cp=Aq+G+Aq+tr,qn=[ls,vj,qd],Vf=[Bj,ho,ec,wl,Im,"wheel","mouseenter","mouseleave","mouseover"],em=[Qi,Di,"keypress","input","contextmenu","compositionstart","compositionupdate","compositionend"],Qg=gj?qn.concat(em):Vf.concat(em),Ki=I,Rq=I,Lb=I,Wi=I,yi=!1,To=ec.length,Yi=function(){Lb&&(xq(Lb.timeout),Lb=I)},Gl=function(){Lb&&kb(Lb.e,Lb.info)};V.addEventListener&&(D=S)&&(gj||(j(V,wl,function(){Yi()}),j(V,Im,function(){xf()})),j(V,Di,function(F){91===F.keyCode?_i={}:delete _i[F.keyCode]},!0),j(V,Qi,function(F){_i[F.keyCode]=!0},!0),j(V,"blur",function(){_i={}}));var no,ei,rd,ol=0,Ek=I,Wq=function(A,g){var G=hl(function(){delete Ek[G],Jb(Ek)&&(Ek=I),A()},g);return G},zn=I,Xb=I,Ej={},rb={},xg={},nn={},rp={},of={},_i={},iq={},op={},Hc={},Fj={},Jq=/.json$/,Wl=/\.(json|bin)$/,Mr=/^data:image\/svg\+xml/,Ic={},fl=[],El={},vm=I,hc=I,No=function(){},Dm=function(){throw"Oops!"},Wb=[0,0,0],Mn={x:0,y:0,width:0,height:0},Or=I,oe=I,jj=I,Pi=function(I,k){rb[I]=k,k&&k.comps&&!k.uuid&&(k.uuid=B.Math.generateUUID()),Ig[I]&&(k.cacheRule=Ig[I],delete Ig[I])},Rf=function(N){oe&&!N._72O&&(jj||(jj={}),jj[N._72O=Bi()]=N),no!=I?Qq()<.05&&v&&!ei&&(sp=Yi):sp=ki},wh=function(W,c,d,t){oe||(oe={});var V=oe[W];if(V){if(V.url===c)return;V.image?(V.image.onload=No,V.image.onerror=No):V.request&&(V.request.onload=No,V.request.onerror=No)}if(Jq.test(c)){var x=new nc;if(oe[W]={request:x,url:c},c=R.beforeLoadURL(c,W),c.data){var h=R.parse(c.data);Ll(W,h),R.handleImageLoaded(W,h)}else{x.onload=function(){if(200===this.status||0===this.status){var o=R.parse(x.getResponseText());Ll(W,o),R.handleImageLoaded(W,o)}else Ll(W,R.handleUnfoundImage(W,c)||I)},x.onerror=function(){Ll(W,R.handleUnfoundImage(W,c)||I)};var M={};M.url=encodeURI(c),M.sync=!1,x.send(M)}}else{var h=new Image;oe[W]={image:h,url:c},/^data:image/.test(c)||(c=R.beforeLoadURL(c,W),c=R.appendTimeStamp(c),c=encodeURI(c),h.crossOrigin=R.crossOrigin),R.convertImageSrc(c,function(K){dq&&(c.toLowerCase().indexOf(".svg")>0||Mr.test(c))?(e.body.appendChild(h),h.style.visibility="hidden",h.onload=function(){hl(function(){if(d&&(h.width=d),t&&(h.height=t),!h.width||!h.height){var U=h.width||h.clientWidth,b=h.height||h.clientHeight;h.width=U,h.height=b}R.handleImageLoaded(W,h),Ll(W,h),e.body.removeChild(h),h.style.visibility=""},180)},h.onerror=function(){Ll(W,R.handleUnfoundImage(W,c)||I),e.body.removeChild(h),h.style.visibility=""}):(h.onload=function(){d&&(h.width=d),t&&(h.height=t),R.handleImageLoaded(W,h),Ll(W,h)},h.onerror=function(){Ll(W,R.handleUnfoundImage(W,c)||I)}),h.src=K})}},Ll=function(G,d){if(Pi(G,d),delete oe[G],Jb(oe)&&(oe=I,jj)){for(var O in jj){var K=jj[O];K._2O&&K._2O[G]&&(K.deleteTexture(G),delete K._2O[G]),K.invalidateAll&&K.invalidateAll(z,"imageLoaded",G),K.redraw&&K.redraw(),K.iv(),d&&d.layoutAttach&&Hn(K.dm)&&K.dm().updateLayoutAttach(G),delete K._72O}jj=I}if(d&&jj)for(var O in jj){var K=jj[O];K.invalidateAll&&K.invalidateAll(z,"imageLoading",G),K.redraw&&K.redraw(),K.iv(),d.layoutAttach&&Hn(K.dm)&&K.dm().updateLayoutAttach(G)}},xn=function(){return Ze=U&&Date,function(){return V.performance&&V.performance.now?V.performance.now():Date.now()}}(),hh=function($,f,l){return{width:$,height:f,comps:ar(l)?l:[l]}},hs=function(H,Q){return{type:Zl,rect:[H,Q,1.6,1.6],borderWidth:1,borderColor:Ch,gradient:tf,gradientColor:Eo,background:Ch}},Bc=function(i,Q){return hh(16,16,{type:fh,rect:[4,4,10,8],background:i,rotation:Q?1.57:3.14})},rh=function(B,l){return hh(16,16,{type:fh,rect:[4,4,8,7],background:B,rotation:l?3.14:0})},Cg=function(I){var G=I._orientation;return"horizontal"===G||"h"===G},mc=function(M,G){var c=I||4,g=I||1,Y=I||1;0>c?c=0:c>.25&&(c=.25);var P,A,v,S,e,V,u,o=.5,r=[],$=[],C=[],q=f/Y,Z=f/g,D=o-c;for(A=0;g>=A;A++)for(S=-L+A*Z,V=F(S),e=k(S),P=0;Y>=P;P++)v=P*q,u=D+c*V,r.push(F(v)*u,e*c,-k(v)*u),(t=[M,G])&&$.push(P/Y,1-A/g);for(A=0;g>A;A++){var z=A*(Y+1),X=(A+1)*(Y+1);for(P=0;Y>P;P++)C.push(z+P,X+P+1,X+P,z+P,z+P+1,X+P+1),cb.z=Cl.z=[M,G]}},Ym=function(m){var O=2,q=0;for(var h in m)h.length===O&&ip(h,32)===kq&&(vm=hc=m[h]),q++;return q},dp=function(J,z,_,Y){return _||(_=gj?5:3,_/=Y||1),{x:J-_,y:z-_,width:2*_,height:2*_}},Nj=function(y,R,i,T){var x=this;R||(R=gj?5:3,i=20,T=20);var k={x:y,y:R,width:i,height:T};if(i)for(var G=0;i>G;G++)if(3===i)T=20;else for(var Y=0;T>Y;Y++)x=V?V:i;var C={x:L,y:2*L};if(cj(k,C)){var b=jc[0]+Vh[0]+jr[1]+en.length,F=dm[0]+Ed[0]+jr[1]+Qk.length;Wj[Cc]=[x[b],x[F]],x[b]=uo[Cc],x[F]=uo[_p]}},_d=function(X){return(/ble$/.test(X)||/ed$/.test(X)||b[X]?"is":"get")+X.charAt(0).toUpperCase()+X.slice(1)},uo=function(L){return"set"+L.charAt(0).toUpperCase()+L.slice(1)},Fc=function(v){return typeof v===Oh||v instanceof String},gs=function(O){return typeof O===Vj},ki=function(L){return typeof L===gq},Pd=function(c){return c&&"object"==typeof c},Hn=function(I){return"function"==typeof I},ar=function(J){return J instanceof Array},vq=function(F){return F instanceof Gk},zk=function($){return ar($)?new Gk($):$},Dg=function(J){return J instanceof nl},kh=function(e){return e instanceof Qb},wp=function(S){return S instanceof we},ke=function(L,Z){if(!(L instanceof B.Group))return!1;if(!Z)return L.isExpanded();var E=Z.getDataUI(L);return E&&E._88I?!0:!1},Me=function(i){return i instanceof Xl},tk=function(B){return B&&"IFRAME"===B.tagName},Hd=function(G){return G==I||R.numberDigits==I?G:parseFloat(G.toFixed(R.numberDigits))},uh=function(u,p,X){var v,x=p.length;if(X)for(var Z=0;X>Z;Z++)if(3===x)u.push(p[0]),u.push(p[1]),u.push(p[2]);else for(v=0;x>v;v++)u.push(p[v]);else if(3===x)u.push(p[0]),u.push(p[1]),u.push(p[2]);else for(v=0;x>v;v++)u.push(p[v])},wj=function(S){return S?Pd(S)?S:{}:!1},Wn=function(y,l,m){var e,Z=Pd(y)?y:y.prototype;for(e in l)m&&e in Z?Z[e]===z&&console.warn("class",Z,"has own undefined property",e,", keep exist!"):Z[e]=l[e];return y},Sm=function(c,T){if(!("wheelDelta"in T)){var U=T.deltaMode;T.wheelDelta=U===T.DOM_DELTA_PIXEL?-T.deltaY:U===T.DOM_DELTA_LINE?40*-T.deltaY:120*-T.deltaY}c.handle_mousewheel(T)},qe=function(e){return String.fromCharCode(e)},Id=function(J){for(var g,A=0,X="";A<J.length;A++)g=J[J.length-1-A],"%"===g?g="'":"a"===g?g='"':"]"===g&&(g="\\"),X+=qe(g.charCodeAt(0)-1);return X},yd=function(j,d,Y){j.superClass.constructor.apply(d,Y)},Jb=function(z){for(var Q in z)return!1;return!0},Bd=function(a){return a?0===a.length:!0},is=function(){var V="";return[Wc[0],im[0],sm[0]].forEach(function(p){V+=uo(p).slice(3)}),gm=e&&e[V]||ws,function(u,i){return u===i?!0:u.x===i.x&&u.y===i.y&&u.width===i.width&&u.height===i.height}}(),Lj=function(s,F,_){return F>s?F:s>_?_:s},oh=function(a){return 0>a?-1:a>0?1:0},Qq=function(){var J=1e4*k(To++);return J-C(J)},Mm=function(S,k,u){return ek(S.x,S.y,k.x,k.y,u.x,u.y,u.x+u.width,u.y,!0)||ek(S.x,S.y,k.x,k.y,u.x+u.width,u.y,u.x+u.width,u.y+u.height,!0)||ek(S.x,S.y,k.x,k.y,u.x+u.width,u.y+u.height,u.x,u.y+u.height,!0)||ek(S.x,S.y,k.x,k.y,u.x,u.y+u.height,u.x,u.y,!0)},ek=function(N,c,T,L,p,d,M,h,a){var W=(M-p)*(c-d)-(h-d)*(N-p),i=(h-d)*(T-N)-(M-p)*(L-c);if(0!==i){var _=W/i,R=N+_*(T-N),f=c+_*(L-c);return a&&(R+xk<X(N,T)||R-xk>o(N,T)||R+xk<X(p,M)||R-xk>o(p,M)||f+xk<X(c,L)||f-xk>o(c,L)||f+xk<X(d,h)||f-xk>o(d,h))?I:[R,f]}return I},ie=function(r,n,h){if(r&&h)if(n){if(n===cn)return r.getStyle(h);if(n===kr)return r.getAttr(h);if(n===Rh)return r[h]}else if(h=_d(h),r[h])return r[h]();return z},Se=function(E,k,J,x){if(E&&J)if(k){if(k===cn)E.s(J,x);else if(k===kr)E.a(J,x);else if(k===Rh){var Z=E[J];E[J]=x,E.fp("f:"+J,Z,x)}}else J=uo(J),E[J]&&E[J](x)},ur=function(K,P,r){var q=100*Math.max(K.width,K.height);return P&&"top"!==P?"bottom"===P?{x:K.x-q,y:K.y-q,width:K.width+2*q,height:K.height*r+q}:"right"===P?{x:K.x-q,y:K.y-q,width:K.width*r+q,height:K.height+2*q}:"left"===P?{x:K.x+K.width*(1-r),y:K.y-q,width:K.width*r+q,height:K.height+2*q}:void 0:{x:K.x-q,y:K.y+K.height*(1-r),width:K.width+2*q,height:K.height*r+q}},Hq=function(X,Y,F,c,D){Y&&gk(X,F,c,1,D,Y)},ae=function(g,C,j,G){var Y=1-g;return Y*Y*C+2*g*Y*j+g*g*G},cb=function(S,n,v,Y,h){var A=1-S;return A*A*A*n+3*A*A*S*v+3*A*S*S*Y+S*S*S*h},lj=function(C){var m,A,u,F,p=0;return C.forEach(function(k){if(m=k.length,m>0)for(A=k[0],F=1;m>F;F++)u=k[F],p+=Jc(A,u),A=u}),p},bo=function(d,E,b){var S="__"+d,X=function(x){("mousedown"===d||"mouseup"===d||"touchstart"===d||"touchend"===d)&&Fe(x),b.disabled||b["handle_"+d](x)};b[S]||(b[S]=X,j(E,d,X))},Vq=function(f,i,e){var Y="__"+f,q=e[Y];q&&(W(i,f,q),delete e[Y])},Yh=function(X,q){var l="_"+q;X[_d(q)]=function(){return this[l]},X[uo(q)]=function(R){var j=this[l];this[l]=R,this.fp(q,j,R)}},ml=function(k){return T.create(k)},ym=function(g){if(!g.element){var G,w;(G=g.textField)?w=Ih(It.TextField,G):(G=g.textArea)?w=Ih(It.TextArea,G):(G=g.button)?w=Ih(It.Button,G):(G=g.comboBox)?w=Ih(It.ComboBox,G):(G=g.checkBox)?w=Ih(It.CheckBox,G):(G=g.radioButton)?w=Ih(It.RadioButton,G):(G=g.slider)?w=Ih(It.Slider,G):(G=g.colorPicker)?w=Ih(It.ColorPicker,G):(G=g.image)&&(w=Ih(It.Image,G)),w&&(g.element=w)}},Fd=function(K,x){var R=eg(K);return R._ht=x,R},qg=V.top===V?V.top:V||V.document,eg=function(M,x){var Y=e.createElement("div"),H=Y.style;return Y.tabIndex=-1,Y.onkeydown=cl,H.msTouchAction=xj,ch(Y,I,0),gj&&H.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",I),M&&(H.overflow=dm),x&&Ul(x,Y),Y},On=function(q,z){var R=e.createElement("canvas"),i=R.style;return i.msTouchAction=xj,z||(i.pointerEvents=xj),ch(R,I,0),q&&Ul(q,R),R},ch=function(u,r,b){var e=u.style;e.border=r?r+" solid 1px":0,e.outline=0,e.padding=b?"0 "+b+Mq:0,al(u)},al=function(J){var m=J.style;m.position=bg,m.margin=0,m.setProperty("box-sizing","border-box",I),m.setProperty("-moz-box-sizing","border-box",I)},Jk=function(H,P,f,F){F||(F=Gn),P!=I&&(H.width=P*F,H.style.width=P+Mq),f!=I&&(H.height=f*F,H.style.height=f+Mq)},Ul=function(k,l,K){k.appendChild(l),K&&(l.style.position=bg)},Yj=function($,K){K.split||(K+="");for(var Y,P=K.split("\n"),v=0,q=P.length,i=0;q>i;i++){var e=Pb($.font,P[i]);e.width>v&&(v=e.width),Y||(Y=e.height)}return $.ss=P,{width:v,height:Y*q}},qm=function(){var L=e?On().getContext("2d"):I;return function(T,t,p,C,o,M){var F=T.split("\n"),k=[],U=Pb(p,T).height;return C||(C=0),L.font=p,L.textBaseline=Vh,F.forEach(function(V){for(var f=0,X=1,n=0,D=V.length;D>=X;X++){var v=V.substring(f,X),Q=o?L.measureText(V[X]):Pb(p,v);o&&(n+=Q.fontBoundingBoxDescent||U);var F=o?n+(v.length-1)*M:Q.width+(v.length-1)*C;F>t&&(X-1===f?(k.push(V.substring(f,X)),f=X):(k.push(V.substring(f,X-1)),f=X-1,X--),n=0)}f!==X-1&&k.push(V.substring(f,X))}),k}}(),ak=function(x,f,p,b,_,y,$,z){x.font=p;var s=x.measureText(f);if(x.beginPath(),x.strokeStyle=b,x.lineWidth=1,"underline"===z){var n;n=s.actualBoundingBoxDescent?s.actualBoundingBoxDescent+1:Pb(p,f).size/2,x.moveTo(_-$/2,y+n),x.lineTo(_+$/2,y+n)}else if("strikethrough"===z)x.moveTo(_-$/2,y),x.lineTo(_+$/2,y);else if("overline"===z){var n;n=s.fontBoundingBoxAscent?s.fontBoundingBoxAscent:Pb(p,f).size/2,x.moveTo(_-$/2,y-n),x.lineTo(_+$/2,y-n)}x.stroke()},Yo=function(c,U,H,k,C,d,z,Y,g,V,L){var T=C.x,$=C.y,N=C.width,f=C.height;if(U!=I){var _=Pb(H,U),P={};g&&(_.width+=(U.length-1)*g),P.y=z&&z!==hi?z===Vh?$+_.height/2:$+f-_.height/2:$+f/2,P.x=d&&d!==xi?d===Dd?T+N-_.width/2:T+N/2:T+_.width/2,yj(c,U,P,H,k,g,V,L),Y&&ak(c,U,H,k,P.x,P.y,_.width,Y)}},Pm=function(X,l,F,z,N,x,A,n,H,p){var f=l.length;if(1===f){var S=l[0];if(yj(X,S,F,z,N,n,H,p),A){var G=Pb(z,S);ak(X,S,z,N,F.x+F.width/2,F.y+F.height/2,G.width,A)}}else for(var D=F.height/f,g={x:F.x,y:F.y,width:F.width,height:D},b=0;b<l.length;b++){if(x)Yo(X,l[b],z,N,g,x,null,A,n,H,p);else if(yj(X,l[b],g,z,N,n,H,p),A){var G=Pb(z,l[b]);ak(X,l[b],z,N,g.x+g.width/2,g.y+g.height/2,G.width,A)}g.y+=D}},yj=function(F,M,e,T,W,G,n,p){F.font=T?T:sd,F.fillStyle=W?W:wk,F.textAlign=Nq,F.textBaseline=hi;var l,P;e?e.width===z?(l=e.x,P=e.y):(l=e.x+e.width/2,P=e.y+e.height/2):(l=0,P=0);var r=n&&p;if(r&&(F.strokeStyle=p,F.lineWidth=n),G){var t=Pb(T,M);l-=(t.width+G*(M.length-1))/2;for(var A=(M+"").length,Q=0;A>Q;Q++){var J=M[Q],j=F.measureText(J);r&&F.strokeText(J,H(l+(j.width+4)/2),H(P)),F.fillText(J,H(l+(j.width+4)/2),H(P)),l+=j.width+G}}else r&&F.strokeText(M,H(l),H(P)),F.fillText(M,H(l),H(P))},ao=function(N){N.getView&&(N=N.getView());var d=N.offsetWidth||N.scrollWidth;return!d&&N.style.width&&(d=ip(N.style.width)),d},el=function(M){M.getView&&(M=M.getView());var g=M.offsetHeight||M.scrollHeight;return!g&&M.style.height&&(g=ip(M.style.height)),g},Od=function(A,M,J){var L=M[0].toUpperCase()+M.substring(1,M.length);A["webkit"+L]=J,A["moz"+L]=J,A["ms"+L]=J,A["o"+L]=J,A[M]=J},sl=function(){var d=function(X){cl(X),X.stopPropagation()},s=function(e){cl(e)},u=[ls,Qi,Bj];return function(z,T){var l=eg(),o=l.style;return o.backgroundColor=R.disabledBackground,z&&(o.backgroundImage="url("+z+")",o.backgroundPosition="50% 50%",o.backgroundRepeat="no-repeat no-repeat"),T===!1?u.forEach(function(p){j(l,p,s)}):u.forEach(function(K){j(l,K,d)}),l}}(),lc=function(Y){var W=Y.getContext("2d");return W.save(),W.lineCap=Lk,W.lineJoin=zo,W},sp=function(i,l,e,f){or(i,l*Gn,e*Gn),f*=Gn,1!==f&&i.scale(f,f)},or=function(U,D,S){U.translate(D,S)},Aj=function(l,z){z&&l.rotate(z)},qs=function(p,H,B){H===z&&(H=1),B===z&&(B=1),(1!==H||1!==B)&&p.scale(H,B)},vo=!1,_=qg[oo[1]+_h[0]],Sk=function(O){var o=e.activeElement;if(e.activeElement!==O){o&&o.forceOnblur&&o.forceOnblur();for(var W=[],y=O.parentNode;y;)W.push([y,y.scrollLeft,y.scrollTop]),y=y.parentNode;if(!vo){var G=[],s=[];try{for(var z=V.parent,E=V;z!==E;)G.push([z,z.scrollX,z.scrollY]),E=z,z=V.parent;var Q=V.frameElement;if(Q)for(var B=Q.parentNode;B;)s.push([B,B.scrollLeft,B.scrollTop]),B=B.parentNode}catch(A){vo=!0}}if(gj)O.focus();else{var t=Ff(),U=t.target;O.focus(),U.scrollLeft=t.left,U.scrollTop=t.top}W.forEach(function(P){P[0].scrollLeft=P[1],P[0].scrollTop=P[2]}),vo||(G.forEach(function(E){E[0].scrollTo(E[1],E[2])}),s.forEach(function(p){p[0].scrollLeft=p[1],p[0].scrollTop=p[2]}))}},ue=function(X){return X&&X.getView?X.getView():X},Ae=function(K,x,h,V,v){if(2===arguments.length&&(h=x.y,V=x.width,v=x.height,x=x.x),K.isSelfViewEvent)K.setX(x),K.setY(h),K.setWidth(V),K.setHeight(v);else{var J=ue(K),s=J.style;if((e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement)!==J)x!==z&&(s.left=x+Mq),h!==z&&(s.top=h+Mq),V!==z&&(s.width=V+Mq),v!==z&&(s.height=v+Mq);else{var n=R.getWindowInfo();s.left=(x=n.left)+Mq,s.top=(h=n.top)+Mq,s.width=(V=n.width)+Mq,s.height=(v=n.height)+Mq}K.endEditing&&!gj&&K.endEditing(),K.redraw&&K.redraw(),K.invalidate&&K.invalidate(),K.onLayouted&&K.onLayouted(x,h,V,v),K.fireViewEvent&&K.fireViewEvent("layout")}},Vc=function(l){if(!l.touches)return l;var d=l.touches[0];return d?d:l.changedTouches[0]},kp=function(Y){return gp(Y)?Vc(Y).target:Y.target},gp=function(K){return K&&"object"==typeof K&&"touches"in K},gf=function(B){R.popup&&R.popup.close(),R.popup=B},_l=I,Nm=function(X){_l.handleWindowTouchMove(X)},Sc=function(H){_l.handleWindowTouchEnd(H),W(V,vj,Nm),W(V,qd,Sc),W(V,"blur",Sc),_l=I},tb=function(o){_l.handleWindowMouseMove(o)},gn=function(T){_l.handleWindowMouseUp(T),W(V,ho,tb),W(V,ec,gn),W(V,"blur",gn),_l=I},Om=function(f){return 1===Gg(f)},Bh=function(N,m){return m?m.keyCode===N:_i[N]},bm=function(e){return Bl(e)&&Bh(65,e)},Zr=function(N){return Bh(46,N)||Bh(8,N)},_c=function(x){return function(o){return o?o.keyCode===x:_i[x]}},kq=573,Ye=[65,83,68,87,37,38,39,40,32,13,27],Ce=_c(Ye[0]),$b=_c(Ye[1]),Mf=_c(Ye[2]),Fi=_c(Ye[3]),so=_c(Ye[4]),Kc=_c(Ye[5]),lf=_c(Ye[6]),Yb=_c(Ye[7]),tl=_c(Ye[8]),$r=_c(Ye[9]),Nn=_c(Ye[10]),vc={65:1,83:1,68:1,87:1,37:1,38:1,39:1,40:1},yc=[2,2,2,2,2,2,2,2,2,2,3,3,5,5,5,5,5,17,43,79],bp=I,cm=I,sb=function(b,q){bp||(bp=On()),Jk(bp,b,q,1);var S=lc(bp);return S.clearRect(0,0,b,q),S},pb=function(v,Y,z){if(Y&&v){if("override"===z)return Y;if("override_rgb"===z){var o=$m(Y);return v=Qm(v),"rgba("+H(255*o[0])+","+H(255*o[1])+","+H(255*o[2])+","+v[3]/255+")"}if("override_a"===z){var o=$m(Y);return v=Qm(v),"rgba("+v[0]+","+v[1]+","+v[2]+","+o[3]+")"}if("multiply_destinationAtop"===z){var T=sj($m(v)),x=T[3],D=sj($m(Y)),d=D[3],V=sj(T),g=V[3],J=T.map(function(f,Z){return f*D[Z]}),Q=1-x,h=1-d,K=h*x+d;return T=T.map(function(g,A){return(d*Q*D[A]+d*x*J[A]+h*x*g)/K}),x=K,Q=1-x,T=T.map(function(I,v){return(g*V[v]*Q+x*I*g)/g}),x=g,"rgba("+H(255*T[0])+","+H(255*T[1])+","+H(255*T[2])+","+x+")"}var o=$m(Y);return v=Qm(v),"rgba("+H(v[0]*o[0])+","+H(v[1]*o[1])+","+H(v[2]*o[2])+","+v[3]/255*o[3]+")"}return v},Qm=function(){var B,Q={};for(var U in V){var G=He.length;if(U.length==G&&U[0]===He[2]&&U[1]===xj[1]&&U[4]===He[3]&&U[5]===He[4]&&U.substr(G-2)===xj[1]+xj[2]){var W=V[U];for(var H in W)H.length===G&&H.substr(0,3)===Dd[3]+Ib[3]+Eg[0]&&H.substr(G-2)===He[0]+Si[3]&&(ye=W[H])}}return function(a){var N,j=Q[a];return j||(B||(B=On(),Jk(B,1,1,1)),N=B.getContext("2d"),N.clearRect(0,0,1,1),gk(N,0,0,1,1,a),j=N.getImageData(0,0,1,1).data,j=Q[a]=[j[0],j[1],j[2],j[3]]),j}}(),$m=function(Y){if(!Fc(Y))return Y;var R=Qm(Y);return R.CA||(R.CA=[R[0]/255,R[1]/255,R[2]/255,R[3]/255]),R.CA},Nh=function(C,n,y,P,l){var _=On();_.width=y,_.height=P;var g=_.getContext("2d");g.drawImage(C,0,0,y,P);try{for(var E=g.getImageData(0,0,y,P),F=E.data,W=0,f=F.length;f>W;W+=4){var x=F[W+0],a=F[W+1],v=F[W+2],L=F[W+3];"override_a"===l?F[W+3]=255*n[3]:"override_rgb"===l?(F[W+0]=255*n[0],F[W+1]=255*n[1],F[W+2]=255*n[2]):"override"===l?(F[W+0]=255*n[0],F[W+1]=255*n[1],F[W+2]=255*n[2],F[W+3]=255*n[3]):(F[W+0]=n[0]*x,F[W+1]=n[1]*a,F[W+2]=n[2]*v,F[W+3]=n[3]*L)}g.putImageData(E,0,0)}catch(c){return C}return _},Wj=function(x,H,y){return H&&(H="miter"===y?8*H+20:H+1,x&&xs(x,H)),H},Sh=function(E,$){if($){var i=new Mc($),G=E.width/2,Z=E.height/2,T=Gj([i.tf(-G,-Z),i.tf(G,-Z),i.tf(G,Z),i.tf(-G,Z)]);return T.x+=E.x+G,T.y+=E.y+Z,T}return E},Al=function(J,T,G,x,D,N,f,E){x*=Math.PI/180;var m={x:Math.cos(x)*(J.x-f.x)/2+Math.sin(x)*(J.y-f.y)/2,y:-Math.sin(x)*(J.x-f.x)/2+Math.cos(x)*(J.y-f.y)/2},Y=Math.pow(m.x,2)/Math.pow(T,2)+Math.pow(m.y,2)/Math.pow(G,2);Y>1&&(T*=Math.sqrt(Y),G*=Math.sqrt(Y));var c=(D==N?-1:1)*Math.sqrt((Math.pow(T,2)*Math.pow(G,2)-Math.pow(T,2)*Math.pow(m.y,2)-Math.pow(G,2)*Math.pow(m.x,2))/(Math.pow(T,2)*Math.pow(m.y,2)+Math.pow(G,2)*Math.pow(m.x,2)));isNaN(c)&&(c=0);var U={x:c*T*m.y/G,y:c*-G*m.x/T},R={x:(J.x+f.x)/2+Math.cos(x)*U.x-Math.sin(x)*U.y,y:(J.y+f.y)/2+Math.sin(x)*U.x+Math.cos(x)*U.y},o=function(P){return Math.sqrt(Math.pow(P[0],2)+Math.pow(P[1],2))},t=function(n,j){return(n[0]*j[0]+n[1]*j[1])/(o(n)*o(j))},i=function(X,U){return(X[0]*U[1]<X[1]*U[0]?-1:1)*Math.acos(t(X,U))},s=i([1,0],[(m.x-U.x)/T,(m.y-U.y)/G]),S=[(m.x-U.x)/T,(m.y-U.y)/G],r=[(-m.x-U.x)/T,(-m.y-U.y)/G],v=i(S,r);t(S,r)<=-1&&(v=Math.PI),t(S,r)>=1&&(v=0);var t=T>G?T:G,V=T>G?1:T/G,b=T>G?G/T:1;if(null==E){var q={x:0,y:0,width:0,height:0};xs(q,t),q.x*=V,q.width*=V,q.y*=b,q.height*=b;var y=new Mc(x);return q=Gj([y.tf(q.x,q.y),y.tf(q.x+q.width,q.y),y.tf(q.x+q.width,q.y+q.height),y.tf(q.x,q.y+q.height)]),q.x+=R.x,q.y+=R.y,[{x:q.x,y:q.y},{x:q.x+q.width,y:q.y},{x:q.x+q.width,y:q.y+q.height},{x:q.x,y:q.y+q.height}]}E.translate(R.x,R.y),E.rotate(x),E.scale(V,b),E.arc(0,0,t,s,s+v,1-N),E.scale(1/V,1/b),E.rotate(-x),E.translate(-R.x,-R.y)},jo=function(j,S){j&&j.beginPath();for(var A,T,d,p=[],t=function($){for(var J,B=/(\-{0,1}[\d\.]+)/gi,D=[];J=B.exec($);)D.push(parseFloat(J[0]));return D},m=/([MmLlHhVvCcSsQqTtAa]{1}[\d\.,\s\-Zz]*)/gi,a={x:0,y:0};A=m.exec(S);){var X=A[0],B=X.substr(0,1);if("M"===B||"m"===B){for(var K=t(X),M=0;M<K.length;M+=2){var V=K[M],e=K[M+1];"m"===B&&(V+=a.x,e+=a.y),j&&j.moveTo(V,e),p.push({x:V,y:e}),a.x=V,a.y=e}T=d=null}else if("H"===B||"h"===B){for(var K=t(X),M=0;M<K.length;M+=1){var V=K[M];"h"===B&&(V+=a.x),j&&j.lineTo(V,a.y),p.push({x:V,y:a.y}),a.x=V}T=d=null}else if("C"===B||"c"===B){for(var K=t(X),M=0;M<K.length;M+=6){var w=K[M],G=K[M+1],h=K[M+2],c=K[M+3],V=K[M+4],e=K[M+5];"c"===B&&(w+=a.x,G+=a.y,h+=a.x,c+=a.y,V+=a.x,e+=a.y),j&&j.bezierCurveTo(w,G,h,c,V,e),p.push({x:w,y:G}),p.push({x:h,y:c}),p.push({x:V,y:e}),a.x=V,a.y=e}T=[w,G,h,c,V,e],d=null}else if("S"===B||"s"===B){for(var K=t(X),M=0;M<K.length;M+=4){var w,G;T?(w=2*T[4]-T[2],G=2*T[5]-T[3]):(w=a.x,G=a.y);var h=K[M],c=K[M+1],V=K[M+2],e=K[M+3];"s"===B&&(h+=a.x,c+=a.y,V+=a.x,e+=a.y),j&&j.bezierCurveTo(w,G,h,c,V,e),p.push({x:w,y:G}),p.push({x:h,y:c}),p.push({x:V,y:e}),a.x=V,a.y=e}T=[w,G,h,c,V,e],d=null}else if("Q"===B||"q"===B){for(var K=t(X),M=0;M<K.length;M+=4){var w=K[M],G=K[M+1],V=K[M+2],e=K[M+3];"q"===B&&(w+=a.x,G+=a.y,V+=a.x,e+=a.y),j&&j.quadraticCurveTo(w,G,V,e),p.push({x:w,y:G}),p.push({x:V,y:e}),a.x=V,a.y=e}T=null,d=[w,G,V,e]}else if("T"===B||"t"===B){for(var K=t(X),M=0;M<K.length;M+=2){var w,G;d?(w=2*d[2]-d[0],G=2*d[3]-d[1]):(w=a.x,G=a.y);var V=K[M],e=K[M+1];"t"===B&&(V+=a.x,e+=a.y),j&&j.quadraticCurveTo(w,G,V,e),p.push({x:w,y:G}),p.push({x:V,y:e}),a.x=V,a.y=e}T=null,d=[w,G,V,e]}else if("V"===B||"v"===B){for(var K=t(X),M=0;M<K.length;M+=1){var e=K[M];"v"===B&&(e+=a.y),j&&j.lineTo(a.x,e),p.push({x:a.x,y:e}),a.y=e}T=d=null}else if("L"===B||"l"===B){for(var K=t(X),M=0;M<K.length;M+=2){var V=K[M],e=K[M+1];"l"===B&&(V+=a.x,e+=a.y),j&&j.lineTo(V,e),p.push({x:V,y:e}),a.x=V,a.y=e}T=d=null}else if("A"===B||"a"===B){for(var K=t(X),M=0;M<K.length;M+=7){var $=K[M],P=K[M+1],N=K[M+2],k=K[M+3],r=K[M+4],V=K[M+5],e=K[M+6];"a"===B&&(V+=a.x,e+=a.y);var q=Al(a,$,P,N,k,r,{x:V,y:e},j);q&&(p=p.concat(q)),a.x=V,a.y=e}T=d=null}var L=X.substr(X.length-1);("z"===L||"Z"===L)&&j&&j.closePath()}return p},zr=function(M,g,k,z,B){var p,E=g[0];if(M.save(),ar(g))if(E&&1===E.length){var m,q="L"===g[0],u=g.length;q?(M.transform(g[5],g[6],g[7],g[8],g[9],g[10]),p=M.createLinearGradient(g[1],g[2],g[3],g[4]),m=11):(M.transform(g[7],g[8],g[9],g[10],g[11],g[12]),p=M.createRadialGradient(g[1],g[2],g[3],g[4],g[5],g[6]),m=13);for(var y=M.compGray;u>m;){var U=g[m+1];U=k(U),p.addColorStop(g[m],y?R.toGrayColor(U):U),m+=2}}else{var m,q="linear"===E,i=B.x,J=B.y,K=B.width,O=B.height,u=g.length,y=M.compGray;if(q)p=M.createLinearGradient(i+K*g[1],J+O*g[2],i+K*g[3],J+O*g[4]),m=5;else{var $=Math.min(K,O),D=g[1]*K+i,Z=g[2]*O+J,N=g[3]*$;if(Fc(g[5]))p=M.createRadialGradient(D,Z,0,D,Z,N),m=4;else{M.transform(g[7],g[8],g[9],g[10],g[11]+D,g[12]+Z);var d=g[4]*K+i-D,A=g[5]*O+J-Z,F=g[6]*$;p=M.createRadialGradient(0,0,N,d,A,F),m=13}}for(;u>m;){var U=g[m+1];U=k(U),p.addColorStop(g[m],y?R.toGrayColor(U):U),m+=2}}else p=g;return z?M.strokeStyle=p:M.fillStyle=p,p},Cl=function(){function t(t,q){var P=t.length,Z=t[0];if(Fc(t)||Z&&1!==Z.length)return t;for(var u=new Array(P),I=0;P>I;I++)u[I]=t[I];var l,V,K,J,b,H,h,Q,G,T,Y,F,N,$="L"===u[0];return l=$?5:7,V=u[l],K=u[l+1],J=u[l+2],b=u[l+3],H=u[l+4],h=u[l+5],Q=q[0],G=q[1],T=q[2],Y=q[3],F=q[4],N=q[5],u[l]=Q*V+T*K,u[l+1]=G*V+Y*K,u[l+2]=Q*J+T*b,u[l+3]=G*J+Y*b,u[l+4]=Q*H+T*h+F,u[l+5]=G*H+Y*h+N,u}return function(J,c){var Y;(Y=J.s("shape.gradient.pack"))&&J.s("shape.gradient.pack",t(Y,c)),(Y=J.s("shape.border.gradient.pack"))&&J.s("shape.border.gradient.pack",t(Y,c))}}(),fj=function(l,p,w,H){var q=!1;if(l.beginPath?l.beginPath():q=!0,vq(p)&&(p=p._as),vq(w)&&(w=w._as),w&&w.length){for(var X,S,G,C,z=0,A=0,y=w.length;y>A;A++)X=w[A],1===X?(S=p[z++],l.moveTo(S.x,q?-S.y:S.y)):2===X?(S=p[z++],l.lineTo(S.x,q?-S.y:S.y)):3===X?(S=p[z++],G=p[z++],l.quadraticCurveTo(S.x,q?-S.y:S.y,G.x,q?-G.y:G.y)):4===X?(S=p[z++],G=p[z++],C=p[z++],l.bezierCurveTo(S.x,q?-S.y:S.y,G.x,q?-G.y:G.y,C.x,q?-C.y:C.y)):5===X&&l.closePath();H&&5!==X&&l.closePath()}else{var v,T,O,K=p.length;if(K>0){for(v=p[0],l.moveTo(v.x,q?-v.y:v.y),T=1;K>T;T++)O=p[T],l.lineTo(O.x,q?-O.y:O.y);H&&l.closePath()}}},mi=function(p,F,u,d){if(vq(p)&&(p=p._as),vq(F)&&(F=F._as),F&&F.length){u=u||ce;for(var l,k,t,C,M,b,q,Y,v=[],e=I,g=0,r=0,S=F.length;S>r;r++)if(l=F[r],1===l)v.push(e=[]),e.push(p[g++]);else if(2===l)e.push(p[g++]);else if(3===l){for(k=e[e.length-1],t=p[g++],C=p[g++],b=1;u>b;b++)q=ae(b/u,k.x,t.x,C.x),Y=ae(b/u,k.y,t.y,C.y),e.push({x:q,y:Y,b:!0});
e.push(C)}else if(4===l){for(k=e[e.length-1],t=p[g++],C=p[g++],M=p[g++],b=1;u>b;b++)q=cb(b/u,k.x,t.x,C.x,M.x),Y=cb(b/u,k.y,t.y,C.y,M.y),e.push({x:q,y:Y,b:!0});e.push(M)}else 5===l&&e.push(e[0]);return d&&5!==l&&e&&e.length>2&&e.push(e[0]),v}return d&&p.length>2&&(p=p.slice(),p.push(p[0])),p?[p]:[]},sh=function(e,s,b,M,w,h){var U,D,p,C=Qm(s),i=M,R=C[0],d=C[1],N=C[2];if(b){var m=Qm(b);U=m[0]-R,D=m[1]-d,p=m[2]-N}else U=255-R,D=255-d,p=255-N;for(h||(h=M>10?1:.5,h=1>w?X(h/w,2):h),e.save(),e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0,e.shadowColor=0;(M-=h)>0;){var S=1-M/i,V=R+U*S,t=d+D*S,Z=N+p*S;V=X($(V),255),t=X($(t),255),Z=X($(Z),255),e.strokeStyle="rgb("+V+","+t+","+Z+")",e.lineWidth=M,e.stroke()}e.restore()},Je=function(){if(yi&&D){var E=D+""||en;Jf=E.indexOf(dm.substr(0,2))>0&&E.indexOf(Vh+Vh.substr(1,1))>1?!0:!1}var Z={};return function(n,I){var f=n+"-"+I,H=Z[f];if(H)return H;var c,k,x,T=Qm(n);return 0>I?(I=(100+I)/100,c=$(T[0]*I),k=$(T[1]*I),x=$(T[2]*I)):(I/=100,c=T[0],k=T[1],x=T[2],c+=(255-c)*I,k+=(255-k)*I,x+=(255-x)*I,c=X($(c),255),k=X($(k),255),x=X($(x),255)),Z[f]="rgb("+c+","+k+","+x+")"}}(),gk=function(W,J,S,X,h,Q){Q&&(W.fillStyle=Q),W.beginPath(),W.rect(J,S,X,h),W.fill()},os=function($,e,d,R,X,k,g){$.beginPath(),ld[e]($,d.x,d.y,d.width,d.height,R,X,k,g)},jp=function(X,G,W,Y,E){var V=ld[W];X.fillStyle=V?V(X,G,Y?Y:Eo,E.x,E.y,E.width,E.height):G},Dl=function(v,B,P,e,I,J){v.fillStyle=pq(v,B,P,e,I,J)},Pq=function(U,R,G,S,$,O){U.strokeStyle=pq(U,R,G,S,$,O)},pq=function(d,O,l,N,F,n){var X;try{if(!O.tagName&&O.comps){O._cacheImage_||(O._cacheImage_={});var A;A="override"===N?"colors_override":"override_rgb"===N?"colors_override_rgb":"override_a"===N?"colors_override_a":"colors",O._cacheImage_[A]||(O._cacheImage_[A]={__count__:0});var U=O._cacheImage_[A][l];U||(O._cacheImage_[A].__count__>R.imageCacheThreshold&&(O._cacheImage_[A]={__count__:0}),U=B.Default.toCanvas(O,nr(O),kd(O),null,F,n,l,null,N),O._cacheImage_[A][l]=U,O._cacheImage_[A].__count__++),O=U}X=d.createPattern(O,"repeat")}catch(e){X="black"}return X},Dj=function(Y){var Z,m,u=[],G=0,k=Y.length;for(Z=0;65>Z;Z++)u[Z]=Z;for(Z=0;65>Z;Z++)G=(G+u[Z]+Y.charCodeAt(Z%k))%65,m=u[Z],u[Z]=u[G],u[G]=m;for(Z=0;65>Z;Z++)u[Z]=bf[u[Z]];return u.join("")},Cr=function(P){for(var B=8+jl.randomInt(8),r=bf[8*jl.randomInt(8)+(B-8)],U="",y=0;B>y;y++)U+=bf[jl.randomInt(64)];var p=Dj(U+G+Aq+tr);return r+U+wr.encode(P,p)},uc=function(w){var b=w[0],K=bf.indexOf(b);if(0>K)return"";K=8+(7&K);var J=w.slice(1,1+K),Y=Dj(J+G+Aq+tr);return wr.decode(w,Y,1+K)},Kd=function(k,i,o,Z,p,A,D){k.save(),k.translate(i,o),k.scale(1,D/A),k.arc(0,0,A,Z,p),k.restore()},ge=function(I,l,b,U,K,x,W,H){var c,t,e,q,Y,z,Z,h,A,X,g;if(i(K)>2*L&&(K=2*L),Y=$(i(K)/(L/4)),c=K/Y,t=-c,e=-U,Y>0){z=l+F(U)*x,Z=b+k(-U)*W,H?I.lineTo(z,Z):I.moveTo(z,Z);for(var y=0;Y>y;y++)e+=t,q=e-t/2,h=l+F(e)*x,A=b+k(e)*W,X=l+F(q)*(x/F(t/2)),g=b+k(q)*(W/F(t/2)),I.quadraticCurveTo(X,g,h,A)}},wo=function(q,t,l,_,V,p,H,c,Y){6===arguments.length&&(ar(p)?(c=p[1],Y=p[2],H=p[3],p=p[0]):(H=p,c=p,Y=p));var z=t+_,m=l+V,u=V>_?2*_:2*V;return p=u>p?p:u,H=u>H?H:u,c=u>c?c:u,Y=u>Y?Y:u,q.roundRect?(q.roundRect(t,l,_,V,[p,H,Y,c]),void 0):(q.moveTo(t+_/2,l),q.arcTo(z,l,z,m,H),q.arcTo(z,m,t,m,Y),q.arcTo(t,m,t,l,c),q.arcTo(t,l,z,l,p),q.lineTo(t+_/2,l),void 0)},jn=function(n,b,x,Z,y,a,O){b&&(x=H(x),Z=H(Z),O||(O=1),n.fillStyle=b,n.beginPath(),n.rect(x,Z,O,a),n.rect(x,Z,y,O),a-O>0&&n.rect(x,Z+a-O,y,O),y-O>0&&n.rect(x+y-O,Z,O,a),n.fill())},Pe=function(C,g,R,M){var S=M.x,k=M.y,v=M.width,c=M.height;if(!(!g||!R||0>=v||0>=c)){var D,Q=Fk(g),U=je(g),e=R>0;1===R||-1===R?(C.fillStyle=e?Q:U,C.beginPath(),C.rect(S,k,1,c),C.rect(S,k,v,1),C.fill(),C.fillStyle=e?U:Q,C.beginPath(),C.rect(S,k+c-1,v,1),C.rect(S+v-1,k,1,c),C.fill()):(R=X(i(R),X(v/2,c/2)),D=C.createLinearGradient(S,k,S+R,k),D.addColorStop(0,e?Q:U),D.addColorStop(1,g),C.fillStyle=D,C.beginPath(),C.moveTo(S,k),C.lineTo(S+R,k+R),C.lineTo(S+R,k+c-R),C.lineTo(S,k+c),C.lineTo(S,k),C.fill(),D=C.createLinearGradient(S,k,S,k+R),D.addColorStop(0,e?Q:U),D.addColorStop(1,g),C.fillStyle=D,C.beginPath(),C.moveTo(S,k),C.lineTo(S+R,k+R),C.lineTo(S+v-R,k+R),C.lineTo(S+v,k),C.lineTo(S,k),C.fill(),D=C.createLinearGradient(S,k+c,S,k+c-R),D.addColorStop(0,e?U:Q),D.addColorStop(1,g),C.fillStyle=D,C.beginPath(),C.moveTo(S,k+c),C.lineTo(S+R,k+c-R),C.lineTo(S+v-R,k+c-R),C.lineTo(S+v,k+c),C.lineTo(S,k+c),C.fill(),D=C.createLinearGradient(S+v,k,S+v-R,k),D.addColorStop(0,e?U:Q),D.addColorStop(1,g),C.fillStyle=D,C.beginPath(),C.moveTo(S+v,k),C.lineTo(S+v-R,k+R),C.lineTo(S+v-R,k+c-R),C.lineTo(S+v,k+c),C.lineTo(S+v,k),C.fill())}},zm=function(K,S,J,Y,D,p,h){var v=K.createLinearGradient(Y,D,p,h);return v.addColorStop(0,J),v.addColorStop(1,S),v},Rr=function(b,v,X,F,e,c,j){var f=b.createLinearGradient(F,e,c,j);return f.addColorStop(0,v),f.addColorStop(.5,X),f.addColorStop(1,v),f},ti=function(h,c,J,L,b,a,O){var n=h.createLinearGradient(L,b,a,O);return n.addColorStop(0,c),n.addColorStop(1/3,J),n.addColorStop(2/3,c),n.addColorStop(1,J),n},Io=function(T,w,x,z,l,Z,H,h,u){var M=T.createRadialGradient(z+Z*h,l+H*u,X(Z,H)/24,z+Z/2,l+H/2,o(Z,H)/2);return M.addColorStop(0,x),M.addColorStop(1,w),M},vd=[0,-1,.22451398828979272,-.30901699437494734,.9510565162951535,-.30901699437494745,.3632712640026804,.11803398874989468,.5877852522924731,.8090169943749473,-1.1102230246251565e-16,.38196601125010515,-.587785252292473,.8090169943749475,-.3632712640026805,.1180339887498949,-.9510565162951536,-.3090169943749473,-.22451398828979285,-.30901699437494734],ld={polygon:function(j,S,Y,s,K,H,t,R){(H==I||3>H)&&(H=6),t==I&&(t=0),R==I&&(R=!0);var i,l=X(s,K),f=l/2,a=new wc(S+s/2,Y+K/2),O=new wc,w=0,p=2*L/H,G=new wc(f,f);if(R===!1&&G.multiply({x:s/l,y:K/l}),0===t)for(i=0;H>i;i++)O.set(F(w),k(w)).multiply(G).add(a),0===i?j.moveTo(O.x,O.y):j.lineTo(O.x,O.y),w+=p;else{var J=[];for(i=0;2>i;i++)J.push(new wc(F(w),k(w)).multiply(G).add(a)),w+=p;var x=J.shift(),A=J[0],q=new wc(F(w),k(w)).multiply(G).add(a),C=x.clone().sub(A),W=q.clone().sub(A),P=C.clone().normalize().dot(W.clone().normalize()),E=Math.sqrt((1-P)/(1+P)),m=t/E;for(C.setLength(m).add(A),j.moveTo(C.x,C.y),i=0;H>i;i++)J.push(new wc(F(w),k(w)).multiply(G).add(a)),w+=p,x=J.shift(),A=J[0],j.arcTo(x.x,x.y,A.x,A.y,t)}j.closePath()},arc:function(p,D,z,W,n,M,m,G,h){M==I&&(M=L),m==I&&(m=f),G==I&&(G=!0);var a=D+W/2,R=z+n/2;G&&p.moveTo(a,R),h?Kd(p,a,R,M,m,W/2,n/2):p.arc(a,R,X(W,n)/2,M,m),G&&p.closePath()},rect:function(K,q,l,f,P){K.rect(q,l,f,P)},circle:function(S,z,Z,r,d){S.arc(z+r/2,Z+d/2,X(r,d)/2,0,f,!0)},oval:function(g,X,Z,$,q){Kd(g,X+$/2,Z+q/2,0,f,$/2,q/2)},roundRect:function(T,n,G,y,J,e){e==I&&(e=X(X(y,J)/4,8)),wo(T,n,G,y,J,e),T.closePath()},star:function($,i,O,x,X){var R=2*x,g=2*X,C=i+x/2,H=O+X/2;$.moveTo(C-R/4,H-g/12),$.lineTo(i+.306*x,O+.579*X),$.lineTo(C-R/6,H+g/4),$.lineTo(i+x/2,O+.733*X),$.lineTo(C+R/6,H+g/4),$.lineTo(i+.693*x,O+.579*X),$.lineTo(C+R/4,H-g/12),$.lineTo(i+.611*x,O+.332*X),$.lineTo(C+0,H-g/4),$.lineTo(i+.388*x,O+.332*X),$.closePath()},pentagram:function(x,I,Z,O,v){var i=.5*v,N=I+.5*O,u=Z+i,y=.5257311121191336*O;y>i&&(y=i);var J=vd,s=0;for(x.moveTo(N+y*J[s++],u+y*J[s++]);20>s;)x.lineTo(N+y*J[s++],u+y*J[s++]);x.closePath()},triangle:function(f,n,T,R,N){f.moveTo(n+R/2,T),f.lineTo(n+R,T+N),f.lineTo(n,T+N),f.closePath()},hexagon:function(H,M,f,B,Q){H.moveTo(M,f+Q/2),H.lineTo(M+B/4,f+Q),H.lineTo(M+3*B/4,+f+Q),H.lineTo(M+B,f+Q/2),H.lineTo(M+3*B/4,f),H.lineTo(M+B/4,f),H.closePath()},pentagon:function(C,u,K,w,c){var g=2*w,z=2*c,l=u+w/2,f=K+c/2;C.moveTo(l-g/4,f-z/12),C.lineTo(l-g/6,f+z/4),C.lineTo(l+g/6,f+z/4),C.lineTo(l+g/4,f-z/12),C.lineTo(l+0,f-z/4),C.closePath()},diamond:function(E,i,s,K,D){E.moveTo(i+K/2,s),E.lineTo(i,s+D/2),E.lineTo(i+K/2,s+D),E.lineTo(i+K,s+D/2),E.closePath()},rightTriangle:function(f,N,s,o,R){f.moveTo(N,s),f.lineTo(N+o,s+R),f.lineTo(N,s+R),f.closePath()},parallelogram:function(O,S,C,s,K){var U=s/4;O.moveTo(S+U,C),O.lineTo(S+s,C),O.lineTo(S+s-U,C+K),O.lineTo(S,C+K),O.closePath()},trapezoid:function(o,G,O,T,M){var e=T/4;o.moveTo(G+e,O),o.lineTo(G+T-e,O),o.lineTo(G+T,O+M),o.lineTo(G,O+M),o.closePath()},"linear.southwest":function(m,j,S,c,k,F,W){return zm(m,j,S,c,k+W,c+F,k)},"linear.southeast":function(p,H,T,v,K,a,A){return zm(p,H,T,v+a,K+A,v,K)},"linear.northwest":function(c,F,b,Z,e,r,L){return zm(c,F,b,Z,e,Z+r,e+L)},"linear.northeast":function(K,C,D,E,$,y,L){return zm(K,C,D,E+y,$,E,$+L)},"linear.north":function(D,T,u,b,m,g,d){return zm(D,T,u,b,m,b,m+d)},"linear.south":function(r,D,X,C,U,h,H){return zm(r,D,X,C,U+H,C,U)},"linear.west":function(n,N,K,I,b,f){return zm(n,N,K,I,b,I+f,b)},"linear.east":function(C,l,z,k,O,e){return zm(C,l,z,k+e,O,k,O)},"radial.center":function(D,Q,U,R,C,Z,F){return Io(D,Q,U,R,C,Z,F,.5,.5)},"radial.southwest":function(f,F,v,A,a,o,B){return Io(f,F,v,A,a,o,B,.25,.75)},"radial.southeast":function(d,A,L,g,Z,K,$){return Io(d,A,L,g,Z,K,$,.75,.75)},"radial.northwest":function(o,h,i,r,K,Q,V){return Io(o,h,i,r,K,Q,V,.25,.25)},"radial.northeast":function(b,j,F,u,R,i,a){return Io(b,j,F,u,R,i,a,.75,.25)},"radial.north":function(Y,H,m,B,o,z,n){return Io(Y,H,m,B,o,z,n,.5,.25)},"radial.south":function(R,M,w,G,O,d,n){return Io(R,M,w,G,O,d,n,.5,.75)},"radial.west":function(H,z,$,Q,X,F,h){return Io(H,z,$,Q,X,F,h,.25,.5)},"radial.east":function(I,P,g,T,C,v,G){return Io(I,P,g,T,C,v,G,.75,.5)},"spread.horizontal":function(h,d,G,m,I,x){return Rr(h,d,G,m,I,m+x,I)},"spread.vertical":function(B,K,v,$,h,m,e){return Rr(B,K,v,$,h,$,h+e)},"spread.diagonal":function(z,f,n,T,S,i,c){return Rr(z,f,n,T+i,S,T,S+c)},"spread.antidiagonal":function(H,s,G,n,i,R,Q){return Rr(H,s,G,n,i,n+R,i+Q)},"spread.north":function(h,F,W,s,O,d,i){return ti(h,F,W,s,O-i/4,s,O+i+i/4)},"spread.south":function(A,v,P,V,w,f,i){return ti(A,P,v,V,w-i/4,V,w+i+i/4)},"spread.west":function(g,k,$,f,i,h){return ti(g,k,$,f-h/4,i,f+h+h/4,i)},"spread.east":function(J,H,Q,M,I,R){return ti(J,Q,H,M-R/4,I,M+R+R/4,I)}},ij=function(I,v,c){return new Mc(I).tf(v,c)},ej=function(Y){var J=Y.touches[0],l=Y.touches[1],X=J.clientX,$=J.clientY,f=l.clientX,K=l.clientY;return a((X-f)*(X-f)+($-K)*($-K))},mn=function(c){var V=c.touches[0],X=c.touches[1],K=V.clientX,x=V.clientY,R=X.clientX,r=X.clientY;return{x:(K+R)/2,y:(x+r)/2}},mo=(function(){for(var Y=0,f=wd.split(""),n=0;n<f.length;n++)Y=10*ip(f[n])+Y;return mc(V[kq.toString(8*n)+sm.substr(n)+3],V[kq.toString(8*n)+sm.substr(n)+4]),Y}(),function(M,s,E){for(var j=0;j<E.size();j++){var D=E.get(j);M.co(D)&&s.add(D)}for(j=0;j<E.size();j++)D=E.get(j),mo(M,s,D._children)}),ck=function(d,h,X){for(var z=0;z<X.size();z++){var r=X.get(X.size()-1-z);d.co(r)&&h.add(r)}for(z=0;z<X.size();z++)r=X.get(z),ck(d,h,r._children)},Zj=function(q,r,t){for(var g=!1,K=0;K<t.size();K++){var N=t.get(K);q.co(N)?g&&r.add(N):g=1}for(K=0;K<t.size();K++)N=t.get(K),Zj(q,r,N._children)},bd=function(I,w,X){for(var a=!1,W=0;W<X.size();W++){var U=X.get(X.size()-1-W);I.co(U)?a&&w.add(U):a=!0}for(W=0;W<X.size();W++)U=X.get(W),bd(I,w,U._children)},wf=R.moveDatas=function(E,f,T,w){var V=w==I;if(0!==f||0!==T||!V&&0!==w){var P=!0,G=[];if(E.forEach(function(N){P&&(N._69O||wp(N)||Me(N))&&(P=!1)}),P)G=E;else{var e={},n={};E.forEach(function(d){e[d._id]=!0});var o={},d=function(T){var m=T._id;return e[m]?(G.push(T),o[m]=!0):o[m]=!1},H=function(L){var T=L._id;if(n[T])return d(L);var K=o[T];if(K!==z)return K;var $=L._parent;if($&&(Me($)||wp($))&&H($))return o[T]=!0;var N=L._host;return N&&(n[T]=T,K=H(N),n[T]=z,K)?o[T]=!0:d(L)};E.forEach(function(A){H(A)})}G.forEach(function(b){if(Dg(b))V?b.translate(f,T):b.translate3d(f,T,w);else{var M=b.s(Sd);if(!M||M.isEmpty())return;var x=new Gk;M.each(function(Z){Z=sj(Z),V?(Z.x+=f,Z.y+=T):(Z.x+=f,Z.y+=w,Z.e==I?Z.e=T:Z.e+=T),x.add(Z)}),b.s(Sd,x)}})}},nj=function(){function f(f,Z){return Z===f.substring(0,Z.length)?!0:!1}function A(c){return parseFloat(c)||0}function U(X,Y){if(Y==z&&(Y=new qc),f(X,"matrix3d")){var U=X.substring(9,X.length-1).split(",");U=U.map(A),Y.fromArray(U)}else if(f(X,"matrix")){var U=X.substring(7,X.length-1).split(",");U=U.map(A),Y.el[0]=U[0],Y.el[1]=U[1],Y.el[2]=0,Y.el[3]=0,Y.el[4]=U[2],Y.el[5]=U[3],Y.el[6]=0,Y.el[7]=0,Y.el[8]=0,Y.el[9]=0,Y.el[10]=1,Y.el[11]=0,Y.el[12]=U[4],Y.el[13]=U[5],Y.el[14]=0,Y.el[15]=1}return Y}function I(R,m){m==z&&(m=new Xn);var G=R.split(/\s+/);return G=G.map(A),m.set(G[0]||0,G[1]||0,G[2]||0),m}var $,W,X,Y,M,m=function(Q,T){$||($=new qc,W=new Xn,X=new qc,Y=new qc,M=new qc),T==z&&(T=new qc);var o=getComputedStyle(Q);o.transform&&"none"!==o.transform&&(U(o.transform,$),I(o.transformOrigin,W),Y.setPosition(W),W.negate(),M.setPosition(W),(dq||"preserve-3d"!==o.transformStyle)&&($.el[8]=0,$.el[9]=0,$.el[10]=1,$.el[11]=0),T.multiplyMatrices(M,T),T.multiplyMatrices($,T),T.multiplyMatrices(Y,T)),!dq&&o.perspective&&"none"!==o.perspective&&(X.el[11]=-1/A(o.perspective),I(o.perspectiveOrigin,W),Y.setPosition(W),W.negate(),M.setPosition(W),T.multiplyMatrices(M,T),T.multiplyMatrices(X,T),T.multiplyMatrices(Y,T));for(var k=Q.offsetParent,b=Q.offsetLeft,J=Q.offsetTop,y=Q.parentElement;y&&y!==k;){var p=getComputedStyle(y);if("none"!==p.transform||"none"!==p.perspective)break;y=y.parentElement}return y==z&&Q!==Q.ownerDocument.documentElement&&"fixed"!==o.position&&(y=Q.ownerDocument.documentElement),k!=z&&k!=y&&(b-=y.offsetLeft,J-=y.offsetTop),y&&(b-=y.scrollLeft,J-=y.scrollTop),W.set(b,J,0),Y.setPosition(W),T.multiplyMatrices(Y,T),y&&m(y,T),T};return function(C,c){var S=C.parentElement;if(S){var H=S.updateAppendMatrix;if(H){delete S.updateAppendMatrix;var J=new qc;m(S,J);var i=new qc;i.getInverse(J),S._matrixAppend=i,S._maxrixPreAppend=J}return c?S._matrixAppend:S._maxrixPreAppend}}}(),cs=function(Q,p){for(;Q&&!Q.hasOwnProperty(p);)Q=T.getPrototypeOf(Q);return Q&&T.getOwnPropertyDescriptor(Q,p)},Ir=T.getPrototypeOf?function(D,s,W){var N=cs(s,W);N&&T.defineProperty(D,W,N)}:function($,s,M){$[M]=s[M]},Zb={1:29,2:30,3:31,4:32,5:33,6:26,7:27,8:28,9:21,10:22,11:23,12:24,13:25,14:14,15:15,16:16,17:17,18:18,19:19,20:20,21:9,22:10,23:11,24:12,25:13,26:6,27:7,28:8,29:1,30:2,31:3,32:4,33:5,34:36,35:37,36:34,37:35,38:54,39:55,40:52,41:53,42:50,43:51,44:49,50:42,51:43,52:40,53:41,54:38,55:39},Xc=function(){var W={1:function(Q,r){return{x:Q.x-r.width/2,y:Q.y-r.height/2}},2:function(F,r){return{x:F.x+r.width/2,y:F.y-r.height/2}},3:function(q,G){return{x:q.x+q.width/2,y:q.y-G.height/2}},4:function(A,F){return{x:A.x+A.width-F.width/2,y:A.y-F.height/2}},5:function(l,p){return{x:l.x+l.width+p.width/2,y:l.y-p.height/2}},6:function(D){return{x:D.x,y:D.y}},7:function(q){return{x:q.x+q.width/2,y:q.y}},8:function(p){return{x:p.x+p.width,y:p.y}},9:function(V,h){return{x:V.x-h.width/2,y:V.y+h.height/2}},10:function(R,G){return{x:R.x+G.width/2,y:R.y+G.height/2}},11:function(B,L){return{x:B.x+B.width/2,y:B.y+L.height/2}},12:function(Z,i){return{x:Z.x-i.width/2+Z.width,y:Z.y+i.height/2}},13:function(J,K){return{x:J.x+J.width+K.width/2,y:J.y+K.height/2}},14:function(h,O){return{x:h.x-O.width/2,y:h.y+h.height/2}},15:function(Z){return{x:Z.x,y:Z.y+Z.height/2}},16:function($,O){return{x:$.x+O.width/2,y:$.y+$.height/2}},17:function(U){return{x:U.x+U.width/2,y:U.y+U.height/2}},18:function(G,C){return{x:G.x+G.width-C.width/2,y:G.y+G.height/2}},19:function(E){return{x:E.x+E.width,y:E.y+E.height/2}},20:function(u,j){return{x:u.x+u.width+j.width/2,y:u.y+u.height/2}},21:function(T,$){return{x:T.x-$.width/2,y:T.y+T.height-$.height/2}},22:function(y,d){return{x:y.x+d.width/2,y:y.y+y.height-d.height/2}},23:function(k,w){return{x:k.x+k.width/2,y:k.y+k.height-w.height/2}},24:function(_,E){return{x:_.x+_.width-E.width/2,y:_.y+_.height-E.height/2}},25:function(b,O){return{x:b.x+b.width+O.width/2,y:b.y+b.height-O.height/2}},26:function(G){return{x:G.x,y:G.y+G.height}},27:function(C){return{x:C.x+C.width/2,y:C.y+C.height}},28:function(v){return{x:v.x+v.width,y:v.y+v.height}},29:function(y,V){return{x:y.x-V.width/2,y:y.y+y.height+V.height/2}},30:function(K,S){return{x:K.x+S.width/2,y:K.y+K.height+S.height/2}},31:function(X,A){return{x:X.x+X.width/2,y:X.y+X.height+A.height/2}},32:function(Z,D){return{x:Z.x+Z.width-D.width/2,y:Z.y+Z.height+D.height/2}},33:function(J,D){return{x:J.x+J.width+D.width/2,y:J.y+J.height+D.height/2}},34:function(e,b){return{x:e.x,y:e.y-b.height/2}},35:function(v,L){return{x:v.x+v.width,y:v.y-L.height/2}},36:function(F,b){return{x:F.x,y:F.y+F.height+b.height/2}},37:function(M,Z){return{x:M.x+M.width,y:M.y+M.height+Z.height/2}},38:function(j,g){return{x:j.x+j.width/4,y:j.y-g.height/2}},39:function(N,C){return{x:N.x+3*N.width/4,y:N.y-C.height/2}},40:function(X){return{x:X.x+X.width/4,y:X.y}},41:function(Y){return{x:Y.x+3*Y.width/4,y:Y.y}},42:function(b,A){return{x:b.x+b.width/4,y:b.y+A.height/2}},43:function(z,d){return{x:z.x+3*z.width/4,y:z.y+d.height/2}},44:function(R,Z){return{x:R.x+R.width/2,y:R.y+R.height/2-Z.height/2}},45:function(p){return{x:p.x+p.width/4,y:p.y+p.height/2}},46:function(J,s){return{x:J.x+J.width/2-s.width/2,y:J.y+J.height/2}},47:function(N,g){return{x:N.x+N.width/2+g.width/2,y:N.y+N.height/2}},48:function(z){return{x:z.x+3*z.width/4,y:z.y+z.height/2}},49:function(Z,z){return{x:Z.x+Z.width/2,y:Z.y+Z.height/2+z.height/2}},50:function(S,g){return{x:S.x+S.width/4,y:S.y+S.height-g.height/2}},51:function(T,d){return{x:T.x+3*T.width/4,y:T.y+T.height-d.height/2}},52:function(B){return{x:B.x+B.width/4,y:B.y+B.height}},53:function(v){return{x:v.x+3*v.width/4,y:v.y+v.height}},54:function(o,X){return{x:o.x+o.width/4,y:o.y+o.height+X.height/2}},55:function(x,y){return{x:x.x+3*x.width/4,y:x.y+x.height+y.height/2}}};return Ym(V)?function(n,v,x){return W[n](v,x?x:Mn)}:void 0}();Wn(r,{highlight:"#1ABC9C",label:"#000",labelSelect:"#FFF",transparent:"rgba(0,0,0,0.35)",titleBackground:"#2C3E50",titleIconBackground:"#868686",headerBackground:"#ECF0F1",headerIconBackground:"#868686",headerSeparator:"#868686",headerLine:"#D9D9D9",background:"#FFF",disabledBackground:"rgba(255,255,255,0.65)",toolTipBackground:"#FFFFE0",rectSelectBorder:"#45C4F9",rectSelectBackground:"rgba(0,0,0,0.35)",editPointBorder:"#2C3E50",editPointBackground:"#D9D9D9",dash:"#2C3E50",groupBackground:"#ECF0F1",groupTitleBackground:"#2C3E50",gridBackground:"#D9D9D9",gridCellBorderColor:"#868686",gridBlockColor:"#868686",reverse:"#868686",contentIconBackground:"#868686",contentLine:"#D9D9D9",widgetBackground:"#ECF0F1",widgetBorder:"#D9D9D9",widgetIconBackground:"#868686",widgetIconBorder:"#868686",widgetIconGradient:"#D9D9D9",widgetIconHighlight:"#43AFF1",imageBackground:"#3498DB",imageGradient:"#FFF",chart:["#2f7ed8","#0d233a","#8bbc21","#910000","#1aadce","#492970","#f28f43","#77a1e5","#c42525","#a6c96a"]},!0);var _g=r.reverse,ys=r.transparent,dc=r.rectSelectBackground,us=r.dash,Jo=r.titleBackground,Pr=r.titleIconBackground,Ni=r.headerBackground,Yn=r.headerIconBackground,mb=r.headerSeparator,uj=r.headerLine,jf=r.contentIconBackground,Sj=r.contentLine,ul=(r.widgetIconHighlight,r.widgetIconBorder),Ch=(r.widgetIconGradient,r.imageBackground),Eo=r.imageGradient,Iq=r.highlight,nm=r.label,_j=r.labelSelect;if(og&&!V.shutAlert1){var fs=new Date,Uf=og.split("-"),jk=new Date(fs.getFullYear(),fs.getMonth(),fs.getDate()),og=new Date(ip(Uf[0],10),ip(Uf[1],10)-1,ip(Uf[2],10)),mg=jk.getTime(),ai=og.getTime(),as=G+"_try",Rc=V.alert;try{var Xh=V.localStorage;if(Xh&&Rc)if(ai>mg&&1728e6>ai-mg){var Vk=(ai-mg)/864e5;Xh&&Xh[as]!=Vk&&(Xh[as]=Vk,V.htWillExpire?Rc(V.htWillExpire.replace("{{day}}",Vk)):Rc("HT for Web free trial license will expire in "+Vk+" days, please apply for a new license!"))}else mg>=ai&&(V.htExpired?Rc(V.htExpired):Rc("Your free trial of HT for Web has expired!")),Xh&&delete Xh[as]}catch(Rp){}}Math.sign===z&&(Math.sign=function(R){return 0>R?-1:R>0?1:+R});var bf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",wr={encode:function(A,y){var r,f,k,b,S,I,R,u="",C=0;for(A=unescape(encodeURIComponent(A));C<A.length;)r=A.charCodeAt(C++),f=A.charCodeAt(C++),k=A.charCodeAt(C++),b=r>>2,S=(3&r)<<4|f>>4,I=(15&f)<<2|k>>6,R=63&k,isNaN(f)?I=R=64:isNaN(k)&&(R=64),u=u+y.charAt(b)+y.charAt(S)+y.charAt(I)+y.charAt(R);return u},decode:function(s,j,P){for(var _,I,f,O,i,R,F,u="",m=P||0;m<s.length;)O=j.indexOf(s.charAt(m++)),i=j.indexOf(s.charAt(m++)),R=j.indexOf(s.charAt(m++)),F=j.indexOf(s.charAt(m++)),_=O<<2|i>>4,I=(15&i)<<4|R>>2,f=(3&R)<<6|F,u+=String.fromCharCode(_),64!=R&&(u+=String.fromCharCode(I)),64!=F&&(u+=String.fromCharCode(f));return u=decodeURIComponent(escape(u))},_utf8_encode:function(K){K=K.replace(/\r\n/g,"\n");for(var F="",W=0;W<K.length;W++){var e=K.charCodeAt(W);128>e?F+=String.fromCharCode(e):e>127&&2048>e?(F+=String.fromCharCode(192|e>>6),F+=String.fromCharCode(128|63&e)):(F+=String.fromCharCode(224|e>>12),F+=String.fromCharCode(128|63&e>>6),F+=String.fromCharCode(128|63&e))}return F},_utf8_decode:function(A){for(var P="",h=0,j=0,$=0,v=0;h<A.length;)j=A.charCodeAt(h),128>j?(P+=String.fromCharCode(j),h++):j>191&&224>j?($=A.charCodeAt(h+1),P+=String.fromCharCode((31&j)<<6|63&$),h+=2):($=A.charCodeAt(h+1),v=A.charCodeAt(h+2),P+=String.fromCharCode((15&j)<<12|(63&$)<<6|63&v),h+=3);return P}},Pl=[],si=[],jl=B.Math={generateUUID:function(){for(var w=[],K=0;256>K;K++)w[K]=(16>K?"0":"")+K.toString(16).toUpperCase();return function(){var L=0|4294967295*Math.random(),h=0|4294967295*Math.random(),I=0|4294967295*Math.random(),p=0|4294967295*Math.random();return w[255&L]+w[255&L>>8]+w[255&L>>16]+w[255&L>>24]+"-"+w[255&h]+w[255&h>>8]+"-"+w[64|15&h>>16]+w[255&h>>24]+"-"+w[128|63&I]+w[255&I>>8]+"-"+w[255&I>>16]+w[255&I>>24]+w[255&p]+w[255&p>>8]+w[255&p>>16]+w[255&p>>24]}}(),clamp:function(Z,T,K){return Math.max(T,Math.min(K,Z))},fequal:function(_,x,l){return null==l&&(l=1e-8),Math.abs(_-x)<l},generateIncreasingID:function(){var f=0;return function(){return++f}}(),encodeBase64:function(r,Z){return wr.encode(r,Z||bf)},decodeBase64:function(d,G){return wr.decode(d,G||bf)},randomArray:function(W,k){k=k||W.length;for(var I=k-1;I>0;I--){var o=Math.floor(Math.random()*(I+1)),$=W[I];W[I]=W[o],W[o]=$}return W},randomInt:function(x,g){return g===z&&(g=x,x=0),x+Math.floor(Math.random()*(g-x))},randomFloat:function(Y,b){return b===z&&(b=Y,Y=0),Y+Math.random()*(b-Y)},isPOT:function(w){return w>0&&0===(w-1&w)},nearestPOT:function(W){if(!W)return 1;var F=W;F--,F|=F>>1,F|=F>>2,F|=F>>4,F|=F>>8,F|=F>>16,F++;var q=F>>1;return W-q>F-W?F:q},requestMatrix4:function(){return Pl.length>0?Pl.pop():new jl.Matrix4},releaseMatrix4:function(g){Pl.push(g)},requestVector3:function(){return si.length>0?si.pop():new jl.Vector3},releaseVector3:function(l){si.push(l)}},sn=B.Matrix=B.Math.Matrix2d=function(M,X,m,D,L){this.setFromTransform(M,X,m,D,L)},Mc=sn;sn.prototype={},sn.prototype.constructor=sn,sn.prototype.set=function(x,N,X,y,T,s){return this.a=x,this.b=N,this.c=X,this.d=y,this.tx=T,this.ty=s,this},sn.prototype.setFromTransform=function(A,J,I,Y,p){var K=this;if(A===z)return K.a=1,K.b=0,K.c=0,K.d=1,K.tx=0,K.ty=0,void 0;var Q,q;return A?(Q=k(A),q=F(A)):(Q=0,q=1),Y=Y||1,p=p||1,K.a=q*Y,K.b=Q*Y,K.c=-Q*p,K.d=q*p,K.tx=J||0,K.ty=I||0,K},sn.prototype.apply=function(u,B){B=B||new wc;var N=u.x,J=u.y;return B.x=this.a*N+this.c*J+this.tx,B.y=this.b*N+this.d*J+this.ty,B},sn.prototype.applyInverse=function(n,o){o=o||new wc;var C=1/(this.a*this.d+this.c*-this.b),k=n.x,H=n.y;return o.x=this.d*C*k+-this.c*C*H+(this.ty*this.c-this.tx*this.d)*C,o.y=this.a*C*H+-this.b*C*k+(-this.ty*this.a+this.tx*this.b)*C,o},sn.prototype.translate=function(v,F){return this.tx+=v,this.ty+=F,this},sn.prototype.scale=function(B,c){return this.a*=B,this.d*=c,this.c*=B,this.b*=c,this.tx*=B,this.ty*=c,this},sn.prototype.rotate=function(W){var T=Math.cos(W),v=Math.sin(W),j=this.a,n=this.c,N=this.tx;return this.a=j*T-this.b*v,this.b=j*v+this.b*T,this.c=n*T-this.d*v,this.d=n*v+this.d*T,this.tx=N*T-this.ty*v,this.ty=N*v+this.ty*T,this},sn.prototype.appendTranslate=function(P,g){return this.tx+=this.a*P+this.c*g,this.ty+=this.b*P+this.d*g,this},sn.prototype.appendScale=function(c,T){return this.a*=c,this.d*=T,this.c*=T,this.b*=c,this},sn.prototype.appendRotate=function(d){if(!d)return this;var p=Math.cos(d),u=Math.sin(d),j=this.a,Z=this.b;return this.a=j*p+this.c*u,this.b=Z*p+this.d*u,this.c=-j*u+this.c*p,this.d=-Z*u+this.d*p,this},sn.prototype.append=function(W){var g=this.a,s=this.b,T=this.c,y=this.d;return this.a=W.a*g+W.b*T,this.b=W.a*s+W.b*y,this.c=W.c*g+W.d*T,this.d=W.c*s+W.d*y,this.tx=W.tx*g+W.ty*T+this.tx,this.ty=W.tx*s+W.ty*y+this.ty,this},sn.prototype.setTransform=function(n,d,I,s,j,O,u,m,B){var g,Q,V,F,a,U,t,p,_,q;return a=Math.sin(u),U=Math.cos(u),t=Math.cos(B),p=Math.sin(B),_=-Math.sin(m),q=Math.cos(m),g=U*j,Q=a*j,V=-a*O,F=U*O,this.a=t*g+p*V,this.b=t*Q+p*F,this.c=_*g+q*V,this.d=_*Q+q*F,this.tx=n+(I*g+s*V),this.ty=d+(I*Q+s*F),this},sn.prototype.prepend=function(i){var $=this.tx;if(1!==i.a||0!==i.b||0!==i.c||1!==i.d){var w=this.a,A=this.c;this.a=w*i.a+this.b*i.c,this.b=w*i.b+this.b*i.d,this.c=A*i.a+this.d*i.c,this.d=A*i.b+this.d*i.d}return this.tx=$*i.a+this.ty*i.c+i.tx,this.ty=$*i.b+this.ty*i.d+i.ty,this},sn.prototype.transform=sn.prototype.prepend,sn.prototype.invert=function(){var F=this.a,r=this.b,G=this.c,S=this.d,h=this.tx,V=F*S-r*G;return this.a=S/V,this.b=-r/V,this.c=-G/V,this.d=F/V,this.tx=(G*this.ty-S*h)/V,this.ty=-(F*this.ty-r*h)/V,this},sn.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},sn.prototype.clone=function(){var c=new sn;return c.a=this.a,c.b=this.b,c.c=this.c,c.d=this.d,c.tx=this.tx,c.ty=this.ty,c},sn.prototype.copy=function(N){return N.a=this.a,N.b=this.b,N.c=this.c,N.d=this.d,N.tx=this.tx,N.ty=this.ty,N},sn.prototype.tf=function(T,e){1===arguments.length&&(e=T.y,T=T.x);var v=this;return{x:v.a*T+v.c*e+v.tx,y:v.b*T+v.d*e+v.ty}},sn.prototype.toArray=function(){return[this.a,this.b,this.c,this.d,this.tx,this.ty]},sn.prototype.fromArray=function(g){return this.a=g[0],this.b=g[1],this.c=g[2],this.d=g[3],this.tx=g[4],this.ty=g[5],this},sn.prototype.toArray9=function(){return[this.a,this.b,0,this.c,this.d,0,this.tx,this.ty,1]},sn.prototype.tfi=function(U,R){1===arguments.length&&(R=U.y,U=U.x);var v=this,W=1/(v.a*v.d+v.c*-v.b);return{x:v.d*W*U+-v.c*W*R+(v.ty*v.c-v.tx*v.d)*W,y:v.a*W*R+-v.b*W*U+(-v.ty*v.a+v.tx*v.b)*W}},sn.prototype.decompose=function(){var O=this,D=O.a,T=O.b,U=O.c,e=O.d,E=Math.sqrt(D*D+T*T),q=Math.sqrt(U*U+e*e),f=D*e-T*U;return 0>f&&(e>D?E=-E:q=-q),E&&(D*=1/E,T*=1/E),q&&(U*=1/q,e*=1/q),{translateX:O.tx,translateY:O.ty,rotation:Math.atan2(T,D),scaleX:E,scaleY:q}},sn.IDENTITY=new sn,sn.TEMP_MATRIX=new sn;var Hm=B.Math.Quaternion=function(M,j,I,X){this.set(M,j,I,X)};T.assign(Hm.prototype,{set:function(w,s,P,f){var X=this;return X._x=w||0,X._y=s||0,X._z=P||0,X._w=f!==z?f:1,X},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(F){var B=this;return B._x=F._x,B._y=F._y,B._z=F._z,B._w=F._w,B},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this},dot:function(v){return this._x*v._x+this._y*v._y+this._z*v._z+this._w*v._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var b=this.length();return 0===b?(this._x=0,this._y=0,this._z=0,this._w=1):(b=1/b,this._x=this._x*b,this._y=this._y*b,this._z=this._z*b,this._w=this._w*b),this},fromArray:function(W,j){j===z&&(j=0);var k=this;return k._x=W[j],k._y=W[j+1],k._z=W[j+2],k._w=W[j+3],this},slerp:function(b,p){if(0===p)return this;if(1===p)return this.copy(b);var c=this._x,S=this._y,s=this._z,w=this._w,_=w*b._w+c*b._x+S*b._y+s*b._z;if(0>_?(this._w=-b._w,this._x=-b._x,this._y=-b._y,this._z=-b._z,_=-_):this.copy(b),_>=1)return this._w=w,this._x=c,this._y=S,this._z=s,this;var x=Math.sqrt(1-_*_);if(Math.abs(x)<.001)return this._w=.5*(w+this._w),this._x=.5*(c+this._x),this._y=.5*(S+this._y),this._z=.5*(s+this._z),this;var Y=Math.atan2(x,_),o=Math.sin((1-p)*Y)/x,L=Math.sin(p*Y)/x;return this._w=w*o+this._w*L,this._x=c*o+this._x*L,this._y=S*o+this._y*L,this._z=s*o+this._z*L,this},setFromAxisAngle:function(H,D){var Y=D/2,P=Math.sin(Y);return this._x=H.x*P,this._y=H.y*P,this._z=H.z*P,this._w=Math.cos(Y),this},setFromEuler:function(T){var n=T._x,R=T._y,K=T._z,D=T._order,O=Math.cos,H=Math.sin,P=O(n/2),b=O(R/2),e=O(K/2),g=H(n/2),V=H(R/2),u=H(K/2);return"XYZ"===D?(this._x=g*b*e+P*V*u,this._y=P*V*e-g*b*u,this._z=P*b*u+g*V*e,this._w=P*b*e-g*V*u):"YXZ"===D?(this._x=g*b*e+P*V*u,this._y=P*V*e-g*b*u,this._z=P*b*u-g*V*e,this._w=P*b*e+g*V*u):"ZXY"===D?(this._x=g*b*e-P*V*u,this._y=P*V*e+g*b*u,this._z=P*b*u+g*V*e,this._w=P*b*e-g*V*u):"ZYX"===D?(this._x=g*b*e-P*V*u,this._y=P*V*e+g*b*u,this._z=P*b*u-g*V*e,this._w=P*b*e+g*V*u):"YZX"===D?(this._x=g*b*e+P*V*u,this._y=P*V*e+g*b*u,this._z=P*b*u-g*V*e,this._w=P*b*e-g*V*u):"XZY"===D&&(this._x=g*b*e-P*V*u,this._y=P*V*e-g*b*u,this._z=P*b*u+g*V*e,this._w=P*b*e+g*V*u),this},setFromRotationMatrix:function(J){var h,N=J.el,w=N[0],g=N[4],Y=N[8],n=N[1],d=N[5],E=N[9],X=N[2],L=N[6],f=N[10],i=w+d+f;return i>0?(h=.5/Math.sqrt(i+1),this._w=.25/h,this._x=(L-E)*h,this._y=(Y-X)*h,this._z=(n-g)*h):w>d&&w>f?(h=2*Math.sqrt(1+w-d-f),this._w=(L-E)/h,this._x=.25*h,this._y=(g+n)/h,this._z=(Y+X)/h):d>f?(h=2*Math.sqrt(1+d-w-f),this._w=(Y-X)/h,this._x=(g+n)/h,this._y=.25*h,this._z=(E+L)/h):(h=2*Math.sqrt(1+f-w-d),this._w=(n-g)/h,this._x=(Y+X)/h,this._y=(E+L)/h,this._z=.25*h),this},setFromToVectors:function(){var X,w;return function(j,E){return X===z&&(X=new Xn),w=j.dot(E)+1,1e-7>w?(w=0,Math.abs(j.x)>Math.abs(j.z)?X.set(-j.y,j.x,0):X.set(0,-j.z,j.y)):X.crossVectors(j,E),this._x=X.x,this._y=X.y,this._z=X.z,this._w=w,this.normalize()}}(),setFromUnitVectors:function(){var X,K,w=1e-6;return function(k,M){return X===z&&(X=new Xn),K=k.dot(M)+1,w>K?(K=0,Math.abs(k.x)>Math.abs(k.z)?X.set(-k.y,k.x,0):X.set(0,-k.z,k.y)):X.crossVectors(k,M),this._x=X.x,this._y=X.y,this._z=X.z,this._w=K,this.normalize()}}(),multiply:function(C){return this.multiplyQuaternions(this,C)},premultiply:function(d){return this.multiplyQuaternions(d,this)},multiplyQuaternions:function(I,P){var g=I._x,f=I._y,X=I._z,H=I._w,E=P._x,K=P._y,d=P._z,k=P._w;return this._x=g*k+H*E+f*d-X*K,this._y=f*k+H*K+X*E-g*d,this._z=X*k+H*d+g*K-f*E,this._w=H*k-g*E-f*K-X*d,this},toArray:function(w,Q){return w||(w=[]),Q=Q||0,w[Q]=this._x,w[Q+1]=this._y,w[Q+2]=this._z,w[Q+3]=this._w,w}});var jq=B.Math.Vector4=function(C,P,w,a){this.x=C||0,this.y=P||0,this.z=w||0,this.w=a!==z?a:1};T.assign(jq.prototype,{isVector4:!0,set:function($,n,l,P){return this.x=$,this.y=n,this.z=l,this.w=P,this},setScalar:function(w){return this.x=w,this.y=w,this.z=w,this.w=w,this},setX:function(I){return this.x=I,this},setY:function(A){return this.y=A,this},setZ:function(y){return this.z=y,this},setW:function(s){return this.w=s,this},setComponent:function(K,G){switch(K){case 0:this.x=G;break;case 1:this.y=G;break;case 2:this.z=G;break;case 3:this.w=G;break;default:throw new Error("index is out of range: "+K)}return this},getComponent:function(y){switch(y){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+y)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(d){return this.x=d.x,this.y=d.y,this.z=d.z,this.w=d.w!==z?d.w:1,this},add:function(L,p){return p!==z?this.addVectors(L,p):(this.x+=L.x,this.y+=L.y,this.z+=L.z,this.w+=L.w,this)},addScalar:function(a){return this.x+=a,this.y+=a,this.z+=a,this.w+=a,this},addVectors:function(m,l){return this.x=m.x+l.x,this.y=m.y+l.y,this.z=m.z+l.z,this.w=m.w+l.w,this},addScaledVector:function(v,J){return this.x+=v.x*J,this.y+=v.y*J,this.z+=v.z*J,this.w+=v.w*J,this},sub:function(L,Q){return Q!==z?this.subVectors(L,Q):(this.x-=L.x,this.y-=L.y,this.z-=L.z,this.w-=L.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(p,F){return this.x=p.x-F.x,this.y=p.y-F.y,this.z=p.z-F.z,this.w=p.w-F.w,this},multiplyScalar:function(J){return this.x*=J,this.y*=J,this.z*=J,this.w*=J,this},applyMatrix4:function(X){var A=this.x,B=this.y,z=this.z,E=this.w,m=X.el;
return this.x=m[0]*A+m[4]*B+m[8]*z+m[12]*E,this.y=m[1]*A+m[5]*B+m[9]*z+m[13]*E,this.z=m[2]*A+m[6]*B+m[10]*z+m[14]*E,this.w=m[3]*A+m[7]*B+m[11]*z+m[15]*E,this},divideScalar:function(u){return this.multiplyScalar(1/u)},setAxisAngleFromQuaternion:function(E){this.w=2*Math.acos(E.w);var Y=Math.sqrt(1-E.w*E.w);return 1e-4>Y?(this.x=1,this.y=0,this.z=0):(this.x=E.x/Y,this.y=E.y/Y,this.z=E.z/Y),this},setAxisAngleFromRotationMatrix:function(k){var n,R,B,A,x=.01,U=.1,f=k.el,L=f[0],l=f[4],T=f[8],p=f[1],u=f[5],O=f[9],d=f[2],e=f[6],V=f[10];if(Math.abs(l-p)<x&&Math.abs(T-d)<x&&Math.abs(O-e)<x){if(Math.abs(l+p)<U&&Math.abs(T+d)<U&&Math.abs(O+e)<U&&Math.abs(L+u+V-3)<U)return this.set(1,0,0,0),this;n=Math.PI;var M=(L+1)/2,I=(u+1)/2,$=(V+1)/2,t=(l+p)/4,h=(T+d)/4,W=(O+e)/4;return M>I&&M>$?x>M?(R=0,B=.707106781,A=.707106781):(R=Math.sqrt(M),B=t/R,A=h/R):I>$?x>I?(R=.707106781,B=0,A=.707106781):(B=Math.sqrt(I),R=t/B,A=W/B):x>$?(R=.707106781,B=.707106781,A=0):(A=Math.sqrt($),R=h/A,B=W/A),this.set(R,B,A,n),this}var v=Math.sqrt((e-O)*(e-O)+(T-d)*(T-d)+(p-l)*(p-l));return Math.abs(v)<.001&&(v=1),this.x=(e-O)/v,this.y=(T-d)/v,this.z=(p-l)/v,this.w=Math.acos((L+u+V-1)/2),this},min:function(P){return this.x=Math.min(this.x,P.x),this.y=Math.min(this.y,P.y),this.z=Math.min(this.z,P.z),this.w=Math.min(this.w,P.w),this},max:function(z){return this.x=Math.max(this.x,z.x),this.y=Math.max(this.y,z.y),this.z=Math.max(this.z,z.z),this.w=Math.max(this.w,z.w),this},clamp:function(X,w){return this.x=Math.max(X.x,Math.min(w.x,this.x)),this.y=Math.max(X.y,Math.min(w.y,this.y)),this.z=Math.max(X.z,Math.min(w.z,this.z)),this.w=Math.max(X.w,Math.min(w.w,this.w)),this},clampScalar:function(){var Y,U;return function(N,r){return Y===z&&(Y=new jq,U=new jq),Y.set(N,N,N,N),U.set(r,r,r,r),this.clamp(Y,U)}}(),clampLength:function(f,U){var $=this.length();return this.divideScalar($||1).multiplyScalar(Math.max(f,Math.min(U,$)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(_){return this.x*_.x+this.y*_.y+this.z*_.z+this.w*_.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(O){return this.normalize().multiplyScalar(O)},lerp:function(D,N){return this.x+=(D.x-this.x)*N,this.y+=(D.y-this.y)*N,this.z+=(D.z-this.z)*N,this.w+=(D.w-this.w)*N,this},lerpVectors:function(T,W,U){return this.subVectors(W,T).multiplyScalar(U).add(T)},equals:function(B){return B.x===this.x&&B.y===this.y&&B.z===this.z&&B.w===this.w},fromArray:function(y,V){return V===z&&(V=0),this.x=y[V],this.y=y[V+1],this.z=y[V+2],this.w=y[V+3],this},toArray:function(X,q){return X===z&&(X=[]),q===z&&(q=0),X[q]=this.x,X[q+1]=this.y,X[q+2]=this.z,X[q+3]=this.w,X},fromBufferAttribute:function(u,M){return this.x=u.getX(M),this.y=u.getY(M),this.z=u.getZ(M),this.w=u.getW(M),this}});var Xn=B.Math.Vector3=function(Q,S,W){Q===z?(this.x=0,this.y=0,this.z=0):"object"==typeof Q?this.copy(Q):this.set(Q,S==z?Q:S,W==z?Q:W)},xe=B.Math.Vector3;T.assign(Xn.prototype,{isNaN:function(){return isNaN(this.x)||isNaN(this.y)||isNaN(this.z)},set:function(F,X,j){return this.x=F,this.y=X,this.z=j,this},equals:function(f){return f&&this.x===f.x&&this.y===f.y&&this.z===f.z},setScalar:function(K){return this.x=K,this.y=K,this.z=K,this},setX:function(r){return this.x=r,this},setY:function($){return this.y=$,this},setZ:function(V){return this.z=V,this},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(O){return O.x===z?(this.x=O[0],this.y=O[1],this.z=O[2]):(this.x=O.x,this.y=O.y,this.z=O.z||0),this},add:function(z){return this.x+=z.x,this.y+=z.y,this.z+=z.z,this},addScalar:function(H){return this.x+=H,this.y+=H,this.z+=H,this},addVectors:function(D,G){return this.x=D.x+G.x,this.y=D.y+G.y,this.z=D.z+G.z,this},addScaledVector:function($,r){return this.x+=$.x*r,this.y+=$.y*r,this.z+=$.z*r,this},sub:function(N){return this.x-=N.x,this.y-=N.y,this.z-=N.z,this},subScalar:function(C){return this.x-=C,this.y-=C,this.z-=C,this},subVectors:function(S,U){return this.x=S.x-U.x,this.y=S.y-U.y,this.z=S.z-U.z,this},divide:function(f){return this.x/=f.x,this.y/=f.y,this.z/=f.z,this},multiply:function(h){return this.x*=h.x,this.y*=h.y,this.z*=h.z,this},multiplyScalar:function(R){return this.x*=R,this.y*=R,this.z*=R,this},divideScalar:function(G){if(0!==G){var j=1/G;this.x*=j,this.y*=j,this.z*=j}else this.x=0,this.y=0,this.z=0;return this},distanceTo:function(n){return Math.sqrt(this.distanceToSquared(n))},distanceToSquared:function(x){var Z=this.x-x.x,k=this.y-x.y,h=this.z-x.z;return Z*Z+k*k+h*h},distanceToSquared2:function(H){var c=this.x-H[0],i=this.y-H[1],u=this.z-H[2];return c*c+i*i+u*u},divideVectors:function(i,Z){return this.x=i.x/Z.x,this.y=i.y/Z.y,this.z=i.z/Z.z,this},multiplyVectors:function(D,X){return this.x=D.x*X.x,this.y=D.y*X.y,this.z=D.z*X.z,this},transformDirection:function(j){var G=this.x,F=this.y,a=this.z,B=j.el;return this.x=B[0]*G+B[4]*F+B[8]*a,this.y=B[1]*G+B[5]*F+B[9]*a,this.z=B[2]*G+B[6]*F+B[10]*a,this.normalize()},applyAxisAngle:function(){var i=new Hm;return function(p,Q){return this.applyQuaternion(i.setFromAxisAngle(p,Q))}}(),applyEuler:function(){var S=new Hm;return function(u){return this.applyQuaternion(S.setFromEuler(u))}}(),applyQuaternion:function(W){var o=this.x,X=this.y,N=this.z,$=W._x,T=W._y,m=W._z,M=W._w,a=M*o+T*N-m*X,f=M*X+m*o-$*N,q=M*N+$*X-T*o,K=-$*o-T*X-m*N;return this.x=a*M+K*-$+f*-m-q*-T,this.y=f*M+K*-T+q*-$-a*-m,this.z=q*M+K*-m+a*-T-f*-$,this},applyMatrix4:function(d){var f=this.x,J=this.y,k=this.z,A=d.el,U=1/(A[3]*f+A[7]*J+A[11]*k+A[15]);return this.x=(A[0]*f+A[4]*J+A[8]*k+A[12])*U,this.y=(A[1]*f+A[5]*J+A[9]*k+A[13])*U,this.z=(A[2]*f+A[6]*J+A[10]*k+A[14])*U,this},applyMatrix3:function(q){var A=this.x,u=this.y,Q=this.z,$=q.el;return this.x=$[0]*A+$[3]*u+$[6]*Q,this.y=$[1]*A+$[4]*u+$[7]*Q,this.z=$[2]*A+$[5]*u+$[8]*Q,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},reflect:function(){var e=new Xn;return function(q){return this.sub(e.copy(q).multiplyScalar(2*this.dot(q)))}}(),dot:function(G){return this.x*G.x+this.y*G.y+this.z*G.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){var E=this.length();return E?this.multiplyScalar(1/E):this},setLength:function(l){return this.normalize().multiplyScalar(l)},fromArray:function(j,K){return K===z&&(K=0),this.x=j[K],this.y=j[K+1],this.z=j[K+2],this},toArray:function(q,m){return q===z&&(q=[0,0,0]),m===z&&(m=0),q[m]=this.x,q[m+1]=this.y,q[m+2]=this.z,q},cross:function(z){return this.crossVectors(this,z)},angleTo:function(k){var V=this.dot(k)/Math.sqrt(this.lengthSq()*k.lengthSq());return V>1||-1>V?0:Math.acos(V)},lerp:function(H,U){return this.x+=(H.x-this.x)*U,this.y+=(H.y-this.y)*U,this.z+=(H.z-this.z)*U,this},lerpVectors:function(W,l,J){return this.subVectors(l,W).multiplyScalar(J).add(W)},crossVectors:function(O,y){var a=O.x,f=O.y,X=O.z,F=y.x,W=y.y,q=y.z;return this.x=f*q-X*W,this.y=X*F-a*q,this.z=a*W-f*F,this},min:function(i){return this.x=Math.min(this.x,i.x),this.y=Math.min(this.y,i.y),this.z=Math.min(this.z,i.z),this},max:function(s){return this.x=Math.max(this.x,s.x),this.y=Math.max(this.y,s.y),this.z=Math.max(this.z,s.z),this},setFromMatrixPosition:function(F){return this.setFromMatrixColumn(F,3)},setFromMatrixScale:function(m){var c=this.setFromMatrixColumn(m,0).length(),v=this.setFromMatrixColumn(m,1).length(),x=this.setFromMatrixColumn(m,2).length();return this.x=c,this.y=v,this.z=x,this},setFromMatrixColumn:function(J,$){return this.fromArray(J.el,4*$)}}),Xn.UP=new Xn(0,1,0),Xn.AxisX=new Xn(1,0,0),Xn.AxisY=new Xn(0,1,0),Xn.AxisZ=new Xn(0,0,1),Xn.normalizeArray=function(){var T=new Xn;return function(p){return T.copy(p).normalize().toArray()}}();var wc=B.Math.Vector2=function(o,E,Y){"object"==typeof o&&(o.x!=z?(E=o.y,Y=o.e,o=o.x):(Y=o[2],E=o[1],o=o[0])),this.set(o||0,E||0,Y)};wc.prototype={},wc.prototype.constructor=wc;var Kj=wc;T.defineProperties(wc.prototype,{width:{get:function(){return this.x},set:function(j){this.x=j}},height:{get:function(){return this.y},set:function(x){this.y=x}}}),wc.prototype.clone=function(){return new wc(this.x,this.y,this.e)},wc.prototype.copy=function(A){return this.set(A.x,A.y,A.e),this},wc.prototype.equals=function(m){return m.x===this.x&&m.y===this.y&&m.e===this.e},wc.prototype.set=function(Y,B,I){return this.x=Y||0,this.y=B||(0!==B?this.x:0),I!=z&&(this.e=I),this},wc.prototype.setScalar=function(k){return this.x=k,this.y=k,this.e=k,this},wc.prototype.setX=function(A){return this.x=A||0,this},wc.prototype.setY=function(V){return this.y=V||0,this},wc.prototype.setE=function(m){return this.e=m||0,this},wc.prototype.add=function(J){return this.x+=J.x,this.y+=J.y,this},wc.prototype.addVectors=function(r,S){return this.x=r.x+S.x,this.y=r.y+S.y,this},wc.prototype.addScalar=function($){return this.x+=$,this.y+=$,this},wc.prototype.addScaledVector=function(f,v){return this.x+=f.x*v,this.y+=f.y*v,this},wc.prototype.sub=function(a){return this.x-=a.x,this.y-=a.y,this},wc.prototype.subScalar=function(f){return this.x-=f,this.y-=f,this},wc.prototype.subVectors=function(H,t){return this.x=H.x-t.x,this.y=H.y-t.y,this},wc.prototype.multiply=function(n){return this.x*=n.x,this.y*=n.y,this},wc.prototype.multiplyScalar=function(H){return this.x*=H,this.y*=H,this},wc.prototype.divide=function(T){return this.x/=T.x,this.y/=T.y,this},wc.prototype.divideScalar=function(e){return this.multiplyScalar(1/e)},wc.prototype.min=function(d){return this.x=Math.min(this.x,d.x),this.y=Math.min(this.y,d.y),this},wc.prototype.max=function(h){return this.x=Math.max(this.x,h.x),this.y=Math.max(this.y,h.y),this},wc.prototype.fromArray=function(q,X){return X===z&&(X=0),this.x=q[X],this.y=q[X+1],this},wc.prototype.clamp=function(Z,k){return this.x=Math.max(Z.x,Math.min(k.x,this.x)),this.y=Math.max(Z.y,Math.min(k.y,this.y)),this},wc.prototype.clampScalar=function(){var R,P;return function(T,Y){return R===z&&(R=new wc,P=new wc),R.set(T,T),P.set(Y,Y),this.clamp(R,P)}}(),wc.prototype.clampLength=function(b,Q){var N=this.length();return this.multiplyScalar(Math.max(b,Math.min(Q,N))/N)},wc.prototype.dot=function(a){return this.x*a.x+this.y*a.y},wc.prototype.cross=function(c){return this.x*c.y-this.y*c.x},wc.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y},wc.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},wc.prototype.normalize=function(){return this.divideScalar(this.length())},wc.prototype.angle=function(){var l=Math.atan2(this.y,this.x);return 0>l&&(l+=2*Math.PI),l},wc.prototype.distanceTo=function(L){return Math.sqrt(this.distanceToSquared(L))},wc.prototype.distanceToSquared=function(A){var Z=this.x-A.x,h=this.y-A.y;return Z*Z+h*h},wc.prototype.isNearEnough=function(I){return this.distanceToSquared(I)<1e-8},wc.prototype.setLength=function(M){var p=this.length();return p?this.multiplyScalar(M/p):this},wc.prototype.lerp=function(B,n){return this.x+=(B.x-this.x)*n,this.y+=(B.y-this.y)*n,"number"==typeof B.e&&"number"==typeof this.e&&(this.e+=(B.e-this.e)*n),this},wc.prototype.lerpVectors=function(P,U,d){return this.subVectors(U,P).multiplyScalar(d).add(P)},wc.prototype.rotateAround=function(i,P){var g=i?i.x:0,d=i?i.y:0,m=Math.cos(P),l=Math.sin(P),V=this.x-g,o=this.y-d;return this.x=V*m-o*l+g,this.y=V*l+o*m+d,this};var Uq=B.Math.Matrix3=function(){this.el=[1,0,0,0,1,0,0,0,1]};T.assign(Uq.prototype,{isMatrix3:!0,set:function(d,t,G,j,B,P,Y,O,h){var o=this.el;return o[0]=d,o[1]=j,o[2]=Y,o[3]=t,o[4]=B,o[5]=O,o[6]=G,o[7]=P,o[8]=h,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.el)},copy:function(l){var q=this.el,R=l.el;return q[0]=R[0],q[1]=R[1],q[2]=R[2],q[3]=R[3],q[4]=R[4],q[5]=R[5],q[6]=R[6],q[7]=R[7],q[8]=R[8],this},setFromMatrix4:function(e){var G=e.el;return this.set(G[0],G[4],G[8],G[1],G[5],G[9],G[2],G[6],G[10]),this},applyToBufferAttribute:function(){var p=new Xn;return function(B){for(var W=0,i=B.count;i>W;W++)p.x=B.getX(W),p.y=B.getY(W),p.z=B.getZ(W),p.applyMatrix3(this),B.setXYZ(W,p.x,p.y,p.z);return B}}(),multiply:function(N){return this.multiplyMatrices(this,N)},premultiply:function(a){return this.multiplyMatrices(a,this)},multiplyMatrices:function(F,k){var W=F.el,m=k.el,B=this.el,q=W[0],o=W[3],v=W[6],$=W[1],l=W[4],E=W[7],L=W[2],w=W[5],Q=W[8],y=m[0],s=m[3],V=m[6],K=m[1],b=m[4],A=m[7],g=m[2],H=m[5],h=m[8];return B[0]=q*y+o*K+v*g,B[3]=q*s+o*b+v*H,B[6]=q*V+o*A+v*h,B[1]=$*y+l*K+E*g,B[4]=$*s+l*b+E*H,B[7]=$*V+l*A+E*h,B[2]=L*y+w*K+Q*g,B[5]=L*s+w*b+Q*H,B[8]=L*V+w*A+Q*h,this},multiplyScalar:function(F){var a=this.el;return a[0]*=F,a[3]*=F,a[6]*=F,a[1]*=F,a[4]*=F,a[7]*=F,a[2]*=F,a[5]*=F,a[8]*=F,this},determinant:function(){var n=this.el,j=n[0],h=n[1],Y=n[2],e=n[3],q=n[4],z=n[5],A=n[6],D=n[7],Q=n[8];return j*q*Q-j*z*D-h*e*Q+h*z*A+Y*e*D-Y*q*A},getInverse:function(g){var X=g.el,V=this.el,A=X[0],h=X[1],q=X[2],d=X[3],F=X[4],w=X[5],P=X[6],J=X[7],a=X[8],$=a*F-w*J,b=w*P-a*d,o=J*d-F*P,B=A*$+h*b+q*o;if(0===B)return this.identity();var k=1/B;return V[0]=$*k,V[1]=(q*J-a*h)*k,V[2]=(w*h-q*F)*k,V[3]=b*k,V[4]=(a*A-q*P)*k,V[5]=(q*d-w*A)*k,V[6]=o*k,V[7]=(h*P-J*A)*k,V[8]=(F*A-h*d)*k,this},transpose:function(){var b,t=this.el;return b=t[1],t[1]=t[3],t[3]=b,b=t[2],t[2]=t[6],t[6]=b,b=t[5],t[5]=t[7],t[7]=b,this},getNormalMatrix:function(Q){return this.setFromMatrix4(Q).getInverse(this).transpose()},transposeIntoArray:function(B){var A=this.el;return B[0]=A[0],B[1]=A[3],B[2]=A[6],B[3]=A[1],B[4]=A[4],B[5]=A[7],B[6]=A[2],B[7]=A[5],B[8]=A[8],this},setUvTransform:function(Z,q,s,N,i,A,P){var n=Math.cos(i),y=Math.sin(i);this.set(s*n,s*y,-s*(n*A+y*P)+A+Z,-N*y,N*n,-N*(-y*A+n*P)+P+q,0,0,1)},scale:function(F,d){var c=this.el;return c[0]*=F,c[3]*=F,c[6]*=F,c[1]*=d,c[4]*=d,c[7]*=d,this},rotate:function(m){var W=Math.cos(m),K=Math.sin(m),L=this.el,N=L[0],$=L[3],z=L[6],I=L[1],h=L[4],a=L[7];return L[0]=W*N+K*I,L[3]=W*$+K*h,L[6]=W*z+K*a,L[1]=-K*N+W*I,L[4]=-K*$+W*h,L[7]=-K*z+W*a,this},translate:function(V,p){var D=this.el;return D[0]+=V*D[2],D[3]+=V*D[5],D[6]+=V*D[8],D[1]+=p*D[2],D[4]+=p*D[5],D[7]+=p*D[8],this},equals:function(d){for(var $=this.el,T=d.el,F=0;9>F;F++)if($[F]!==T[F])return!1;return!0},fromArray:function(p,G){G===z&&(G=0);for(var q=0;9>q;q++)this.el[q]=p[q+G];return this},toArray:function(s,F){s===z&&(s=[]),F===z&&(F=0);var G=this.el;return s[F]=G[0],s[F+1]=G[1],s[F+2]=G[2],s[F+3]=G[3],s[F+4]=G[4],s[F+5]=G[5],s[F+6]=G[6],s[F+7]=G[7],s[F+8]=G[8],s}});var Xk=B.Math.Plane=function(C,T){this.normal=C!==z?C:new Xn(1,0,0),this.constant=T!==z?T:0};T.assign(Xk.prototype,{set:function(q,W){return this.normal.copy(q),this.constant=W,this},setComponents:function(R,k,j,w){return this.normal.set(R,k,j),this.constant=w,this},setFromNormalAndCoplanarPoint:function(I,Q){return this.normal.copy(I),this.constant=-Q.dot(this.normal),this},setFromCoplanarPoints:function(){var G=new Xn,Y=new Xn;return function(m,o,E){var K=G.subVectors(E,o).cross(Y.subVectors(m,o)).normalize();return this.setFromNormalAndCoplanarPoint(K,m),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(h){return this.normal.copy(h.normal),this.constant=h.constant,this},normalize:function(){var I=1/this.normal.length();return this.normal.multiplyScalar(I),this.constant*=I,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(s){return this.normal.dot(s)+this.constant},distanceToSphere:function(_){return this.distanceToPoint(_.center)-_.radius},projectPoint:function(b,l){return l===z&&(l=new Xn),l.copy(this.normal).multiplyScalar(-this.distanceToPoint(b)).add(b)},intersectLine:function(){var D=new Xn;return function(H,S){S===z&&(S=new Xn);var X=H.delta(D),e=this.normal.dot(X);if(0===e)return 0===this.distanceToPoint(H.start)?S.copy(H.start):z;var a=-(H.start.dot(this.normal)+this.constant)/e;return 0>a||a>1?z:S.copy(X).multiplyScalar(a).add(H.start)}}(),intersectsLine:function(Z){var o=this.distanceToPoint(Z.start),D=this.distanceToPoint(Z.end);return 0>o&&D>0||0>D&&o>0},intersectsBox:function(y){return y.intersectsPlane(this)},intersectsSphere:function(X){return X.intersectsPlane(this)},coplanarPoint:function(P){return P===z&&(P=new Xn),P.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var o=new Xn,c=new Uq;return function(M,m){var b=m||c.getNormalMatrix(M),A=this.coplanarPoint(o).applyMatrix4(M),f=this.normal.applyMatrix3(b).normalize();return this.constant=-A.dot(f),this}}(),translate:function(p){return this.constant-=p.dot(this.normal),this},equals:function(B){return B.normal.equals(this.normal)&&B.constant===this.constant}});var Sp=B.Math.Ray=function(u,k){this.origin=u!==z?u.clone():new Xn,this.direction=k!==z?k.clone():new Xn};T.assign(Sp.prototype,{set:function(D,k){return this.origin.copy(D),this.direction.copy(k),this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){return this.origin.copy(a.origin),this.direction.copy(a.direction),this.maxHitLen=a.maxHitLen,this},at:function(e,N){var $=N||new Xn;return $.copy(this.direction).multiplyScalar(e).add(this.origin)},setMaxHitLength:function(e){this.maxHitLen=e},lookAt:function(I){return this.direction.copy(I).sub(this.origin).normalize(),this},applyMatrix4:function(O){var g=this.maxHitLen;if(g){var v=this.direction.clone().multiplyScalar(g).add(this.origin);v.applyMatrix4(O)}return this.origin.applyMatrix4(O),this.direction.transformDirection(O),g&&(this.maxHitLen=this.origin.distanceTo(v)),this},distanceToPlane:function(F){var C=F.normal.dot(this.direction);if(0===C)return 0===F.distanceToPoint(this.origin)?0:null;var e=-(this.origin.dot(F.normal)+F.constant)/C;return e>=0?e:null},intersectPlane:function(Z,O){var D=this.distanceToPlane(Z);return null===D?null:this.at(D,O)},intersectSphere:function(){var z=new Xn;return function(M,U){z.subVectors(M.center,this.origin);var y=z.dot(this.direction),R=z.dot(z)-y*y,c=M.radius*M.radius;if(R>c)return null;var X=Math.sqrt(c-R),v=y-X,b=y+X;return 0>v&&0>b?null:0>v?this.at(b,U):this.at(v,U)}}(),intersectEllipsoid:function(){var F=new Xn,E=new Xn;return function(X,U){F.subVectors(X.center,this.origin),F.divide(X.radius),E.divideVectors(this.direction,X.radius);var y=E.lengthSq(),D=F.dot(E),P=F.dot(F)*y-D*D;if(P>y)return null;var l=Math.sqrt(y-P),A=(D-l)/y,z=(D+l)/y;return 0>A&&0>z?null:0>A?this.at(z,U):this.at(A,U)}}(),intersectBox:function(k,U){var u,K,l,y,f,c,h=1/this.direction.x,Z=1/this.direction.y,D=1/this.direction.z,Q=this.origin;if(h>=0?(u=(k.min.x-Q.x)*h,K=(k.max.x-Q.x)*h):(u=(k.max.x-Q.x)*h,K=(k.min.x-Q.x)*h),Z>=0?(l=(k.min.y-Q.y)*Z,y=(k.max.y-Q.y)*Z):(l=(k.max.y-Q.y)*Z,y=(k.min.y-Q.y)*Z),u>y||l>K)return null;if((l>u||u!==u)&&(u=l),(K>y||K!==K)&&(K=y),D>=0?(f=(k.min.z-Q.z)*D,c=(k.max.z-Q.z)*D):(f=(k.max.z-Q.z)*D,c=(k.min.z-Q.z)*D),u>c||f>K)return null;if((f>u||u!==u)&&(u=f),(K>c||K!==K)&&(K=c),0>K)return null;var E=u>=0?u:K,m=this.maxHitLen;return m&&E>m?null:this.at(E,U)},intersectTriangle:function(){var H=new Xn,v=new Xn,K=new Xn,Z=new Xn;return function(e,u,D,O,p){v.subVectors(u,e),K.subVectors(D,e),Z.crossVectors(v,K);var M,A=this.direction.dot(Z);if(A>0){if(O)return null;M=1}else{if(!(0>A))return null;M=-1,A=-A}H.subVectors(this.origin,e);var X=M*this.direction.dot(K.crossVectors(H,K));if(0>X)return null;var n=M*this.direction.dot(v.cross(H));if(0>n||X+n>A)return null;var l=-M*H.dot(Z);if(0>l)return null;var B=l/A,j=this.maxHitLen;return j&&B>j?null:this.at(B,p)}}()});var cr=B.Math.Box3=function(b,B){this.min=b!==z?b:new Xn(1/0,1/0,1/0),this.max=B!==z?B:new Xn(-1/0,-1/0,-1/0)};T.assign(cr.prototype,{set:function(z,B){return this.min.copy(z),this.max.copy(B),this},setFromArray:function(p){for(var l=1/0,Y=1/0,K=1/0,Z=-1/0,O=-1/0,A=-1/0,f=0,W=p.length;W>f;f+=3){var M=p[f],z=p[f+1],T=p[f+2];l>M&&(l=M),Y>z&&(Y=z),K>T&&(K=T),M>Z&&(Z=M),z>O&&(O=z),T>A&&(A=T)}return this.min.set(l,Y,K),this.max.set(Z,O,A),this},setFromPoints:function(e){this.makeEmpty();for(var q=0,E=e.length;E>q;q++)this.expandByPoint(e[q]);return this},clone:function(){return(new this.constructor).copy(this)},intersectsBox:function(v){return v.max.x<this.min.x||v.min.x>this.max.x||v.max.y<this.min.y||v.min.y>this.max.y||v.max.z<this.min.z||v.min.z>this.max.z?!1:!0},copy:function(Z){return this.min.copy(Z.min),this.max.copy(Z.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByBox:function(k){return this.min.min(k.min),this.max.max(k.max),this},applyMatrix4:function(){var I=[new Xn,new Xn,new Xn,new Xn,new Xn,new Xn,new Xn,new Xn];return function(b){return this.isEmpty()?this:(I[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b),I[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b),I[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b),I[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b),I[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b),I[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b),I[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b),I[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b),this.setFromPoints(I),this)}}()});var zp=B.Math.Sphere=function(i,x){this.center=i!==z?i:new Xn,this.radius=x!==z?x:0};T.assign(zp.prototype,{set:function(u,H){return this.center.copy(u),this.radius=H,this},setFromPoints:function(){var U=new cr;return function(h,T){var w=this.center;T!==z?w.copy(T):U.setFromPoints(h).getCenter(w);for(var N=0,k=0,X=h.length;X>k;k++)N=Math.max(N,w.distanceToSquared(h[k]));return this.radius=Math.sqrt(N),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(m){return this.center.copy(m.center),this.radius=m.radius,this},empty:function(){return this.radius<=0},containsPoint:function(u){return u.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(W){return W.distanceTo(this.center)-this.radius},intersectsSphere:function(z){var J=this.radius+z.radius;return z.center.distanceToSquared(this.center)<=J*J},intersectsBox:function(k){return k.intersectsSphere(this)},intersectsPlane:function(o){return Math.abs(o.distanceToPoint(this.center))<=this.radius},clampPoint:function(K,L){var j=this.center.distanceToSquared(K);return L===z&&(L=new Xn),L.copy(K),j>this.radius*this.radius&&(L.sub(this.center).normalize(),L.multiplyScalar(this.radius).add(this.center)),L},getBoundingBox:function(e){return e===z&&(e=new cr),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(b){return this.center.applyMatrix4(b),this.radius=this.radius*b.getMaxScaleOnAxis(),this},translate:function(P){return this.center.add(P),this},equals:function(q){return q.center.equals(this.center)&&q.radius===this.radius}});var xb=B.Math.Frustum=function(Q,x,O,K,D,S){this.planes=[Q!==z?Q:new Xk,x!==z?x:new Xk,O!==z?O:new Xk,K!==z?K:new Xk,D!==z?D:new Xk,S!==z?S:new Xk]};T.assign(xb.prototype,{set:function(D,L,h,j,U,f){var C=this.planes;return C[0].copy(D),C[1].copy(L),C[2].copy(h),C[3].copy(j),C[4].copy(U),C[5].copy(f),this},clone:function(){return(new this.constructor).copy(this)},copy:function(V){for(var N=this.planes,p=0;6>p;p++)N[p].copy(V.planes[p]);return this},setFromMatrix:function(U){var I=this.planes,C=U.el,z=C[0],p=C[1],D=C[2],r=C[3],i=C[4],n=C[5],F=C[6],P=C[7],S=C[8],v=C[9],b=C[10],o=C[11],Q=C[12],J=C[13],$=C[14],f=C[15];return I[0].setComponents(r-z,P-i,o-S,f-Q).normalize(),I[1].setComponents(r+z,P+i,o+S,f+Q).normalize(),I[2].setComponents(r+p,P+n,o+v,f+J).normalize(),I[3].setComponents(r-p,P-n,o-v,f-J).normalize(),I[4].setComponents(r-D,P-F,o-b,f-$).normalize(),I[5].setComponents(r+D,P+F,o+b,f+$).normalize(),this},intersectsObject:function(){var Q=new zp;return function(C){var s=C.geometry;return null===s.boundingSphere&&s.computeBoundingSphere(),Q.copy(s.boundingSphere).applyMatrix4(C.matrixWorld),this.intersectsSphere(Q)}}(),intersectsSprite:function(){var C=new zp;return function(L){return C.center.set(0,0,0),C.radius=.7071067811865476,C.applyMatrix4(L.matrixWorld),this.intersectsSphere(C)}}(),intersectsSphere:function(r){for(var n=this.planes,c=r.center,Y=-r.radius,D=0;6>D;D++){var W=n[D].distanceToPoint(c);if(Y>W)return!1}return!0},intersectsBox:function(){var N=new Xn;return function(D){for(var r=this.planes,l=0;6>l;l++){var E=r[l];if(N.x=E.normal.x>0?D.max.x:D.min.x,N.y=E.normal.y>0?D.max.y:D.min.y,N.z=E.normal.z>0?D.max.z:D.min.z,E.distanceToPoint(N)<0)return!1}return!0}}(),containsPoint:function(k){for(var V=this.planes,$=0;6>$;$++)if(V[$].distanceToPoint(k)<0)return!1;return!0}});var qc=B.Math.Matrix4=function(){this.el=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};T.assign(qc.prototype,{isMatrix4:!0,set:function(c,g,M,j,X,F,h,z,r,f,x,$,A,o,k,u){var S=this.el;return S[0]=c,S[4]=g,S[8]=M,S[12]=j,S[1]=X,S[5]=F,S[9]=h,S[13]=z,S[2]=r,S[6]=f,S[10]=x,S[14]=$,S[3]=A,S[7]=o,S[11]=k,S[15]=u,this},clone:function(){return(new qc).fromArray(this.el)},fromArray:function(h,p){p===z&&(p=0);for(var C=this.el,q=0;16>q;q++)C[q]=h[q+p];return this},getElements:function(){return this.el},scale:function(k){var H=this.el,q=k.x,S=k.y,z=k.z;return H[0]*=q,H[4]*=S,H[8]*=z,H[1]*=q,H[5]*=S,H[9]*=z,H[2]*=q,H[6]*=S,H[10]*=z,H[3]*=q,H[7]*=S,H[11]*=z,this},translate:function(u){var p=this.el,B=u.x||0,t=u.y||0,w=u.z||0;return p[12]+=p[0]*B+p[4]*t+p[8]*w,p[13]+=p[1]*B+p[5]*t+p[9]*w,p[14]+=p[2]*B+p[6]*t+p[10]*w,p[15]+=p[3]*B+p[7]*t+p[11]*w,this},makeRotationFromEuler:function(M){var b=this.el,Y=M._x,I=M._y,j=M._z,$=M._order,J=Math.cos(Y),V=Math.sin(Y),F=Math.cos(I),q=Math.sin(I),p=Math.cos(j),m=Math.sin(j);if("XYZ"===$){var K=J*p,t=J*m,z=V*p,L=V*m;b[0]=F*p,b[4]=-F*m,b[8]=q,b[1]=t+z*q,b[5]=K-L*q,b[9]=-V*F,b[2]=L-K*q,b[6]=z+t*q,b[10]=J*F}else if("YXZ"===$){var s=F*p,d=F*m,G=q*p,v=q*m;b[0]=s+v*V,b[4]=G*V-d,b[8]=J*q,b[1]=J*m,b[5]=J*p,b[9]=-V,b[2]=d*V-G,b[6]=v+s*V,b[10]=J*F}else if("ZXY"===$){var s=F*p,d=F*m,G=q*p,v=q*m;b[0]=s-v*V,b[4]=-J*m,b[8]=G+d*V,b[1]=d+G*V,b[5]=J*p,b[9]=v-s*V,b[2]=-J*q,b[6]=V,b[10]=J*F}else if("ZYX"===$){var K=J*p,t=J*m,z=V*p,L=V*m;b[0]=F*p,b[4]=z*q-t,b[8]=K*q+L,b[1]=F*m,b[5]=L*q+K,b[9]=t*q-z,b[2]=-q,b[6]=V*F,b[10]=J*F}else if("YZX"===$){var f=J*F,r=J*q,W=V*F,y=V*q;b[0]=F*p,b[4]=y-f*m,b[8]=W*m+r,b[1]=m,b[5]=J*p,b[9]=-V*p,b[2]=-q*p,b[6]=r*m+W,b[10]=f-y*m}else if("XZY"===$){var f=J*F,r=J*q,W=V*F,y=V*q;b[0]=F*p,b[4]=-m,b[8]=q*p,b[1]=f*m+y,b[5]=J*p,b[9]=r*m-W,b[2]=W*m-r,b[6]=V*p,b[10]=y*m+f}return b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this},makeRotationFromQuaternion:function(S){var x=this.el,J=S._x,j=S._y,y=S._z,p=S._w,K=J+J,M=j+j,t=y+y,w=J*K,U=J*M,f=J*t,O=j*M,$=j*t,i=y*t,P=p*K,n=p*M,B=p*t;return x[0]=1-(O+i),x[4]=U-B,x[8]=f+n,x[1]=U+B,x[5]=1-(w+i),x[9]=$-P,x[2]=f-n,x[6]=$+P,x[10]=1-(w+O),x[3]=0,x[7]=0,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},getInverse:function(u){var S=this.el,W=u.el,e=W[0],o=W[1],J=W[2],a=W[3],c=W[4],O=W[5],Q=W[6],b=W[7],R=W[8],N=W[9],x=W[10],j=W[11],X=W[12],Y=W[13],K=W[14],t=W[15],P=N*K*b-Y*x*b+Y*Q*j-O*K*j-N*Q*t+O*x*t,g=X*x*b-R*K*b-X*Q*j+c*K*j+R*Q*t-c*x*t,F=R*Y*b-X*N*b+X*O*j-c*Y*j-R*O*t+c*N*t,f=X*N*Q-R*Y*Q-X*O*x+c*Y*x+R*O*K-c*N*K,l=e*P+o*g+J*F+a*f;if(0===l)return this.identity();var z=1/l;return S[0]=P*z,S[1]=(Y*x*a-N*K*a-Y*J*j+o*K*j+N*J*t-o*x*t)*z,S[2]=(O*K*a-Y*Q*a+Y*J*b-o*K*b-O*J*t+o*Q*t)*z,S[3]=(N*Q*a-O*x*a-N*J*b+o*x*b+O*J*j-o*Q*j)*z,S[4]=g*z,S[5]=(R*K*a-X*x*a+X*J*j-e*K*j-R*J*t+e*x*t)*z,S[6]=(X*Q*a-c*K*a-X*J*b+e*K*b+c*J*t-e*Q*t)*z,S[7]=(c*x*a-R*Q*a+R*J*b-e*x*b-c*J*j+e*Q*j)*z,S[8]=F*z,S[9]=(X*N*a-R*Y*a-X*o*j+e*Y*j+R*o*t-e*N*t)*z,S[10]=(c*Y*a-X*O*a+X*o*b-e*Y*b-c*o*t+e*O*t)*z,S[11]=(R*O*a-c*N*a-R*o*b+e*N*b+c*o*j-e*O*j)*z,S[12]=f*z,S[13]=(R*Y*J-X*N*J+X*o*x-e*Y*x-R*o*K+e*N*K)*z,S[14]=(X*O*J-c*Y*J-X*o*Q+e*Y*Q+c*o*K-e*O*K)*z,S[15]=(c*N*J-R*O*J+R*o*Q-e*N*Q-c*o*x+e*O*x)*z,this},invert:function(){return this.getInverse(this)},makeRotationAxis:function(Z,x){var m=Math.cos(x),J=Math.sin(x),b=1-m,A=Z.x,r=Z.y,l=Z.z,o=b*A,v=b*r;return this.set(o*A+m,o*r-J*l,o*l+J*r,0,o*r+J*l,v*r+m,v*l-J*A,0,o*l-J*r,v*l+J*A,b*l*l+m,0,0,0,0,1),this},multiply:function(Q){return this.multiplyMatrices(this,Q)},premultiply:function(s){return this.multiplyMatrices(s,this)},multiplyMatrices:function(_,a){var Y=_.el,q=a.el,u=this.el,D=Y[0],s=Y[4],d=Y[8],f=Y[12],y=Y[1],M=Y[5],E=Y[9],T=Y[13],p=Y[2],H=Y[6],h=Y[10],J=Y[14],c=Y[3],j=Y[7],P=Y[11],I=Y[15],g=q[0],w=q[4],o=q[8],l=q[12],n=q[1],G=q[5],e=q[9],v=q[13],Z=q[2],i=q[6],x=q[10],U=q[14],O=q[3],F=q[7],A=q[11],N=q[15];return u[0]=D*g+s*n+d*Z+f*O,u[4]=D*w+s*G+d*i+f*F,u[8]=D*o+s*e+d*x+f*A,u[12]=D*l+s*v+d*U+f*N,u[1]=y*g+M*n+E*Z+T*O,u[5]=y*w+M*G+E*i+T*F,u[9]=y*o+M*e+E*x+T*A,u[13]=y*l+M*v+E*U+T*N,u[2]=p*g+H*n+h*Z+J*O,u[6]=p*w+H*G+h*i+J*F,u[10]=p*o+H*e+h*x+J*A,u[14]=p*l+H*v+h*U+J*N,u[3]=c*g+j*n+P*Z+I*O,u[7]=c*w+j*G+P*i+I*F,u[11]=c*o+j*e+P*x+I*A,u[15]=c*l+j*v+P*U+I*N,this},lookAt:function(){var v=new Xn;return function(y,p,s){return v.subVectors(y,p),this.lookAtDirection(v,s)}}(),lookAtDirection:function(){var h=new Xn,Z=new Xn,n=new Xn;return function(K,a){a||(a=Xn.UP);var $=this.el;return n.copy(K),0===n.lengthSq()&&(n.z=1),n.normalize(),h.crossVectors(a,n),0===h.lengthSq()&&(1===Math.abs(a.z)?n.x+=1e-4:n.z+=1e-4,n.normalize(),h.crossVectors(a,n)),h.normalize(),Z.crossVectors(n,h),$[0]=h.x,$[4]=Z.x,$[8]=n.x,$[1]=h.y,$[5]=Z.y,$[9]=n.y,$[2]=h.z,$[6]=Z.z,$[10]=n.z,this}}(),extractScale:function(){var M;return function(E){M===z&&(M=new Xn),E===z&&(E=new Xn);var l=M.setFromMatrixColumn(this,0).length(),h=M.setFromMatrixColumn(this,1).length(),n=M.setFromMatrixColumn(this,2).length();return E.set(l,h,n),E}}(),extractRotation:function(){var m;return function(B){m===z&&(m=new Xn),B===z&&(B=new qc);var M=this.el,U=B.el,e=1/m.setFromMatrixColumn(B,0).length(),O=1/m.setFromMatrixColumn(B,1).length(),b=1/m.setFromMatrixColumn(B,2).length();return M[0]=U[0]*e,M[1]=U[1]*e,M[2]=U[2]*e,M[4]=U[4]*O,M[5]=U[5]*O,M[6]=U[6]*O,M[8]=U[8]*b,M[9]=U[9]*b,M[10]=U[10]*b,this}}(),multiplyScalar:function(E){var Q=this.el;return Q[0]*=E,Q[4]*=E,Q[8]*=E,Q[12]*=E,Q[1]*=E,Q[5]*=E,Q[9]*=E,Q[13]*=E,Q[2]*=E,Q[6]*=E,Q[10]*=E,Q[14]*=E,Q[3]*=E,Q[7]*=E,Q[11]*=E,Q[15]*=E,this},getPosition:function(p){return p===z&&(p=new Xn),p.setFromMatrixColumn(this,3)},setPosition:function(k){var Z=this.el;return Z[12]=k.x,Z[13]=k.y,Z[14]=k.z,this},copyPosition:function(e){var q=this.el,U=e.el;return q[12]=U[12],q[13]=U[13],q[14]=U[14],this},toArray:function(h,$){h===z&&(h=[]),$===z&&($=0);var F=this.el;return h[$]=F[0],h[$+1]=F[1],h[$+2]=F[2],h[$+3]=F[3],h[$+4]=F[4],h[$+5]=F[5],h[$+6]=F[6],h[$+7]=F[7],h[$+8]=F[8],h[$+9]=F[9],h[$+10]=F[10],h[$+11]=F[11],h[$+12]=F[12],h[$+13]=F[13],h[$+14]=F[14],h[$+15]=F[15],h},determinant:function(){var j=this.el,O=j[0],r=j[4],W=j[8],g=j[12],E=j[1],m=j[5],z=j[9],C=j[13],B=j[2],$=j[6],t=j[10],q=j[14],o=j[3],K=j[7],d=j[11],V=j[15];
return o*(+g*z*$-W*C*$-g*m*t+r*C*t+W*m*q-r*z*q)+K*(+O*z*q-O*C*t+g*E*t-W*E*q+W*C*B-g*z*B)+d*(+O*C*$-O*m*q-g*E*$+r*E*q+g*m*B-r*C*B)+V*(-W*m*B-O*z*$+O*m*t+W*E*$-r*E*t+r*z*B)},copy:function(c){var K=this.el,P=c.el;return K[0]=P[0],K[1]=P[1],K[2]=P[2],K[3]=P[3],K[4]=P[4],K[5]=P[5],K[6]=P[6],K[7]=P[7],K[8]=P[8],K[9]=P[9],K[10]=P[10],K[11]=P[11],K[12]=P[12],K[13]=P[13],K[14]=P[14],K[15]=P[15],this},compose:function(x,P,R){var I=this.el,Y=P._x,u=P._y,i=P._z,Z=P._w,M=Y+Y,a=u+u,k=i+i,p=Y*M,O=Y*a,U=Y*k,Q=u*a,$=u*k,B=i*k,c=Z*M,j=Z*a,g=Z*k,t=R.x,r=R.y,y=R.z;return I[0]=(1-(Q+B))*t,I[1]=(O+g)*t,I[2]=(U-j)*t,I[3]=0,I[4]=(O-g)*r,I[5]=(1-(p+B))*r,I[6]=($+c)*r,I[7]=0,I[8]=(U+j)*y,I[9]=($-c)*y,I[10]=(1-(p+Q))*y,I[11]=0,I[12]=x.x,I[13]=x.y,I[14]=x.z,I[15]=1,this},decompose:function(){var Z=new Xn,z=new qc;return function(h,g,m){var J=this.el,I=Z.set(J[0],J[1],J[2]).length(),x=Z.set(J[4],J[5],J[6]).length(),c=Z.set(J[8],J[9],J[10]).length(),R=this.determinant();0>R&&(I=-I),h.x=J[12],h.y=J[13],h.z=J[14],z.copy(this);var K=1/I,d=1/x,a=1/c;return z.el[0]*=K,z.el[1]*=K,z.el[2]*=K,z.el[4]*=d,z.el[5]*=d,z.el[6]*=d,z.el[8]*=a,z.el[9]*=a,z.el[10]*=a,g.setFromRotationMatrix(z),m.x=I,m.y=x,m.z=c,this}}(),equals:function(Y){for(var r=this.el,D=Y.el,y=0;16>y;y++)if(r[y]!==D[y])return!1;return!0}}),new qc,new qc;var Sn=B.Math.Triangle=function(I,r,S){this.a=I!==z?I:new Xn,this.b=r!==z?r:new Xn,this.c=S!==z?S:new Xn};T.assign(Sn,{barycoordFromPoint:function(){var Z=new Xn,I=new Xn,c=new Xn;return function(Y,K,i,v,n){Z.subVectors(v,K),I.subVectors(i,K),c.subVectors(Y,K);var l=Z.dot(Z),r=Z.dot(I),h=Z.dot(c),G=I.dot(I),x=I.dot(c),H=l*G-r*r,w=n||new Xn;if(0===H)return w.set(-2,-1,-1);var e=1/H,j=(G*h-r*x)*e,p=(l*x-r*h)*e;return w.set(1-j-p,p,j)}}(),uvIntersection:function(){var F=new Xn;return function(t,S,P,H,p,U,M){return Sn.barycoordFromPoint(t,S,P,H,F),p.multiplyScalar(F.x),U.multiplyScalar(F.y),M.multiplyScalar(F.z),p.add(U).add(M),p.clone()}}()});var vb=B.Math.Euler=function(K,P,b,N,w){this.set(K,P,b,N,w)};vb.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],vb.DefaultOrder="XYZ",vb.ReverseOrder=function(){var e={xyz:"ZYX",xzy:"YZX",yxz:"ZXY",yzx:"XZY",zxy:"YXZ",zyx:"XYZ"};return function(t){return e[t]}}(),T.defineProperties(vb.prototype,{x:{get:function(){return this._x},set:function(T){this._x=T,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(s){this._y=s,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(f){this._z=f,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(x){this._order=x,this.onChangeCallback()}}}),T.assign(vb.prototype,{set:function(K,t,k,E,S){return ar(K)&&(S=k,E=t,k=K[2],t=K[1],K=K[0]),E?S&&(E=vb.ReverseOrder(E)):E="ZYX",this._x=K||0,this._y=t||0,this._z=k||0,this._order=E||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(E){return this._x=E._x,this._y=E._y,this._z=E._z,this._order=E._order,this.onChangeCallback(),this},setFromRotationMatrix:function(z,X,s){var F=B.Math.clamp,t=z.el||z,o=t[0],c=t[4],u=t[8],w=t[1],Q=t[5],H=t[9],J=t[2],n=t[6],L=t[10];return X=X||this._order,"XYZ"===X?(this._y=Math.asin(F(u,-1,1)),Math.abs(u)<.99999?(this._x=Math.atan2(-H,L),this._z=Math.atan2(-c,o)):(this._x=Math.atan2(n,Q),this._z=0)):"YXZ"===X?(this._x=Math.asin(-F(H,-1,1)),Math.abs(H)<.99999?(this._y=Math.atan2(u,L),this._z=Math.atan2(w,Q)):(this._y=Math.atan2(-J,o),this._z=0)):"ZXY"===X?(this._x=Math.asin(F(n,-1,1)),Math.abs(n)<.99999?(this._y=Math.atan2(-J,L),this._z=Math.atan2(-c,Q)):(this._y=0,this._z=Math.atan2(w,o))):"ZYX"===X?(this._y=Math.asin(-F(J,-1,1)),Math.abs(J)<.99999?(this._x=Math.atan2(n,L),this._z=Math.atan2(w,o)):(this._x=0,this._z=Math.atan2(-c,Q))):"YZX"===X?(this._z=Math.asin(F(w,-1,1)),Math.abs(w)<.99999?(this._x=Math.atan2(-H,Q),this._y=Math.atan2(-J,o)):(this._x=0,this._y=Math.atan2(u,L))):"XZY"===X?(this._z=Math.asin(-F(c,-1,1)),Math.abs(c)<.99999?(this._x=Math.atan2(n,Q),this._y=Math.atan2(u,o)):(this._x=Math.atan2(-H,L),this._y=0)):console.warn("unsupported order: "+X),this._order=X,s!==!1&&this.onChangeCallback(),this},setFromQuaternion:function(){var g=new qc;return function(V,M,W){return g.makeRotationFromQuaternion(V),this.setFromRotationMatrix(g,M,W)}}(),setFromVector3:function(f,P){return this.set(f.x,f.y,f.z,P||this._order)},reorder:function(){var y=new Hm;return function(r){return y.setFromEuler(this),this.setFromQuaternion(y,r)}}(),equals:function(s){return s._x===this._x&&s._y===this._y&&s._z===this._z&&s._order===this._order},fromArray:function(I){return this._x=I[0],this._y=I[1],this._z=I[2],I[3]!==z&&(this._order=I[3]),this.onChangeCallback(),this},toArray:function(d,b){return d===z&&(d=[]),b===z&&(b=0),d[b]=this._x,d[b+1]=this._y,d[b+2]=this._z,d[b+3]=this._order,d},toVector3:function(L){return L?L.set(this._x,this._y,this._z):new Xn(this._x,this._y,this._z)},onChange:function(P){return this.onChangeCallback=P,this},onChangeCallback:function(){}});var ng={ms_ac:function(Y,h){for(var G=h.ms_ac,W=0;W<G.length;W++)Yh(Y,G[W])},ms_listener:function(w){w.addListeners=function(){var n=this,i=Qg;R.mockTouch&&(i=qn.concat(Vf).concat(em)),n.__events__=i;for(var W=0,B=i.length;B>W;W++){var c=i[W];"wheel"===c&&!n.handle_wheel&&n.handle_mousewheel&&(n.handle_wheel=function(x){Sm(n,x)}),n["handle_"+c]&&bo(c,n.getView(),n)}},w.removeListeners=function(){var A=this,m=A.__events__;if(m){A.__events__=z;for(var d=0,i=m.length;i>d;d++)A["handle_"+m[d]]&&Vq(m[d],A.getView(),A)}}},ms_fire:function(q){q.mp=function(B,H,$){this.addPropertyChangeListener(B,H,$)},q.ump=function(K,d){this.removePropertyChangeListener(K,d)},q.fp=function(I,f,z,R,e){return this.firePropertyChange(I,f,z,R,e)},q.addPropertyChangeListener=function(F,K,r){var J=this;J._62I||(J._62I=new Tn),J._62I.add(F,K,r)},q.removePropertyChangeListener=function(M,X){this._62I&&this._62I.remove(M,X)},q.firePropertyChange=function(I,f,e,B,l){if(B){if(B(f,e))return!1}else if(f===e)return!1;var b=this,M=l||{};return M.property=I,M.oldValue=f,M.newValue=e,M.source=b,M.data=b,b._62I&&b._62I.fire(M),b.onPropertyChanged&&b.onPropertyChanged(M),!0}},ms_attr:function(W){W.a=function(w,b){var C=this;if(2===arguments.length)C.setAttr(w,b);else{if(!Pd(w))return C.getAttr(w);for(var Z in w)C.setAttr(Z,w[Z])}return C},W.getAttr=function(V,P){if(P===z&&(P=1),this._attrObject&&V in this._attrObject)return this._attrObject[V];if(this.getImage){var C=this.getImage();if(Fc(C)&&(C=rb[C]),Pd(C)&&"dataBindings"in C)for(var u=C.dataBindings,Z=u.length-1;Z>=0;Z--){var W=u[Z];if(W.attr===V){if("defaultValue"in W)return W.defaultValue;break}}}return P?h[V]:z},W.setAttr=function(H,J){var $=this;$._attrObject||($._attrObject={});var V=$._attrObject[H];J===z?delete $._attrObject[H]:$._attrObject[H]=J,$.fp&&$.fp("a:"+H,V,J)&&$.onAttrChanged&&$.onAttrChanged(H,V,J)},W.getSerializableAttrs=function(){var e,K={};for(e in this._attrObject)K[e]=1;return K}},ms_bnb:function(C){C.getBodyColor=function(z){return z.s("body.color")},C.getBorderColor=function(D){return D.s("border.color")}},_51o:function(J){J.mi=function(o,a,B){this.addInteractorListener(o,a,B)},J.umi=function(d,h){this.removeInteractorListener(d,h)},J.fi=function(Z){this.fireInteractorEvent(Z)},J.addInteractorListener=function($,C,_){var P=this;P._63I||(P._63I=new Tn),P._63I.add($,C,_)},J.removeInteractorListener=function(D,l){this._63I&&this._63I.remove(D,l)},J.fireInteractorEvent=function(e){this._63I&&this._63I.fire(e)},J.setInteractors=function(_){var O=this,n=O._interactors;n&&n.each(function(I){I.tearDown()}),ar(_)&&(_=new Gk(_)),O._interactors=_,_&&_.each(function(f){f.setUp()}),O.fp("interactors",n,_),O.invalidateSelection()},J.getInteractors=function(){return this._interactors}},_49o:function(v){v._44O=I,v._45O=I,v.getTopPainters=function(){return this._44O},v.getBottomPainters=function(){return this._45O},v.addTopPainter=function(t){var Y=this;Y._44O||(Y._44O=new Gk),Y._44O.contains(t)||(Y._44O.add(t),Y.redraw&&Y.redraw())},v.removeTopPainter=function(Z){var _=this;_._44O&&(_._44O.remove(Z),_.redraw&&_.redraw())},v.addBottomPainter=function(Y){var C=this;C._45O||(C._45O=new Gk),C._45O.contains(Y)||(C._45O.add(Y),C.redraw&&C.redraw())},v.removeBottomPainter=function(P){var y=this;y._45O&&(y._45O.remove(P),y.redraw&&y.redraw())},v._93db=function(N,X){var S=this;S._45O&&S._45O.each(function(Z){Z.draw?Z.draw(N,X):Z.call(S,N,X)})},v._92db=function(F,r){var N=this;N._44O&&N._44O.each(function(O){O.draw?O.draw(F,r):O.call(N,F,r)})}},ms_sm:function(g){g.sm=function(){return this.getSelectionModel()},g.setSelectableFunc=function(T){this.sm().setFilterFunc(T)},g.getSelectableFunc=function(){return this.sm().getFilterFunc()},g.getSelectionModel=function(){var e=this;return e._selectionModel?e._selectionModel:e.dm().sm()},g.isSelectionModelShared=function(){return!this._selectionModel},g.setSelectionModelShared=function($){var L=this,V=L.sm(),P=!L._selectionModel,Y=L.handleSelectionChange,Q=L.dm();P!==$&&(L.invalidateSelection&&L.invalidateSelection(),$?(Q.sm().ms(Y,L),L._selectionModel.ums(Y,L),L._selectionModel.dispose(),L._selectionModel=I):(Q.sm().ums(Y,L),L._selectionModel=new Gc(Q),L._selectionModel.ms(Y,L)),L.onSelectionModelSharedChanged(),L.fp("selectionModelShared",P,$),L.fireViewEvent({kind:"selectionModelSharedChange",oldValue:P,newValue:$,oldSelectionModel:V,newSelectionModel:L.sm()}))},g.onSelectionModelSharedChanged=function(){var x=this;x.redraw(),x.invalidateSelection&&x.invalidateSelection()},g.removeSelection=function(){var U=this.dm();U.beginTransaction(),this.sm().toSelection().each(U.remove,U),U.endTransaction()},g.selectAll=function(){var S=this;S.sm().ss(S.dm().toDatas(function(P){return S.isVisible(P)&&S.isSelectable(P)}))},g.isSelected=function(c){return this.sm().co(c)},g.isSelectedById=function(r){var S=this.dm().getDataById(r);return S?this.isSelected(S):!1},g.isSelectable=function(u){return this.sm().isSelectable(u)}},ms_tx:function(v){v._64I=0,v._65O=0,v.isScrollable=function(){return this.getWidth()<this._64I},v._40o=function(){return this.isScrollable()},v.getLogicalPoint=function(c){return Lf(c,this._canvas||this._view,this.tx(),this.ty?this.ty():0)},v.tx=function(S){return S===z?this.getTranslateX():(this.setTranslateX(S),void 0)},v.getTranslateX=function(){return this._65O},v.setTranslateX=function(y){var s=this,w=s.getWidth()-s._64I;w>y&&(y=w),y>0&&(y=0),y=H(y);var F=s._65O;s._65O=y,s.fp(_h,F,y)}},ms_ty:function(q){q._23Q=0,q._66O=0,q._41o=function(){return this.getHeight()<this._23Q},q.getLogicalPoint=function(w){return Lf(w,this._canvas||this._view,this.tx?this.tx():0,this.ty())},q.ty=function(G){return G===z?this.getTranslateY():(this.setTranslateY(G),void 0)},q.getTranslateY=function(){return this._66O},q.setTranslateY=function(G){var E=this,P=E.getHeight()-E._23Q;P>G&&(G=P),G>0&&(G=0),G=H(G);var k=E._66O;E._66O=G,E.fp(Gp,k,G)}},ms_txy:function(i){i._65O=0,i._66O=0,i.tx=function(r){return r===z?this.getTranslateX():(this.setTranslateX(r),void 0)},i.ty=function(n){return n===z?this.getTranslateY():(this.setTranslateY(n),void 0)},i.onTranslateEnded=function(){},i.setTranslate=function(o,y,h){var S=this;if(h=wj(h)){S._65I&&S._65I.stop(!0);var U=S.tx(),x=S.ty();h.action=function(t){S.setTranslate(U+(o-U)*t,x+(y-x)*t)},h._37o=function(){delete S._66I,delete S._65I,S.onTranslateEnded()},S._66I=1,S._65I=$h(h)}else S.tx(o),S.ty(y)},i.getTranslateX=function(){return this._65O},i.setTranslateX=function(w){var R=this;w=R.adjustTranslateX(w);var Z=R._65O;R._65O=w,R.fp(_h,Z,w)},i.getTranslateY=function(){return this._66O},i.setTranslateY=function(y){var q=this;y=q.adjustTranslateY(y);var r=q._66O;q._66O=y,q.fp(Gp,r,y)},i.adjustTranslateX=function(Q){return H(Q)},i.adjustTranslateY=function(o){return H(o)},i.translate=function(m,z,Y){this.setTranslate(this.tx()+m,this.ty()+z,Y)},i.getLogicalPoint=function(S){var G=this;return Lf(S,this._canvas||G._view,G.tx(),G.ty())}},ms_dm:function(t){t.dm=function(B){return B?(this.setDataModel(B),void 0):this.getDataModel()},t.getDataModel=function(){return this._dataModel}},ms_lp:function(J){J.lp=function(J){return this.getLogicalPoint(J)}},ms_v:function(P){P._disabled=!1,P.setDisabled=function(v,K){var J=this,p=J._disabled;p!==v&&(p&&(Pp(J._63O),delete J._63O),v&&(Ul(J._view,J._63O=sl(K)),J.iv()),J._disabled=v,J.fp("disabled",p,v))},P.isDisabled=function(){return this._disabled},P.getDisabledDiv=function(){return this._63O},P.getView=function(){return this._view},P.addToDOM=function(I){var A=this,Z=A.getView(),z=Z.style;I=I||e.body,I.appendChild(Z),z.left="0",z.right="0",z.top="0",z.bottom="0",j(V,"resize",function(){A.iv()}),A.iv()},P.setCursor=function(W){"default"===W&&(W=this._defaultCursor||W);var T=this.getView().style;T.cursor=W,T.cursor="-webkit-"+W,T.cursor="-moz-"+W},P.getWidth=function(){return this._view.clientWidth},P.getHeight=function(){return this._view.clientHeight},P.setWidth=function(e){var K=this;K._view.style.width=e+Mq,K.iv(),K.fp&&K.fp(xo,I,e)},P.setHeight=function(g){var l=this;l._view.style.height=g+Mq,l.iv(),l.fp&&l.fp(jc,I,g)},P.setFocus=function(V){var i=this,s=i._currentEditor;return V&&s&&(s.getView&&(s=s.getView()),s.contains(V.target))?!1:(Sk(i._view),i.endEditing&&i.endEditing(),i.fireViewEvent("focus"),!0)},P.iv=function(K){this.invalidate(K)},P.invalidate=function(k){var Q=this;Q._68I||(Q._68I=1,Q._ivTimerId=ed(Q._validateImpl,Q,I,k),Q._ivTimerDelay=k,Q.onInvalidated&&Q.onInvalidated(),Q.fireViewEvent("invalidate"))},P.validate=function(){var w=this._ivTimerId,r=this._ivTimerDelay;this._validateImpl()!==!1&&w&&nk(w,r)},P._validateImpl=function(){var v=this,A=v._view;if(!v._68I)return!1;if(delete v._68I,A.parentNode)if(0===A.offsetWidth&&0===A.offsetHeight&&v._67I!==I)v._67I===z&&(v._67I=R.reinvalidateCount),v._67I>0?v._67I--:v._67I=I,v.iv();else{v.fireViewEvent("beginValidate"),v.validateImpl(),v.onValidated&&v.onValidated(),v.fireViewEvent("validate");var x=v._63O;x&&(A.lastChild!==x&&(Pp(x),Ul(A,x)),Ae(x,0,0,v.getWidth(),v.getHeight())),Rf(v),rm(v),Yg(v)}},P.layout=function(p,e,g,O){1===arguments.length?Ae(this,p):Ae(this,p,e,g,O)},P.addViewListener=function(A,r,I){var R=this;R._67O||(R._67O=new Tn),R._67O.add(A,r,I)},P.removeViewListener=function(Y,B){this._67O.remove(Y,B)},P.fireViewEvent=function(z){var S=this;S._67O&&(Fc(z)&&(z={kind:z}),S._67O.fire(z)),R.viewListener&&R.viewListener(S,z)}},ms_tip:function(X){X.setToolTipEnabled=function(G){var p=this;G?gj||p._13o||(p.enableToolTip(),p.fp("toolTipEnabled",!1,!0)):p._13o&&(p.disableToolTip(),p.fp("toolTipEnabled",!0,!1))},X.isToolTipEnabled=function(){return!!this._13o},X.enableToolTip=function(){var g=this;if(!gj&&!g._13o){g._13o=function(t){if(!t.toolTipView){t.toolTipView=g;var P=g.getToolTip(t);P!=I?(R.toolTipContinual&&R.isToolTipShowing()?kb(t,P):(xf(),Lb={timeout:hl(Gl,$o),e:t,info:P}),Wi={e:t,view:g}):xf()}};var P=g.getView();j(P,ho,g._13o),j(P,"mouseleave",R.hideToolTip)}},X.disableToolTip=function(){var k=this;if(k._13o){var B=k.getView();W(B,ho,k._13o),W(B,"mouseleave",R.hideToolTip),delete k._13o}},X.getToolTip=function(N){var Y=this;if(Y.getDataAt){var e=Y.getDataAt(N);return e?e.getToolTip():I}return Y.getValue?Y.getValue():void 0}},_52o:function(L){L._zoom=1,L._29I=Mn,L.zoomIn=function(T,N){this.setZoom(this._zoom*ms,T,N)},L.zoomOut=function(i,h){this.setZoom(this._zoom/ms,i,h)},L.zoomReset=function(e,b){this.setZoom(1,e,b)},L.scrollZoomIn=function(p){this.setZoom(this._zoom*Vb,I,p)},L.scrollZoomOut=function(V){this.setZoom(this._zoom/Vb,I,V)},L.pinchZoomIn=function(B){this.setZoom(this._zoom*Wp,I,B)},L.pinchZoomOut=function(J){this.setZoom(this._zoom/Wp,I,J)},L.adjustZoom=function(K){return Hf>K?Hf:K>fq?fq:K},L.getZoom=function(){return this._zoom},L.setZoom=function(t,i,e){var Q=this;if(i=wj(i)){Q._14o&&Q._14o.stop(!0);var o=Q._zoom;i.action=function(w){Q._96O(o+(t-o)*w,e)},i._37o=function(){delete Q._zooming,delete Q._14o,Q.onZoomEnded()},Q._zooming=1,Q._14o=$h(i)}else Q._96O(t,e)},L._96O=function(B,H){var I=this;if(B=I.adjustZoom(B),B!==I._zoom){I.validate();var R=I._29I,J=I._zoom;0!==R.width&&0!==R.height&&(H=H?H:{x:R.x+R.width/2,y:R.y+R.height/2},I.tx((H.x-R.x)*J-H.x*B),I.ty((H.y-R.y)*J-H.y*B)),I._zoom=B,I.fp("zoom",J,B)}}},ms_edge:function(I){I._2I=function(D){var v=this;v._44I||(v._44I=new Gk),v._42I||(v._42I=new Gk),v._44I.add(D),v._42I.add(D),v._20I()},I._4I=function(Y){var M=this;M._44I||(M._44I=new Gk),M._43I||(M._43I=new Gk),M._44I.add(Y),M._43I.add(Y),M._20I()},I._16I=function(X){var y=this;y._44I.remove(X),y._42I.remove(X),y._44I.isEmpty()&&delete y._44I,y._42I.isEmpty()&&delete y._42I,y._20I()},I._18I=function(F){var L=this;L._44I.remove(F),L._43I.remove(F),L._44I.isEmpty()&&delete L._44I,L._43I.isEmpty()&&delete L._43I,L._20I()},I._20I=function(){var A=this;if(delete A._45I,!A._44I||A._44I.isEmpty())return delete A._70O,void 0;var I;A._44I.each(function(_){_.isLooped()&&(I||(I={}),I[_._id]||(A._45I||(A._45I=new Gk),A._45I.add(_),I[_._id]=_))}),I?(A._70O=new Gk,A._44I.each(function(y){I[y._id]?"A"===I[y._id]||(I[y._id]="A",A._70O.add(y)):A._70O.add(y)})):A._70O=A._44I},I.hasAgentEdges=function(){return!!this._49I&&!this._49I.isEmpty()},I.getSourceAgentEdges=function(){return this._46I},I.getTargetAgentEdges=function(){return this._47I},I._1I=function(U){var s=this;s._46I||(s._46I=new Gk),s._48I||(s._48I=new Gk),s._46I.add(U),s._48I.add(U),s._19I()},I._3I=function(r){var e=this;e._47I||(e._47I=new Gk),e._48I||(e._48I=new Gk),e._47I.add(r),e._48I.add(r),e._19I()},I._15I=function(a){var H=this;H._46I.remove(a),H._48I.remove(a),H._46I.isEmpty()&&delete H._46I,H._48I.isEmpty()&&delete H._48I,H._19I()},I._17I=function(y){var d=this;d._47I.remove(y),d._48I.remove(y),d._47I.isEmpty()&&delete d._47I,d._48I.isEmpty()&&delete d._48I,d._19I()},I._19I=function(){var R=this;delete R._49I;var e=R._48I;if(e&&!e.isEmpty()){var H={};e.each(function(U){H[U._id]?R._49I||(R._49I=new Gk):H[U._id]=U}),R._49I?e.each(function(B){H[B._id]&&(R._49I.add(B),delete H[B._id])}):R._49I=e}},I.getLoopedEdges=function(){return this._45I},I.getEdges=function(){return this._70O},I.getAgentEdges=function(){return this._49I},I.getSourceEdges=function(){return this._42I},I.getTargetEdges=function(){return this._43I},I._8I=function(){this._70O&&this._70O.each(function(B){B._7I()})}}};Wn(R,{getVersion:function(){return"7.3.1"}},!0);var pr=function($){return $.devicePixelRatio?$.devicePixelRatio:$.screen&&$.screen.logicalXDPI?$.screen.deviceXDPI/$.screen.logicalXDPI:1};Wn(R,{numberDigits:5,crossOrigin:"",baseZIndex:z,isTouchable:gj,mockTouch:!0,devicePixelRatio:pr(V),reinvalidateCount:3,hitMaxArea:3e3,imageCacheThreshold:20,autoMakeVisible:!0,autoHideScrollBar:!0,disabledOpacity:.4,disabledBackground:r.disabledBackground,forceHierarchicalSerialization:!0,extractBatchTranslation:!1,extractShapeTranslation:!1,extractPolylineTranslation:!1,extractVerticesTranslation:!1,envmapProbeMinWaitTime:300,envmapProbeMaxWaitTime:25e3,EnvmapTextureSize:1024,hoverDelay:600,clickDelay:200,toolTipDelay:800,toolTipContinual:!1,getDragger:function(){return _l},lineCap:"butt",lineJoin:"round",imageGradient:"linear.northeast",dashPattern:[16,16],blockMinSize:1,textExtraWidth:4,encodeStringKey:null,doubleClickSpeed:500,doubleClickRange:1,doubleTouchRange:20,touchMoveThreshold:10,animDuration:200,animEasing:function(S){return S*S},labelColor:nm,labelSelectColor:_j,labelFont:"12px arial, sans-serif",widgetIndent:gj?30:20,widgetRowHeight:gj?30:20,widgetHeaderHeight:gj?32:22,widgetTitleHeight:gj?34:24,scrollBarColor:ys,scrollBarSize:7,scrollBarTimeout:1e3,scrollBarMinLength:20,scrollBarInteractiveSize:gj?32:16,zoomIncrement:1.3,scrollZoomIncrement:1.05,pinchZoomIncrement:1.08,pinchZoomThreshold:1,zoomMax:20,zoomMin:.01,segmentResolution:12,shapeResolution:24,shapeSide:24,intersectionLineRect:Mm,intersectionLineLine:ek,isEnter:$r,isEsc:Nn,isDelete:Zr,isSpace:tl,isLeft:so,isUp:Kc,isRight:lf,isDown:Yb,isTouchEvent:gp,getTarget:kp,isString:Fc,isNumber:gs,isBoolean:ki,isArray:ar,isSelectAll:bm,isFunction:Hn,isObject:Pd,getPropertyValue:ie,setPropertyValue:Se,addMethod:Wn,createGradient:function(H,l,P,S,n,X,Q,T){var e=ld[l];return e(H,P,S,n,X,Q,T)},appendToScreen:function(m){m=m.getView?m.getView():m,(e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement||e.body).appendChild(m)},encodeString:function(t){return B.Math.encodeBase64(t,R.encodeStringKey)},decodeString:function(k){return B.Math.decodeBase64(k,R.encodeStringKey)},findView:function(u){var B=function(e,d){var X=d._ht;X&&e.push(X);var Y=d.children,f=Y.length;if(f)for(var b=0;f>b;b++)B(e,Y[b])},V=[];B(V,e.body);var y=function(o,S){for(var T="2d"===S?Ap.GraphView:lp.Graph3dView,F=0,B=o.length;B>F;F++)if(o[F]instanceof T)return V[F];return null};return"all"===u?V:"2d"===u?y(V,"2d"):"3d"===u?y(V,"3d"):y(V,"3d")||y(V,"2d")},toggleFullscreen:function(D){var S=D.getView();if(e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement)e.exitFullscreen?e.exitFullscreen():e.msExitFullscreen?e.msExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitExitFullscreen&&e.webkitExitFullscreen();else{var n=!0;if(D.isSelfViewEvent){var q=D.getX(),Q=D.getY(),L=D.getWidth(),W=D.getHeight(),M=S.style.background,J=S.style.backgroundColor;M||J||(S.style.backgroundColor="white"),S.requestFullscreen?S.requestFullscreen():S.msRequestFullscreen?S.msRequestFullscreen():S.mozRequestFullScreen?S.mozRequestFullScreen():S.webkitRequestFullscreen&&S.webkitRequestFullscreen();var C=setInterval(function(){if(S!==(e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement))clearInterval(C),D.setX(q),D.setY(Q),D.setWidth(L),D.setHeight(W),D._fullscreen=!1,S.style.oldBackgroundColor=J,D.iv();else{var H=B.Default.getWindowInfo();(n||H.width!==D.getWidth()||H.height!==D.getHeight())&&(D.setX(H.left),D.setY(H.top),D.setWidth(H.width),D.setHeight(H.height),D._fullscreen=!0,D.iv(),n=!1)}},500)}else{var r=S.style.left,K=S.style.top,L=S.style.width,W=S.style.height,M=S.style.background,J=S.style.backgroundColor;M||J||(S.style.backgroundColor="white"),S.requestFullscreen?S.requestFullscreen():S.msRequestFullscreen?S.msRequestFullscreen():S.mozRequestFullScreen?S.mozRequestFullScreen():S.webkitRequestFullscreen&&S.webkitRequestFullscreen();var C=setInterval(function(){if(S!==(e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement))clearInterval(C),S.style.left=r,S.style.top=K,S.style.width=L,S.style.height=W,S.style.oldBackgroundColor=J,D.iv();else{var c=B.Default.getWindowInfo();(n||c.width!==D.getWidth()||c.height!==D.getHeight())&&(Ae(D),n=!1)}},500)}}},appendTimeStamp:function(g){return g},setCompType:function(w,m){Fc(m)&&m.substr(0,12)==Cp&&(m=R.parse(m)),Hn(m)||Pd(m)?iq[w]=m:Bo(w)},getCompType:function(x){var P=iq[x];return P===z&&Jq.test(x)&&Bo(x),P},getCompTypeMap:function(){return iq},drawCompType:function(X,V,S,Y,c,z){X(V,S,Y,c,z)},numberListener:function(){var y={46:1,8:1,9:1,27:1,13:1,109:1,110:1,189:1,190:1};return function(c){var G=c.keyCode;y[G]||65===G&&R.isCtrlDown(c)||86===G&&R.isCtrlDown(c)||67===G&&R.isCtrlDown(c)||88===G&&R.isCtrlDown(c)||G>=35&&40>=G||(c.shiftKey||48>G||G>57)&&(96>G||G>105)&&c.preventDefault()}}(),ignoreKeyCodes:[122,123],preventDefault:function(N){var u=N.target.tagName;("DIV"===u||"CANVAS"===u)&&!(R.ignoreKeyCodes.indexOf(N.keyCode)>=0)&&("keydown"!==N.type||so(N)||lf(N)||Kc(N)||Yb(N)||Zr(N)||65===N.keyCode&&(N.metaKey||N.ctrlKey))&&N.cancelable===!0&&(N.preventDefault(),N.preventManipulation&&N.preventManipulation())},getWindowInfo:function(){var u=e.documentElement,n=u&&(u.scrollLeft||u.scrollTop)?u:e.body;return{target:n,left:n.scrollLeft,top:n.scrollTop,width:V.innerWidth||n.clientWidth,height:V.innerHeight||n.clientHeight}},isDragging:function(){return!!_l},isLeftButton:function(R){return gp(R)?!0:0===R.button},isMiddleButton:function(w){return gp(w)?!1:w&&(1===w.button||4&(w.buttons||0))},isRightButton:function(m){return gp(m)?!1:m&&(2===m.button||2&(m.buttons||0))},isInput:function(Q){if(!Q)return!1;var L=Q.tagName;return"INPUT"===L||"TEXTAREA"===L||"SELECT"===L},getTouchCount:function(y){return gp(y)?y.touches.length:1},isDoubleClick:function(){function f(N){N.details=0,N.timeout=null,N.lastPoint=null}var k={};return zn=new Ze,Xb=zn.getTime(),function(S){if(Gg(S)>1)return!1;var O=S.button==I?"":S.button,H=S.type+O,Y=H+"_isDoubleClick",B=k[H];if(B||(B=k[H]={details:0,timeout:null,lastPoint:null}),S[Y]===z){S[Y]=!0;var $=Po(S);B.timeout&&(xq(B.timeout),B.timeout=null);var s=gp(S)?R.doubleTouchRange:R.doubleClickRange;B.lastPoint&&Jc(B.lastPoint,$)>s&&f(B),B.lastPoint=$,B.details++,B.timeout=hl(function(){f(this)}.bind(B),R.doubleClickSpeed)}return 2===B.details}}(),isShiftDown:function(f){return f?f.shiftKey:_i["16"]},isCtrlDown:function(V){return V?dn?V.metaKey:V.ctrlKey:dn?_i["91"]:_i["17"]},getClientPoint:function(O){return gp(O)&&(O=Vc(O)),{x:O.clientX,y:O.clientY}},isMouseEvent:function(_){return _ instanceof MouseEvent||0===_.type.indexOf("mouse")},getTargetElement:function(M){var S,F=Af(M);if(S=R.isMouseEvent(M)||!e.elementFromPoint?M.target:e.elementFromPoint(F.x,F.y),dq&&e.elementFromPoint){for(var p=[],n=[];"none"===S.style.pointerEvents;)p.push(S),n.push(S.style.display||""),S.style.display="none",S=e.elementFromPoint(F.x,F.y);p.forEach(function(N,J){N.style.display=n[J]})}return S},getPagePoint:function(f){return gp(f)&&(f=Vc(f)),{x:f.pageX,y:f.pageY}},createObject:function(z,f){var Q=new z;for(var C in f){var h=f[C];if(Hn(h))Q[C]=h;else if(0===C.indexOf("s:"))Q.s(C.substr(2),f[C]);else if(0===C.indexOf("a:"))Q.a(C.substr(2),f[C]);else{var c=uo(C),h=f[C];Q[c]?(Q[c](h),"setToolTip"===c&&Q.enableToolTip&&Q.enableToolTip()):Q[C]=h}}return Q},setImage:function(j,s,r,S){var N=arguments.length;4===N?wh(j,S,s,r):2===N?Fc(s)?s.substr(0,12)==Cp?Pi(j,R.parse(s)):wh(j,s):Pi(j,s):1===N&&wh(j,j)},getImage:function(C,n,h){var F;if(C==I)return I;if(Pd(C)?F=C:(F=rb[C],C&&F===z&&(oe&&oe[C]||wh(C,C))),n&&F&&F.tagName){var y;y="override"===h?"colors_override":"override_rgb"===h?"colors_override_rgb":"override_a"===h?"colors_override_a":"colors",F[y]||(F[y]={__count__:0});var a=F[y][n];return a||(F[y].__count__>R.imageCacheThreshold&&(F[y]={__count__:0}),a=Nh(F,$m(n),F.width,F.height,h),F[y][n]=a,F[y].__count__++),a}return F},isImageComplete:function(A,l,r){var U=Td(A);if(!U)return!1;if(U.tagName)return U.complete;for(var M,A,X,T=U.comps,x=!0,P=0,j=T.length;j>P;P++)if(M=T[P],X=M.type,"image"===M.type){A=M.name,A&&A.func&&(A=tp(A,l));var m=sg(A,l,r);if(!m){x=!1;break}}else if(Jq.test(X)&&R.getCompType(X)===z){x=!1,Bo(X);break}return x},getId:function(){var A=1;return function(){return++A}}(),callLater:function($,o,T,I){var m=function(){$.apply(o,T)};return I?hl(m,I):V.requestAnimationFrame(m)},cancelLater:function(W,m){m?xq(W):V.cancelAnimationFrame(W)},clone:function(Y){if(null==Y||"object"!=typeof Y)return Y;if(Y instanceof Date){var o=new Date;return o.setTime(Y.getTime()),o}if(Y instanceof Array){for(var o=[],E=0,W=Y.length;W>E;E++)o[E]=sj(Y[E]);return o}if(Y instanceof Gk){for(var o=new Gk,E=0,W=Y.length;W>E;E++)o.set(E,sj(Y.get(E)));return o}if(Y instanceof If)return Y;if(Y instanceof Og){var o=new Og;return o.deserialize(Y.serialize()),o}if(Y instanceof T){var o={};for(var l in Y)Y.hasOwnProperty(l)&&(o[l]=sj(Y[l]));return o}return Y},callWhenLoaded:function(t,P){P=P||100;var u=Wq(t,P);Ek||(Ek={}),Ek[u]={tick:u,cb:t,delay:P}},beforeLoadURL:function(V,p){if(Ek){var b={};for(var p in Ek){var n=Ek[p];xq(n.tick);var A=Wq(n.cb,n.delay);b[A]={tick:A,delay:n.delay,cb:n.cb}}Ek=b}return R.convertURL?R.convertURL(V,p):V},convertURL:function(u){return u},handleRefGraphLoaded:function(){},handleCompTypeLoaded:function(){},handleImageLoaded:function(){},handleUnfoundImage:function(){return R.getImage("default_blank")},resizeImage:function(D,S,M,L){M||(M=S),L||(L=On());var h=L.getContext("2d");return Jk(L,S,M,1),h.drawImage(D,0,0,S,M),L},resizeImagePOT:function(m,V,X){if(!m||!m.tagName)return m;var d=m.width,K=m.height;if(!d||!K)return m;if(jl.isPOT(d)&&jl.isPOT(K)&&(!V||d===K))return m;var $,P;return V?P=$=jl.nearestPOT(Math.min(d,K)):($=jl.nearestPOT(d),P=jl.nearestPOT(K)),R.resizeImage(m,$,P,X)},sortFunc:function(A,j){if(A===j)return 0;if(A==I&&j!=I)return 1;if(A!=I&&j==I)return-1;if(A==I&&j==I)return 0;var C,p=typeof A,v=typeof j;return p===Oh&&v===Oh?C=A.localeCompare(j):p===Vj&&v===Vj&&(C=A-j),C===z&&(C=(""+A).localeCompare(""+j)),C>0?1:0>C?-1:0},getClassMap:function(){return Ej},getClass:function(k){if(Fc(k)){var p,R=Ej[k];if(!R){p=k.split("."),R=V;for(var i=0;i<p.length;i++)R=R[p[i]];Ej[k]=R}return R}return k},def:function(Y,z,s){var o,W,n,c=function(){};if(c.prototype=z.prototype,o=new c,Fc(Y)){if(Ej[Y])throw"'"+Y+"' already defined";n=Lo(Y),o.getClassName=function(){return Y}}else n=Y;if(o.constructor=n,o.getClass=function(){return n},o.getSuperClass=function(){return z},s)for(W in s)ng[W]&&ng.hasOwnProperty(W)?ng[W](o,s):Ir(o,s,W);n.prototype=o,n.superClass=z.prototype},startAnim:function(){var Q=function(H){H.duration&&(H.startTime=xn()),H.timeId=ed(H.tick,I,I,H.interval)};return function(r){return r=sj(r),r.easing=r.easing||R.animEasing,r.duration||r.frames||(r.duration=R.animDuration),r.t=0,r.duration?r.interval=0:(r.frame=0,r.interval=r.interval||10),r.tick=function(){if(r.duration){var X=(xn()-r.startTime)/r.duration;if(X>1&&(X=1),r.t=X,r.action(r.easing(X),X),!r.isRunning())return;1===X?r.stop():r._isPaused||(r.timeId=ed(r.tick))}else{if(r.frame++,X=r.t=r.frame/r.frames,r.action(r.easing(X),X),!r.isRunning())return;r.frame<r.frames?r._isPaused||(r.timeId=ed(r.tick,I,I,r.interval)):r.stop()}},r.resume=function(){r._isPaused&&(delete r._isPaused,r.duration?r.t<1&&(r.startTime=xn()-r.duration*r.t,r.timeId=ed(r.tick)):r.frame<r.frames&&(r.timeId=ed(r.tick,I,I,r.interval)))},r.pause=function(){nk(r.timeId,!r.duration),r._isPaused=!0},r.isPaused=function(){return this._isPaused},r.stop=function(j){r.isRunning()&&(nk(r.timeId,!r.duration),delete r.timeId,r.duration?r.t<1&&j&&(r.t=1,r.action(r.easing(1),1)):r.frame<r.frames&&j&&(r.frame=r.frames,r.action(r.easing(1),1)),r._37o&&r._37o(),r.finishFunc&&r.finishFunc())},r.isRunning=function(){return r.timeId!=I},r.delay?ed(Q,I,[r],r.delay):Q(r),r}}(),getTextSize:function(){var X={},J=e?On().getContext("2d"):I;return function(w,Y){J.font=w?w:sd;var l=X[J.font];return l||(l=2*J.measureText("e").width+4,X[J.font]=l),{width:J.measureText(Y).width+R.textExtraWidth,height:l}}}(),drawText:function(A,S,R,o,d,a,N,U,E,i,s){if(S!=I){var p=Pb(R,S),O={};O.y=i&&i!==hi?i===Vh?a+p.height/2:a+U-p.height/2:a+U/2,O.x=E&&E!==xi?E===Dd?d+N-p.width/2:d+N/2:d+p.width/2,yj(A,S,O,R,o),s&&ak(A,S,R,o,O.x,O.y,p.width,s)}},getDistance:function(C,m){var u=C.length;return m?3===u?a(Tp(C[0]-m[0])+Tp(C[1]-m[1])+Tp(C[2]-m[2])):2===u?a(Tp(C[0]-m[0])+Tp(C[1]-m[1])):C.z===z?a(Tp(m.x-C.x)+Tp(m.y-C.y)):a(Tp(m.x-C.x)+Tp(m.y-C.y)+Tp(m.z-C.z)):3===u?a(Tp(C[0])+Tp(C[1])+Tp(C[2])):2===u?a(Tp(C[0])+Tp(C[1])):void 0},brighter:function(k,g){return 0>g&&(g=-g),Je(k,g?g:40)},darker:function(n,X){return X>0&&(X=-X),Je(n,X?X:-40)},unionPoint:function(s,t){if(!s)return I;if(2===arguments.length)return s&&t?{x:X(s.x,t.x),y:X(s.y,t.y),width:i(s.x-t.x),height:i(s.y-t.y)}:I;var T=s;if(T._as&&(T=T._as),T.length===z)return I;var f=T.length;if(0>=f)return I;for(var D=1,B=T[0],H={x:B.x,y:B.y,width:0,height:0};f>D;D++){B=T[D];var u=X(H.x,B.x),c=o(H.x+H.width,B.x),K=X(H.y,B.y),y=o(H.y+H.height,B.y);H.x=u,H.y=K,H.width=c-u,H.height=y-K}return H},unionRect:function(t,H){if(t&&!H)return sj(t);if(!t&&H)return sj(H);if(t&&H){var Z={x:X(t.x,H.x),y:X(t.y,H.y)};return Z.width=o(t.x+t.width,H.x+H.width)-Z.x,Z.height=o(t.y+t.height,H.y+H.height)-Z.y,Z}return I},containsPoint:function(q,A,H,l){if(l!=I&&1!==l){var u=q.x+q.width/2,N=q.y+q.height/2;q={x:u-q.width/2*l,y:N-q.height/2*l,width:q.width*l,height:q.height*l}}if(H){var L=q.width/2,m=q.height/2,n=k(-H),V=F(-H),W=A.x-q.x-L,v=A.y-q.y-m;
return A={x:V*W-n*v,y:n*W+V*v},cj({x:-L,y:-m,width:q.width,height:q.height},A)}return!(!q||A.x<q.x||A.y<q.y||A.x>q.x+q.width||A.y>q.y+q.height)},containsRect:function(x,A){if(!x||!A)return!1;var k=A.x,E=A.y,f=A.width,v=A.height,$=x.width,b=x.height;if(0>($|b|f|v))return!1;var S=x.x,O=x.y;if(S>k||O>E)return!1;if($+=S,f+=k,k>=f){if($>=S||f>$)return!1}else if($>=S&&f>$)return!1;if(b+=O,v+=E,E>=v){if(b>=O||v>b)return!1}else if(b>=O&&v>b)return!1;return!0},intersectsRect:function(y,G){if(!y||!G)return!1;var Q=G.width,j=G.height,a=y.width,X=y.height;if(0>=a||0>=X||0>=Q||0>=j)return!1;var e=G.x,U=G.y,z=y.x,E=y.y;return a+=z,X+=E,Q+=e,j+=U,a>e&&X>U&&Q>z&&j>E},intersection:function(E,g){if(!E||!g)return I;var L=g.x,y=g.y,m=E.x,Y=E.y,o=L,j=y,U=m,D=Y;return o+=g.width,j+=g.height,U+=E.width,D+=E.height,m>L&&(L=m),Y>y&&(y=Y),o>U&&(o=U),j>D&&(j=D),o-=L,j-=y,0>=o||0>=j?I:{x:L,y:y,width:o,height:j}},grow:function(b,E,m){m===z&&(m=E),b.x-=E,b.y-=m,b.width=b.width+2*E,b.height=b.height+2*m},getScreenPoint:function(s,I,U,w,C,L,z){var B=U.getBoundingClientRect(),k=s*(L||1)-U.scrollLeft+(w||0),f=I*(z||1)-U.scrollTop+(C||0),t=nj(U,!1);if(t){var b=new Xn(k,f,0);return b.applyMatrix4(t),console.log(b),{x:b.x,y:b.y}}return{x:k+B.left,y:f+B.top}},getLogicalPoint:function(X,D,Z,W,d,L){var A,t,C=D.getBoundingClientRect();X.target?(Bl(X)?dn?_i["91"]=!0:_i["17"]=!0:dn?_i["91"]=!1:_i["17"]=!1,_i["16"]=Ac(X)?!0:!1,X=gp(X)?Vc(X):X,A=X.clientX,t=X.clientY):(A=X.x,t=X.y);var O=nj(D,!0);if(O){var P=new Xn(A,t,0);P.applyMatrix4(O);do{if(Math.abs(P.z)<=1e-6)break;var u=new Xn(A,t,1);if(u.applyMatrix4(matrix),Math.abs(u.z)<=1e-6){P=u;break}if(u.sub(P),Math.abs(u.z)<=1e-6)break;P.addScaledVector(u,-P.z/u.z)}while(!1);return{x:(P.x+D.scrollLeft-(Z||0))/(d||1),y:(P.y+D.scrollTop-(W||0))/(L||1)}}return{x:(A-C.left+D.scrollLeft-(Z||0))/(d||1),y:(t-C.top+D.scrollTop-(W||0))/(L||1)}},removeHTML:function(){var v;return function(Y){return Y&&Y.getView&&(Y=Y.getView()),Y&&Y.parentNode?v===Y?!0:(v=Y,Y.parentNode.removeChild(Y),v=I,!0):!1}}(),getToolTipDiv:function(){if(!Ki){Ki=eg(),Rq=eg();var f=Ki.style;R.baseZIndex!=I&&(f.zIndex=ip(R.baseZIndex)+3+""),f.whiteSpace="nowrap",f.color=R.toolTipLabelColor,f.background=R.toolTipBackground,f.font=R.toolTipLabelFont,f.padding="5px",f.boxShadow="0px 0px 3px "+R.toolTipShadowColor}return Ki},isToolTipShowing:function(){return Ki&&Ki.parentNode?!0:Rq&&Rq.parentNode?!0:!1},updateToolTipContent:function(m,x){if(R.isToolTipShowing()&&(x||(x=Wi&&Wi.view),m===z&&x&&Wi.e&&(m=x.getToolTip(Wi.e)),m!=I)){var p;m.html?(m=m.html,p=Rq):p=Ki,p.innerHTML=m}},hideToolTip:function(){if(Yi(),R.isToolTipShowing()){Pp(Ki),Pp(Rq);var e=Wi&&Wi.view;e&&e.onHideToolTip&&e.onHideToolTip(),Wi=I}},showToolTip:function(v,p,e){if(!v||p==I)return xf(),void 0;R.getToolTipDiv();var f,u;if(p.html?(p=p.html,f=Rq,Pp(Ki)):(f=Ki,Pp(Rq)),u=f.style,f.innerHTML="",p instanceof HTMLElement?f.appendChild(p):f.innerHTML=p,f.parentNode||B.Default.appendToScreen(f),v.target){v=Af(v);var m=Ff(),w=v.x,E=v.y,$=gj?60:12;if(gj){var K=f.getBoundingClientRect();u.left=w-K.width/2+Mq,u.top=E-K.height-$<m.top?E+$+Mq:E-K.height-$+Mq}else{u.left=w+$+Mq,u.top=E+$+Mq;var K=f.getBoundingClientRect();K.left+K.width>m.width&&(u.left=w-$-K.width+Mq),K.top+K.height>m.height&&(u.top=E-$-K.height+Mq),K.left<0&&(u.left=w+$+Mq),K.top<0&&(u.top=E+$+Mq)}}else u.left=v.x+Mq,u.top=v.y+Mq;Yi(),e===z?e=Wi&&Wi.view:Wi={e:v,view:e},e&&e.onShowToolTip&&e.onShowToolTip()},startDragging:function(Y,k,s){s==z&&(s=!0),Y!==_l&&(_l?s&&(gp(k)?_l.handleWindowTouchEnd(k):_l.handleWindowMouseUp(k)):gp(k)?(j(V,vj,Nm),j(V,qd,Sc),j(V,"blur",Sc)):(j(V,ho,tb),j(V,ec,gn),j(V,"blur",gn)),_l=Y)},getImageMap:function(){return rb},toBoundaries:function(M,x,r,z){var j=[];return mi(M,x,r,z).forEach(function(u){var l=[];u.forEach(function(F){l.push(F.x,F.y)}),j.push(l)}),j},getCurrentKeyCodeMap:function(){return _i},drawCenterImage:function(N,e,o,q,i,$,R,Y){!i&&$&&$.isSelfViewEvent&&(i=$);var w=nr(e,i,$),u=kd(e,i,$);cq(N,e,H(o-w/2),H(q-u/2),w,u,i,$,R,Y)},drawStretchImage:function(k,L,p,t,x,y,I,s,B,W,z,a){!s&&B&&B.isSelfViewEvent&&(s=B);var j,S=nr(L,s,B,y),Z=kd(L,s,B,I);"uniform"===p?(j=X(y/S,I/Z),S*=j,Z*=j,t+=H((y-S)/2),x+=H((I-Z)/2),y=S,I=Z):"centerUniform"===p&&((S>y||Z>I)&&(j=X(y/S,I/Z),S*=j,Z*=j),t+=H((y-S)/2),x+=H((I-Z)/2),y=S,I=Z);var r=k.interactiveInfo;if(r){var l;if(l="center"===p?{x:t+y/2-S/2,y:x+I/2-Z/2,width:S,height:Z}:{x:t,y:x,width:y,height:I},r.rect){var m=r.compInfos,J=m.length;J&&(m[J-1].rect.image=L)}else r.rect=l}if("center"===p){var O=z!==!1&&(S>y||Z>I);O&&(k.save(),k.beginPath(),k.rect(t,x,y,I),k.clip()),cq(k,L,t+y/2-S/2,x+I/2-Z/2,S,Z,s,B,W,a),O&&k.restore()}else cq(k,L,t,x,y,I,s,B,W,a)},toCanvas:function(z,E,$,T,R,m,V,Z,M){z=Td(z,V),E=E||nr(z,R),$=$||kd(z,R);var O=On(),t=lc(O);return Z?(Jk(O,E,$,Z),t.scale(Z,Z)):Jk(O,E,$,1),_n(t,z,T,0,0,E,$,R,m,V,M),z&&z.clampToEdge&&(O.clampToEdge=z.clampToEdge),t.restore(),O},toGrayColor:function(g){if(!g)return g;var y=Qm(g),m=H(.299*y[0]+.587*y[1]+.114*y[2]);return"rgba("+m+","+m+","+m+","+y[3]/255+")"},createGradientImage:function(m,$,A,f){for(var s=["L",0,0,m,0,1,0,0,1,0,0],z=0,t=Math.min($.length,A.length);t>z;z++)s.push(A[z],$[z]);var P=B.Default.toCanvas({width:m,height:m,clampToEdge:!0,comps:[{type:"shape",rotation:f||0,points:[0,0,m,0,m,m,0,m],background:"#ffffff",gradientPack:s}]});return P},createElement:function(j,y,i,s){var U=e.createElement(j);return ch(U,y||r.widgetBorder,2),U.style.font=i?i:sd,s!=I&&(U.value=s),R.onElementCreated&&R.onElementCreated(U),U},containedInView:function(q,W){var Z=ue(W).getBoundingClientRect();return cj({x:Z.left,y:Z.top,width:Z.width,height:Z.height},Po(q))},isIsolating:function(){return ol>0},setIsolating:function(T){T?ol++:ol--},getMSMap:function(){return ng},stringify:function(c,A,l){var G=Date.prototype.toJSON;Date.prototype.toJSON=function(){return"__ht__date"+this.getTime()};var K=Og.prototype.toJSON;Og.prototype.toJSON=function(){return"__ht__dataModel"+this.serialize(0)},A=l?0:A==I?2:A;var V=JSON.stringify(c,function($,G){return"function"==typeof G?"__ht__"+(G.__ht__||G.toString()):gs(G)?Hd(G):G instanceof B.List?"__ht__list"+(G.__ht__list||R.stringify(G._as)):G},A);return Date.prototype.toJSON=G,Og.prototype.toJSON=K,l&&(V=Cp+Cr(V)),V},parse:function(J,S){return Fc(J)?J.substr(0,12)!=Cp||(J=uc(J.substr(12)),Fc(J))?(S=S||{},JSON.parse(J,function(L,D){if(Fc(D))if(S.ignoreFunction||"__ht__function"!=D.substr(0,14)){if(!S.ignoreDate&&"__ht__date"==D.substr(0,10))return new Date(ip(D.substr(10)));if("__ht__list"===D.substr(0,10))return new Gk(R.parse(D.substr(10)));if(!S.ignoreDataModel&&"__ht__dataModel"===D.substr(0,15)){var C=new Og;return C.deserialize(R.parse(D.substr(15))),C}}else{var n=D.indexOf("{")+1,V=D.lastIndexOf("}"),I=D.indexOf("(")+1,E=D.indexOf(")");if(n&&V&&I&&E)try{var K=new Function(D.substring(I,E),D.substring(n,V));return K.__ht__=D.substr(6),K}catch($){throw console.info("=== SyntaxError ===\n",D),$}}return D})):J:J},loadJS:function(A,j){j&&A.push(j);var c=A.shift();if(ar(c))A=c.contact(A),R.loadJS(A);else if(Hn(c))c(),R.loadJS(A);else if(Fc(c)){var V=e.createElement("script");V.onload=function(){R.loadJS(A)},V.setAttribute("src",c),e.getElementsByTagName("head")[0].appendChild(V)}else A.length&&R.loadJS(A)},extendClass:function(R,t){var i=R.prototype;for(var d in t)ng[d]&&ng.hasOwnProperty(d)?ng[d](i,t):i[d]=t[d]},toRoundedCorner:function(){function M(D,T,C){D.x=T.x,D.y=T.e||C,D.z=T.y}var o=new Xn,V=new Xn,W=new Xn,d=new Xn;return function(N,v){var s,C=0;N.getPoints&&(C=N.getElevation(),N=N.getPoints()),s=N instanceof Gk?N:new Gk(N);var G=s.size();if(0>=v)return{points:s};var K=new Gk,u=new Gk,p=s.get(0);M(o,p,C),K.add(p),u.add(1);for(var _=1;G>_;_++)if(G>_+1){var h=s.get(_),B=s.get(_+1);M(V,h,C),M(W,B,C),d.subVectors(o,V).setLength(Math.min(.99*d.length(),v)).add(V),h.e!==z||p.e!==z?K.add({x:d.x,y:d.z,e:d.y}):K.add({x:d.x,y:d.z}),K.add(h),d.subVectors(W,V).setLength(Math.min(.99*d.length(),v)).add(V),h.e!==z||B.e!==z?K.add(p={x:d.x,y:d.z,e:d.y}):K.add(p={x:d.x,y:d.z}),o.copy(d),u.addAll([2,3])}else K.add(s.get(_)),u.add(2);return{points:K,segments:u}}}(),toColorData:Qm,setCanvas:Jk,createDiv:eg,createDisabledDiv:sl,createView:Fd,createCanvas:On,appendChild:Ul,initContext:lc,checkLoadingImage:Rf,translateAndScale:sp,layout:Ae,getPosition:Xc,drawPoints:fj,drawRoundRect:wo,drawBorder:jn,setFocus:Sk,getter:_d,setter:uo,isEmptyObject:Jb,cameraPriority:function(){var n={skybox:0,main:1e4,top:1e7,infinity:1/0};return T.seal(T.defineProperties({},{skybox:{configurable:!1,enumerable:!1,get:function(){return n.skybox},set:function(K){if(K>=n.main)throw new RangeError("Skybox camera must have lower priority than the main camera.");n.skybox=Number(K)}},main:{configurable:!1,enumerable:!1,get:function(){return n.main},set:function(b){if(b<=n.skybox)throw new RangeError("Main camera must have higher priority than the skybox camera.");if(b>=n.top)throw new RangeError("Main camera must have lower priority than the top camera.");n.main=Number(b)}},top:{configurable:!1,enumerable:!1,get:function(){return n.top},set:function(u){if(u<=n.main)throw new RangeError("Top camera must have higher priority than the main camera.");n.top=Number(u)}}}))}(),addFontFace:function(){function H(k){var G=k.substr(k.lastIndexOf(".")+1);k=R.convertURL?R.convertURL(k):k;var y=i[G]||G;return{postfix:G,url:"url("+k+') format("'+y+'")'}}function J(S,s){return w[S.postfix]-w[s.postfix]}var i={ttf:"truetype",otf:"opentype",eot:"embedded-opentype"},w={eot:0,woff2:1,woff:2,ttf:3,otf:4};return function(j,l,f,p){if(j){p&&R.removeFontFace(j,!0);var w;if(w=xg[j])return w.parentNode||e.head.appendChild(w),f&&f(w),void 0;if(Fc(l)&&(l=[l]),l=l.filter(function(c){return Fc(c)?c.length>0:!1}),0!==l.length){l=l.map(H);var o="";l.sort(J).forEach(function(b){o+=", "+b.url}),o=o.substr(2);var w=e.createElement("style");w.innerText='@font-face{font-family: "'+j+'";src: '+o+";}",e.head.appendChild(w),xg[j]=w,f&&f(w)}}}}(),clearFontFace:function(){if(!Jb(xg)){for(var F in xg)R.removeFontFace(F);xg={}}},removeFontFace:function(v,U){if(v){var C=v;if(C.tagName){if(Pp(C),U){var R=[];for(var I in xg)xg[I]===C&&R.push(I);var J=R.length;if(J>0)for(var E=0,J=R.length;J>E;E++)delete xg[R[E]]}}else(C=xg[v])&&(Pp(C),U&&delete xg[v])}},getFontFaceMap:function(){return xg},handleFontFacesLoaded:function(){}},!0),e&&e.fonts&&e.fonts.addEventListener&&e.fonts.addEventListener("loadingdone",function(E){R.handleFontFacesLoaded(E.fontfaces),R.findView("all").forEach(function(U){U.redraw?U.redraw():U.iv()})}),Wn(b,{autoAdjustIndex:1,hierarchicalRendering:1,adjustChildrenToTop:1,autoHideScrollBar:1,autoUpdate:1,firstPersonMode:1,ortho:1,strict:1,stickToRight:1,instant:1,closePath:1,hierarchical:1,doubleClickToToggle:1,continuousLayout:1,syncSize:1},!0);var Db=R.disabledOpacity,$o=R.toolTipDelay,Gn=R.devicePixelRatio,Fp=R.autoMakeVisible,fi=R.autoHideScrollBar,tf=R.imageGradient,kb=R.showToolTip,xf=R.hideToolTip,$k=R.dashPattern,Lk=R.lineCap,zo=R.lineJoin,wk=R.labelColor,Wm=R.labelSelectColor,sd=R.labelFont,kn=R.widgetIndent,ee=R.widgetRowHeight,Ri=R.widgetHeaderHeight,wb=R.widgetTitleHeight,Dr=R.scrollBarColor,lm=R.scrollBarSize,xc=R.scrollBarTimeout,ui=R.scrollBarMinLength,Ud=R.scrollBarInteractiveSize,ms=R.zoomIncrement,Vb=R.scrollZoomIncrement,Wp=R.pinchZoomIncrement,fq=R.zoomMax,Hf=R.zoomMin,Ih=R.createObject,cl=R.preventDefault,Wk=R.setImage,Td=R.getImage,sg=R.isImageComplete,Vd=R.drawCenterImage,_n=R.drawStretchImage,Bi=R.getId,ed=R.callLater,nk=R.cancelLater,cf=R.sortFunc,sj=R.clone,Lo=R.getClass,$h=R.startAnim,Fk=R.brighter,je=R.darker,dg=R.drawText,Pb=R.getTextSize,fb=R.isLeftButton,Ie=R.isMiddleButton,Ne=R.isRightButton,Gg=R.getTouchCount,Fe=R.isDoubleClick,Ac=R.isShiftDown,Bl=R.isCtrlDown,Po=R.getClientPoint,Af=R.getPagePoint,Jc=R.getDistance,Gj=R.unionPoint,xr=R.unionRect,cj=R.containsPoint,Nc=R.containsRect,bi=R.intersectsRect,cp=R.intersection,Ff=R.getWindowInfo,xs=R.grow,Lf=R.getLogicalPoint,to=R.getScreenPoint,ii=R.startDragging,Pp=R.removeHTML,Kp=R.createElement,ce=R.segmentResolution,Eq=R.shapeResolution,hb=R.shapeSide,Lp=R.def,$e=function(r,B,$){Lp(G+"."+r,B,$)},hr=function(Q,L){Q.childNodes.forEach(function(Y){L(Y),hr(Y,L)})};Wn(R,{toolTipLabelColor:wk,toolTipLabelFont:sd,toolTipBackground:r.toolTipBackground,toolTipShadowColor:ys,debugTipLabelFont:sd,debugTipLabelColor:wk,debugTipBackground:r.toolTipBackground,drawBreakableText:Pm,setDevicePixelRatio:function(F){Gn=R.devicePixelRatio="number"==typeof F?F:pr(V),hr(e.body,function(u){var g=u._ht;g&&g._canvas&&(Jk(g._canvas,g.getWidth(),g.getHeight()),g.redraw?g.redraw():g.iv())})},getPosition3dGap:function(){return Zg()}},!0);var xk=1e-6,Ge="undefined"!=typeof Uint16Array?Uint16Array:Array,oj="undefined"!=typeof Uint32Array?Uint32Array:Ge,Tb="undefined"!=typeof Float32Array?Float32Array:Array,Er=function(g,F,o){var Y=[g[0]-F[0],g[1]-F[1],g[2]-F[2]];if(o){var S=Jc(Y);S>0&&(Y[0]/=S,Y[1]/=S,Y[2]/=S)}return Y},Em=function(){var R="charCodeAt",u=2*(2*bg.length+1);for(var c in V)if(c===G+xi[0]+(Mq.length+2)){var g=V[c];if(!g)break;for(var o=g.length,w=0;o>w;w++)if(g[w][R](0)===u&&g[w+1]!=I&&g[w+1]===Mq[0]&&g[w+2]!=I&&g[w+2][R](0)===u){for(var N=w+3;o>N;N++)if(g[N][R](0)===u){if(0==g[N+1])for(var S,n=N+2;o>n;n++){if(g[n][R](0)===u){0==g[n-1]&&S&&(po=S.substr(0,S.length-1));break}S==I?S=g[n]:S+=g[n]}break}break}break}return function(E){return[-E[0],-E[1],-E[2]]}}(),Li=function(H,e){return 3===H.length?H[0]*e[0]+H[1]*e[1]+H[2]*e[2]:H[0]*e[0]+H[1]*e[1]},an=function(){var K=new Array(16);return K[0]=1,K[1]=0,K[2]=0,K[3]=0,K[4]=0,K[5]=1,K[6]=0,K[7]=0,K[8]=0,K[9]=0,K[10]=1,K[11]=0,K[12]=0,K[13]=0,K[14]=0,K[15]=1,K},Lr=an(),yq=function(u){var A=new Array(16);return A[0]=u[0],A[1]=u[1],A[2]=u[2],A[3]=u[3],A[4]=u[4],A[5]=u[5],A[6]=u[6],A[7]=u[7],A[8]=u[8],A[9]=u[9],A[10]=u[10],A[11]=u[11],A[12]=u[12],A[13]=u[13],A[14]=u[14],A[15]=u[15],A},rn=function(A,z){return A[0]=z[0],A[1]=z[1],A[2]=z[2],A[3]=z[3],A[4]=z[4],A[5]=z[5],A[6]=z[6],A[7]=z[7],A[8]=z[8],A[9]=z[9],A[10]=z[10],A[11]=z[11],A[12]=z[12],A[13]=z[13],A[14]=z[14],A[15]=z[15],A},un=function(R){return R[0]=1,R[1]=0,R[2]=0,R[3]=0,R[4]=0,R[5]=1,R[6]=0,R[7]=0,R[8]=0,R[9]=0,R[10]=1,R[11]=0,R[12]=0,R[13]=0,R[14]=0,R[15]=1,R},Ee=function(x,G){var S=x[0],B=x[1],F=x[2];return x[0]=G[0]*S+G[4]*B+G[8]*F+G[12],x[1]=G[1]*S+G[5]*B+G[9]*F+G[13],x[2]=G[2]*S+G[6]*B+G[10]*F+G[14],x},Ng=function(X,l){var w=X[0],h=X[1],k=X[2],U=X[3];return X[0]=l[0]*w+l[4]*h+l[8]*k+l[12]*U,X[1]=l[1]*w+l[5]*h+l[9]*k+l[13]*U,X[2]=l[2]*w+l[6]*h+l[10]*k+l[14]*U,X[3]=l[3]*w+l[7]*h+l[11]*k+l[15]*U,X},Eh=function(){var x,Q,Z,V,s=qe(Ye[1]+Ye[7]),B=qe(Ye[0]+Ye[3]-Ye[10]),C=qe(Ye[8]+2),J=function(){return Q=Z.charAt(x),x+=1,Q},l=function(){var B="";if(Q===C)for(;J();){if(Q===C)return J(),B;B+=Q}else J()},X=function(){for(;Q&&" ">=Q;)J()},K=function(){var K,T={};if(Q===s){if(J(),X(),Q===B)return J(),T;for(;Q;){if(K=l(),X(),J(),T[K]=V(),X(),Q===B)return J(),T;J(),X()}}};return V=function(){switch(X(),Q){case s:return K();default:return l()}},function(M){if(v={},M){var n;if(Z=M,x=0,Q=" ",n=V(),X(),!Q)return n}}}(),Kf=function(E,t){if(t){var R=k(t),I=F(t),l=E[4],o=E[5],S=E[6],P=E[7],O=E[8],B=E[9],j=E[10],e=E[11];E[4]=l*I+O*R,E[5]=o*I+B*R,E[6]=S*I+j*R,E[7]=P*I+e*R,E[8]=O*I-l*R,E[9]=B*I-o*R,E[10]=j*I-S*R,E[11]=e*I-P*R}},eh=function(i,S){if(S){var b=k(S),y=F(S),$=i[0],R=i[1],l=i[2],U=i[3],_=i[8],X=i[9],T=i[10],w=i[11];i[0]=$*y-_*b,i[1]=R*y-X*b,i[2]=l*y-T*b,i[3]=U*y-w*b,i[8]=$*b+_*y,i[9]=R*b+X*y,i[10]=l*b+T*y,i[11]=U*b+w*y}},Ao=function(T,c){if(c){var R=k(c),b=F(c),U=T[0],f=T[1],O=T[2],d=T[3],s=T[4],v=T[5],I=T[6],N=T[7];T[0]=U*b+s*R,T[1]=f*b+v*R,T[2]=O*b+I*R,T[3]=d*b+N*R,T[4]=s*b-U*R,T[5]=v*b-f*R,T[6]=I*b-O*R,T[7]=N*b-d*R}},Zi=function(s,r,K){return Jg(I,K===!1?I:s.getFinalScale3d(),s.getFinalRotation3d(),s.getRotationMode(),s.p3(),I,r)},Jg=function(f,R,U,Y,Q,$,u){return $||($=an()),Q&&uf($,Q),Ml($,U,Y),u&&Hh($,$,u),R&&xm($,R),f&&Hh($,$,f),$},Vl=function(C,J,r){J=ip(J),r=ip(r);var E=this;E.g=C,E._84O=J,E._85O=r,E._70I=!0,E.F=0,E._83O=J+r,E.pen={x:0,y:0}},$f="lineDashOffset",bh="setLineDash",Kn=function(U){for(var _ in U)1===_.length&&($f=U[_]);return _?1:0},tm=function(s,N,f){return Bd(N)?s:s[bh]?(s[bh](N),f&&(s.lineDashOffset=f),s):new Vl(s,N[0],N.length>1?N[1]:N[0])},vk=function(F,k){!Bd(k)&&F[bh]&&(F[bh](fl),F.lineDashOffset=0)};Lp(Vl,T,{_69I:6,moveTo:function(N,n){var X=this,r=X.pen;r.x=N,r.y=n,X.g.moveTo(N,n),X.start||(X.start={x:N,y:n})},lineTo:function(s,U){var g=this,b=g.pen,E=s-b.x,r=U-b.y,d=Wd(r,E),Z=F(d),Y=k(d),p=g._23O(b.x,b.y,s,U),H=g._85O,N=g._84O,I=g._83O;if(g.F){if(g.F>p)return g._70I?g._72I(s,U):g.moveTo(s,U),g.F-=p,void 0;if(g._70I?g._72I(b.x+Z*g.F,b.y+Y*g.F):g.moveTo(b.x+Z*g.F,b.y+Y*g.F),p-=g.F,g.F=0,g._70I=!g._70I,!p)return}var w=C(p/I);if(w){for(var i=Z*N,c=Y*N,f=Z*H,P=Y*H,W=0;w>W;W++)g._70I?(g._72I(b.x+i,b.y+c),g.moveTo(b.x+f,b.y+P)):(g.moveTo(b.x+f,b.y+P),g._72I(b.x+i,b.y+c));p-=I*w}g._70I?p>N?(g._72I(b.x+Z*N,b.y+Y*N),g.moveTo(s,U),g.F=H-(p-N),g._70I=!1):(g._72I(s,U),p===N?(g.F=0,g._70I=!g._70I):(g.F=N-p,g.moveTo(s,U))):p>H?(g.moveTo(b.x+Z*H,b.y+Y*H),g._72I(s,U),g.F=N-(p-H),g._70I=!0):(g.moveTo(s,U),p===H?(g.F=0,g._70I=!g._70I):g.F=H-p)},quadraticCurveTo:function(X,t,n,b){var W,o=this,M=o.pen,r=M.x,O=M.y,F=o._22O(r,O,X,t,n,b),V=0,q=0,s=o._85O,G=o._84O;if(o.F){if(o.F>F)return o._70I?o._71I(X,t,n,b):o.moveTo(n,b),o.F-=F,void 0;if(V=o.F/F,W=o._20O(r,O,X,t,n,b,V),o._70I?o._71I(W[2],W[3],W[4],W[5]):o.moveTo(W[4],W[5]),o.F=0,o._70I=!o._70I,!F)return}var c=F-F*V,P=C(c/o._83O),h=G/F,l=s/F;if(P)for(var N=0;P>N;N++)o._70I?(q=V+h,W=o._21O(r,O,X,t,n,b,V,q),o._71I(W[2],W[3],W[4],W[5]),V=q,q=V+l,W=o._21O(r,O,X,t,n,b,V,q),o.moveTo(W[4],W[5])):(q=V+l,W=o._21O(r,O,X,t,n,b,V,q),o.moveTo(W[4],W[5]),V=q,q=V+h,W=o._21O(r,O,X,t,n,b,V,q),o._71I(W[2],W[3],W[4],W[5])),V=q;c=F-F*V,o._70I?c>G?(q=V+h,W=o._21O(r,O,X,t,n,b,V,q),o._71I(W[2],W[3],W[4],W[5]),o.moveTo(n,b),o.F=s-(c-G),o._70I=!1):(W=o._19O(r,O,X,t,n,b,V),o._71I(W[2],W[3],W[4],W[5]),F===G?(o.F=0,o._70I=!o._70I):(o.F=G-c,o.moveTo(n,b))):c>s?(q=V+l,W=o._21O(r,O,X,t,n,b,V,q),o.moveTo(W[4],W[5]),W=o._19O(r,O,X,t,n,b,q),o._71I(W[2],W[3],W[4],W[5]),o.F=G-(c-s),o._70I=!0):(o.moveTo(n,b),c===s?(o.F=0,o._70I=!o._70I):o.F=s-c)},bezierCurveTo:function(){var j=arguments;this.pen={x:j[4],y:j[5]},this.g.bezierCurveTo(j[0],j[1],j[2],j[3],j[4],j[5])},arc:function(y,k,P,S,s,B){B||(S=-S,s=-s),ge(this,y,k,S,s-S,P,P,!1)},rect:function(a,J,r,f){var S=this;S.pen={x:a,y:J},S.moveTo(a,J),S.lineTo(a,J+f),S.lineTo(a+r,J+f),S.lineTo(a+r,J),S.lineTo(a,J)},beginPath:function(){this.g.beginPath()},closePath:function(){this.lineTo(this.start.x,this.start.y)},_23O:function(e,$,w,m){var p=w-e,f=m-$;return a(p*p+f*f)},_22O:function(G,V,O,c,t,u,K){for(var e,b,A,S,f,o,n,v=0,d=G,L=V,y=K>0?K:this._69I,B=1;y>=B;B++)A=B/y,S=1-A,f=S*S,o=2*A*S,n=A*A,e=f*G+o*O+n*t,b=f*V+o*c+n*u,v+=this._23O(d,L,e,b),d=e,L=b;return v},_21O:function(X,h,t,R,n,Q,I,K){var y=this;if(0===I)return y._20O(X,h,t,R,n,Q,K);if(1===K)return y._19O(X,h,t,R,n,Q,I);var q=y._20O(X,h,t,R,n,Q,K);return q.push(I/K),y._19O.apply(y,q)},_20O:function(L,b,g,l,A,c,z){if(1!==z){var N=g+(A-g)*z,Q=l+(c-l)*z;g=L+(g-L)*z,l=b+(l-b)*z,A=g+(N-g)*z,c=l+(Q-l)*z}return[L,b,g,l,A,c]},_19O:function(G,S,A,_,C,L,l){if(1!==l){var I=G+(A-G)*l,F=S+(_-S)*l;A+=(C-A)*l,_+=(L-_)*l,G=I+(A-I)*l,S=F+(_-F)*l}return[G,S,A,_,C,L]},_72I:function(v,O){var s=this.pen;(v!==s.x||O!==s.y)&&(s.x=v,s.y=O,this.g.lineTo(v,O))},_71I:function(j,a,y,L){var n=this.pen;(j!==y||a!==L||y!==n.x||L!==n.y)&&(n.x=y,n.y=L,this.g.quadraticCurveTo(j,a,y,L))}}),ng.ms_quickVisible=function(v){v._4BQ=!1,v._4CQ=function(a){var E=a._4EQ;return E!==z?E:E=a._4EQ=this._4FQ(a)},v._4DQ=function(B){if(!B)return this.dm().each(function(C){C._4EQ=z}),void 0;B._4EQ=z;var K=this;if(B instanceof Xl||wp(B)||B instanceof Ti||B.ISubGraph)B.eachChild(function(_){K.invalidateQuickVisible(_)});else if(B.getEdges){var q=B.getEdges();q&&q.each(function(n){K.invalidateQuickVisible(n)})}},v.enableQuickVisibleMode=function(){this._4BQ||(this._4BQ=!0,this._4FQ=this.isVisible,this.isVisible=this._4CQ,this.invalidateQuickVisible=this._4DQ)},v.disableQuickVisibleMode=function(){this._4BQ&&(this._4BQ=!1,this.isVisible=this._4FQ,this.invalidateQuickVisible=No)},v.isQuickVisibleMode=function(){return this._4BQ},v.invalidateQuickVisible=No},Kk=Mp()+1,fn&&V.console&&Kk&&!1&&(V.navigator&&V.navigator.userAgent.toLowerCase().indexOf("chrome")>-1?V.console.log.apply(console,["Hightopo - Version："+B.Default.getVersion()+" - %cTrial：http://hightopo.com/request.html","color: #f00;"]):V.console.log("Hightopo - Version："+B.Default.getVersion()+" - Trial：http://hightopo.com/request.html"));var te=I,yp=I,rm=R.checkLoadingCompType=function(P){te&&!P._72O_&&(yp||(yp={}),yp[P._72O_=Bi()]=P)},Bo=function(N,g){if(g||(g=N),g&&(te||(te={}),!te[N])){var p=new nc;if(te[g]={request:p,url:g},g=R.beforeLoadURL(g,N),g.data){var j=R.parse(g.data);yr(N,j),R.handleCompTypeLoaded(N,j)}else{p.onload=function(){if(200===this.status||0===this.status){var L=R.parse(p.getResponseText());yr(N,L),R.handleCompTypeLoaded(N,L)}else yr(N,I)},p.onerror=function(){yr(N,I)};var B={};B.url=encodeURI(g),B.sync=!1,p.send(B)}}},yr=function(v,F){if(iq[v]=F,delete te[v],Jb(te)&&(te=I,yp)){for(var C in yp){var j=yp[C];j.invalidateAll&&j.invalidateAll(z,"compTypeLoaded",v),j.redraw&&j.redraw(),j.iv(),delete j._72O_}yp=I}if(F&&yp)for(var C in yp){var j=yp[C];j.invalidateAll&&j.invalidateAll(z,"compTypeLoading",v),j.redraw&&j.redraw(),j.iv()}},ig=r.chart,up="",We=!0,Th=R.compStack=[],pl=/^style@/,pd=/^attr@/,eb=/^field@/,mh={x:.5,y:.5},Ho=function(){We=!0},pe=function(){return We},Ip=function(R,b,X){if(!R)return!1;var M;return X&&X.isImageFitSize&&(M=X.isImageFitSize(b,R)),M==I&&(M=tp(R.fitSize,b,X)),M},nr=function(N,F,h,q){if(!N)return 0;if(Ip(N,F,h)&&q)return q;var n=tp(N.width,F,h);return null==n?20:n},kd=function(b,n,a,A){if(!b)return 0;if(Ip(b,n,a)&&A)return A;var D=tp(b.height,n,a);return null==D?20:D},tp=function($,s,t){if(!$||!$.func)return $;var U,W=$.func,X=$.value;return U=Hn(W)?t&&t.vectorDataBindingDisabled&&!$.isSafeFunc?X:W(s,t):s instanceof If||(B.ui?s instanceof B.ui.View:0)?pd.test(W)?s.a(up+W.slice(5)):pl.test(W)?s.s(up+W.slice(6)):eb.test(W)?s[W.slice(6)]:s[W]?s[W](t):X:X,X!==z&&U==I?X:U},cq=R.drawImage=function(){var A,$,H,l,Z,x,C=3,G=6,a=function(d,G){d.getValue&&d.getValue.compType===G||(d.getValue=function(S){var b=h(d,S);if(b===z&&G.properties){var E=G.properties[S];E&&(b=E.defaultValue)}return b},d.getColor=function(I,h){return h===!0?e(I):e(d.getValue(I))},d.getValue.compType=G)},h=function(Q,D,Y){var F,h=!1;if(Q.prefix&&$ instanceof If){var U=$.a(up+D);U!==z&&(h=!0,F=U)}return F===z&&(F=Q[D]),F&&F.func&&(h=!0,F=tp(F,$,H)),Y&&(F=Y(F),h||(Q[D]=F)),F},e=function(N,y){var a;return a=y?h(N,y):N,A&&A.compGray&&a?R.toGrayColor(a):Z&&a?pb(a,Z,x):a},v=function(h){if(ar(h)){for(var V=new Gk,w=h.length,g=0;w>g;g+=2)V.add({x:h[g],y:h[g+1]});h=V}return h},m=function(p){var H=h(p,"anchorX"),I=h(p,"anchorY");if(H!==z||I!==z)return{x:H===z?mh.x:H,y:I===z?mh.y:I};var _=h(p,"type"),D=h(p,"name");if("image"!==_||!D)return mh;var t=Td(D);return t&&t.anchorX!==z&&t.anchorY!==z?{x:t.anchorX,y:t.anchorY}:mh},Q=function(E,F){var S=h(E,fk),V=m(E);if(ar(S)){var O=S.length,W=h(E,"relative"),M=F.width,X=F.height;if(4===O)S={x:S[0],y:S[1],width:S[2],height:S[3]},W&&(S.x*=M,S.y*=X,S.width*=M,S.height*=X);else if(3===O){var b=S[0];S={width:S[1],height:S[2]},W&&(S.width*=M,S.height*=X),"object"==typeof b?b.length&&(b={x:b[0],y:b[1]}):b=Xc(b,F,S),S.x=b.x-S.width*V.x,S.y=b.y-S.height*V.y}S.x+=h(E,"offsetX")||0,S.y+=h(E,"offsetY")||0,!W&&F.fitSize&&(S=u(E,S,F))}return S},u=function(d,q,y){if(q){var Q,P,g,F={x:q.x,y:q.y,width:q.width,height:q.height},N=m(d),w=h(d,"layoutH"),i=h(d,"layoutV"),G=1,r=1,Y=0,v=0,O=1,z=1;switch(w){case"left":break;case"right":F.x+=y.width-y.rw;break;case"center":F.x+=.5*(y.width-y.rw);break;case"scale":case"leftright":default:Q=h(d,zh)||0,Q&&(Y=Math.abs(v=Math.sin(Q)),O=Math.abs(z=Math.cos(Q))),"leftright"!==w?(G+=O*(y.widthScale-1),r+=Y*(y.widthScale-1)):(G+=F.width?O*(y.width-y.rw)/F.width:0,r+=F.height?Y*(y.width-y.rw)/F.height:0,P=-Math.min(-N.x*z+N.y*v,-N.x*z-(1-N.y)*v,(1-N.x)*z+N.y*v,(1-N.x)*z-(1-N.y)*v))}switch(i){case"top":break;case"bottom":F.y+=y.height-y.rh;break;case"center":F.y+=.5*(y.height-y.rh);break;case"scale":case"topbottom":default:Q==I&&(Q=h(d,zh),Q&&(Y=Math.abs(v=Math.sin(Q)),O=Math.abs(z=Math.cos(Q)))),"topbottom"!==i?(G+=Y*(y.heightScale-1),r+=O*(y.heightScale-1)):(G+=F.width?Y*(y.height-y.rh)/F.width:0,r+=F.height?O*(y.height-y.rh)/F.height:0,g=-Math.min(-N.x*v-N.y*z,-N.x*v+(1-N.y)*z,(1-N.x)*v-N.y*z,(1-N.x)*v+(1-N.y)*z))}return(1!==G||1!==r)&&("scale"!==w&&w?"leftright"===w&&(F.x+=F.width*(1-G)*N.x+P*(y.width-y.rw)):F.x+=F.x*(y.widthScale-1)+N.x*F.width*(y.widthScale-G),"scale"!==i&&i?"topbottom"===i&&(F.y+=F.height*(1-r)*N.y+g*(y.height-y.rh)):F.y+=F.y*(y.heightScale-1)+N.y*F.height*(y.heightScale-r),F.width*=G,F.height*=r),F.width<0&&(F.width=0),F.height<0&&(F.height=0),F}},W=function(r){return ar(r)?new Gk(r):r},y=function(s,G,K,o,n,F,N){var T=A.interactiveInfo,J=s.transform;if(J)return A.save(),A.setTransform(J.a,J.b,J.c,J.d,J.tx,J.ty),T&&T.compInfos.push({comp:s,rect:G,matrix:J.clone(),prefix:up,refRect:T.refRect}),!0;n===z&&(n=1),F===z&&(F=1);var R=h(s,"clipPercentage"),C=is(K,G);if(C&&!o&&1===n&&1===F&&R==z)return T&&T.compInfos.push({comp:s,rect:G,matrix:T.matrix.clone(),prefix:up,refRect:T.refRect}),!1;N=N||mh;var l=G.x+G.width*N.x,P=G.y+G.height*N.y,Z=K.x+K.width*N.x,U=K.y+K.height*N.y,X=K.width?n*(G.width/K.width):1,b=K.height?F*(G.height/K.height):1;if(A.save(),T&&(T.matrix.appendTranslate(l,P).appendRotate(o).appendScale(X,b).appendTranslate(-Z,-U),T.compInfos.push({comp:s,rect:G,matrix:T.matrix.clone(),prefix:up,refRect:T.refRect})),or(A,l,P),Aj(A,o||0),qs(A,X,b),or(A,-Z,-U),R!=z){var y=ur(K,h(s,"clipDirection"),R);A.beginPath(),A.rect(y.x,y.y,y.width,y.height),A.clip()}return!0},J=function(){A.restore()},P=function(P,_,S){var U=h(P,"path"),Q=h(P,zh),V=h(P,"scaleX"),R=h(P,"scaleY"),W=m(P),q=I,Y=jo(null,U);if(S||(S=P.unionRect,S||(S=Gj(Y),P.path.func||(P.unionRect=S)),q=S),S){q||(q=P.unionRect,q||(q=Gj(Y),P.path.func||(P.unionRect=q)));var z=y(P,S,q,Q,V,R,W),T=h(P,"borderPattern"),f=tm(A,T),N=e(P,"background"),i=e(P,"borderColor"),g=h(P,"borderWidth"),H=h(P,"gradient"),M=e(P,"gradientColor"),o=h(P,"border3d"),E=e(P,"border3dColor"),p=h(P,"border3dAccuracy"),k=A.lineJoin,B=A.lineCap;A.lineJoin=h(P,"borderJoin")||zo,A.lineCap=h(P,"borderCap")||Lk,N?(jp(A,N,H,M,q),jo(A,U),A.fill(),f!==A&&jo(A,U)):jo(A,U);var X=h(P,"borderWidthAbsolute");if(X&&(A.save(),A.setTransform(1,0,0,1,0,0)),g&&i&&(A.lineWidth=g,A.strokeStyle=i,A.stroke(),o&&sh(A,i,E,g,l,p)),vk(A,T),h(P,"dash")){var n=h(P,"dashWidth")||g;if(n>0){T=h(P,"dashPattern")||$k;var f=tm(A,T,h(P,"dashOffset")),F=e(P,"dashColor")||e(us);f!==A&&jo(A,U),A.strokeStyle=F,A.lineWidth=n,A.stroke(),h(P,"dash3d")&&sh(A,F,e(P,"dash3dColor"),n,l,h(P,"dash3dAccuracy")),vk(A,T)}}X&&A.restore(),_===fk&&Pe(A,N,h(P,"depth"),q),A.lineJoin=k,A.lineCap=B,z&&J()}},g=function(s,R,d,g){var Q=h(s,vr,v),c=h(s,zh),p=m(s);if(Q&&g.fitSize){var o=new Gk,D=Gj(Q),N=u(s,D,g),E=D.x+p.x*D.width,w=D.y+p.y*D.height,K=N.x+p.x*N.width,B=N.y+p.y*N.height,j=D.width?N.width/D.width:1,G=D.height?N.height/D.height:1;Q.each(function(I){o.add({x:K+(I.x-E)*j,y:B+(I.y-w)*G})}),Q=o,s.unionRect=null}var S=h(s,"scaleX"),X=h(s,"scaleY"),L=R===$l,k=I;if(!d&&L&&(d=s.unionRect,d||(d=Gj(Q),s.points.func||(s.unionRect=d)),k=d),d){L?k||(k=s.unionRect,k||(k=Gj(Q),s.points.func||(s.unionRect=k))):k=d;var n,b,a,_,i=y(s,d,k,c,S,X,p),V=h(s,"borderPattern"),O=tm(A,V),C=e(s,"background"),Y=Td(h(s,"repeatImage"),Z,x),t=h(s,"gradientPack"),M=h(s,"borderGradientPack"),q=e(s,"borderColor"),U=h(s,"borderWidth"),P=Td(h(s,"borderRepeatImage"),Z,x),f=h(s,"segments",W),F=h(s,"gradient"),r=e(s,"gradientColor"),T=h(s,"border3d"),Ym=e(s,"border3dColor"),Tc=h(s,"border3dAccuracy"),yi=h(s,"closePath"),Sb=h(s,"fillRule")||"nonzero",zc=A.lineJoin,Gq=A.lineCap;if(A.lineJoin=h(s,"borderJoin")||zo,A.lineCap=h(s,"borderCap")||Lk,L)if(C||Y||t){var Kj=h(s,"fillClipPercentage");if(Kj!=z){var un=ur(k,h(s,"fillClipDirection"),Kj);A.save(),A.beginPath(),A.rect(un.x,un.y,un.width,un.height),A.clip()}fj(A,Q,f,yi),t?zr(A,t,e,!1,k):Y?Dl(A,Y,Z,x,$,H):jp(A,C,F,r,k),A.fill(Sb),t&&A.restore(),Kj!=z&&A.restore(),O!==A&&fj(O,Q,f,yi)}else fj(O,Q,f,yi);else if("roundRect"===R?n=h(s,"cornerRadius"):"polygon"===R?(n=h(s,"polygonSide"),b=h(s,"cornerRadius"),a=h(s,"regular")):"arc"===R&&(n=h(s,"arcFrom"),b=h(s,"arcTo"),a=h(s,"arcClose"),_=h(s,"arcOval")),C||Y||t){var Kj=h(s,"fillClipPercentage");if(Kj!=z){var un=ur(k,h(s,"fillClipDirection"),Kj);A.save(),A.beginPath(),A.rect(un.x,un.y,un.width,un.height),A.clip()}os(A,R,k,n,b,a,_),t?zr(A,t,e,!1,k):Y?Dl(A,Y,Z,x,$,H):jp(A,C,F,r,k),A.fill(Sb),t&&A.restore(),Kj!=z&&A.restore(),A!==O&&os(O,R,k,n,b,a,_)}else os(O,R,k,n,b,a,_);var ob=h(s,"borderWidthAbsolute");if(ob&&(A.save(),A.setTransform(1,0,0,1,0,0)),U&&(q||P||M)&&(A.lineWidth=U,M?zr(A,M,e,!0,k):P?Pq(A,P,Z,x,$,H):A.strokeStyle=q,A.stroke(),M&&A.restore(),T&&sh(A,q,Ym,U,l,Tc)),vk(A,V),h(s,"dash")){var fe=h(s,"dashWidth")||U;if(fe>0){V=h(s,"dashPattern")||$k;var O=tm(A,V,h(s,"dashOffset")),gc=e(s,"dashColor")||e(us);O!==A&&(L?fj(O,Q,f,yi):os(O,R,k,n,b,a,_)),A.strokeStyle=gc,A.lineWidth=fe,A.stroke(),h(s,"dash3d")&&sh(A,gc,e(s,"dash3dColor"),fe,l,h(s,"dash3dAccuracy")),vk(A,V)}}ob&&A.restore(),R===fk&&Pe(A,C,h(s,"depth"),k),A.lineJoin=zc,A.lineCap=Gq,i&&J()}},S=function(S,M){var K=Z||h(S,_b),i=x||h(S,"blendMode"),d=h(S,"name"),u=Td(d,K,i);u&&u.cacheRule!=I&&(u=bc(A,u,h(S,"stretch"),M.width,M.height,$,H,K)),u?_n(A,u,h(S,"stretch"),M.x,M.y,M.width,M.height,$,H,K,null,i):We=!1},s=function(D,d){var f=h(D,"text");if(f!=I){f+="";var S,p=h(D,"gradientPack"),$=h(D,"gradient"),T=e(D,"gradientColor"),Y=h(D,"font"),_=h(D,"vertical"),L=h(D,"verticalGap")||0,V=h(D,"align"),O=h(D,"vAlign"),s=h(D,"decoration"),M=h(D,"letterGap")||0,Z=h(D,"wrap"),E=h(D,"borderWidth"),x=h(D,"borderColor"),b=Pb(Y,f);if(p?(S=zr(A,p,e,!1,d),A.restore()):S=e(D,_b),!p&&$&&(S=R.createGradient(A,$,S||R.labelColor,T||r.imageGradient,d.x,d.y,d.width,d.height)),E&&ar(x)&&(x=zr(A,x,e,!1,d),A.restore()),_){null==L&&(L=1);var k,a,X,B=[],l=[];k=Z?qm(f,d.height,Y,M,_,L):[f],A.textBaseline=Vh,A.font=Y,k.forEach(function(w){for(var f=w.length,X=0,z=(f-1)*L,D=0;f>D;D++){var k=A.measureText(w[D]);B.push(k),z+=k.fontBoundingBoxDescent||b.height,X=o(X,k.width)}l.push({width:X,height:z})});var W=(k.length-1)*M;l.forEach(function(n){W+=n.width}),a=V&&V!==xi?V===Dd?d.x+d.width-W:d.x+(d.width-W)/2:d.x;var t=0;k.forEach(function(o,z){var Q=l[z],K=o.length;X=O&&O!==hi?O===Vh?d.y:d.y+d.height-Q.height:d.y+(d.height-Q.height)/2;for(var D=0;K>D;D++){var f=o[D],e=B[t],P=e.fontBoundingBoxDescent||b.height;Yo(A,f,Y,S,{x:a,y:X,width:Q.width,height:P},Nq,O,s,M,E,x),X+=P+L,t++}a+=Q.width+M})}else{var k=Z?qm(f,d.width,Y,M,_,L):f.split("\n"),n=k.length;if(n>1){var q=Pb(Y,f),u=q.height,j=n*u+L*(n-1),F=sj(d);return O&&O!==hi?O===dd&&(F.y=d.y+d.height-j):F.y=d.y+(d.height-j)/2,F.height=j,Pm(A,k,F,Y,S,V||xi,s,M,E,x),void 0}Yo(A,f,Y,S,d,V,O,s,M,E,x)}}},i=function(W,d){jn(A,e(W,_b),d.x,d.y,d.width,d.height,h(W,"width"))},M=function(s,C){var Y=h(s,tq),N=0;if(Y&&(Y.forEach(function(q){N+=q}),N>0)){for(var T=h(s,"colors")||ig,e=h(s,"startAngle")||0,B=h(s,"hollow"),c=h(s,sm),W=h(s,pf),V=h(s,Zc),l=c?new Gk:I,M=C.x,Z=C.y,v=C.width,m=C.height,z=M+v/2,q=Z+m/2,g=X(v,m)/2,w=0,u=0;u<Y.length;u++){var U=Y[u],Q=f*U/N,j=e+Q;if(A.fillStyle=T[w++],w===T.length&&(w=0),A.beginPath(),B){var E=z+F(e)*g/2,S=q+k(e)*g/2,d=z+F(j)*g,x=q+k(j)*g;A.moveTo(E,S),A.arc(z,q,g/2,e,j,!1),A.lineTo(d,x),A.arc(z,q,g,j,e,!0)}else A.moveTo(z,q),A.arc(z,q,g,j,e,!0);l&&(Q=(e+j)/2,l.add({text:Hn(c)?c(U,u,N,$):U,x:z+.75*F(Q)*g,y:q+.75*k(Q)*g})),A.closePath(),A.fill(),e=j}l&&l.each(function(H){dg(A,H.text,W,V,H.x,H.y,0,0,Nq)})}},Y=function(X,F){var s=h(X,ep);if(s&&s.length>0){var a=s.length,e=h(X,sm),W=h(X,pf),b=h(X,Zc),J=e?new Gk:I,O=h(X,"minValue")||0,m=h(X,"maxValue");
if(m==I&&(m=0,s.forEach(function(C){h(C,tq).forEach(function(Q){m=o(m,Q)})})),O===m)return;for(var Q=F.height/(m-O),E=F.y+m*Q,y=h(s[0],tq).length,Z=F.width/(3*y+1),T=2*Z/a,f=0,k=0;a>k;k++)for(var i=s[k],D=h(i,_b),L=h(i,"colors"),P=h(i,tq),U=0;y>U;U++){L?A.fillStyle=L[U]:D?A.fillStyle=D:(A.fillStyle=ig[f++],f===ig.length&&(f=0));var Y=P[U],S=Y*Q,C=F.x+(1+3*U)*Z+k*T;if(gk(A,C,E-S,T,S),J){var p=Hn(e)?e(Y,U,i,$):Y,H=Pb(W,p).height;J.add({x:C,y:E-S-H,width:T,height:H,text:p})}}J&&J.each(function(t){dg(A,t.text,W,b,t.x,t.y,t.width,t.height,Nq)})}},w=function(m,J){var f=h(m,ep);if(f&&f.length>0){var M=f.length,z=h(f[0],tq).length,V=J.width/(3*z+1),g=0,j=h(m,"maxValue"),Z=h(m,sm),d=h(m,pf),e=h(m,Zc),H=Z?new Gk:I;if(j==I){j=0;for(var G=0;z>G;G++){for(var u=0,n=0;M>n;n++)u+=h(f[n],tq)[G];j=o(j,u)}}if(j>0){for(var G=0;z>G;G++)for(var N=J.y+J.height,n=0;M>n;n++){var y=f[n],Y=h(y,_b),T=h(y,tq)[G],F=T/j*J.height;Y?A.fillStyle=Y:(A.fillStyle=ig[g++],g===ig.length&&(g=0)),N-=F;var U={x:J.x+(1+3*G)*V,y:N,width:2*V,height:F};gk(A,U.x,U.y,U.width,U.height),H&&(U.text=Hn(Z)?Z(T,G,y,$):T,H.add(U))}H&&H.each(function(M){dg(A,M.text,d,e,M.x,M.y,M.width,M.height,Nq)})}}},O=function(n,L){var T=h(n,ep);if(T&&T.length>0){for(var B=T.length,q=h(T[0],tq).length,c=L.width/(3*q+1),w=0,f=h(n,sm),U=h(n,pf),_=h(n,Zc),p=f?new Gk:I,F=0;q>F;F++){for(var W=0,X=0;B>X;X++)W+=h(T[X],tq)[F];if(W>0){var M=L.y+L.height;for(X=0;B>X;X++){var N=T[X],x=h(N,_b),g=h(N,tq)[F],E=g/W*L.height;x?A.fillStyle=x:(A.fillStyle=ig[w++],w===ig.length&&(w=0)),M-=E;var u={x:L.x+(1+3*F)*c,y:M,width:2*c,height:E};gk(A,u.x,u.y,u.width,u.height),p&&(u.text=Hn(f)?f(g,F,N,$):g,p.add(u))}}}p&&p.each(function(b){dg(A,b.text,U,_,b.x,b.y,b.width,b.height,Nq)})}},D=function(M,g){var U=h(M,ep);if(U&&U.length>0){var L=U.length,T=h(M,"minValue")||0,E=h(M,"maxValue");if(E==I&&(E=0,U.forEach(function(z){h(z,tq).forEach(function(F){E=o(E,F)})})),T===E)return;for(var H=g.height/(E-T),z=g.y+E*H,B=h(U[0],tq).length,D=g.width/(3*B+1),a=0,n=h(M,"lineWidth")||2,u=h(M,"line3d"),X=h(M,"linePoint"),q=h(M,sm),Z=h(M,pf),W=h(M,Zc),e=0;L>e;e++){var O=U[e],t=h(O,_b),S=h(O,tq);t?A.strokeStyle=t:(t=A.strokeStyle=ig[a++],a===ig.length&&(a=0)),A.beginPath();for(var r=0;B>r;r++){var Y=g.x+(2+3*r)*D,d=z-S[r]*H;0===r?A.moveTo(Y,d):A.lineTo(Y,d)}if(A.lineWidth=n,A.stroke(),u&&sh(A,t,I,n,l),X||q){var Q,j=n/2+2;for(r=0;B>r;r++){var x=S[r];if(Y=g.x+(2+3*r)*D,d=z-x*H,Hn(X)?X(A,Y,d,t,r,O,$):X&&(A.fillStyle=t,A.beginPath(),A.arc(Y,d,j,0,f,!0),A.fill()),Hn(q)?Q=q(x,r,O,$):q&&(Q=x),Q){var c=Pb(Z,Q).height,i=A.shadowBlur;if(i){var _=A.shadowOffsetX,R=A.shadowOffsetY,G=A.shadowColor;A.shadowOffsetX=0,A.shadowOffsetY=0,A.shadowBlur=0,A.shadowColor=I}dg(A,Q,Z,W,Y,d-c-j+2,0,c,Nq),i&&(A.shadowOffsetX=_,A.shadowOffsetY=R,A.shadowBlur=i,A.shadowColor=G)}}}}}},K=function(o){A=o[0],$=o[1],H=o[2],l=o[3],Z=o[4],x=o[5]},E=function(){return[A,$,H,l,Z,x]},_=function(O,N){var i;H&&H.getDrawableState?i=H.getDrawableState($):H&&H.getState?i=H.getState($):(i=$ instanceof If?$.s(Ph):null,(i===z||null===i)&&(i=h(O,Ph)));var E=h(N,Ph);return E!==z&&null!==E&&E!==i?!1:h(N,nb)},T={border:i,image:S,text:s,pieChart:M,columnChart:Y,stackedColumnChart:w,percentageColumnChart:O,lineChart:D};return function(s,D,f,L,w,t,u,d,F,M){if(D&&w&&t){var b=E();A=s,$=u,H=d,!$&&H&&H.isSelfViewEvent&&($=H),l=H?H._zoom?H._zoom:1:1,Z=F,x=M;var X=w,N=t;if(sr()){var q,U,O,i,n,S,c;0===A[ll]?sr[0]&&(q=!0):q=!0,A.texureImage2D?sr[1]&&(U=!0):U=!0,A.texureImage3D?sr[2]&&(O=!0):O=!0,A.drawDNDState?sr[3]&&(n=!0):n=!0,A.drawRect?sr[pf[2]]&&(c=!0):c=!0,B[Pk[1]+Il[0]+bq[1]]?sr[Il[0]]&&(S=!0):S=!0,hc.widget[0]?sr[4]&&(i=!0):i=!0,q&&U&&O&&i&&n&&S&&c&&(X=f,N=L)}if(D.tagName)return Fc(po)&&!V[po]||A.drawImage(D,X,N,w,t),K(b),void 0;if(0==h(D,"visible"))return K(b),void 0;Z||(Z=tp(D.color,$,H)),M||(x=tp(D.blendMode,$,H)),Fc(po)&&!V[po]&&(w=X,t=N);var r=nr(D,$,H,w),k=kd(D,$,H,t),o={x:0,y:0,width:r,height:k,fitSize:Ip(D,$,H)},Y=h(D,"clip"),j=h(D,"opacity");if(o.fitSize){var p=o.rw=tp(D.width,$,H)||20;o.widthScale=r/p;var nf=o.rh=tp(D.height,$,H)||20;o.heightScale=k/nf}if(A.save(),A.interactiveInfo){var uk=A.interactiveInfo.matrix,Qc=uk.clone();uk.appendTranslate(X,N).appendScale(w/r,t/k),A.interactiveInfo.refRect=o}or(A,X,N),(r!==w||k!==t)&&A.scale(w/r,t/k),Y&&(Hn(Y)?Y(A,r,k,$,H,D):(A.beginPath(),A.rect(0,0,r,k),A.clip())),j!=I&&(A.globalAlpha*=j),h(D,"comps").forEach(function(c){if(c.prefix){var x=up,w=tp(c.prefix,$,H);w&&(up=up+w+".")}if(0==_(D,c))return c.prefix&&(up=x),void 0;if(Th.splice(0,0,c),A.interactiveInfo)var q=A.interactiveInfo.matrix.clone();var F=h(c,"opacity"),d=h(c,"shadow"),K=h(c,"type"),X=h(c,"refRect")||o,M=Q(c,X);if(F!=I){var k=A.globalAlpha;A.globalAlpha*=F}if(d){var t=l*R.devicePixelRatio,U=A.shadowOffsetX,n=A.shadowOffsetY,r=A.shadowBlur,N=A.shadowColor,s=h(c,"shadowOffsetX"),Y=h(c,"shadowOffsetY"),i=h(c,"shadowBlur"),S=e(c,"shadowColor");A.shadowOffsetX=(s==I?C:s)*t,A.shadowOffsetY=(Y==I?C:Y)*t,A.shadowBlur=(i==I?G:i)*t,A.shadowColor=S||e(Iq)}if("save"===K)A.save();else if("endClip"===K||"restore"===K)A.restore();else if("clip"===K)A.save(),fj(A,h(c,"points",v),h(c,"segments",W),!0),A.clip();else if(ld[K]){if(M=M||{x:0,y:0,width:X.width,height:X.height},g(c,K,M,X),c.prefix&&0===c.prefix.indexOf("ui.")&&H&&B.ui&&H instanceof B.ui.View){H._vectorCompInfo||(H._vectorCompInfo=[]);for(var L=!1,p=0;p<H._vectorCompInfo.length;p++){var Z=H._vectorCompInfo[p];if(c.prefix===Z.comp.prefix&&u===Z.data){H._vectorCompInfo[p]={comp:c,type:K,rect:M,compRefRect:X,data:u,image:D,transform:A.getTransform()},L=!0;break}}L||H._vectorCompInfo.push({comp:c,type:K,rect:M,compRefRect:X,data:u,image:D,transform:A.getTransform()})}}else if(K===$l)g(c,K,M,X);else if("SVGPath"===K)P(c,K,M);else{M=M||{x:0,y:0,width:X.width,height:X.height};var f=h(c,zh),j=h(c,"scaleX"),E=h(c,"scaleY"),O=m(c),b=y(c,M,M,f,j,E,O);if(Hn(K))a(c,K),R.drawCompType(K,A,M,c,$,H);else if(R.getCompType(K)){var V=R.getCompType(K),kg=V.func||V;a(c,V),R.drawCompType(kg,A,M,c,$,H)}else T[K]?T[K](c,M):R.getCompType(K)===z&&Jq.test(K)&&(Bo(K),We=!1);b&&J()}d&&(A.shadowOffsetX=U,A.shadowOffsetY=n,A.shadowBlur=r,A.shadowColor=N),F!=I&&(A.globalAlpha=k),A.interactiveInfo&&(A.interactiveInfo.matrix=q),c.prefix&&(up=x),Th.splice(0,1)}),A.interactiveInfo&&(A.interactiveInfo.matrix=Qc),A.restore(),K(b)}}}();R.getCurrentComp=function(){return Th[0]},R.getParentComp=function(){return Th[1]},R.getInternal=function(){return{isEnter:$r,isEsc:Nn,isSpace:tl,isLeft:so,isUp:Kc,isRight:lf,isDown:Yb,addMethod:Wn,superCall:yd,toPointsArray:mi,translateAndScale:sp,appendArray:uh,createWorldMatrix:Jg,vec3TransformMat4:Ee,setCanvas:Jk,createDiv:eg,createView:Fd,createCanvas:On,createImage:hh,initContext:lc,layout:Ae,fillRect:gk,Mat:Mc,drawBorder:jn,isString:Fc,setBorder:ch,getPropertyValue:ie,setPropertyValue:Se,drawVerticalLine:Hq,draw3DRect:Pe,getPinchDist:ej,isSameRect:is,getPosition:Xc,intersectionLineRect:Mm,getNodeRect:Qj,getEdgeAgentPosition:Hj,getEdgeHostPosition:Hi,getImageWidth:nr,getImageHeight:kd,initItemElement:ym,drawPoints:fj,createG2:tm,closePopup:gf,isH:Cg,createAnim:wj,createNormalMatrix:gd,makeUVMatrix:dl,toColorArray:$m,createNormals:df,toFloatArray:Cq,glMV:Rg,glPop:ci,batchShape:ob,createNodeMatrix:Zi,getShapeModel:kg,getFaceInfo:Vo,transformAppend:Ep,drawFaceInfo:il,glUploadData:Vi,glUploadElementData:Pn,glDrawArray:qb,glDrawElement:kc,glBindTexture:Eb,pickValueToColor:Vs,to3dPointsArray:ff,setGLDebugMode:function(S){$c=S},cube:function(){return{vs:Tm,is:Mb,uv:Zp}},ui:function(){return{DataUI:td,NodeUI:Kg,EdgeUI:Xd,GroupUI:dk,ShapeUI:Zd,GridUI:Cn,Data3dUI:jt,Node3dUI:kt,Shape3dUI:nt}},getInternalVersion:function(){return"U2FsdGVkX1+61laEkosWGdq55OpKLAsc0ekbplL7fQs="},getDragger:function(){return _l},addMSMap:function(N){Wn(ng,N)},k:N,overrideTimerFunc:function(O,t){ed=B.Default.callLater=O,nk=B.Default.cancelLater=t},canEnterEditDetailMode:Gh,addEventListener:j,removeEventListener:W,createGradientByPackedData:zr}},function(d){function A(L,p){L!=I&&(p==I&&Oh!=typeof L?this._54O(L,256):this._54O(L,p))}function c(){return new A(I)}function g(c,v,l,z,F,x){for(;--x>=0;){var D=v*this[c++]+l[z]+F;F=C(D/67108864),l[z++]=67108863&D}return F}function n(q,W,l,s,u,X){for(var k=32767&W,e=W>>15;--X>=0;){var S=32767&this[q],t=this[q++]>>15,K=e*S+t*k;S=k*S+((32767&K)<<15)+l[s]+(1073741823&u),u=(S>>>30)+(K>>>15)+e*t+(u>>>30),l[s++]=1073741823&S}return u}function t(V,Y,P,X,F,B){for(var U=16383&Y,A=Y>>14;--B>=0;){var l=16383&this[V],N=this[V++]>>14,J=A*l+N*U;l=U*l+((16383&J)<<14)+P[X]+F,F=(l>>28)+(J>>14)+A*N,P[X++]=268435455&l}return F}function x(T){return pq.charAt(T)}function h(i,E){var _=oe[i.charCodeAt(E)];return _==I?-1:_}function Y(p){for(var o=this.t-1;o>=0;--o)p[o]=this[o];p.t=this.t,p.s=this.s}function M(g){this.t=1,this.s=0>g?-1:0,g>0?this[0]=g:-1>g?this[0]=g+this.DV:this.t=0}function H(v){var L=c();return L._58O(v),L}function q(s,C){var m,r=this;if(16==C)m=4;else if(8==C)m=3;else if(256==C)m=8;else if(2==C)m=1;else if(32==C)m=5;else{if(4!=C)return r.fromRadix(s,C),void 0;m=2}r.t=0,r.s=0;for(var L=s.length,w=!1,g=0;--L>=0;){var v=8==m?255&s[L]:h(s,L);0>v?"-"==s.charAt(L)&&(w=!0):(w=!1,0==g?r[r.t++]=v:g+m>r.DB?(r[r.t-1]|=(v&(1<<r.DB-g)-1)<<g,r[r.t++]=v>>r.DB-g):r[r.t-1]|=v<<g,g+=m,g>=r.DB&&(g-=r.DB))}8==m&&0!=(128&s[0])&&(r.s=-1,g>0&&(r[r.t-1]|=(1<<r.DB-g)-1<<g)),r._57O(),w&&A.ZERO._78O(r,r)}function j(){for(var f=this,m=f.s&f.DM;f.t>0&&f[f.t-1]==m;)--f.t}function r(s){var o=this;if(o.s<0)return"-"+o._85O()[vi](s);var R;if(16==s)R=4;else if(8==s)R=3;else if(2==s)R=1;else if(32==s)R=5;else{if(4!=s)return o.toRadix(s);R=2}var E,L=(1<<R)-1,A=!1,g="",u=o.t,Q=o.DB-u*o.DB%R;if(u-->0)for(Q<o.DB&&(E=o[u]>>Q)>0&&(A=!0,g=x(E));u>=0;)R>Q?(E=(o[u]&(1<<Q)-1)<<R-Q,E|=o[--u]>>(Q+=o.DB-R)):(E=o[u]>>(Q-=R)&L,0>=Q&&(Q+=o.DB,--u)),E>0&&(A=!0),A&&(g+=x(E));return A?g:"0"}function R(){var R=c();return A.ZERO._78O(this,R),R}function _(){return this.s<0?this._85O():this}function z(t){var y=this,T=y.s-t.s;if(0!=T)return T;var z=y.t;if(T=z-t.t,0!=T)return y.s<0?-T:T;for(;--z>=0;)if(0!=(T=y[z]-t[z]))return T;return 0}function D(x){var c,M=1;return 0!=(c=x>>>16)&&(x=c,M+=16),0!=(c=x>>8)&&(x=c,M+=8),0!=(c=x>>4)&&(x=c,M+=4),0!=(c=x>>2)&&(x=c,M+=2),0!=(c=x>>1)&&(x=c,M+=1),M}function V(){var d=this;return d.t<=0?0:d.DB*(d.t-1)+D(d[d.t-1]^d.s&d.DM)}function s(v,f){var y;for(y=this.t-1;y>=0;--y)f[y+v]=this[y];for(y=v-1;y>=0;--y)f[y]=0;f.t=this.t+v,f.s=this.s}function y(w,R){for(var M=w;M<this.t;++M)R[M-w]=this[M];R.t=o(this.t-w,0),R.s=this.s}function e(y,G){var x,q=this,D=y%q.DB,s=q.DB-D,b=(1<<s)-1,R=C(y/q.DB),N=q.s<<D&q.DM;for(x=q.t-1;x>=0;--x)G[x+R+1]=q[x]>>s|N,N=(q[x]&b)<<D;for(x=R-1;x>=0;--x)G[x]=0;G[R]=N,G.t=q.t+R+1,G.s=q.s,G._57O()}function O(V,H){var x=this;H.s=x.s;var S=C(V/x.DB);if(S>=x.t)return H.t=0,void 0;var L=V%x.DB,s=x.DB-L,m=(1<<L)-1;H[0]=x[S]>>L;for(var K=S+1;K<x.t;++K)H[K-S-1]|=(x[K]&m)<<s,H[K-S]=x[K]>>L;L>0&&(H[x.t-S-1]|=(x.s&m)<<s),H.t=x.t-S,H._57O()}function v(o,w){for(var H=this,q=0,L=0,x=X(o.t,H.t);x>q;)L+=H[q]-o[q],w[q++]=L&H.DM,L>>=H.DB;if(o.t<H.t){for(L-=o.s;q<H.t;)L+=H[q],w[q++]=L&H.DM,L>>=H.DB;L+=H.s}else{for(L+=H.s;q<o.t;)L-=o[q],w[q++]=L&H.DM,L>>=H.DB;L-=o.s}w.s=0>L?-1:0,-1>L?w[q++]=H.DV+L:L>0&&(w[q++]=L),w.t=q,w._57O()}function p(d,E){var w=this.abs(),s=d.abs(),x=w.t;for(E.t=x+s.t;--x>=0;)E[x]=0;for(x=0;x<s.t;++x)E[x+w.t]=w.am(0,s[x],E,x,0,w.t);E.s=0,E._57O(),this.s!=d.s&&A.ZERO._78O(E,E)}function Z(T){for(var y=this.abs(),O=T.t=2*y.t;--O>=0;)T[O]=0;for(O=0;O<y.t-1;++O){var $=y.am(O,y[O],T,2*O,0,1);(T[O+y.t]+=y.am(O+1,2*y[O],T,2*O+1,$,y.t-O-1))>=y.DV&&(T[O+y.t]-=y.DV,T[O+y.t+1]=1)}T.t>0&&(T[T.t-1]+=y.am(O,y[O],T,2*O,0,1)),T.s=0,T._57O()}function l(W,y,p){var K=W.abs(),n=this;if(!(K.t<=0)){var E=n.abs();if(E.t<K.t)return y!=I&&y._58O(0),p!=I&&n._77O(p),void 0;p==I&&(p=c());var s=c(),r=n.s,F=W.s,t=n.DB-D(K[K.t-1]);t>0?(K._44O(t,s),E._44O(t,p)):(K._77O(s),E._77O(p));var d=s.t,m=s[d-1];if(0!=m){var P=m*(1<<n.F1)+(d>1?s[d-2]>>n.F2:0),k=n.FV/P,u=(1<<n.F1)/P,b=1<<n.F2,T=p.t,l=T-d,f=y==I?c():y;for(s._59O(l,f),p._52O(f)>=0&&(p[p.t++]=1,p._78O(f,p)),A.ONE._59O(d,f),f._78O(s,s);s.t<d;)s[s.t++]=0;for(;--l>=0;){var H=p[--T]==m?n.DM:C(p[T]*k+(p[T-1]+b)*u);if((p[T]+=s.am(0,H,p,l,0,d))<H)for(s._59O(l,f),p._78O(f,p);p[T]<--H;)p._78O(f,p)}y!=I&&(p._45O(d,y),r!=F&&A.ZERO._78O(y,y)),p.t=d,p._57O(),t>0&&p._46O(t,p),0>r&&A.ZERO._78O(p,p)}}}function w(S){var x=c();return this.abs()._49O(S,I,x),this.s<0&&x._52O(A.ZERO)>0&&S._78O(x,x),x}function u(b){this.m=b}function U(E){return E.s<0||E._52O(this.m)>=0?E.mod(this.m):E}function b(u){return u}function L(g){g._49O(this.m,I,g)}function J(D,I,r){D._47O(I,r),this._74O(r)}function E(S,U){S._48O(U),this._74O(U)}function P(){if(this.t<1)return 0;var n=this[0];if(0==(1&n))return 0;var K=3&n;return K=15&K*(2-(15&n)*K),K=255&K*(2-(255&n)*K),K=65535&K*(2-(65535&(65535&n)*K)),K=K*(2-n*K%this.DV)%this.DV,K>0?this.DV-K:-K}function B(b){var k=this;k.m=b,k.mp=b._50O(),k.mpl=32767&k.mp,k.mph=k.mp>>15,k.um=(1<<b.DB-15)-1,k.mt2=2*b.t}function K(m){var Z=c();return m.abs()._59O(this.m.t,Z),Z._49O(this.m,I,Z),m.s<0&&Z._52O(A.ZERO)>0&&this.m._78O(Z,Z),Z}function i(C){var a=c();return C._77O(a),this._74O(a),a}function S(B){for(var S=this;B.t<=S.mt2;)B[B.t++]=0;for(var U=0;U<S.m.t;++U){var j=32767&B[U],u=j*S.mpl+((j*S.mph+(B[U]>>15)*S.mpl&S.um)<<15)&B.DM;for(j=U+S.m.t,B[j]+=S.m.am(0,u,B,U,0,S.m.t);B[j]>=B.DV;)B[j]-=B.DV,B[++j]++}B._57O(),B._45O(S.m.t,B),B._52O(S.m)>=0&&B._78O(S.m,B)}function W(w,q){w._48O(q),this._74O(q)}function T(l,Z,K){l._47O(Z,K),this._74O(K)}function Zm(){return 0==(this.t>0?1&this[0]:this.s)}function $c(b,Y){if(b>4294967295||1>b)return A.ONE;var M=c(),O=c(),G=Y._73O(this),T=D(b)-1;for(G._77O(M);--T>=0;)if(Y._76O(M,O),(b&1<<T)>0)Y._75O(O,G,M);else{var W=M;M=O,O=W}return Y.revert(M)}function cc(X,p){var F;return F=256>X||p._51O()?new u(p):new B(p),this.exp(X,F)}function Lk(){var Q=this;if(Q.s<0){if(1==Q.t)return Q[0]-Q.DV;if(0==Q.t)return-1}else{if(1==Q.t)return Q[0];if(0==Q.t)return 0}return(Q[1]&(1<<32-Q.DB)-1)<<Q.DB|Q[0]}function eo(V,I){return new A(V,I)}function mi(){var k=this;k.n=I,k.e=0,k.d=I,k.p=I,k.q=I,k.dmp1=I,k.dmq1=I,k._10A=I}function rr(T){return T._53O(this.e,this.n)}function Pm(r){var a,K,T,H="",X=0;for(a=0;a<r.length&&r.charAt(a)!=lg;++a)T=Hg.indexOf(r.charAt(a)),0>T||(0==X?(H+=x(T>>2),K=3&T,X=1):1==X?(H+=x(K<<2|T>>4),K=15&T,X=2):2==X?(H+=x(K),H+=x(T>>2),K=3&T,X=3):(H+=x(K<<2|T>>4),H+=x(15&T),X=0));return 1==X&&(H+=x(K<<2)),H}function Od(k){var h=k.split(""),G=Pm(k);return h.forEach(function(y){var w=y.length;w>0&&G&&(no+=ip(y))}),G}function bc(W,P){var Z=Dq._4O.Util._56O(W,"ss"),x={},N=0;return x.v=Z==P,x.t=1,x.s=0>N?-1:0,ei=x.v,N>0?x[0]=N:-1>N?x[0]=N+x.DV:x.t=0,[Z,x]}function Cn(f){var V=38,R=f.substring(0,V);if(R&&30==R.indexOf("05000420")){var A=["ss",f.substring(V)];return A}return[]}function Xl(T,d){d=d.replace(pn,""),d=d.replace(/[ \n]+/g,"");var h=eo(d,16);if(h._55O()>this.n._55O())return 0;var D=this._37O(h),g=D[vi](16).replace(/^1f+00/,""),B=Cn(g);if(0==B.length)return!1;for(var q,U,u,b=.5,R=hb,p=[0,.5,.75,.875,.9375],V=[],X=[],G=[],W=f/R,Y=B[1],S=bc(T,Y)[0],K=0,H=0;K<p.length;K++){var o=0===K%2?0:.5;for(q=0;R>=q;q++)U=(q+o)*W,u=1-p[K],V.push(F(U)*b*u,-b+2*p[K]*b,-k(U)*b*u),X.push((q+o)/R,u)}for(K=0;K<p.length-1;K++){var r=K*(R+1),m=(K+1)*(R+1);for(q=0;R>q;q++)G.push(r+q,m+q+1,m+q,r+q,r+q+1,m+q+1)}return G.forEach(function(I){H+=I}),Y==S&&H>10}var _l,Wn=0xdeadbeefcafe,Fb=15715070==(16777215&Wn),vi="toString",Aj="",Nj="nat",ds=function(){};Q=d["D"+11182[vi](m(2,5))];var Jc=A.prototype;md+=mj.substr(0,1);var bo=d.navigator?d.navigator.appName:"";Fb&&"Microsoft Internet Explorer"==bo?(Jc.am=n,_l=30):Fb&&"Netscape"!=bo?(Jc.am=g,_l=26):(Jc.am=t,_l=28),Jc.DB=_l,Jc.DM=(1<<_l)-1,Jc.DV=1<<_l;var kr=52;Jc.FV=m(2,kr),Jc.F1=kr-_l,Jc.F2=2*_l-kr;var Ir,xh,pq="0123456789abcdefghijklmnopqrstuvwxyz",oe=[],No=function(l){return String.fromCharCode(l)};for(Ir="0".charCodeAt(0),xh=0;9>=xh;++xh)oe[Ir++]=xh;for(Ir="a".charCodeAt(0),xh=10;36>xh;++xh)oe[Ir++]=xh;for(Ir="A".charCodeAt(0),xh=10;36>xh;++xh)oe[Ir++]=xh;var Vk=u.prototype;Vk._73O=U,Vk.revert=b,Vk._74O=L,Vk._75O=J,Vk._76O=E;var Yk=B.prototype;Yk._73O=K,Yk.revert=i,Yk._74O=S,Yk._75O=T,Yk._76O=W,Jc._77O=Y,Jc._58O=M,Jc._54O=q,Jc._57O=j,Jc._59O=s,Jc._45O=y,Jc._44O=e,Jc._46O=O,Jc._78O=v,Jc._47O=p,Jc._48O=Z,Jc._49O=l,Jc._50O=P,Jc._51O=Zm,Jc.exp=$c,Jc.toString=r,Jc._85O=R,Jc.abs=_,Jc._52O=z,Jc._55O=V,Jc.mod=w,Jc._53O=cc,A.ZERO=H(0),A.ONE=H(1),Jc._86O=Lk;var Pr=function(k,p){var X=this;X.isPublic=!0,typeof k!==Oh?(X.n=k,X.e=p):k!=I&&p!=I&&k.length>0&&p.length>0&&(X.n=eo(k,16),X.e=ip(p,16))};cm=function(){var j,P,r=Od(Ef),J=r.substr(0,4),f=r.substr(4,2),b=r.substr(6,2),B=1,V=!B,O=N,x=[],Y=pj.charAt(7);if(Q&&(Q[vi]().indexOf(Nj)<0||Q[md][vi]().indexOf(Nj)<0||!r?j=I:(r=new Q(J-0,f-B,b-0),P=r.setHours(9),Q[md]()>P?j=Cl[Y]:V=!0)),r&&j&&j[0]&&j[$(.5)]&&O){var C=Eh(j[0]),L=Eh(j[1]);for(var D in L)x.push(D);var g,T=0,a=C[x[T]],u=L[x[T++]],y=L[x[T++]],S=L[x[T++]],W=L[x[T++]],q=L[x[T++]],i=L[x[T++]],K=C[x[T]],k=L[x[T++]],t=cr._27O(O);if(a===u&&t&&k){g=u+y+S+W+q+i;var e=!i||i===ye||!ye&&i===(Jq+"")[0];if(!e&&i)for(var U,Z=0,R=i.length;R>Z;Z++)i[Z]===mm[T]?U===ye?e=!0:U[0]===Ar[5]&&ye&&ye.indexOf(U.substr(1))>=0?e=!0:U=I:(U==I?U=i[Z]:U+=i[Z],Z===R-1&&(U===ye?e=!0:U[0]===Ar[5]&&ye&&ye.indexOf(U.substr(1))>=0&&(e=!0)));g&&t._31O(g,k)&&t._31O(a,K)&&e&&(!q||Q[md]()<q)&&(V=!0)}}return V||(os=Bd),Y};var zd=mi.prototype;zd._37O=rr,zd._38O=Pr;var Hg="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lg="=",gb=25,Jo=10,Ef="ICKRU===",Fo=Fo||function(K,x){var A={},v=A._7A={},s=v._6A=function(){function r(){}return{_80O:function(m){r.prototype=this;var e=new r;return m&&e._5A(m),e.hasOwnProperty("_82O")||(e._82O=function(){e.$super._82O.apply(this,arguments)}),e._82O.prototype=e,e.$super=this,e},_3A:function(){var I=this._80O();return I._82O.apply(I,arguments),I},_82O:function(){},_5A:function(H){for(var x in H)H.hasOwnProperty(x)&&(this[x]=H[x]);H.hasOwnProperty(vi)&&(this.toString=H.toString)},_88O:function(){return this._82O.prototype._80O(this)}}}(),I=v._39O=s._80O({_82O:function(w,q){w=this._84O=w||[],this._65O=q!=x?q:4*w.length},toString:function(p){return(p||q).stringify(this)},_89O:function(f){var t=this._84O,Z=f._84O,r=this._65O,l=f._65O;if(this._57O(),r%4)for(var I=0;l>I;I++){var R=255&Z[I>>>2]>>>24-8*(I%4);t[r+I>>>2]|=R<<24-8*((r+I)%4)}else if(Z.length>65535)for(var I=0;l>I;I+=4)t[r+I>>>2]=Z[I>>>2];else t.push.apply(t,Z);return this._65O+=l,this},_57O:function(){var a=this._84O,W=this._65O;a[W>>>2]&=4294967295<<32-8*(W%4),a.length=$(W/4)},_88O:function(){var S=s._88O.call(this);return S._84O=this._84O.slice(0),S},_87O:function(M){for(var g=[],R=0;M>R;R+=4)g.push(0|4294967296*Mp);return new I._82O(g,M)}}),d=A._2A={},q=d._69O={stringify:function(j){var C,o=j._84O,q=j._65O,v=[];for(C=0;q>C;C++){var h=255&o[C>>>2]>>>24-8*(C%4);v.push((h>>>4).toString(16)),v.push((15&h).toString(16))}return v.join("")},_68O:function(r){for(var h=r.length,c=[],V=0;h>V;V+=2)c[V>>>3]|=ip(r.substr(V,2),16)<<24-4*(V%8);return new I._82O(c,h/2)}},n=d._8A={stringify:function(m){var x,S=m._84O,Y=m._65O,B=[];for(x=0;Y>x;x++){var U=255&S[x>>>2]>>>24-8*(x%4);B.push(No(U))}return B.join("")},_68O:function(G){var Z,d=G.length,P=[];for(Z=0;d>Z;Z++)P[Z>>>2]|=(255&G.charCodeAt(Z))<<24-8*(Z%4);return new I._82O(P,d)}},m=d._9A={stringify:function(D){try{return decodeURIComponent(escape(n.stringify(D)))}catch(h){throw new Error("")}},_68O:function(z){return n._68O(unescape(encodeURIComponent(z)))}},H=v._32O=s._80O({_1A:function(){this._83O=new I._82O,this._23O=0},_33O:function(G){typeof G==Oh&&(G=m._68O(G)),this._83O._89O(G),this._23O+=G._65O},_25O:function(d){var i=this._83O,m=i._84O,C=i._65O,W=this._79O,k=4*W,n=C/k;n=d?$(n):o((0|n)-this._22O,0);var u=n*W,Z=X(4*u,C);if(u){for(var G=0;u>G;G+=W)this._20O(m,G);var N=m.splice(0,u);i._65O-=Z}return new I._82O(N,Z)},_88O:function(){var K=s._88O.call(this);return K._83O=this._83O._88O(),K},_22O:0});v._66O=H._80O({cfg:s._80O(),_82O:function(s){this.cfg=this.cfg._80O(s),this._1A()},_1A:function(){H._1A.call(this),this._34O()},_81O:function(y){return this._33O(y),this._25O(),this},_72O:function(A){A&&this._33O(A);var R=this._21O();return R},_79O:16,_26O:function(U){return function(Z,S){return new U._82O(S)._72O(Z)}},_19O:function(M){return function(f,J){return new w._71O._82O(M,J)._72O(f)}}});var w=A._67O={};return A}();!function(){var D=Fo,r=D._7A,F=r._39O,k=r._66O,z=D._67O,q=[],B=[];!function(){function L(o){for(var p=a(o),k=2;p>=k;k++)if(!(o%k))return!1;return!0}function J(Y){return 0|4294967296*(Y-(0|Y))}for(var f=2,Z=0;64>Z;)L(f)&&(8>Z&&(q[Z]=J(m(f,.5))),B[Z]=J(m(f,1/3)),Z++),f++}();var L=[],b=z._41O=k._80O({_34O:function(){this._64O=new F._82O(q.slice(0))},_20O:function(s,j){for(var k=this._64O._84O,E=k[0],X=k[1],_=k[2],z=k[3],V=k[4],p=k[5],i=k[6],G=k[7],Y=0;64>Y;Y++){if(16>Y)L[Y]=0|s[j+Y];else{var g=L[Y-15],F=(g<<25|g>>>7)^(g<<14|g>>>18)^g>>>3,u=L[Y-2],S=(u<<15|u>>>17)^(u<<13|u>>>19)^u>>>10;L[Y]=F+L[Y-7]+S+L[Y-16]}var J=V&p^~V&i,b=E&X^E&_^X&_,R=(E<<30|E>>>2)^(E<<19|E>>>13)^(E<<10|E>>>22),M=(V<<26|V>>>6)^(V<<21|V>>>11)^(V<<7|V>>>25),T=G+M+J+B[Y]+L[Y],v=R+b;G=i,i=p,p=V,V=0|z+T,z=_,_=X,X=E,E=0|T+v}k[0]=0|k[0]+E,k[1]=0|k[1]+X,k[2]=0|k[2]+_,k[3]=0|k[3]+z,k[4]=0|k[4]+V,k[5]=0|k[5]+p,k[6]=0|k[6]+i,k[7]=0|k[7]+G},_21O:function(){var Z=this._83O,I=Z._84O,B=8*this._23O,U=8*Z._65O;return I[U>>>5]|=128<<24-U%32,I[(U+64>>>9<<4)+14]=C(B/4294967296),I[(U+64>>>9<<4)+15]=B,Z._65O=4*I.length,this._25O(),this._64O},_88O:function(){var N=k._88O.call(this);return N._64O=this._64O._88O(),N}});D._41O=k._26O(b),D._42O=k._19O(b)}();var pn=new RegExp("");pn.compile("[^0-9a-f]","gi"),mi._28O=-1,mi._29O=-2,zd._31O=Xl,zd._63O=Xl,mi._43O=-2;var Ur=new function(){var O=this;O._5O=function($,B){if("8"!=$.substring(B+2,B+3))return 1;var Q=ip($.substring(B+3,B+4));return 0==Q?-1:Q>0&&10>Q?Q+1:-2},O._13O=function(t,J){var X=O._5O(t,J);return 1>X?"":t.substring(J+2,J+2+2*X)},O._12O=function(z,g){var L=O._13O(z,g);if(""==L)return-1;var H;return H=ip(L.substring(0,1))<8?new A(L,16):new A(L.substring(2),16),H._86O()},O._6O=function(h,y){var Q=O._5O(h,y);return 0>Q?Q:y+2*(Q+1)},O._11O=function(j,Y){var p=O._6O(j,Y),N=O._12O(j,Y);return j.substring(p,p+2*N)},O._10O=function(t,r){var p=O._6O(t,r),A=O._12O(t,r);return p+2*A},O._7O=function(Z,D){var y=[],R=O._6O(Z,D);y.push(R);for(var P=O._12O(Z,D),m=R,C=0;;){var J=O._10O(Z,m);if(J==I||J-R>=2*P)break;if(C>=200)break;y.push(J),m=J,C++}return y}};if(Ur._90O=No(Jo+24),Ur._91O=G+No(Jo*Jo+8),Dq==I||!Dq)var Dq={};Dq._4O!=I&&Dq._4O||(Dq._4O={});var yf=Dq._4O;Dq._4O.Util=new function(){var t=this;t._56O=function(B){var Q=new Dq._4O._3O;return Q._30O(B)},t._4A=function(o){var _=new Dq._4O._3O;return _._36O(o)},t._11A=function(T){var p=new yf._3O;return p._30O(T)}},Dq._4O._3O=function(){var P=this;P._8O=function(W,$){if("ss"==W&&"cj"==$){try{P.md=Fo._67O._41O._3A()}catch(I){ds(Aj)}P._24O=function(J){P.md._81O(J)},P._35O=function(e){var $=Fo._2A._69O._68O(e);P.md._81O($)},P._60O=function(){var K=P.md._72O();return K[vi](Fo._2A._69O)},P._30O=function(q){return P._24O(q),P._60O()},P._36O=function(I){return P._35O(I),P._60O()}}},P._24O=function(){ds(Aj)},P._35O=function(){ds(Aj)},P._60O=function(){ds(Aj)},P._30O=function(){ds(Aj)},P._36O=function(){ds(Aj)},P._8O("ss","cj")},rd=function(R){var g=cb[Yd[7]],Q=1,y=!1;if(yc.a!=cb[Vj])return yc.a;if(yc.forEach(function(I){Q*=I}),R>Q){if(g&&g[1]&&g[0]){var K=g[0],p=g[1];p=p.split(Ur._90O),K=K.split(Ur._90O);var T=p[3],O=K[3],H=p[7],x=p[11],v=p[15],A=p[19],J=p[23],P=p[27],f=K[7],h=T+H+x+v+A+J,k=J?!1:!0,o=O===T;if(J===Wl.toString()[0]&&(J=J+J+J),J){var e=J&&J.split(uo("firefox")[3]);if(e)for(var c=0;c<e.length;c++){var Z=e[c];if(Z[0]===vs[8]&&(Z=Z.substring(1)),gm.indexOf(Z)>=0){k=!0;break}}}y=o&&Or()(O,f)&&Or()(h,P)&&k&&(!A||A>R),y&&x.indexOf(lr.length)>=0&&(rd[lr.length]=lr),y&&x.indexOf(lr.length+1)>=0&&(rd[lr.length+1]=lr),y&&x.indexOf(lr.length+3)>=0&&(rd[lr.length+3]=lr),y&&x.indexOf(Tl.length)>=0&&(rd[Tl.length]=Tl)}y||(td.prototype._42=Gl)}else y=!0,rd[lr.length]=rd[lr.length+1]=rd[lr.length+3]=rd[Tl.length]=lr;return yc.a=y,y},gb=String.fromCharCode(gb+20);var gh=function(n){return n=n.replace(pn,Aj),n=n.replace(/[ \n]+/g,Aj)},Ek="30",sd="06",Sm="02",Wk="03",Bq=eo,wn=/^1f+00/,cr=function(){var z;return z={_18O:function(A){var i=A,D=i.replace(/\s+/g,""),l=Pm(D);return l},_14O:function(h){var l=this._18O(h),E=this._15O(l);return E},_15O:function($){var D=this._17O($);if("2a864886f70d010101"==D._61O){var i=this._16O(D.key),x=new mi;return x._38O(i.n,i.e),x}ds(Aj)},_16O:function(L){var U={};L.substr(0,2)!=Ek&&ds(Aj);var v=Ur._7O(L,0);return 2!=v.length&&ds(Aj),L.substr(v[0],2)!=Sm&&ds(Aj),U.n=Ur._11O(L,v[0]),L.substr(v[1],2)!=Sm&&ds(Aj),U.e=Ur._11O(L,v[1]),U},_17O:function(C){var G={};G._40O=I;var M=Ur._7O(C,0);2!=M.length&&ds(Aj);var b=M[0];C.substr(b,2)!=Ek&&ds(Aj);var k=Ur._7O(C,b);return 2!=k.length&&ds(Aj),C.substr(k[0],2)!=sd&&ds(Aj),G._61O=Ur._11O(C,k[0]),C.substr(k[1],2)==sd?G._40O=Ur._11O(C,k[1]):C.substr(k[1],2)==Ek&&(G._40O={},G._40O.p=Ur._70O(C,k[1],[0],Sm),G._40O.q=Ur._70O(C,k[1],[1],Sm),G._40O.g=Ur._70O(C,k[1],[2],Sm)),C.substr(M[1],2)!=Wk&&ds(Aj),G.key=Ur._11O(C,M[1]).substr(2),G}},z._17O?z:I}(),Bb=cr._27O=function(j){return cr._14O(j)};Or=function(){return function(J,g){if(J&&g){g=gh(g);var $=Bq(g,m(2,4)),A=this;if(!A||!A.n||$._55O()>A.n._55O())return 0;var k=A._37O($),D=k[vi](m(2,4)).replace(wn,""),F=Cn(D);if(0==F.length)return!1;var c=F[0],U=F[1],Y=function(u){return Dq._4O.Util._56O(u,c)},M=Y(J);return U==M}}.bind(Bb(N))};var kd,ls;return function(){var v=Ld.length-Kh.length;if(v>0)for(var d=0;v>d;d++)kd=yf.Util,ls=gh}(),Ic=function(S,P){P=ls(P);var U=Bb($f),E=Mq.length,r=2*E,C=Bq(P,m(E,r)),a=U,L=!0;if(a){var A=a[xj[0]];A&&C._55O()<=A._55O()&&(L=!1)}if(L)return 0;var u=a._37O(C),t=u[vi](m(E,r)).replace(wn,""),I=Cn(t);if(0==I.length)return!1;var H=I[0],g=I[1],D=kd._11A(S,H);return g==D},cr}(V,T),Wn(R,{load:function(){var D={},x=function(j){return j?"c_"+(j.sync?"1":"0")+"_"+(j.post?"1":"0")+"_"+(j.responseType||"H")+"_"+(j.mimeType||"H")+"_"+(j.data?JSON.stringify(j.data):"H"):""};return function(K,h,b){var V,P=D[K],j=x(b);return P&&(V=P[j])?(V.push(h),void 0):(D[K]||(P=D[K]={count:0}),V=P[j]=[h],P.count++,R.xhrLoad(K,function(g){delete P[j],P.count--,P.count||delete D[K],V.forEach(function(C){C(g)})},b),void 0)}}(),asyncEach:function(p,S,j){"function"!=typeof j&&(j=Function.prototype);var J=new Array(p.length),m=0,r=!1;p.forEach(function(R,P){S(R,function(o,s){return r?void 0:o?(r=!0,j(null)):(J[P]=s,m++,m===p.length?j(J):void 0)})})},xhrLoad:function(J,t,T){var l=!1;ar(J)||(l=!0,J=[J]),T=T||{};var z=T.sync,F=null,E=T.method||"GET";return T.post&&(E="POST"),T.method=E,R.asyncEach(J,function(g,o){if(g=R.beforeLoadURL(g),g.data)o(null,g.data);else{T.url=encodeURI(g);var v=new nc;v.onload=function(){200===this.status||0===this.status?o(null,v.getResponseText()):o(!0)},v.onerror=function(){o(!0)},v.send(T)}},function(I){var A="function"==typeof t;(A||z)&&(F=l&&I?I[0]:I,A&&t(F))}),z?F:void 0}});var nh=T.setPrototypeOf||function(O,W){return O.__proto__=W,O},uk=T.getPrototypeOf||function(t){return t.__proto__},fc=T.freeze;T.isFrozen;var Bf=function(){var $=function(Q){return Q};return function(c){return c&&c.length?new Function("o",["return o['",c.join("']['"),"'];"].join("")):$}}(),Ad=function(){var a=function(d,$){return d=$};return function(H){return H&&H.length?new Function("o","v",["return o['",H.join("']['"),"'] = v;"].join("")):a}}();!function(){function t(e){var H=[];if(e)for(var Z;(Z=L.exec(e))!=z;)H.push(Z[1]);return H}function o(v,e){var k=i.exec(e);this._cell=v,this._key=k[1],this._format=k[2],this._style=t(k[3])}function _(L){for(var x=this._cellList=[],h=this._paramList=[],V=L.split(G),i=0,d=V.length;d>i;++i){var s=V[i];if("{{"!==s)for(var y=s.split(R),F=0,J=y.length;J>F;++F){var O=y[F];R.test(O)?(h.push(new o(x.length,O)),x.push(z)):O.length>0&&x.push(O)}else x.push("{")}this._formatList=this._cellList.slice(0)}var d={},s={},G=/(\{\{)/,R=/(\{\w+(?:\:\w+(?:\&[\w\.])*)?\})/,i=/\{(\w+)(?:\:(\w+)((?:\&[\w\.])*))?\}/,L=/\&([\w\.]*)/g;_.prototype._73O=function(e){for(var D=this._paramList.length;D--;){var z=this._paramList[D],h=e[ip(z._key)+1],v=s[z._format];v&&(h=v(h,z._style)),this._formatList[z._cell]=h}return this._formatList.join("")},_.prototype._map=function(u){for(var B=this._paramList.length;B--;){var e=this._paramList[B],a=u[e._key],d=s[e._format];d&&(a=d(a,e._style)),this._formatList[e._cell]=a}return this._formatList.join("")};var f=function(Q){var U=d[Q];return U||(d[Q]=U=new _(Q)),U._73O(arguments)};return f.map=function(P,a){var X=d[P];return X||(d[P]=X=new _(P)),X._map(a)},f.setValueFormat=function(v,F){s[v]=F},f.gc=function(){d.length=0},f.__parsed=d,f}();var qq=function(){function h(R,w,c,D){var F=R?R.path.slice(0):[];w&&F.push(w),this.desc=c,this.name=w,this.path=fc(F),this.getter=Bf(F),this.setter=Ad(F),this.isLeaf=D,this.parent=R,this.children=[],this.childMap={}}return h.create=function(){function J(D,f,l,G){var g=G(l),V=new h(D,f,l,g);if(!g){for(var K=V.children,j=V.childMap,w=T.keys(l),R=0,s=w.length;s>R;++R){var $=w[R],o=J(V,$,l[$],G);K.push(o),j[o.name]=o}V.children=fc(K),V.childMap=fc(j)}return fc(V),V}return function(p,V){return J(z,z,p,V)}}(),h.prototype.forEach=function(G,k){for(var o=this.children,L=0,C=o.length;C>L;++L){var V=o[L];G(V,k)}},h}(),fc=T.freeze,yh={main:{mask:1,priority:R.cameraPriority.main,clearDepth:!1,ignore:!1},top:{mask:2,priority:R.cameraPriority.top,ignore:!1}},Fl="main",Dc=yh[Fl].mask,rc=function(F,k){F=F||0;var I;if(k in yh)I=yh[k].mask;else{if(!(32>aj))throw new Error("Only 31 render layer can be defined.");yh[k]={mask:1<<aj++,priority:yh[Fl].priority},I=yh[k].mask,ok=ir(T.keys(yh)),aj=ok.length}return F|=I},Qo=function(Z,I){return Z&&I&&Z&I},ir=function(m){return m.sort(function(O,c){return yh[O].priority-yh[c].priority})},ok=ir(T.keys(yh)),aj=ok.length;Wn(R,{setRenderLayerInfo:function(U,A){if(rc(0,U),A){for(var E in A)yh[U][E]=A[E];A.priority&&(ok=ir(T.keys(yh)))}},getRenderLayerInfo:function(Q){return yh[Q]}},!0);var Gk=B.List=function(){this._as=[];var V,s,q=arguments.length;if(1===q){var o=arguments[0];if(vq(o)&&(o=o._as),ar(o))for(s=o.length,V=0;s>V;V++)this._as.push(o[V]);else o!=I&&this._as.push(o)}else if(q>1)for(V=0;q>V;V++)this._as.push(arguments[V])};$e("List",T,{forEach:function(A,i){this.each(A,i)},push:function(){for(var K=0;K<arguments.length;K++)this.add(arguments[K])},pop:function(){return this._as.pop()},shift:function(){return this._as.shift()},unshift:function(){return this._as.unshift.apply(this._as,arguments)},size:function(){return this._as.length},isEmpty:function(){return 0===this._as.length},add:function(x,J){return J===z?this._as.push(x):this._as.splice(J,0,x)},addAll:function(N){vq(N)&&(N=N._as),ar(N)?uh(this._as,N):this._as.push(N)},get:function(K){return this._as[K]},slice:function(W,O){return new Gk(this._as.slice(W,O))},remove:function(A){var l=this._as.indexOf(A);return l>=0&&l<this._as.length&&this.removeAt(l),l},removeAt:function(g){return this._as.splice(g,1)[0]},set:function(x,b){return this._as[x]=b},clear:function(){return this._as.splice(0,this._as.length)},contains:function(c){return this._as.indexOf(c)>=0},indexOf:function(P){return this._as.indexOf(P)},each:function(K,B){for(var R=0,O=this._as.length;O>R;R++){var H=this._as[R];B?K.call(B,H,R,this):K(H,R,this)}},reverseEach:function(E,T){for(var z=this._as.length-1;z>=0;z--){var u=this._as[z];T?E.call(T,u):E(u)}},getArray:function(){return this._as},toArray:function(e,J){if(e){for(var f,O=[],i=0,D=this._as.length;D>i;i++)f=this._as[i],J?e.call(J,f)&&O.push(f):e(f)&&O.push(f);return O}return this._as.concat()},toList:function(J,z){if(J){for(var X,o=new Gk,w=0,n=this._as.length;n>w;w++)X=this._as[w],z?J.call(z,X)&&o.add(X):J(X)&&o.add(X);return o}return new Gk(this)},reverse:function(){this._as.reverse()},sort:function(Q){return this._as.sort(Q?Q:cf),this},toString:function(){return this._as.toString()}}),T.defineProperties(Gk.prototype,{length:{get:function(){return this._as.length
},set:function(x){this._as.length=x}}});var De=new Gk;Wn(De,{size:function(){return 0},indexOf:function(){return-1},contains:function(){return!1},isEmpty:function(){return!0},sort:No,each:No,reverseEach:No,toArray:function(){return[]},toList:function(){return new Gk},add:Dm,addAll:Dm,set:Dm,remove:Dm,removeAt:Dm,clear:Dm});var Tn=B.Notifier=function(){this._f=0};$e("Notifier",T,{contains:function(v,J){if(this._ls)for(var M,V=0,e=this._ls.size();e>V;V++)if(M=this._ls.get(V),v===M.l&&J===M.s)return!0;return!1},add:function(y,s,I){var T=this,W={l:y,s:s,a:I};T._ls||(T._ls=new Gk),T._f?(T._as||(T._as=new Gk),T._as.add(W)):W.a?T._ls.add(W,0):T._ls.add(W)},remove:function(a,V){var N=this;N._ls&&(N._f?(N._rs||(N._rs=new Gk),N._rs.add({l:a,s:V})):N._remove(a,V))},_remove:function(k,M){for(var e,I=this._ls,h=0,V=I.size();V>h;h++)if(e=I.get(h),e.l===k&&e.s===M)return I.removeAt(h),void 0},fire:function(v){var B=this,u=B._ls;if(B._b=1e4,u){++B._f;try{for(var L,U=0,T=u.size();T>U;U++)L=u.get(U),L.s?L.l.call(L.s,v):L.l(v)}catch(v){hl(function(){throw v})}finally{if(--B._f)return;if(B._rs){for(T=B._rs.size(),U=0;T>U;U++)L=B._rs.get(U),B._remove(L.l,L.s);delete B._rs}if(B._as){for(T=B._as.size(),U=0;T>U;U++)L=B._as.get(U),L.a?u.add(L,0):u.add(L);delete B._as}}}}});var If=B.Data=function(){this._id=Bi()};$e("Data",T,{ms_ac:["tag","name","displayName","icon","toolTip","attrObject","styleMap","layer","renderLayer","adjustChildrenToTop","dataBindings"],ms_dm:1,ms_attr:1,_icon:I,_parent:I,_children:De,_childMap:I,_styleMap:I,_layer:"0",_renderLayer:Fl,_adjustChildrenToTop:!1,getRenderLayer:function(){return this._renderLayer||Fl},getUIClass:function(){return I},_22Q:function(){return I},beginTransaction:function(){this._dataModel&&this._dataModel.beginTransaction()},endTransaction:function(){this._dataModel&&this._dataModel.endTransaction()},s:function(Y,w){var j=this;if(2===arguments.length)j.setStyle(Y,w);else{if(!Pd(Y))return j.getStyle(Y);for(var g in Y)j.setStyle(g,Y[g])}return j},fp:function(h,N,m,S,D){return this.firePropertyChange(h,N,m,S,D)},firePropertyChange:function(D,t,v,n,d){if(n){if(n(t,v))return!1}else if(t===v)return!1;var z=this,Y=d||{};return Y.property=D,Y.oldValue=t,Y.newValue=v,Y.data=z,z._dataModel&&z._dataModel.handleDataPropertyChange(Y),z.onPropertyChanged(Y),!0},onPropertyChanged:function(A){var p=this,Y=p._parent,L=A.property;if(wp(Y)){var y=p.s(Uo),E="s:ingroup"===L;(y&&Nf[L]||L===E)&&Y._81I(),(y||E)&&Y.fp("childChange",!0,!1)}Me(Y)&&(Nf[L]||"elevation"===L||Un[L]||"scaleTall"===L||"tall"===L)&&Y.updateFromChildren(),("s:alwaysOnTop"===L||"s:shape3d.alwaysOnTop"===L)&&(A.newValue?this.setRenderLayer("top"):this.setRenderLayer(z))},_21I:function(C){var y=this;if(C&&y._dataModel)throw"Remove data from dataModel before adding";y._dataModel=C},removeFromDataModel:function(){this._dataModel?this._dataModel.remove(this):this.setParent(null)},clearChildrenFromDataModel:function(){for(var i=0,w=this._children.toArray(),h=w.length;h>i;i++)w[i].removeFromDataModel()},getId:function(){return this._id},setId:function(t){this._id=t},getChildren:function(){return this._children},size:function(){return this._children.size()},toChildren:function(O,S){return this._children.toList(O,S)},eachChild:function(d,x){this._children.each(d,x)},addChild:function(h,a){var n=this;h!==n&&(n._children===De&&(n._children=new Gk,n._childMap={}),a>=0||(a=n._children.size()),n._childMap[h._id]||n.isDescendantOf(h)||(h._parent&&h._parent.removeChild(h),(0>a||a>n._children.size())&&(a=n._children.size()),n._children.add(h,a),n._childMap[h._id]=h,h.setParent(n),n.onChildAdded(h,a),n.fp(Pc,I,h)))},onChildAdded:function(){},removeChild:function(Y){var S=this;if(S._childMap&&S._childMap[Y._id]){var o=S._children.remove(Y);delete S._childMap[Y._id],S.fp(Pc,Y,I),Y.setParent(I,o),S.onChildRemoved(Y,o)}},onChildRemoved:function(){},getChildAt:function(S){return this._children.get(S)},clearChildren:function(){var y=this;if(!y._children.isEmpty())for(var M=0,T=y._children.toArray(),v=T.length;v>M;M++)y.removeChild(T[M])},getParent:function(){return this._parent},setParent:function(o,s){var p=this;if(!(p._73I||p._parent===o||p===o||o&&o.isDescendantOf(p))){var P,r=p._parent;p._parent=o,p._73I=1,r?(s==I&&(s=r.getChildren().indexOf(p)),r.removeChild(p)):p._dataModel&&s==I&&(s=p._dataModel.getRoots().indexOf(p)),o&&(o.addChild(p),P=o.getChildren().indexOf(p)),delete p._73I,p.fp("parent",r,o,z,{oldIndex:s,newIndex:P}),p.onParentChanged(r,o)}},onParentChanged:function(){},hasChildren:function(){return this._children.size()>0},isEmpty:function(){return this._children.isEmpty()},isRelatedTo:function(N){return N?this.isDescendantOf(N)||N.isDescendantOf(this):!1},isParentOf:function(S){return S&&this._childMap?!!this._childMap[S._id]:!1},isDescendantOf:function(k){if(!k||k.isEmpty())return!1;for(var l=this._parent;l;){if(k===l)return!0;l=l._parent}return!1},getStyle:function(H,y){y===z&&(y=1);var b=this._styleMap?this._styleMap[H]:z;return b===z&&y?c[H]:b},setStyle:function(I,n){var V=this;V._styleMap||(V._styleMap={});var H=V._styleMap[I];n===z?delete V._styleMap[I]:V._styleMap[I]=n,V.fp("s:"+I,H,n)&&V.onStyleChanged(I,H,n)},onStyleChanged:function(){},iv:function(U){this.invalidate(U)},invalidate:function(v){this.fp(v||"*",!1,!0)},toString:function(){var V=this;return V._displayName||V._name||V._tag||V._id},toLabel:function(){return this._displayName||this._name},addStyleIcon:function(Q,X){var s=this,Z=s.s(Vp);s.beginTransaction(),Z||s.s(Vp,Z={}),X?Z[Q]=X:delete Z[Q],s.fp(Vp,I,Z),s.endTransaction()},removeStyleIcon:function(g){var T=this.s(Vp);if(T){var J=T[g];delete T[g],this.fp(Vp,I,T)}return J},_calcAnchorMatrix3d:function(){},appendAnchorMatrix3d:function(w){var u=this;if(u.hasOwnProperty("_anchor")||u.hasOwnProperty("_anchorElevation")){var U=u.getAnchor3d(),S={x:U.x-.5,y:U.y-.5,z:U.z-.5};uf(w,[-S.x,-S.y,-S.z])}},getSerializableProperties:function(){return{name:1,displayName:1,icon:1,toolTip:1,parent:1,layer:1,renderLayer:1,tag:1,adjustChildrenToTop:1,dataBindings:1}},getSerializableStyles:function(){var w,q={};for(w in this._styleMap)q[w]=1;return q},getCurrentPrefix:function(){return this._interactPrefix||up},ca:function(u,F){var x=this.getCurrentPrefix();return u=x+u,2===arguments.length?this.a(u,F):this.a(u)}});var Og=B.DataModel=function(){var P=this;P._isDeserializing=0,P._datas=new Gk,P._dataMap={},P._roots=new Gk,P._rootMap={},P._fsDataMap={},P._78O={},P._reflectorMap={},P._36I=new Tn,P._35I=new Tn,P._serializeNotifier=new Tn,P._selectionModel=new Gc(P);var B=P._29Q=[],Y=P._scheduleCallback=function(){for(var T=Date.now(),b=0;b<B.length;b++){var O=B[b];O.enabled&&T-O.lastTime>O.interval&&(O.beforeAction&&O.beforeAction(),O.action&&P.each(function(S){O.action(S)}),O.afterAction&&O.afterAction(),O.lastTime=T)}B.length&&(P._30Q=V.requestAnimationFrame(Y))}};$e("DataModel",T,{ms_fire:1,ms_attr:1,ms_ac:["layers","name","autoAdjustIndex","hierarchicalRendering","background","envmapType","envmap","postProcessingData","init"],_name:z,_autoAdjustIndex:!0,_hierarchicalRendering:!1,_background:z,_init:z,_envmap:z,_envmapType:z,_postProcessingData:z,sm:function(){return this.getSelectionModel()},mm:function(f,Z,J){this.addDataModelChangeListener(f,Z,J)},umm:function($,w){this.removeDataModelChangeListener($,w)},md:function(Q,s,p){this.addDataPropertyChangeListener(Q,s,p)},umd:function(F,i){this.removeDataPropertyChangeListener(F,i)},mh:function(A,g,E){this.addHierarchyChangeListener(A,g,E)},umh:function(E,i){this.removeHierarchyChangeListener(E,i)},getAttrObject:function(){return this._attrObject},setAttrObject:function(F){return this._attrObject=F},getSelectionModel:function(){return this._selectionModel},size:function(){return this._datas.size()},isEmpty:function(){return this._datas.isEmpty()},getRoots:function(){return this._roots},getDatas:function(){return this._datas},getFullscreenDatas:function(){return this._fsDataMap},getReflectors:function(){return this._reflectorMap},getDataById:function(M){return this._dataMap[M]},removeDataById:function(V){this.remove(this.getDataById(V))},toDatas:function(J,Z){return this._datas.toList(J,Z)},each:function(i,P){this._datas.each(i,P)},getDataByTag:function(Z){return this._78O[Z]},getTagMap:function(){return this._78O},removeDataByTag:function(f){this.remove(this.getDataByTag(f))},add:function(y,s,C){var e=this,q=y._id,t=y._tag,m=e._roots;if(e._dataMap[q])throw"'"+q+"' already exists";t!=I&&(e._78O[t]=y),e._dataMap[q]=y,C>=0?e._datas.add(y,C):e._datas.add(y),y._parent||(e._rootMap[q]=y,s>=0?m.add(y,s):m.add(y)),y.s("fullscreen")!==z&&(e._fsDataMap[q]=y),y.s("shape3d.reflector")&&(e._reflectorMap[q]=y),y._21I(e),e.onAdded(y),e._36I.fire({kind:"add",data:y,rootsIndex:s,datasIndex:C})},onAdded:function(){},remove:function(B,r){if(B){var N=this,p=B._id,a=r&&r.keepStructure,s=r&&r.keepChildren,Y=B.getTag();if(B._dataModel===N){var e=B instanceof Xl;e&&R.setIsolating(!0),this.beginTransaction(),a?N._removingData||(N._removingData=B):N.prepareRemove(B),s||B.toChildren().each(function(Q){N.remove(Q,r)},N),a?N._removingData===B&&(B._parent&&B._parent.removeChild(B),delete N._removingData):B._parent&&B._parent.removeChild(B);var j=N._datas.remove(B);delete N._dataMap[p],Y!=I&&delete N._78O[Y];var _;N._rootMap[p]&&(delete N._rootMap[p],_=N._roots.remove(B)),N._fsDataMap[p]&&delete N._fsDataMap[p],N._reflectorMap[p]&&delete N._reflectorMap[p],B._21I(I),N.onRemoved(B),N._36I.fire({kind:Ib,data:B,rootsIndex:_,datasIndex:j}),this.endTransaction(),e&&R.setIsolating(!1)}}},onRemoved:function(){},prepareRemove:function(){},clear:function(){var X=this;if(X._datas.size()){var x=X._historyManager?this.toJSON():z;X._datas.toArray().forEach(function(s){s._21I(I)}),X._datas.clear(),X._dataMap={},X._roots.clear(),X._rootMap={},X._fsDataMap={},X._reflectorMap={},X._78O={},X._36I.fire({kind:jr,json:x})}},contains:function(o){return o&&o._dataModel===this},handleDataPropertyChange:function(x){var c=this,N=x.data,C=x.property;if("parent"===C){var n=N._id,s=c._rootMap,T=c._roots;N._parent?s[n]&&(delete s[n],T.remove(N)):s[n]||(s[n]=N,T.add(N))}else if("tag"===C){var j=x.oldValue,U=x.newValue,D=c._78O;j!=I&&delete D[j],U!=I&&(D[U]=N)}else if("s:fullscreen"===C){var n=N._id,r=c._fsDataMap;x.oldValue!=I&&delete r[n],x.newValue!=I&&(r[n]=N)}else if("s:shape3d.reflector"===C){var n=N._id,A=c._reflectorMap;x.oldValue&&delete A[n],x.newValue&&(A[n]=N)}this.onDataPropertyChanged(N,x),this._35I.fire(x)},onDataPropertyChanged:function(){},addDataModelChangeListener:function(M,y,s){this._36I.add(M,y,s)},removeDataModelChangeListener:function(R,y){this._36I.remove(R,y)},addSerializeListener:function(R,P,G){this._serializeNotifier.add(R,P,G)},removeSerializeListener:function(F,b){this._serializeNotifier.remove(F,b)},fireSerializeEvent:function(Q){this._serializeNotifier.fire(Q)},addDataPropertyChangeListener:function(r,Q,L){this._35I.add(r,Q,L)},removeDataPropertyChangeListener:function(T,I){this._35I.remove(T,I)},_38I:function(j,b,P){this._37I&&this._37I.fire({data:j,oldIndex:b,newIndex:P})},addHierarchyChangeListener:function(t,o,Z){this._37I||(this._37I=new Tn),this._37I.add(t,o,Z)},removeHierarchyChangeListener:function(f,K){this._37I.remove(f,K)},getSiblings:function(r){var I=r._parent;return I?I._children:this._roots},eachByHierarchical:function(s,P,F){if(P)return this._eachByHierarchical(s,P,F);for(var G=0,v=this._roots,e=v.size();e>G;G++)if(this._eachByHierarchical(s,v.get(G),F)===!1)return!1;return!0},_eachByHierarchical:function(G,a,Q){if(Q){if(G.call(Q,a)===!1)return!1}else if(G(a)===!1)return!1;for(var q=a.size(),D=0;q>D;D++)if(this._eachByHierarchical(G,a.getChildAt(D),Q)===!1)return!1;return!0},reverseEachByHierarchical:function(e,A,b){if(A)return this._reverseEachByHierarchical(e,A,b);for(var T=this._roots,O=T.size(),s=O-1;s>=0;s--)if(this._reverseEachByHierarchical(e,T.get(s),b)===!1)return!1;return!0},_reverseEachByHierarchical:function($,Y,E){for(var m=Y.size(),u=m-1;u>=0;u--)if(this._reverseEachByHierarchical($,Y.getChildAt(u),E)===!1)return!1;if(E){if($.call(E,Y)===!1)return!1}else if($(Y)===!1)return!1;return!0},eachByDepthFirst:function(R,u,$){if(u)return this._11I(R,u,$);for(var h=0,P=this._roots,Z=P.size();Z>h;h++)if(this._11I(R,P.get(h),$)===!1)return!1;return!0},_11I:function(N,A,t){for(var _=A.size(),O=0;_>O;O++)if(this._11I(N,A.getChildAt(O),t)===!1)return!1;if(t){if(N.call(t,A)===!1)return!1}else if(N(A)===!1)return!1;return!0},eachByBreadthFirst:function(J,X,_){var H=new Gk;for(X?H.add(X):this._roots.each(H.add,H);H.size()>0;)if(X=H.removeAt(0),X.eachChild(H.add,H),_){if(J.call(_,X)===!1)return!1}else if(J(X)===!1)return!1;return!0},moveTo:function(g,l){var R=this.getSiblings(g),v=R.indexOf(g);v===l||0>v||l>=0&&l<=R.size()&&(R.remove(g),l>R.size()&&l--,R.add(g,l),this._38I(g,v,l))},moveUp:function(F){this.moveTo(F,this.getSiblings(F).indexOf(F)-1)},moveDown:function(W){this.moveTo(W,this.getSiblings(W).indexOf(W)+1)},moveToTop:function(o){this.moveTo(o,0)},moveToBottom:function(r){this.moveTo(r,this.getSiblings(r).size())},moveSelectionUp:function(F){this.beginTransaction(),F||(F=this.sm());var X=new Gk;Zj(F,X,this._roots),X.each(this.moveUp,this),this.endTransaction()},moveSelectionDown:function(Y){this.beginTransaction(),Y||(Y=this.sm());var $=new Gk;bd(Y,$,this._roots),$.each(this.moveDown,this),this.endTransaction()},moveSelectionToTop:function(c){this.beginTransaction(),c||(c=this.sm());var J=new Gk;ck(c,J,this._roots),J.each(this.moveToTop,this),this.endTransaction()},moveSelectionToBottom:function(D){this.beginTransaction(),D||(D=this.sm());var N=new Gk;mo(D,N,this._roots),N.each(this.moveToBottom,this),this.endTransaction()},moveToIndex:function(c,U,z){var s=this.getDatas();null==z&&(z=s.indexOf(c)),z===U||0>z||U>=0&&U<=s.size()&&(s.remove(c),U>s.size()&&U--,s.add(c,U),this._76I(c,z,U))},bringForward:function(o){this.moveToIndex(o,this.getDatas().indexOf(o)+1)},bringToFront:function(i){this.moveToIndex(i,this.size())},sendBackward:function(V){this.moveToIndex(V,this.getDatas().indexOf(V)-1)},sendToBack:function(t){this.moveToIndex(t,0)},bringSelectionForward:function(s){this.beginTransaction(),s||(s=this.sm());for(var O=new Gk,a=this.getDatas(),B=!1,Y=0;Y<a.size();Y++){var e=a.get(a.size()-1-Y);s.contains(e)?B&&O.add(e):B=!0}O.each(this.bringForward,this),this.endTransaction()},bringSelectionToFront:function(t){this.beginTransaction(),t||(t=this.sm());for(var M=new Gk,k=this.getDatas(),f=0;f<k.size();f++){var L=k.get(f);t.contains(L)&&M.add(L)}M.each(this.bringToFront,this),this.endTransaction()},sendSelectionBackward:function(P){this.beginTransaction(),P||(P=this.sm());for(var V=new Gk,R=this.getDatas(),z=!1,d=0;d<R.size();d++){var g=R.get(d);P.contains(g)?z&&V.add(g):z=!0}V.each(this.sendBackward,this),this.endTransaction()},sendSelectionToBack:function(e){this.beginTransaction(),e||(e=this.sm());for(var n=new Gk,H=this.getDatas(),A=0;A<H.size();A++){var Y=H.get(H.size()-1-A);e.contains(Y)&&n.add(Y)}n.each(this.sendToBack,this),this.endTransaction()},addScheduleTask:function(Q){var y=this;y.removeScheduleTask(Q),Q.enabled==I&&(Q.enabled=!0),Q.interval==I&&(Q.interval=10),Q.lastTime=Date.now(),y._29Q.push(Q),y._30Q==I&&(y._30Q=V.requestAnimationFrame(y._scheduleCallback))},removeScheduleTask:function(i){var x=this,W=x._29Q,s=W.indexOf(i);s>=0&&W.splice(s,1),W.length||x._30Q==I||(V.cancelAnimationFrame(x._30Q),delete x._30Q)},getHistoryManager:function(){return this._historyManager},enableHistoryManager:function(P){this._historyManager||new B.HistoryManager(this),null!=P&&this._historyManager.setMaxHistoryCount(P),this._historyManager.setDisabled(!1)},disableHistoryManager:function(){this._historyManager&&this._historyManager.setDisabled(!0)},clearHistoryManager:function(){this._historyManager&&this._historyManager.clear()},undo:function(r){this._historyManager&&this._historyManager.undo(r)},redo:function(t){this._historyManager&&this._historyManager.redo(t)},beginTransaction:function(){this._historyManager&&this._historyManager.beginTransaction()},endTransaction:function(){this._historyManager&&this._historyManager.endTransaction()},addHistory:function(t){this._historyManager&&this._historyManager.addHistory(t)},onHistoryManagerChanged:function(){},isDeserializing:function(){return this._isDeserializing>0},setDeserializing:function(q){q?this._isDeserializing++:this._isDeserializing--},updateLayoutAttach:function(p){this.each(function(T){T instanceof nl&&T.getImage()===p&&T.updateLayoutAttaches()})},isCubicEnvmap:function(){return!1},setCubicEnvmap:function(){},setEnvmap:function(E){var n=this._envmap;this._envmap=E,n===E&&ar(n)&&ar(E)&&(n=[]),this.fp("envmap",n,E)}});var Gc=B.SelectionModel=function(n){var U=this;U._68O=He,U._map={},U._73O=new Gk,U._74I=new Tn,U._21I(n)};$e("SelectionModel",T,{ms_fire:1,ms_dm:1,ms:function(S,v,x){this.addSelectionChangeListener(S,v,x)},ums:function(l,z){this.removeSelectionChangeListener(l,z)},fd:function(){return this.getFirstData()},ld:function(){return this.getLastData()},sg:function(){return this._68O===lo},co:function(G){return this._map[G._id]!=I},ss:function(Q){this.setSelection(Q)},as:function(L){this.appendSelection(L)},rs:function(o){this.removeSelection(o)},cs:function(){this.clearSelection()},sa:function(){this.selectAll()},getSelectionMode:function(){return this._68O},setSelectionMode:function(C){var h=this;if(h._68O!==C&&(C===xj||C===lo||C===He)){h.cs();var y=h._68O;h._68O=C,h.fp("selectionMode",y,C)}},_21I:function(G){var Y=this,J=Y._dataModel;J!==G&&(J&&(Y.cs(),J.umm(Y.handleDataModelChange,Y)),Y._dataModel=G,G.mm(Y.handleDataModelChange,Y,!0),Y.fp(Bb,J,G))},dispose:function(){var H=this;H.cs(),H._dataModel.umm(H.handleDataModelChange,H)},handleDataModelChange:function(J){var L=this;if(J.kind===Ib){var A=J.data;L.co(A)&&(L._73O.remove(A),delete L._map[A._id],L._75I(Ib,new Gk(A)))}else J.kind===jr&&L.cs()},getFilterFunc:function(){return this._filterFunc},setFilterFunc:function(a){var I=this;if(I._filterFunc!==a){I.cs();var G=I._filterFunc;I._filterFunc=a,I.fp("filterFunc",G,I._filterFunc)}},_75I:function(k,e,G,s){G&&(this._73O.each(function(M){s[M._id]?G.remove(M):G.add(M)}),e=G.toList()),this._74I.fire({kind:k,datas:new Gk(e)})},addSelectionChangeListener:function(j,I,l){this._74I.add(j,I,l)},removeSelectionChangeListener:function(N,k){this._74I.remove(N,k)},_97O:function(q,S){for(var c,D=this,o=0,A=new Gk(q);o<A.size();o++)c=A.get(o),(D._filterFunc&&!D._filterFunc(c)||S&&D.co(c)||!S&&!D.co(c)||!D._dataModel.contains(c))&&(A.removeAt(o),o--);return A},appendSelection:function(m){var b=this;if(b._68O!==xj){var $,S,D=b._73O,x=b._97O(m,!0);x.isEmpty()||(b.sg()&&($=new Gk(D),S=b._map,D.clear(),b._map={},x=new Gk(x.get(x.size()-1))),x.each(function(K){D.add(K),b._map[K._id]=K}),b._75I("append",x,$,S))}},removeSelection:function(m){var M=this,x=M._97O(m),d=0,H=x.size();if(0!==H){for(;H>d;d++){var G=x.get(d);M._73O.remove(G),delete M._map[G._id]}M._75I(Ib,x)}},toSelection:function(f,R){return this._73O.toList(f,R)},getSelection:function(){return this._73O},each:function($,Y){this._73O.each($,Y)},setSelection:function(o){var T=this,z=T._73O;if(T._68O!==xj&&!(z.isEmpty()&&!o||1===z.size()&&T.ld()===o)){var V=new Gk(z),W=T._map;z.clear(),T._map={};var c=T._97O(o,!0);T.sg()&&c.size()>1&&(c=new Gk(c.get(c.size()-1))),c.each(function(M){z.add(M),T._map[M._id]=M}),T._75I("set",I,V,W)}},clearSelection:function(){var M=this,j=M._73O;if(j.size()>0){var r=j.toList();j.clear(),M._map={},M._75I(jr,r)}},selectAll:function(){var s=this;if(s._68O!==xj){var z,p,o=s._dataModel.toDatas();if(s._filterFunc)for(z=0;z<o.size();z++)p=o.get(z),s._filterFunc(p)||(o.removeAt(z),z--);var X=s._73O,Q=new Gk(X),$=s._map;X.clear(),s._map={},s.sg()&&o.size()>1&&(o=new Gk(o.get(o.size()-1)));var g=o.size();for(z=0;g>z;z++)p=o.get(z),X.add(p),s._map[p._id]=p;s._75I("all",I,Q,$)}},size:function(){return this._73O.size()},isEmpty:function(){return this._73O.isEmpty()},contains:function(r){return this._map[r._id]!=I},getLastData:function(){var b=this._73O;return b.size()>0?b.get(b.size()-1):I},getFirstData:function(){var y=this._73O;return y.size()>0?y.get(0):I},isSelectable:function(r){var $=this;return r&&$._68O!==xj?$._filterFunc?$._filterFunc(r):!0:!1},getTopSelection:function(){var y=this,T=new Gk;return y._73O.each(function(Y){for(var U=Y.getParent();U;){if(y.contains(U)){Y=I;break}U=U.parent}Y&&T.add(Y)}),T}});var Qj=function(){return Nj(0),function(h,n){var v;if(ke(n)){var j=h.getDataUI(n);j&&j._88I&&(v=j._88I.rect)}return v?v:n.getRect()}}();Wn(R,{edgeGroupAgentFunc:I,graphViewAutoScrollZone:16,graphViewZoomable:!0,graphViewResettable:!1,graphViewPannable:!0,graphViewRectSelectable:!0,graphViewScrollBarVisible:!0,graphViewRectSelectBorderColor:r.rectSelectBorder,graphViewRectSelectBackground:dc,graphViewEditPointSize:gj?17:7,graphViewEditPointBorderColor:r.editPointBorder,graphViewEditPointBackground:r.editPointBackground,setEdgeType:function(c,Z,H){op[c]=Z,Fj[c]=H},getEdgeType:function(j){return op[j]},getEdgeTypeMap:function(){return op},getNodeRect:Qj},!0);var ne={"layout.h":z,"layout.v":z,"2d.selectable":!0,"2d.visible":!0,"2d.movable":!0,"2d.editable":!0,"2d.move.mode":z,"2d.attachable":!1,"2d.hostable":!1,interactive:!1,preventDefaultWhenInteractive:!0,disableDoubleClick:!1,"image.stretch":"fill",icons:z,ingroup:!0,"body.color":z,"2d.gray":!1,fullscreen:z,"fullscreen.gap":2,"fullscreen.lock":!1,opacity:z,pixelPerfect:!0,keepAspectRatio:!1,"attach.points":null,"attach.style":null,"attach.close.threshold":16,"vector.layoutable":!1,"clip.direction":"top","clip.percentage":z,"clip.host":!1,"select.color":Iq,"select.width":1,"select.padding":2,"select.type":fk,"shadow.interactable":!0,shadow:!1,"shadow.blur":6,"shadow.offset.x":3,"shadow.offset.y":3,shadow2:!1,"shadow2.color":Iq,"shadow2.blur":6,"shadow2.offset.x":3,"shadow2.offset.y":3,"border.color":z,"border.width":2,"border.padding":2,"border.type":fk,label:z,"label.font":z,"label.color":wk,"label.background":z,"label.position":31,"label.position.fixed":!1,"label.offset.x":0,"label.offset.y":2,"label.rotation":z,"label.max":z,"label.opacity":z,"label.scale":1,"label.align":z,"label.selectable":!0,"label.decoration":z,label2:z,"label2.font":z,"label2.color":wk,"label2.background":z,"label2.position":34,"label2.position.fixed":!1,"label2.offset.x":0,"label2.offset.y":-2,"label2.rotation":z,"label2.max":z,"label2.opacity":z,"label2.scale":1,"label2.align":z,"label2.selectable":!0,"label2.decoration":z,note:z,"note.expanded":!0,"note.font":z,"note.color":Wm,"note.background":Iq,"note.position":8,"note.offset.x":-3,"note.offset.y":3,"note.max":z,"note.toggleable":!0,"note.border.width":1,"note.border.color":z,"note.opacity":z,"note.scale":1,"note.align":z,note2:z,"note2.expanded":!0,"note2.font":z,"note2.color":Wm,"note2.background":Iq,"note2.position":3,"note2.offset.x":3,"note2.offset.y":-3,"note2.max":z,"note2.toggleable":!0,"note2.border.width":1,"note2.border.color":z,"note2.opacity":z,"note2.scale":1,"note2.align":z,"group.type":z,"group.image":z,"group.image.stretch":"fill","group.repeat.image":z,"group.border.repeat.image":z,"group.padding":8,"group.padding.left":0,"group.padding.right":0,"group.padding.top":0,"group.padding.bottom":0,"group.position":17,"group.toggleable":!0,"group.title.font":z,"group.title.color":Wm,"group.title.background":r.groupTitleBackground,"group.title.align":xi,"group.title.orientation":Vh,"group.background":r.groupBackground,"group.depth":1,"group.border.width":1,"group.border.pattern":z,"group.border.color":Ch,"group.border.radius":z,"group.border.cap":Lk,"group.border.join":zo,"group.border.width.absolute":!1,"group.splitLine":!1,"group.gradient":I,"group.gradient.color":"#FFF",shape:z,"shape.background":Ch,"shape.repeat.image":z,"shape.border.repeat.image":z,"shape.border.width":0,"shape.border.width.absolute":!1,"shape.border.color":Ch,"shape.border.3d":!1,"shape.border.3d.color":z,"shape.border.3d.accuracy":z,"shape.border.cap":Lk,"shape.border.join":zo,"shape.border.pattern":z,"shape.gradient":I,"shape.gradient.color":"#FFF","shape.depth":0,"shape.dash":!1,"shape.dash.pattern":$k,"shape.dash.offset":0,"shape.dash.color":us,"shape.dash.width":z,"shape.dash.3d":!1,"shape.dash.3d.color":z,"shape.dash.3d.accuracy":z,"shape.polygon.side":6,"shape.arc.from":L,"shape.arc.to":f,"shape.arc.close":!0,"shape.arc.oval":!1,"shape.corner.radius":z,"shape.gradient.pack":z,"shape.border.gradient.pack":z,"shape.fill.rule":"nonzero","shape.fill.clip.direction":"top","shape.fill.clip.percentage":z,"shape.foreground":z,"shape.foreground.gradient":I,"shape.foreground.gradient.color":"#FFF","shape.foreground.clip.direction":"top","shape.foreground.clip.percentage":z,"shape.regular":!0,"autolayout.gap":z,"autolayout.hgap":z,"autolayout.vgap":z,"edge.type":z,"edge.points":z,"edge.segments":z,"edge.color":Ch,"edge.width":2,"edge.width.absolute":!1,"edge.repeat.image":null,"edge.offset":0,"edge.group":0,"edge.expanded":!0,"edge.gap":12,"edge.toggleable":!0,"edge.center":!1,"edge.3d":!1,"edge.3d.color":z,"edge.3d.accuracy":z,"edge.cap":Lk,"edge.join":zo,"edge.source.position":17,"edge.source.anchor.x":z,"edge.source.anchor.y":z,"edge.source.offset.x":0,"edge.source.offset.y":0,"edge.source.index":-1,"edge.source.percent":0,"edge.target.position":17,"edge.target.anchor.x":z,"edge.target.anchor.y":z,"edge.target.offset.x":0,"edge.target.offset.y":0,"edge.target.index":-1,"edge.target.percent":0,"edge.pattern":z,"edge.dash":!1,"edge.dash.pattern":$k,"edge.dash.offset":0,"edge.dash.color":us,"edge.dash.width":z,"edge.dash.3d":!1,"edge.dash.3d.color":z,"edge.dash.3d.accuracy":z,"edge.independent":!1,"attach.row.index":0,"attach.column.index":0,"attach.row.span":1,"attach.column.span":1,"attach.padding":0,"attach.padding.left":0,"attach.padding.right":0,"attach.padding.top":0,"attach.padding.bottom":0,"attach.index":-1,"attach.offset":0,"attach.offset.relative":!1,"attach.offset.opposite":!1,"attach.thickness":z,"attach.gap":0,"attach.gap.relative":!1,"grid.row.count":1,"grid.column.count":1,"grid.row.percents":z,"grid.column.percents":z,"grid.border":1,"grid.border.left":0,"grid.border.right":0,"grid.border.top":0,"grid.border.bottom":0,"grid.gap":1,"grid.background":r.gridBackground,"grid.depth":1,"grid.cell.depth":-1,"grid.cell.border.color":r.gridCellBorderColor,"grid.block":z,"grid.block.padding":3,"grid.block.width":1,"grid.block.color":r.gridBlockColor,text:"","text.align":"left","text.vAlign":"middle","text.color":wk,"text.gradient.pack":z,"text.font":sd,"text.shadow":!1,"text.shadow.color":Iq,"text.shadow.blur":6,"text.shadow.offset.x":3,"text.shadow.offset.y":3,"text.scale.x":1,"text.scale.y":1,"text.gradient":z,"text.gradient.color":"#FFF","text.decoration":z,"text.vertical":!1,"text.vertical.gap":1,"text.wrap":!1,"text.letter.gap":null,"text.border.color":Iq,"text.border.width":0,keepPosition:!0};ne[Ph]=z,Wn(c,ne,!0),Wn(Og,{_76I:function(z,q,L){this._39I&&this._39I.fire({data:z,oldIndex:q,newIndex:L})},addIndexChangeListener:function(A,G,s){var N=this;N._39I||(N._39I=new Tn),N._39I.add(A,G,s)},removeIndexChangeListener:function(U,$){this._39I.remove(U,$)},prepareRemove:function(a){kh(a)&&(a.setSource(I),a.setTarget(I)),a._70O&&a._70O.toList().each(this.remove,this),a._69O&&a._69O.toList().each(function(r){r.setHost(I)}),a._host&&a.setHost(I)},onAdded:function(f){this.isAutoAdjustIndex()&&this.adjustIndex(f)},onDataPropertyChanged:function(x,p){nf[p.property]&&this.isAutoAdjustIndex()&&this.adjustIndex(x)},isAdjustable:function(V){return Dg(V)||kh(V)},isAdjustedToBottom:function(g){return wp(g)?g.isExpanded()&&rq(g):!1},adjustIndex:function(Q){var X=this;this.isHierarchicalRendering()||(X.isAdjustedToBottom(Q)?(X.sendToBottom(Q),Q.eachChild(X.adjustIndex,X)):X.sendToTop(Q))},sendToTop:function(t){var w=this;if(w.contains(t)&&w.isAdjustable(t)){var f=w._datas;if(t!==f.get(w.size()-1)){var c=f.indexOf(t);f.removeAt(c),f.add(t),w._76I(t,c,w.size()-1)}if(kh(t)){var x=t._40I;x&&!w.isAdjustedToBottom(x)&&w.sendToTop(x),x=t._41I,x&&!w.isAdjustedToBottom(x)&&w.sendToTop(x)}t._69O&&t._69O.each(function(J){J.isRelatedTo(t)||Dg(t)&&J.isLoopedHostOn(t)||w.sendToTop(J)}),t.ISubGraph||(!wp(t)||t.isExpanded())&&t._adjustChildrenToTop&&t.eachChild(function(H){kh(H)||w.sendToTop(H)})}},sendToBottom:function(I,c){var P=this;if(I!==c&&P.contains(I)&&P.isAdjustable(I)&&(!c||P.contains(c))){var z=P._datas,f=z.remove(I),D=c?P._datas.indexOf(c):0;if(z.add(I,D),f!==D){P._76I(I,f,D);var K=I._parent;!K||K.ISubGraph||kh(K)||P.sendToBottom(I._parent,I)}}}}),Wn(ng,{ms_edit:function(D){D._46O=function(S){var J=this,e=J.gv.dm(),r=J._index,v=J._89I,D=J._node,F=J._shape,I=J._edge,z=J._77I;D&&v?(this.fi({kind:"endEditRect",event:S,data:D,direction:v}),e.endTransaction()):F&&r>=0?(J.fi({kind:"endEditPoint",event:S,data:F,index:r}),e.endTransaction()):I&&r>=0?(J.fi({kind:"endEditPoint",event:S,data:I,index:r}),e.endTransaction()):z&&(J.fi({kind:"endEditRotation",event:S,data:z}),e.endTransaction())},D._78I=function(G){var Q=this;Q.autoScroll(G);var $=Q.gv.lp(G),r=Q._index,b=Q._89I,x=Q._node,g=Q._shape,s=Q._edge,T=Q._77I;if(x&&b)Q._80O($),Q.fi({kind:"betweenEditRect",event:G,data:x,direction:b});else if(g&&r>=0)$.e=g.getPoints().get(r).e,g.setPoint(r,$),Q.fi({kind:"betweenEditPoint",event:G,data:g,index:r});else if(s&&r>=0){var q=s.s(Sd);$.e=q.get(r).e,q.set(r,$),s.fp(Sd,I,q),Q.fi({kind:"betweenEditPoint",event:G,data:s,index:r})}else if(T){var V=T.p(),F=T.getScale(),y=pk+Wd($.y-V.y,$.x-V.x);F.y<0&&(y+=L),i(y)<.04&&(y=0),T.setRotation(y),Q.fi({kind:"betweenEditRotation",event:G,data:T})}},D._80O=function(t){var m=this,q=m._node,E=m._rect,a=E.x,A=E.y,$=E.width,D=E.height,R=m._89I,M=m._anchor,N=m._matrix,t=N.tfi(t);"northwest"===R?E=Gj(t,{x:a+$,y:A+D}):R===lr?E=Gj({x:a,y:t.y},{x:a+$,y:A+D}):"northeast"===R?E=Gj({x:a,y:t.y},{x:t.x,y:A+D}):R===mj?E=Gj({x:t.x,y:A},{x:a+$,y:A+D}):R===Yr?E=Gj({x:a,y:A},{x:t.x,y:A+D}):"southwest"===R?E=Gj({x:t.x,y:A},{x:a+$,y:t.y}):"south"===R?E=Gj({x:a,y:A},{x:a+$,y:t.y}):"southeast"===R&&(E=Gj({x:a,y:A},t)),q.setPosition(N.tf(E.x+E.width*M.x,E.y+E.height*M.y)),q.setWidth(E.width),q.setHeight(E.height)},D._80I=function(b,p,j,c){var E=this,C=E.gv._zoom,l=(E.gv.getEditPointSize()+2)/C;return cj({x:p-l/2,y:j-l/2,width:l,height:l},b)?(E._89I!==c&&(E._89I=c),!0):!1},D._79I=function(E,f,X){var i=this,N=i.gv,m=f?N.getDataUI(f):I,a=m?m._55O:I;if(a){var x,y,g,R,J=N._zoom,o=(N.getEditPointSize()+2)/J,W=N.lp(E);if(Dg(f)){if(a._56O&&Dg(f)&&(y=a._98o,cj({x:y.x-o/2,y:y.y-o/2,width:o,height:o},W)))return i._77I=f,X&&i.fi({kind:"beginEditRotation",event:E,data:f}),i.setCursor("crosshair"),!0;if(a._43O&&f instanceof gi)for(g=f.getPoints(),x=g.size()-1;x>=0;x--)if(y=g.get(x),cj({x:y.x-o/2,y:y.y-o/2,width:o,height:o},W))return i._index=x,i._shape=f,X&&i.fi({kind:"beginEditPoint",event:E,data:f,index:x}),i.setCursor("crosshair"),!0;if(a._42O)for(var w=f.getEditControlPoints(),H=["northwest",-1,-1,mj,-1,0,"southwest",-1,1,"south",0,1,"southeast",1,1,Yr,1,0,"northeast",1,-1,lr,0,-1],x=0,R=w.length;R>x;x++){var L=H[3*x],z=w[x];if(i._80I(W,z.x,z.y,L)){i._node=f;var d=f.getWidth(),p=f.getHeight(),v=f.getAnchor();i._rect={x:-d*v.x,y:-p*v.y,width:d,height:p},i._anchor=v,i._matrix=f.getMatrix();var U=f.getRotation(),j=F(U),e=k(U),t=H[3*x+1]*oh(f.getScale().x),O=H[3*x+2]*oh(f.getScale().y),$=Math.atan2(-e*t-j*O,j*t-e*O),Q=(Math.round($/(Math.PI/4))+8)%8,c=[ub,"nesw-resize",pj,"nwse-resize",ub,"nesw-resize",pj,"nwse-resize"][Q];return i.setCursor(c),X&&i.fi({kind:"beginEditRect",event:E,data:f,direction:i._89I}),!0}}}if(a._43O&&kh(f)&&f.s(bq)===vr&&(g=f.s(Sd)))for(x=g.size()-1;x>=0;x--)if(y=g.get(x),cj({x:y.x-o/2,y:y.y-o/2,width:o,height:o},W))return i._index=x,i._edge=f,X&&i.fi({kind:"beginEditPoint",event:E,data:f,index:x}),i.setCursor("crosshair"),!0}return!1}},ms_gv:function(d){d._currentSubGraph=I,d._initView=function(){this._fpsInfo={time:0,fps:0,frames:0}},d.upSubGraph=function(){this.setCurrentSubGraph(Pj(this._currentSubGraph))
},d.isVisible=function(d){var g=this;if(Pj(d)!==g._currentSubGraph)return!1;if(kh(d)){var L=d._40I,O=d._41I;if(!L||!O)return!1;if(!(d.s("edge.independent")||g.isVisible(L)&&g.isVisible(O)))return!1;if(d.isEdgeGroupHidden())return!1}else for(var j=d._parent;j&&!j.ISubGraph;){if(wp(j)&&(!j.isExpanded()||!g.isVisible(j)))return!1;j=j._parent}if(d._parent instanceof Xl&&!g.isVisible(d._parent))return!1;if(d._refGraph instanceof Ti&&!g.isVisible(d._refGraph))return!1;if(g instanceof Fs){if(!d.s("3d.visible"))return!1}else{var X=g.getLayersInfo();if(X){var o=X[d._layer];if(o&&o.visible===!1)return!1}if(!d.s("2d.visible"))return!1}return g._visibleFunc?g._visibleFunc(d):!0},d.handleSelectionChange=function(c){var S=this;c.datas.each(function(q){S.invalidateData(q);var L=q._parent;wp(L)&&Dg(q)&&q.s(Uo)&&(S.invalidateData(L),L._49I&&L._49I.each(function(n){S.invalidateData(n)}))}),S.onSelectionChanged(c)},d.onSelectionChanged=function(O){var y=this,u=y.sm();if(1===u.size()&&("set"===O.kind||"append"===O.kind)){var e=u.ld();y.isAutoMakeVisible()&&y.makeVisible(e),y.adjustIndex&&y._dataModel.isAutoAdjustIndex()&&y.adjustIndex(e)}},d.makeVisible=function(w){if(w){var P=this,y=P.getDataUI?P.getDataUI(w):P.getData3dUI(w);if(y){var A=w,F=Pj(w);for(F!==P._currentSubGraph&&P.setCurrentSubGraph(F);(A=A._parent)&&A!==F;)wp(A)&&A.setExpanded(!0);P._23I=w,P.iv()}}},d.getLabel=function(C){var M=C.getStyle(sm);return M===z?C.getName():M},d.getLabelBackground=function(I){return I.getStyle("label.background")},d.getLabelColor=function(G){return G.getStyle("label.color")},d.getLabel2=function(F){return F.getStyle("label2")},d.getLabel2Background=function(E){return E.getStyle("label2.background")},d.getLabel2Color=function(S){return S.getStyle("label2.color")},d.getNote=function(s){return s.getStyle(Si)},d.getNoteBackground=function(E){return E.getStyle("note.background")},d.getNote2=function(K){return K.getStyle(bl)},d.getNote2Background=function(V){return V.getStyle("note2.background")},d.handleClick=function(Y,G,q){var $=this;G?($.fi({kind:"clickData",event:Y,data:G,part:q}),$.onDataClicked(G,Y)):($.fi({kind:"clickBackground",event:Y}),$.onBackgroundClicked(Y))},d.handleDoubleClick=function(P,T,X){var f=this;fb(P)&&(T?(f.fi({kind:"doubleClickData",event:P,data:T,part:X}),f.onDataDoubleClicked(T,P,X),f.checkDoubleClickOnNote(P,T,X)||f.checkDoubleClickOnRotation&&f.checkDoubleClickOnRotation(P,T,X)||(kh(T)?f.onEdgeDoubleClicked(T,P,X):T.ISubGraph?f.onSubGraphDoubleClicked(T,P,X):wp(T)?f.onGroupDoubleClicked(T,P,X):T.IDoorWindow?f.onDoorWindowDoubleClicked(T,P,X):T.ICSGBox&&f.onCSGBoxDoubleClicked(T,P,X))):(f.fi({kind:"doubleClickBackground",event:P}),f.onBackgroundDoubleClicked(P)))},d.onSubGraphDoubleClicked=function(g){this.setCurrentSubGraph(g)},d.onEdgeDoubleClicked=function(L,G){this.isEditable(L)||(L.ISubGraph&&!Bl(G)?this.setCurrentSubGraph(L):L.s("edge.toggleable")&&L.toggle())},d._39Q=function(G){return this.isInteractive(G)?this.preventDefaultWhenInteractive(G):!1},d.preventDefaultWhenInteractive=function(C){return C.s("preventDefaultWhenInteractive")},d.onGroupDoubleClicked=function(i){i.s("group.toggleable")&&i.toggle()},d.onDoorWindowDoubleClicked=function(N){N.s("dw.toggleable")&&N.toggle(!0)},d.onCSGBoxDoubleClicked=function(w,P){var B=this;if(B instanceof Fs){var W=B.intersectObject(P,w);W&&w.s(W.part+".toggleable")&&w.toggleFace(W.part,!0)}},d.onBackgroundClicked=function(){},d.onBackgroundDoubleClicked=function(){this.upSubGraph()},d.onDataClicked=function(){},d.onDataDoubleClicked=function(){},d.onAutoLayoutEnded=function(){},d.onMoveEnded=function(){},d.onPanEnded=function(){},d.onPinchEnded=function(){},d.onRectSelectEnded=function(){},d.onZoomEnded=function(){},d.serialize=function(Z){return this.dm().serialize(Z)},d.toJSON=function(){return this.dm().toJSON()},d.deserialize=function(H,g){var r=this;g=g instanceof If?{rootParent:g}:ki(g)?{setId:g}:Hn(g)?{finishFunc:g}:g||{},g.view=r;var b=r.dm();return g.reset&&(b.setAttrObject({}),b.setLayers(z),b.setName(z),b.setAutoAdjustIndex(!0),b.setHierarchicalRendering(!1),b.setBackground(z),b.setInit(z),b.setPostProcessingData(z),b.setEnvmap(z),b.setEnvmapType(z),r.disableToolTip(),r instanceof B.graph.GraphView?(r.setZoomable(R.graphViewZoomable),r.setPannable(R.graphViewPannable),r.setRectSelectable(R.graphViewRectSelectable)):r instanceof B.graph3d.Graph3dView&&(r.shadowMap.resetProperties(),r.setDashDisabled(R.graph3dViewDashDisabled),r.setUvClipEnabled(R.graph3dViewUvClipEnabled),r.getHighlightHelper().resetProperties(),r.resetHeadlightProperties(),r.resetFogProperties(),r.setBatchInfoMap({}),r.setBatchColorDisabled(R.graph3dViewBatchColorDisabled),r.setBatchInstancedDisabled(R.graph3dViewBatchInstancedDisabled),r.setBatchBlendDisabled(R.graph3dViewBatchBlendDisabled),r.setBatchBrightnessDisabled(R.graph3dViewBatchBrightnessDisabled),r.setFlowBlendMode(R.graph3dViewFlowBlendMode),r.setMoveStep(R.graph3dViewMoveStep),r.setRotateStep(R.graph3dViewRotateStep),r.setSortable(R.graph3dViewSortable),r.setSortFunc(z),r.setSkybox(z),Bm(r))),g.__innerHandler__=function(j){if(ki(b.a("toolTipEnable"))&&(b.a("toolTipEnable")?r.enableToolTip():r.disableToolTip()),ar(b.a("fontFaces"))&&b.a("fontFaces").forEach(function(K){R.addFontFace(K.name,K.url)}),r instanceof B.graph.GraphView&&(ki(b.a("zoomable"))&&r.setZoomable&&r.setZoomable(b.a("zoomable")),ki(b.a("pannable"))&&r.setPannable&&r.setPannable(b.a("pannable")),ki(b.a("rectSelectable"))&&r.setRectSelectable&&r.setRectSelectable(b.a("rectSelectable")),b.a("fitContent")===!0&&r.fitContent&&r.fitContent(!0,0)),r instanceof B.graph3d.Graph3dView){var x=j.scene;x&&x.shadow!=I&&r.shadowMap.setShadow(x.shadow,x.shadowParams);var q=b.a("sceneContext");q?(q.eye&&r.setEye(q.eye),q.center&&r.setCenter(q.center),gs(q.far)&&r.setFar(q.far),gs(q.near)&&r.setNear(q.near)):(gs(b.a("sceneNear"))&&r.setNear(b.a("sceneNear")),gs(b.a("sceneFar"))&&r.setFar(b.a("sceneFar")),x&&(x.eye&&r.setEye(x.eye),x.center&&r.setCenter(x.center))),gs(b.a("sceneFovy"))&&r.setFovy(b.a("sceneFovy")),ki(b.a("sceneOrtho"))&&r.setOrtho(b.a("sceneOrtho")),gs(b.a("sceneOrthoWidth"))&&r.setOrthoWidth(b.a("sceneOrthoWidth")),ki(b.a("sceneShadowEnabled"))&&(b.a("sceneShadowEnabled")?r.enableShadow():r.disableShadow()),gs(b.a("sceneShadowDegreeX"))&&r.setShadowDegreeX(b.a("sceneShadowDegreeX")),gs(b.a("sceneShadowDegreeZ"))&&r.setShadowDegreeZ(b.a("sceneShadowDegreeZ")),gs(b.a("sceneShadowIntensity"))&&r.setShadowIntensity(b.a("sceneShadowIntensity")),b.a("sceneShadowQuality")!=I&&r.setShadowQuality(b.a("sceneShadowQuality")),b.a("sceneShadowType")&&r.setShadowType(b.a("sceneShadowType")),gs(b.a("sceneShadowRadius"))&&r.setShadowRadius(b.a("sceneShadowRadius")),gs(b.a("sceneShadowBias"))&&r.setShadowBias(b.a("sceneShadowBias")),ki(b.a("sceneDashEnable"))&&r.setDashDisabled(!b.a("sceneDashEnable")),ki(b.a("sceneUvClipEnabled"))&&r.setUvClipEnabled(b.a("sceneUvClipEnabled")),Fc(b.a("sceneHighlightMode"))&&r.setHighlightMode(b.a("sceneHighlightMode")),gs(b.a("sceneHighlightWidth"))&&r.setHighlightWidth(b.a("sceneHighlightWidth")),b.a("sceneHighlightColor")&&r.setHighlightColor(b.a("sceneHighlightColor")),b.a("sceneHighlightType")&&r.setHighlightType(b.a("sceneHighlightType")),b.a("sceneHighlightGlow")&&r.setHighlightGlow(b.a("sceneHighlightGlow")),b.a("sceneHighlightStrength")&&r.setHighlightStrength(b.a("sceneHighlightStrength")),ki(b.a("sceneHeadlightEnable"))&&r.setHeadlightDisabled(!b.a("sceneHeadlightEnable")),b.a("sceneHeadlightDirection")!=I&&r.setHeadlightDirection(b.a("sceneHeadlightDirection")),gs(b.a("sceneHeadlightRange"))&&r.setHeadlightRange(b.a("sceneHeadlightRange")),b.a("sceneHeadlightColor")&&r.setHeadlightColor(b.a("sceneHeadlightColor")),gs(b.a("sceneHeadlightIntensity"))&&r.setHeadlightIntensity(b.a("sceneHeadlightIntensity")),gs(b.a("sceneHeadlightAmbientIntensity"))&&r.setHeadlightAmbientIntensity(b.a("sceneHeadlightAmbientIntensity")),gs(b.a("sceneHeadlightGroup"))&&r.setHeadlightGroup(b.a("sceneHeadlightGroup")),ki(b.a("sceneFogEnable"))&&r.setFogDisabled(!b.a("sceneFogEnable")),b.a("sceneFogMode")&&r.setFogMode(b.a("sceneFogMode")),gs(b.a("sceneFogDensity"))&&r.setFogDensity(b.a("sceneFogDensity")),b.a("sceneFogColor")&&r.setFogColor(b.a("sceneFogColor")),gs(b.a("sceneFogNear"))&&r.setFogNear(b.a("sceneFogNear")),gs(b.a("sceneFogFar"))&&r.setFogFar(b.a("sceneFogFar")),ki(b.a("sceneBatchBrightnessDisabled"))&&r.setBatchBrightnessDisabled(b.a("sceneBatchBrightnessDisabled")),b.a("sceneFlowBlendMode")!==z&&r.setFlowBlendMode(b.a("sceneFlowBlendMode")),ki(b.a("sceneBatchBlendDisabled"))&&r.setBatchBlendDisabled(b.a("sceneBatchBlendDisabled")),ki(b.a("sceneBatchColorDisabled"))&&r.setBatchColorDisabled(b.a("sceneBatchColorDisabled")),ki(b.a("sceneBatchInstancedDisabled"))&&r.setBatchInstancedDisabled(b.a("sceneBatchInstancedDisabled")),b.a("sceneBatchInfoMap")&&r.setBatchInfoMap(b.a("sceneBatchInfoMap")),b.a("sceneRenderLayerInfoMap")&&r.setRenderLayerInfoMap(b.a("sceneRenderLayerInfoMap")),gs(b.a("sceneMoveStep"))&&r.setMoveStep(b.a("sceneMoveStep")),gs(b.a("sceneRotateStep"))&&r.setRotateStep(b.a("sceneRotateStep")),ki(b.a("sceneSortable"))&&r.setSortable(b.a("sceneSortable")),Hn(b.a("sceneSortFunc"))&&r.setSortFunc(b.a("sceneSortFunc"));var t=b.a("sceneSkyboxType")||"sphere";if(t!=I){var w={},X=!1;if("sphere"===t){w.shape3d=t;var S=b.a("sceneSkyboxImage");S&&(w["shape3d.image"]=S,X=!0)}else"cube"===t?(w.shape3d=z,["front","back","left","right","top","bottom"].forEach(function(Z){var c=Z+".image",D=Z.charAt(0).toUpperCase()+Z.slice(1),$=b.a("sceneSkybox"+D+"Image");$&&(w[c]=$,X=!0)})):"color"===t&&(X=!0);if(X){var C=new nl,s=b.a("sceneSkyboxDiameter");if(gs(s)?C.s3(s,s,s):C.s3(20,20,20),w["body.color"]=b.a("sceneSkyboxBodyColor"),w.envmap=b.a("sceneSkyboxEnvmap"),w["envmap.probe"]=b.a("sceneSkyboxEnvmapProbe"),w.roughness=b.a("sceneSkyboxRoughness"),w["shape3d.light"]=w["all.light"]=b.a("sceneSkyboxLight"),w["light.mask"]=b.a("sceneSkyboxLightMask"),w["headlight.ambientIntensity"]=b.a("sceneSkyboxHeadLightAmbientIntensity"),w["texture.wrap"]="clampToEdge",w["3d.clipbox.mask"]=Wg,w["effect.flow.mask"]=Wg,"color"===t){w.shape3d="sphere";var g=2,F=1024,S=C.s("shape3d.image"),p=S&&B.Default.getImage(S);p&&"CANVAS"===p.tagName||(p=e.createElement("canvas"),S=B.Math.generateUUID(),B.Default.setImage(S,p)),S&&r.getTextureMap()&&r.deleteTexture(S),B.Default.setCanvas(p,g,F,1);var f=p.getContext("2d");f.clearRect(0,0,g,F),f.beginPath(),f.rect(0,0,g,F),zr(f,b.a("sceneSkyboxColor"),function(H){return H},!1,{x:0,y:0,width:g,height:F}),f.fill(),f.restore(),w["shape3d.image"]=S}C.s(w),["X","Y","Z"].forEach(function(U){var e=b.a("sceneSkyboxRotation"+U);gs(e)&&C["setRotation"+U](e)}),r.setSkybox(C)}}}},b.deserialize(H,g.rootParent,g)},d.isDebugTipShowing=function(){return!!this._debugDiv},d.showDebugTip=function(){var n=this,D=n._debugDiv;if(!D){D=n._debugDiv=e.createElement("div"),D.style.position="absolute",D.style.overflow="hidden",D.style.font=R.debugTipLabelFont,D.style.padding="6px",D.style.backgroundColor=R.debugTipBackground,D.style.color=R.debugTipLabelColor;var $=n.getView();n._79O?$.insertBefore(D,n._79O):$.appendChild(D);var T=function(){n.redraw();var X=n._canvas,O="FPS: "+n._fpsInfo.fps+"<br/>"+"Datas: "+n.dm().getDatas().length+(X?"<br/>Size: "+X.width+" * "+X.height:""),I=n.dm()._historyManager;I&&(O+="<br/>Undoes: "+I.getHistories().length+" index: "+I.getHistoryIndex());var i=n.getDebugTip();i&&(O+="<hr>"+i),D.innerHTML=O,n._isDebugging&&requestAnimationFrame(T)};requestAnimationFrame(T),n._isDebugging=!0}},d.hideDebugTip=function(){var r=this,G=r._debugDiv;G&&(delete r._debugDiv,r.getView().removeChild(G),r._isDebugging=!1)},d.updateDOMAppendMatrix=function(){var W=this.getView();W&&(W.updateAppendMatrix=!0)},d.countFrame=function(){if(this._isDebugging){var q=Date.now(),d=this._fpsInfo;q-d.time>1e3?(d.fps=Math.round(1e5*(d.frames+1)/(q-d.time))/100,d.time=q,d.frames=0):d.frames++}}},ms_icons:function(B){B.getRotation=function(z){return z==I?0:z},B._15O=function(){var W=this,Q=W.s(Vp);if(Q){var K=W,O=W.data||W._data,H=O.getRotation&&O.getRotation(),Y=W._38o={icons:Q,rects:{}};for(var h in Q){var g=Q[h],T=tp(g.shape3d,O,K);if(!(tp(g.visible,O,K)===!1||tp(g.for3d,O,K)&&!W.I3d||T&&!W.I3d)){var X=T?[T]:tp(g.names,O,K),x=X?X.length:0,D=tp(g.position,O,K)||3,i=tp(g.offsetX,O,K)||0,s=tp(g.offsetY,O,K)||0,r=tp(g.direction,O,K)||Yr,V=tp(g.gap,O,K),R=V!=I?V:1,p=tp(g.rotation,O,K),d=tp(g.keepOrien,O,K),q=tp(g.rotationFixed,O,K)?p:W.getRotation(p,d,D),F=I,B=Y.rects[h]=new Array(x);gs(H)&&(gs(q)?q+=H:q=H),B.rotation=q;for(var $=0;x>$;$++){var E,P,J,Z,j=X[$];if(T)J=0,Z=0;else{var z=Td(j);J=tp(g.width,O,K),Z=tp(g.height,O,K),J==I&&(J=nr(z,O)),Z==I&&(Z=kd(z,O))}if(F?r===Yr?i+=J/2:r===mj?i-=J/2:r===lr?s-=Z/2:s+=Z/2:F={width:J,height:Z},W.I3d){var S=-J/2,C=-Z/2;P={width:J,height:Z,mat:W._16O(tp(g.autorotate,O,K),D,F,tp(g.face,O,K)||Uj,tp(g.t3,O,K),tp(g.r3,O,K),tp(g.rotationMode,O,K),i,s),vs:new Tb([S,-C,0,S,-C-Z,0,S+J,-C-Z,0,S+J,-C,0])}}else E=W.getPosition(D,i,s,F,tp(g.positionFixed,O,K)),P={x:E.x-J/2,y:E.y-Z/2,width:J,height:Z},W._68o(P,q);B[$]=P,r===Yr?i+=J/2+R:r===mj?i-=J/2+R:r===lr?s-=Z/2+R:s+=Z/2+R}}}}}}});var $q={1:1,2:1,6:1,9:1,10:1,14:1,15:1,16:1,21:1,22:1,26:1,29:1,30:1,34:1,36:1,38:1,40:1,42:1,45:1,50:1,52:1,54:1},Np={3:1,7:1,11:1,17:1,23:1,27:1,31:1,44:1,46:1,47:1,49:1},Jp={translateX:1,translateY:1,zoom:1,scrollBarVisible:1},nf={sourceAgent:1,targetAgent:1,expanded:1,parent:1,host:1},Nf={position:1,width:1,height:1,expanded:1,rotation:1,anchor:1,scale:1,"s:edge.points":1},qr={"edge.type":1,"edge.group":1},Un={rotation:1,rotationX:1,rotationZ:1,rotation3d:1},Kb={rotation:1,position:1,width:1,height:1,anchor:1,scale:1,host:1,"s:vector.layoutable":1},lq={position:1,width:1,height:1,anchor:1,scale:1,"s:grid.row.count":1,"s:grid.column.count":1,"s:grid.row.percents":1,"s:grid.column.percents":1,"s:grid.border":1,"s:grid.border.left":1,"s:grid.border.right":1,"s:grid.border.top":1,"s:grid.border.bottom":1,"s:grid.gap":1},aq={"attach.row.index":1,"attach.column.index":1,"attach.row.span":1,"attach.column.span":1,"attach.padding":1,"attach.padding.left":1,"attach.padding.right":1,"attach.padding.top":1,"attach.padding.bottom":1,"attach.index":1,"attach.offset":1,"attach.offset.relative":1,"attach.offset.opposite":1,"attach.gap":1,"attach.gap.relative":1,"attach.thickness":1},uq={shape:1,thickness:1,position:1,anchor:1,scale:1},Pj=function(L){if(!L)return I;if(kh(L)){var x=L._40I,$=L._41I;if(!x||!$)return I;var v=Pj(x),U=Pj($);return v===U?v:I}for(var o=L._parent;kh(o)&&!o.ISubGraph;)o=o._parent;return o?o.ISubGraph?o:Pj(o):I},vh=function(V,U,f,x){var N=U.getStyle(f)*x;N&&xs(V,N),N=U.getStyle(f+".left")*x,N&&(V.x-=N,V.width+=N),N=U.getStyle(f+".right")*x,N&&(V.width+=N),N=U.getStyle(f+".top")*x,N&&(V.y-=N,V.height+=N),N=U.getStyle(f+".bottom")*x,N&&(V.height+=N),V.width<0&&(V.width=-V.width,V.x-=V.width),V.height<0&&(V.height=-V.height,V.y-=V.height)},rq=function(r){for(var B,l=0,j=r.size();j>l;l++)if(B=r.getChildAt(l),Dg(B)&&rq(B))return!0;return r.hasAgentEdges()},Mh=function(n){if(!n)return I;for(var $=n._parent;wp($);){if(!wp($._parent))return $.isExpanded()?n:$;$.isExpanded()||(n=$),$=$._parent}return n},Lq=function(i,z){if(!i||!z)return I;var d,x,Z,e=Pj(i),t=Pj(z);if(e!==t){for(;t&&e!==t;)t=Pj(t);if(e===t)return i;d=new Gk,d.add(i,0);for(var J=i._parent;Dg(J)&&!z.isDescendantOf(J);)d.add(J,0),J=J._parent;for(Z=d.size(),x=0;Z>x;x++){var B=d.get(x);if(wp(B)&&!B.isExpanded())return B;if(B.ISubGraph)return B}return i}return i},Ij=function(n){if(n.isLooped())return n._source;var v=Mh(n._source),b=Mh(n._target);return v===b?n._source:Lq(v,b)},Mi=function(T){if(T.isLooped())return T._target;var i=Mh(T._source),z=Mh(T._target);return i===z?T._target:Lq(z,i)},Hi=function(t,G,X){"target"!==X&&(X="source");var k="target"===X?G.getTargetAgent():G.getSourceAgent(),R="edge."+X+".";if(kh(k)){var n=t.getDataUI(k);n._79o();var w=G.s(R+"index");if(w>=0){var d=Gq(n);return d[Math.max(0,Math.min(w,d.length-1))]}var z=G.s(R+"percent")||0;z=Math.max(0,Math.min(z,1));var Y=yn(n);return zs(Y,100*z)}return Hj(t,k,G.s(R+"position"),G.s(R+"offset.x"),G.s(R+"offset.y"),G.s(R+"anchor.x"),G.s(R+"anchor.y"))},Hj=function(o,i,C,t,x,y,O){if(!i)return I;var l,Q=i.getRotation?i.getRotation():0;if(y!==z||O!==z){y=y===z?.5:y,O=O===z?.5:O;var u=i.getScale();if(Q&&!ke(i,o)||u.x<0||u.y<0){var M=i.getPosition(),v=i.getWidth(),K=i.getHeight(),f=i.getAnchor(),B=new Mc(Q,M.x,M.y,u.x,u.y);C=B.tf((y-f.x)*v,(O-f.y)*K)}else l=Qj(o,i),C={x:l.x+y*l.width,y:l.y+O*l.height}}else C=Xc(C,Qj(o,i));if(Q){var s=F(Q),W=k(Q),$=t*s-x*W;x=t*W+x*s,t=$}return C.x+=t,C.y+=x,C},zj=function(U,J){if(!U||!J)return I;var B,T,y,P,t,e;if(U===J){if(P=U.getLoopedEdges(),!P)return I;P=new Gk(P)}else{if(t=U.getAgentEdges(),e=J.getAgentEdges(),!t||!e)return I;for(T=t.size(),B=0;T>B;B++)y=t.get(B),e.contains(y)&&(P||(P=new Gk),P.add(y))}if(P)for(B=0;B<P.size();B++)y=P.get(B),y.getStyle(bq)===vr&&(y._22I(I),P.removeAt(B),B--);return P},Gf=function(x,A){var P=zj(x,A);if(P&&!P.isEmpty()){if(1===P.size())return P.get(0)._22I(I),void 0;var Y=new Gk,l=new Gk;P.each(function(A){var f=A.s("edge.group");Y.contains(f)||Y.add(f)}),Y.sort(),Y.each(function(q){l.add(new B.EdgeGroup(P.toList(function(Y){return q===Y.s("edge.group")}),l))}),l.each(function(h){h.each(function($){$._22I(h)})})}},tn=function(i,_,M){var Y=i._canvas;i._zoom;var o=Lf(_,Y),X=Lf(M,Y);return{x:o.x-X.x,y:o.y-X.y}},Gd=function(s,W){if(W){var d=W.rect,y=W.color,j=W.rotation,t=W.labelWidth,v=W.background,D=W.opacity,M=W.scale,c=M!=I&&1!==M;if(D!=I){var T=s.globalAlpha;s.globalAlpha*=D}if(j||c){s.save();var R=d.x+d.width/2,S=d.y+d.height/2;or(s,R,S),j&&Aj(s,j),c&&s.scale(M,M),or(s,-R,-S)}if(v&&gk(s,d.x,d.y,d.width,d.height,v),t){var V=d.width,a=s.createLinearGradient(d.x,d.y,d.x+V,d.y);a.addColorStop(0,y),a.addColorStop(.9,y),a.addColorStop(1,Fb),y=a,d.width=t}Pm(s,W.ss,d,W.font,y,W.align,W.decoration),t&&(d.width=V),(j||c)&&s.restore(),D!=I&&(s.globalAlpha=T)}},tg=function(W,O){if(O){var k=O.rect,i=k.x,q=k.y,o=k.width,D=k.height,J=O.background,v=O.backgroundImage,c=O.borderWidth,a=O.borderColor,T=O.labelWidth,K=O.opacity,$=O.scale,t=$!=I&&1!==$;if(K!=I){var B=W.globalAlpha;W.globalAlpha*=K}if(t){W.save();var U=k.x+k.width/2,j=k.y+k.height/2;or(W,U,j),W.scale($,$),or(W,-U,-j)}if(O.expanded){var u=X(8,o/4),p=q+D-8;if(W.fillStyle=J,W.beginPath(),W.moveTo(i,q),W.lineTo(i,p),W.lineTo(i+o/2,p),W.lineTo(i+o/2,q+D),W.lineTo(i+o/2+u,p),W.lineTo(i+o,p),W.lineTo(i+o,q),W.closePath(),W.fill(),c&&(W.lineWidth=c,W.lineJoin="round",W.lineCap="round",a?(W.strokeStyle=a,W.stroke()):(W.strokeStyle=je(J),W.beginPath(),W.moveTo(i+o,q),W.lineTo(i+o,p),W.lineTo(i+o/2+u,p),W.lineTo(i+o/2,q+D),W.stroke(),W.strokeStyle=Fk(J),W.beginPath(),W.moveTo(i+o,q),W.lineTo(i,q),W.lineTo(i,p),W.lineTo(i+o/2,p),W.lineTo(i+o/2,q+D),W.stroke())),v)_n(W,Td(v),ws,k.x,k.y,k.width,k.height-8,O.data,O.view);else{if(k.height-=8,J=O.color,T){var V=o,z=W.createLinearGradient(i,q,i+V,q);z.addColorStop(0,J),z.addColorStop(.9,J),z.addColorStop(1,Fb),J=z,k.width=T}Pm(W,O.ss,k,O.font,J,O.align),T&&(k.width=V),k.height+=8}}else if(O.icon)cq(W,Td(O.icon),i,q,o,D,O.data,O.view);else{var w=o/2;c&&(W.lineWidth=c,W.lineJoin="round",W.lineCap="round",W.strokeStyle=a?a:je(J),W.beginPath(),W.arc(i+w,q+w,w,pk,1.6*L,!0),W.moveTo(i+w,q+D),W.lineTo(i+o-w/5,q+w),W.stroke(),W.strokeStyle=a?a:Fk(J),W.beginPath(),W.arc(i+w,q+w,w,1.6*L,pk,!0),W.moveTo(i+w,q+D),W.lineTo(i+w/5,q+w),W.stroke()),W.fillStyle=J,W.beginPath(),W.arc(i+w,q+w,w,0,f,!0),W.moveTo(i+w,q+D),W.lineTo(i+o-w/5,q+w),W.lineTo(i+w/5,q+w),W.closePath(),W.fill(),W.fillStyle=O.color,W.beginPath(),W.arc(i+w,q+w,w/3,0,f,!0),W.fill()}t&&W.restore(),K!=I&&(W.globalAlpha=B)}},om=function(L,W){return W>2*L?L:W/2},cd=function(_,x,P,c){if(!_||!x)return 0;var l=Wd(x.y-_.y,x.x-_.x);return P||(l=x.x<_.x?l+L:l),l+c},bk=function(J,s,W,G,o,M,u){u&&(J.x>s.x||J.x===s.x&&J.y>s.y)&&(W=Zb[W],o=-o);var d=Xc(W,{x:0,y:0,width:Jc(J,s),height:0},M);return d.x+=G,d.y+=o,d=new Mc(Wd(s.y-J.y,s.x-J.x)).tf(d),d.x+=J.x,d.y+=J.y,d},Kq=function(P,O,K,c,G){if(P._19Q=!0,!K.getEdgeGroup())return c?K.s("edge.gap"):0;if(kh(K.getSourceAgent())||kh(K.getTargetAgent()))return 0;var S,_=0,f=0,r=0;if(K.getEdgeGroup().getSiblings().each(function($){$.each(function(x){if(O.isVisible(x)&&x.s(bq)==G){var y=x.s("edge.gap");S?(f+=r/2+y/2,r=y):(S=x,r=y),x===K&&(_=f)}})}),c)return f-_+r;var L=_-f/2;return S&&K._40I!==S._40I&&(P._19Q=!1),L},Gh=function(c){var g=c._getValidSelection();if(1===g.length){var l=g[0],q=l instanceof B.Edge;if(l instanceof B.Shape||q){if(q){var r=l.s("edge.type");if(r&&"points"!==r)return}var j=c.gv;if((!j.isPointEditable||j.isPointEditable(l))&&j.isEditable(l))return l}}},Hl=function(){var x=function(O){var p=[];return O.forEach(function(k){p.push({x:k.x,y:k.y}),p.push({x:k.x+k.width,y:k.y+k.height}),p.push({x:k.x+k.width,y:k.y}),p.push({x:k.x,y:k.y+k.height})}),p};return function(q,F,K){if("oval"===q){var j=0,$=K.height/K.width,M=$*$,v=K.x+K.width/2,c=K.y+K.height/2,N=x(F);N.forEach(function(w){var L=w.x-v,F=w.y-c,o=L*L+F*F/M;o>j&&(j=o)}),j=a(j);var t=$*j;return{x:v-j,y:c-t,width:2*j,height:2*t}}if("circle"===q){var r=0,v=K.x+K.width/2,c=K.y+K.height/2,N=x(F);return N.forEach(function(I){var R=I.x-v,n=I.y-c,J=R*R+n*n;J>r&&(r=J)}),r=a(r),{x:v-r,y:c-r,width:2*r,height:2*r}}return"roundRect"===q?(xs(K,X(K.width,K.height)/16),K):K}}(),Ap=B.graph={},pg=function(c,H,w){Lp(G+".graph."+c,H,w)};B.layout={};var Ig={},bc=function(P,o,Q,t,T,m,e,J){var f=e._zoom;if(!f)return o;if(f!==e._cacheZoom&&(e._cacheZoom=f,e._cacheImage={}),f*=Gn,t=Math.ceil(t),T=Math.ceil(T),t*f>2048||T*f>2048)return o;var K=[o.uuid,t,T,Q].join("_");if(m instanceof B.Data){var V=o.dataBindings;if(V)for(var $=V.length-1;$>=0;$--){var g=m.a(V[$].attr);Pd(g)||ar(g)||(K+="_"+g)}}if(o.cacheRule){var _;_=Hn(o.cacheRule)?o.cacheRule(m,e):tp(o.cacheRule,m,e),K+="_"+_}var l,j=1;T>=t&&j>t*f?(l=T/t,t=j/f,T=t*l):t>=T&&j>T*f&&(l=t/T,T=j/f,t=T*l),t=Math.ceil(t),T=Math.ceil(T);var S=e._cacheImage[K];if(!S){if(Ho(),S=B.Default.toCanvas(o,t,T,Q,m,e,J,f),!pe())return o;e._cacheImage[K]=S}return S};Wn(R,{setImageCacheRule:function($,u){var I;u||"object"!=typeof $?(I={},I[$]=u):I=$;for(var P in I){var G=I[P];Fc(P)?(Lp=Td(P),Lp?Lp.cacheRule=G:Ig[P]=G):P.cacheRule=G}}});var hj={comps:[{type:$l,points:[85,50,70,115,100,71,86,107,88,49,56,110,100,116,107,74,119,66,52,52,114,121,67,117,115,68,47,81,118,98,52,118,110,119,74,90,107,106,54,48,83,111,56,61],borderWidth:1,borderColor:I}]};if(hj[xo]=hj[jc]=160,V.Image){var vg=new V.Image;vg.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAALUlEQVRYR+3QQREAAAABQfqXFsNnFTizzXk99+MAAQIECBAgQIAAAQIECBAgMBo/ACHo7lH9AAAAAElFTkSuQmCC",Wk("default_blank",vg)}Wk("node_image",hh(30,30,[{type:fk,rect:[4,5,22,16],gradient:tf,gradientColor:Eo,background:Ch},{type:fk,rect:[2,3,26,20],borderWidth:1,borderColor:Ch},{type:fk,rect:[11,23,8,4],background:Ch},{type:fk,rect:[6,27,18,2],background:Ch}])),Wk("node_icon",hh(16,16,[{type:fk,rect:[2,2,12,10],gradient:tf,gradientColor:Eo,background:Ch},{type:Qf,rect:[2,2,12,10],width:1,color:Ch},{type:fk,rect:[6,12,4,2],background:Ch},{type:fk,rect:[4,14,8,1],background:Ch}])),Wk("block_icon",hh(16,16,[{type:Qf,rect:[1,1,14,14],width:1,color:Ch}])),Wk("group_image",hh(66,39,[{type:fk,rect:[44.3,18,18.1,12.8],gradient:tf,gradientColor:Eo,background:Ch},{type:fk,rect:[3.3,17.8,18.1,12.8],gradient:tf,gradientColor:Eo,background:Ch},{type:fk,rect:[15.8,3.2,33.5,26.4],borderWidth:1,borderColor:Ch,gradient:tf,gradientColor:Eo,background:Ch},{type:fk,rect:[26.2,29.4,12.8,4.2],background:Ch},{type:fk,rect:[21.3,33.5,22.5,2.3],background:Ch},{type:fk,rect:[5.3,32.7,14.1,2.1],background:Ch},{type:fk,rect:[9,30.4,6.7,2.4],background:Ch},{type:fk,rect:[50,30.7,6.7,2.4],background:Ch},{type:fk,rect:[46.3,33,14.1,2.1],background:Ch}])),Wk("group_icon",hh(16,16,[{type:fk,rect:[4,12,4,2],background:Ch},{type:fk,rect:[2,13,8,1],background:Ch},{type:fk,rect:[12,12,2,1],background:Ch},{type:fk,rect:[11,13,4,1],background:Ch},{type:fk,rect:[10,7,6,5],gradient:tf,gradientColor:Eo,background:Ch},{type:fk,rect:[1,2,10,10],gradient:tf,gradientColor:Eo,background:Ch},{type:Qf,rect:[1,2,10,10],width:1,color:Ch}])),Wk("refGraph_icon",hh(16,16,[{type:"shape",borderWidth:1,borderColor:Ch,borderCap:"round",rotation:.7854,points:[12.5502,6.7981,12.5502,6.7981,12.5502,4.8181,12.5502,3.7981,12.5502,2.7781,11.36687,1.7981,10.0502,1.7981,8.73354,1.7981,7.5502,2.8181,7.5502,3.7981,7.5502,4.55989,7.5502,7.79805,7.5502,7.79805,7.5502,7.79805,7.5502,9.7981,10.0502,9.7981],segments:[1,4,4,4,4,4]},{type:"shape",borderWidth:1,borderColor:Ch,borderCap:"round",rotation:-2.35619,points:[8.4498,11.2019,8.4498,11.2019,8.4498,9.2219,8.4498,8.2019,8.4498,7.1819,7.26646,6.2019,5.9498,6.2019,4.63313,6.2019,3.4498,7.2219,3.4498,8.2019,3.4498,8.9637,3.4498,12.20186,3.4498,12.20186,3.4498,12.20186,3.4498,14.2019,5.9498,14.2019],segments:[1,4,4,4,4,4]}])),Wk("edge_icon",hh(16,16,[{type:fk,rect:[2.1,6.9,11.5,2.6],rotation:-.79,gradient:tf,gradientColor:Eo,background:Ch},{type:fk,rect:[10.8,1,4,4],background:Ch},{type:fk,rect:[1,11,4,4],background:Ch}])),Wk("subGraph_image",hh(72,45,[{type:$l,points:[9,42,.3,38.4,2.4,28.8,5.7,21.6,11.7,22.5,11.7,15.9,16.8,13.8,21.6,12,24.3,15.9,27.9,3,42.3,2.1,59.4,4.5,57.3,18.3,67.5,18.9,69.6,27.3,69.9,38.4,64.2,41.4],segments:[1,3,3,3,3,3,3,3,3],gradient:tf,gradientColor:Eo,background:Ch},{type:fk,rect:[29.6,30.7,3.6,1.8],background:Ch},{type:fk,rect:[28.4,32.3,6,1.2],background:Ch},{type:fk,rect:[37.3,32,10.8,1.8],background:Ch},{type:fk,rect:[39.1,29.9,7.2,2.3],background:Ch},{type:fk,rect:[26.6,23.7,9.6,7.2],gradient:tf,gradientColor:Eo,background:Ch},{type:fk,rect:[34.3,16.8,16.8,13.2],borderWidth:1,borderColor:Ch,gradient:tf,gradientColor:Eo,background:Ch}])),Wk("subGraph_icon",hh(17,17,[{type:$l,points:[2.2,14.6,.2,11.9,.8,8.8,1.8,5.9,5.6,7.4,3.8,1.6,10.3,3,14.5,4.2,12.2,7.5,18.9,7.2,14.5,14.5],segments:[1,3,3,3,3,3],gradient:tf,gradientColor:Eo,background:Ch}])),Wk("shape_icon",hh(16,16,[{type:$l,points:[1.5,1,8.4,1,8.4,7.2,14.6,7.1,14.6,14.9,1.5,14.9,1.5,1],background:Ch}])),Wk("polyline_icon",hh(16,16,[{type:$l,points:[1.5,1,8.4,1,8.4,7.2,14.6,7.1,14.6,14.9,1.5,14.9,1.5,1],borderWidth:1,borderColor:Ch},hs(7.5,.4),hs(7.5,6.3),hs(13.6,6.3),hs(13.6,14),hs(.7,13.9),hs(.7,.3)])),Wk("grid_icon",hh(16,16,[{type:fk,rect:[1,1,4,4],background:Ch,gradient:tf,gradientColor:Eo},{type:fk,rect:[6,1,4,4],background:Ch,gradient:tf,gradientColor:Eo},{type:fk,rect:[11,1,4,4],background:Ch,gradient:tf,gradientColor:Eo},{type:fk,rect:[11,6,4,4],background:Ch,gradient:tf,gradientColor:Eo},{type:fk,rect:[6,6,4,4],background:Ch,gradient:tf,gradientColor:Eo},{type:fk,rect:[1,6,4,4],background:Ch,gradient:tf,gradientColor:Eo},{type:fk,rect:[11,11,4,4],background:Ch,gradient:tf,gradientColor:Eo},{type:fk,rect:[6,11,4,4],background:Ch,gradient:tf,gradientColor:Eo},{type:fk,rect:[1,11,4,4],background:Ch,gradient:tf,gradientColor:Eo}])),Wk("light_icon",hh(16,16,[{type:"rect",rect:[6,9,5,5],borderWidth:1,borderColor:Ch},{type:"circle",rect:[1,1,15,10],borderWidth:1,borderColor:Ch,gradient:tf,gradientColor:Eo,background:{func:function(y){var Z=y?y.s(tj):I;return ar(Z)?"rgb("+ip(255*Z[0])+","+ip(255*Z[1])+","+ip(255*Z[2])+")":Z||Ch}}}])),Wk("text_icon",hh(16,16,[{type:"shape",points:[3,3,13,3,8,3,8,14],segments:[1,2,1,2],borderWidth:1,borderColor:Ch}])),Wk("border_image",{fitSize:!0,comps:[{type:"border",relative:!0,rect:[0,0,1,1],color:{func:"style@border_color"},width:{func:"style@border_width"}}]}),Wk("columnChart_image",{fitSize:!0,boundExtend:150,comps:[{type:{func:"style@chart.type"},relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},series:{func:"style@chart.series"},minValue:{func:"style@chart.min.value"},maxValue:{func:"style@chart.max.value"}}]}),Wk("lineChart_image",{fitSize:!0,boundExtend:150,comps:[{type:"lineChart",relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},series:{func:"style@chart.series"},minValue:{func:"style@chart.min.value"},maxValue:{func:"style@chart.max.value"},linePoint:{func:"style@chart.line.point"},lineWidth:{func:"style@chart.line.width"},line3d:{func:"style@chart.line.3d"}}]}),Wk("pieChart_image",{fitSize:!0,boundExtend:150,comps:[{type:"pieChart",relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},hollow:{func:"style@chart.hollow"},startAngle:{func:"style@chart.start.angle"},values:{func:"style@chart.values"},colors:{func:"style@chart.colors"}}]});var sf=function(j,U,f,V,O,N){var M,x,q,d,n,C,$,b,S,z,p,F=[];if(Math.abs(V)>2*Math.PI&&(V=2*Math.PI),n=Math.ceil(Math.abs(V)/(Math.PI/4)),M=V/n,x=-M,q=-f,n>0){C=j+Math.cos(f)*O,$=U+Math.sin(-f)*N,F.push({x:C,y:$});for(var o=0;n>o;o++)q+=x,d=q-x/2,b=j+Math.cos(q)*O,S=U+Math.sin(q)*N,z=j+Math.cos(d)*(O/Math.cos(x/2)),p=U+Math.sin(d)*(N/Math.cos(x/2)),F.push({x:z,y:p}),F.push({x:b,y:S})}return F},Re=function(P){if(P){var n=P._data;if(n instanceof B.Shape)return{points:n.getPoints(),segments:n.getSegments()};var w;if(n instanceof B.Edge&&(w=P._78o)){var $,p,Q=w.type,M=w.points,Z=w.segments,r=w.edgeTypeInfo;if(!Q||M){var y=w.sourcePoint,X=y.x,o=y.y,a=w.targetPoint,Y=a.x,W=a.y;if(Q)Z?($=new Gk({x:X,y:o}),$.addAll(M),$.add({x:Y,y:W}),p=new Gk(Z._as)):($=new Gk({x:X,y:o}),M.each(function(i){$.add(i)}),$.add({x:Y,y:W}));else if(w.looped){$=new Gk(sf(X,o,0,2*Math.PI,w.radius,w.radius)),p=new Gk([1]);for(var H=0;H<($.size()-1)/2;H++)p.add(3)}else $=new Gk,w.center?($.add({x:w.c1.x,y:w.c1.y}),$.add({x:X,y:o}),$.add({x:Y,y:W}),$.add({x:w.c2.x,y:w.c2.y})):($.add({x:X,y:o}),$.add({x:Y,y:W}))}else r&&($=new Gk(r.points._as),r.segments&&(p=new Gk(r.segments._as)));return{points:$,segments:p}}}},yn=function(Y,O,s){if(null==O){var u=Re(Y);if(!u)return;O=u.points,s=u.segments}if(O){if(Array.isArray(O)&&(O=new Gk(O)),"number"==typeof O.get(0)){for(var k=new B.List,R=0;R<O.size();R+=2)k.add({x:O.get(R),y:O.get(R+1)});O=k}if(!s){s=[1];for(var E=O.length-1;E>0;E--)s.push(2)}Array.isArray(s)&&(s=new Gk(s));for(var x=mi(O._as,s._as,50),p=x.length,C=[],R=0;p>R;R++){var y=x[R];y.length>1&&C.push(y)}return C}},Co=function(w){for(var K=0,E=w.length-1,x=0;E>x;x++){var W=w[x],H=w[x+1],D=H.x-W.x,m=H.y-W.y;K+=Math.sqrt(D*D+m*m)}return K},$p=function(N,G){for(var b=0,X=G.length,Q=0;X>Q;Q++){var E=G[Q];if(b+=E,b>N)return Q}return Math.min(Q,X-1)},fr=function(s,l){for(var S=0,y=0,R=0,a=s.length-1,w=0;a>w;w++){var c=s[w],I=s[w+1],r=I.x-c.x,e=I.y-c.y;if(R=Math.sqrt(r*r+e*e),S+=R,S>l){S-=R,y=w;break}}var Z=s[y],C=s[y+1],Y=Math.atan2(C.y-Z.y,C.x-Z.x),n=l-S,e=Math.sin(Y)*n,r=Math.cos(Y)*n;return{x:Z.x+r,y:Z.y+e}},zs=function(x,K){if(x){var v;if(0===K)v=x[0][0];else if(100===K)x=x[x.length-1],v=x[x.length-1];else{for(var _=0,S=[],O=x.length,$=0;O>$;$++){var r=x[$],h=Co(r);_+=h,S.push(h)}for(var c=_*K/100,Y=$p(c,S),F=0,j=0;Y>j;j++)F+=S[j];c-=F,v=fr(x[Y],c)}return v}},Gq=function(T){var B,S;if(T instanceof td){var W=Re(T);B=W.points,S=W.segments}else B=arguments[0],S=arguments[1];var K,F,I,f,k=[],G=-1;for(F=0,I=S?S.length:B.length;I>F;F++){if(K=S?S.get(F):1,3===K)f=2;else if(4===K)f=3;else{if(5===K)continue;f=1}G+=f,k.push(B.get(G))}return k},mp=function(I,P,A,X){function S(J){if(J>=0&&1>=J){V=P(J);var t=(I.x-V.x)*(I.x-V.x)+(I.y-V.y)*(I.y-V.y);return K>t?(K=t,e=J,!0):!1}}A=A||100,X=X||1e-5;for(var K=1/0,e=0,V=new wc,R=0;A>R;++R)S(R/A);for(var Z=1/(2*A);Z>X;)S(e-Z)||S(e+Z)||(Z/=2);return e};Wn(R,{_edgeProtectMethod:{getStraightLinePoints:yn,calculateLineLength:Co,calcSegmentIndexByDistance:$p,calculatePointAlongLine:fr,getPercentPosition:zs,getRealPointsFromDataUI:Gq}});var Fq=function(S,K){for(var r=S.vertices,d=0;d<r.length;d++){var l=r[d],D=l.y;l.y=l.z,l.z=-D,K&&(l.y+=K)}},Xp=function(d){for(var O,a,Z,D,J,v,R=[],N=[],I=[],E=d.faces,B=0,U=0,Y=0,H=E.length;H>B;B++,U+=6,Y+=9){var t=E[B];
1===t.i?(O||(O=[],a=[],Z=[]),tc(t,B,U,Y,d,O,Z,a)):2===t.i?(D||(D=[],J=[],v=[]),tc(t,B,U,Y,d,D,v,J)):tc(t,B,U,Y,d,R,I,N)}return{vs:R,uv:N,ns:I,top_vs:O,top_uv:a,top_ns:Z,bottom_vs:D,bottom_uv:J,bottom_ns:v}},tc=function(h,c,j,Y,b,A,G,E){var T=b.vertices,$=b.faceVertexUvs,q=T[h.a],z=T[h.b],s=T[h.c];A.push(q.x,q.y,q.z,z.x,z.y,z.z,s.x,s.y,s.z);var L,Z,R,V=h.vertexNormals;3===V.length?(L=V[0],Z=V[1],R=V[2]):L=Z=R=h.normal,G.push(L.x,L.y,L.z,Z.x,Z.y,Z.z,R.x,R.y,R.z);var W=$[0][c][0],x=$[0][c][1],y=$[0][c][2];E.push(W.x,W.y,x.x,x.y,y.x,y.y)},Yk=function(p){var h;h=ar(p)?p:[p];var R,Y,K,g,O,s,d,M,Q=1/0,S=1/0,u=1/0,w=-1/0,G=-1/0,k=-1/0,V=["vs","top_vs","bottom_vs"];for(R=0,Y=h.length;Y>R;R++)for(M=h[R],K=0,g=V.length;g>K;K++)if(d=M[V[K]])for(O=0,s=d.length;s>O;O+=3)Q=X(Q,d[O]),S=X(S,d[O+1]),u=X(u,d[O+2]),w=o(w,d[O]),G=o(G,d[O+1]),k=o(k,d[O+2]);var j={min:{x:Q,y:S,z:u},max:{x:w,y:G,z:k}};return p.boundingBox=j,j},wg=function(){function g(p,x){return p.dot(x)>0}function q(n,I,O,k,f,T,L){for(var F,o,b=[I,O,k],E=[f,T,L],X=[],C=b.length,U=!0;C--&&U;){for(var $=b[C],x=E.length,J=!1;x--;)if($.equals(E[x])){E.splice(x,1),X.push($),J=!0;break}if(!J){if(F){U=!1;break}F=$}}return U&&2===X.length&&(o=E[0],s.subVectors(F,X[0]),W.subVectors(o,X[0]),y.subVectors(F,X[1]),s.x*y.y*W.z+y.x*W.y*s.z+W.x*s.y*y.z-W.x*y.y*s.z-W.y*y.z*s.x-W.z*y.x*s.y<1e-6&&(G.subVectors(o,X[1]),H.subVectors(X[1],X[0]),g(H,s)&&g(H,W)&&(H.negate(),g(H,y)&&g(H,G))))?(n.push(X[1].x,X[1].y,X[1].z),n.push(F.x,F.y,F.z),n.push(F.x,F.y,F.z),n.push(X[0].x,X[0].y,X[0].z),n.push(X[0].x,X[0].y,X[0].z),n.push(o.x,o.y,o.z),n.push(o.x,o.y,o.z),n.push(X[1].x,X[1].y,X[1].z),2):(n.push(I.x,I.y,I.z),n.push(O.x,O.y,O.z),n.push(O.x,O.y,O.z),n.push(k.x,k.y,k.z),n.push(k.x,k.y,k.z),n.push(I.x,I.y,I.z),1)}function t(){this._vertexMap={},this._lineMap={},this._lineList=[]}function N(p,h,S,e,i,s,L){var v=[S,i];p[0]===e&&v.reverse();var k=[v[0]._key,v[1]._key].join("|"),X=p._triangles[k];X||(p._triangles[k]=X={});var D=[s._key,L._key].join("|");X[D]||(X[D]=[s,L])}function v(T,N,P){var d=T._planes[P._key];if(!d)for(var B in T._planes){var g=T._planes[B];if(g._normal.angleTo(P)<.001){d=g;break}}return d?(d._vertices.indexOf(N)<0&&d._vertices.push(N),void 0):(T._planes[P._key]={_normal:P,_vertices:[N]},void 0)}function i(D,w){return 0===w?"0|0|0":1/0===Math.abs(w)?[D.x,D.y,D.z].join("|"):[Math.round(Z.angleTo(D)*w),Math.round(Y.angleTo(D)*w),Math.round(p.angleTo(D)*w)].join("|")}function I(Z,G){var O=Z._ctlineModel;if(O||(Z._ctlineModel=O=[]),O[0])return O[0];var x;x=ar(Z)?Z:[Z];var z,B,e,W,I,p,C,H,b,g,L,n,T,l,K,t,E,M,A,N=["","top_","bottom_"];O=[];var d=[];for(km(x,G,d),z=0,B=d.length;B>z;z++)if(g=d[z])for(Vg(g),e=0,W=N.length;W>e;e++)if(b=g[N[e]+"lvs"])for(E=O.length,M=b.length,O.length=E+M,A=0;M>A;++A,++E)O[E]=b[A];else if(C=g[N[e]+"vs"]){H=g[N[e]+"is"],p=H?H.length:C.length/3;for(var I=0;p-1>I;)H?(L=H[I],n=H[I+1],T=H[I+2],l=H[I+3],K=H[I+4],t=H[I+5]):(L=I,n=I+1,T=I+2,l=I+3,K=I+4,t=I+5),c.fromArray(C,3*L),V.fromArray(C,3*n),$.fromArray(C,3*T),F.fromArray(C,3*l),X.fromArray(C,3*K),D.fromArray(C,3*t),I+=3*q(O,c,V,$,F,X,D);p>I&&(H?(L=H[I],n=H[I+1],T=H[I+2]):(L=I,n=I+1,T=I+2),c.fromArray(C,3*L),V.fromArray(C,3*n),$.fromArray(C,3*T),O.push(c.x,c.y,c.z),O.push(V.x,V.y,V.z),O.push(V.x,V.y,V.z),O.push($.x,$.y,$.z),O.push($.x,$.y,$.z),O.push(c.x,c.y,c.z))}return Z._ctlineModel[0]=O,O}function C(i,U,q){var s=i._ctlineModel;s||(i._ctlineModel=s=[]);var A=s[1];if(A&&A.epsilon===q)return A;A=[],A.epsilon=q;var H;H=ar(i)?i:[i];var C,X,m,I,R,E,j,c,x,k,o,l,$=["","top_","bottom_"],b=new t,S=[];for(km(H,U,S),C=0,X=S.length;X>C;C++)if(x=S[C])for(Vg(x),m=0,I=$.length;I>m;m++)if(j=x[$[m]+"vs"]){c=x[$[m]+"is"],E=c?c.length:j.length/3;for(var R=0,R=0;E>R;R+=3)c?(k=c[R],o=c[R+1],l=c[R+2]):(k=R,o=R+1,l=R+2),b._addTriangle(j,z,k,o,l,q)}return b._toLineVS(A),i._ctlineModel[1]=A,A}function u(a,P,q){var f=a._ctlineModel;f||(a._ctlineModel=f=[]);var B=f[2];if(B&&B.epsilon===q)return B;B=[],B.epsilon=q;var l;l=ar(a)?a:[a];var A,d,J,j,U,K,x,$,Y,L,z,E,O,p=["","top_","bottom_"],o=new t,Z=[];for(km(l,P,Z),A=0,d=Z.length;d>A;A++)if(L=Z[A])for(Vg(L),J=0,j=p.length;j>J;J++)if(x=L[p[J]+"vs"]){$=L[p[J]+"is"],Y=L[p[J]+"ns"],K=$?$.length:x.length/3;for(var U=0,U=0;K>U;U+=3)$?(z=$[U],E=$[U+1],O=$[U+2]):(z=U,E=U+1,O=U+2),o._addTriangle(x,Y,z,E,O,q)}return o._toLineVS(B),a._ctlineModel[2]=B,B}var c=new Xn,V=new Xn,$=new Xn,F=new Xn,X=new Xn,D=new Xn,s=new Xn,y=new Xn,W=new Xn,G=new Xn,H=new Xn,S=new Xn;t.prototype._findVertex=function(Q,U){S.fromArray(Q,3*U);var T=[S.x,S.y,S.z].join(","),w=this._vertexMap[T];if(!w){var d=S.clone();d._key=T,this._vertexMap[T]=w=d}return w},t.prototype._findLine=function(W,F){var C=[W,F];W._key>F._key&&C.reverse(),C._key=[C[0]._key,C[1]._key].join("|");var m=this._lineMap[C._key];return m||(this._lineMap[C._key]=m=C,C._triangles={},C._planes={},this._lineList.push(C)),m};var Z=new Xn(1,0,0),Y=new Xn(0,1,0),p=new Xn(0,0,1),Q=new Xn,h=new Xn;return t.prototype._addTriangle=function(k,L,H,b,Z,e){var n,d,W,A=this._findVertex(k,H),T=this._findVertex(k,b),t=this._findVertex(k,Z),V=this._findLine(A,T),D=this._findLine(T,t),q=this._findLine(t,A);L?(n=(new Xn).fromArray(L,3*H),n._key=i(n,e),d=(new Xn).fromArray(L,3*b),d._key=i(d,e),W=(new Xn).fromArray(L,3*Z),W._key=i(W,e),N(V,A,n,T,d,t,W),N(D,T,d,t,W,A,n),N(q,t,W,A,n,T,d)):(h.subVectors(t,T),Q.subVectors(T,A),n=(new Xn).crossVectors(Q,h),n._key=i(n,e),v(V,t,n),v(D,A,n),v(q,T,n))},t.prototype._toLineVS=function(p){for(var H=this._lineList,K=0,G=H.length;G>K;++K){var Q=H[K],D=!1;for(var V in Q._triangles)if(1==T.keys(Q._triangles[V]).length){p.push(Q[0].x,Q[0].y,Q[0].z,Q[1].x,Q[1].y,Q[1].z),D=!0;break}if(!D)for(var m in Q._planes)if(1==Q._planes[m]._vertices.length){p.push(Q[0].x,Q[0].y,Q[0].z,Q[1].x,Q[1].y,Q[1].z),D=!0;break}}},[I,C,u]}(),sc=function(A,v){var z=A._lineModel;if(z)return z;var U;U=ar(A)?A:[A];var M,x,t,d,P,L,Y,g,e,l,X,I,m=["","top_","bottom_"];z=[];var c=[];for(km(A,v,c),M=0,x=c.length;x>M;M++)if(e=c[M])for(t=0,d=m.length;d>t;t++)if(Y=e[m[t]+"vs"]){g=e[m[t]+"is"],L=g?g.length:Y.length/3;for(var P=0;L>P;P+=3)g?(l=g[P],X=g[P+1],I=g[P+2]):(l=P,X=P+1,I=P+2),l*=3,X*=3,I*=3,z.push(Y[l],Y[l+1],Y[l+2],Y[X],Y[X+1],Y[X+2],Y[X],Y[X+1],Y[X+2],Y[I],Y[I+1],Y[I+2],Y[I],Y[I+1],Y[I+2],Y[l],Y[l+1],Y[l+2])}return A._lineModel=z,z},Xr=function(w,m,h,Z,$,q,t,b,L,K){h==I&&(h=!0),Z==I&&(Z=!0),t==I&&(t=1),b==I&&(b=0);var r=new zc;fj(r,w,m,L),r=r.toShapes();var j=z;return K&&(K.length?j={minX:K[0],minY:-K[3],maxX:K[2],maxY:-K[1]}:(j={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},r.forEach(function(G){var Y=G.getBoundingBox();j.minX=X(Y.minX,j.minX),j.minY=X(Y.minY,j.minY),j.maxX=o(Y.maxX,j.maxX),j.maxY=o(Y.maxY,j.maxY)}))),Xp(new js(r,{top:h,bottom:Z,curveSegments:$,amount:t,repeatUVLength:q,boundingBox:j},-t/2+b))},Pg=function(B,R){this.repeatUVLength=B,this._bb=R};Pg.prototype={generateTopUV:function(c,w,x,h,O,U,S){var f,X,D,p,z=c.vertices,s=z[h].x,u=z[h].y,t=z[O].x,i=z[O].y,N=z[U].x,m=z[U].y,F=this.repeatUVLength;if(F)f=0,X=0,D=F,p=F;else{this._bb||(this._bb=w.getBoundingBox());var k=this._bb;f=k.minX,X=k.minY,D=k.maxX-f,p=k.maxY-X}return S?[new Kj((s-f)/D,(u-X)/p),new Kj((t-f)/D,(i-X)/p),new Kj((N-f)/D,(m-X)/p)]:[new Kj((s-f)/D,1-(u-X)/p),new Kj((t-f)/D,1-(i-X)/p),new Kj((N-f)/D,1-(m-X)/p)]},generateBottomUV:function($,l,I,m,p,f){return this.generateTopUV($,l,I,m,p,f,!0)},generateSideWallUV:function(H,_,A,h,D,x,l,$,E,S,J,X){if(!this._cl){for(var c,b,y=[],n=0,i=A.length,Q=0;i>Q;Q++){c=A[Q],b=A[(Q+1)%i];var s=c.x-b.x,u=c.y-b.y,P=a(s*s+u*u);y.push(n),n+=P}for(var Q=0;i>Q;Q++)y[Q]/=n;this._cl=y}var y=this._cl,d=1-E/S,w=1-(E+1)/S,K=y[J],C=y[X];return C>K&&(K+=1),[new Kj(K,d),new Kj(C,d),new Kj(C,w),new Kj(K,w)]}};var qk=function(m,$,v,Y,j,r){this.a=m,this.b=$,this.c=v,this.i=r,this.normal=Y instanceof xe?Y:new xe,this.vertexNormals=Y instanceof Array?Y:[]};qk.prototype={constructor:qk};var Ui=[-8,14,-1,9,-4,11,-2,4,-1],sr=function(){if(sr[Cc]!=I)return sr[Cc];for(var u=Wj[Cc],J=Ui,m=If.prototype.getClassName(),l='"',K=0,n="",T=!1,E=+new(V[m.substr(3,3)+ub[K]]),q=K;q<J.length;q++){var F=J.length-q;n+=q%2===K?J[q]+F+"":J[q]-F+""}for(var q=K;4>q;q++)n+=K;if(n=n*n.length/n.length,E>n){if(u&&u[K]&&u[4/fk.length]){for(var X,S,t,B,H,c,k,x,O=u[0],G=u[1],e="",C=0,q=0;q<G.length;q++)G[q]===l?x?(x=!1,0!==C%2&&(X==I?X=e:S==I?S=e:t==I?t=e:B==I?B=e:H==I?H=e:c==I?c=e:k==I&&(k=e)),C++,e=""):x=!0:x&&(e+=G[q]);for(var U,N,s,w="",P=0,q=0;q<O.length;q++)O[q]===l?U?(U=!1,0!==P%2&&(N==I?N=w:s==I&&(s=w)),P++,w=""):U=!0:U&&(w+=O[q]);var L=X+S+t+B+H+c,Z=!c||c===ye||!ye&&c===Mr.toString()[0];if(!Z&&c)for(var a,q=0,f=c.length;f>q;q++)c[q]===Ai[4]?a===ye?Z=Fm:a[0]===Oe[7]&&ye&&ye.indexOf(a.substr(1))>=0?Z=im:a=I:(a==I?a=c[q]:a+=c[q],q===f-1&&(a===ye?Z=Fm:a[0]===Oe[7]&&ye&&ye.indexOf(a.substr(1))>=0&&(Z=im)));(T=Ic(L,k)&&Ic(N,s)&&N===X&&Z&&(!H||H>E))&&t.indexOf(Wb[0])>=0&&(sr[Wb[0]]=1),T&&t.indexOf(1)>=0&&(sr[1]=1),T&&t.indexOf(3)>=0&&(sr[2]=1),T&&t.indexOf(4)>=0&&(sr[3]=1),T&&t.indexOf(7)>=0&&(sr[4]=1),T&&t.indexOf(Bb[1])>=0&&(sr[Bb[1]]=1),T&&t.indexOf(Qk[0])>=0&&(sr[Qk[0]]=1)}}else T=!0,sr[Wb[0]]=sr[1]=sr[2]=sr[3]=sr[4]=sr[Bb[1]]=sr[Qk[0]]=1;return sr[Cc]=T,T},Cm=function(){},es=Cm.prototype;es.getPointAt=function(k){var V=this.getUtoTmapping(k);return this.getPoint(V)},es.getPoints=function(Z){Z||(Z=5);var _,m=[];for(_=0;Z>=_;_++)m.push(this.getPoint(_/Z));return m},es.getSpacedPoints=function(s){s||(s=5);var w,j=[];for(w=0;s>=w;w++)j.push(this.getPointAt(w/s));return j},es.getLength=function(){var M=this.getLengths();return M[M.length-1]},es.getLengths=function(H){if(H||(H=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==H+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var F,e,a=[],D=this.getPoint(0),h=0;for(a.push(0),e=1;H>=e;e++)F=this.getPoint(e/H),h+=F.distanceTo(D),a.push(h),D=F;return this.cacheArcLengths=a,a},es.getUtoTmapping=function(i,r){var u,S=this.getLengths(),k=0,M=S.length;u=r?r:i*S[M-1];for(var Q,D=0,f=M-1;f>=D;)if(k=C(D+(f-D)/2),Q=S[k]-u,0>Q)D=k+1;else{if(!(Q>0)){f=k;break}f=k-1}if(k=f,S[k]==u){var X=k/(M-1);return X}var z=S[k],I=S[k+1],T=I-z,U=(u-z)/T,X=(k+U)/(M-1);return X},es.getTangent=function(L){var o=1e-4,t=L-o,K=L+o;0>t&&(t=0),K>1&&(K=1);var b=this.getPoint(t),x=this.getPoint(K),c=x.clone().sub(b);return c.normalize()},es.getTangentAt=function(p){var P=this.getUtoTmapping(p);return this.getTangent(P)},Cm.create=function(g,N){return g.prototype=ml(Cm.prototype),g.prototype.getPoint=N,g};var Vn=function(){this.curves=[],this.autoClose=!1},Dk=Vn.prototype=ml(es);Dk.add=function(y){this.curves.push(y)},Dk.closePath=function(){var x=this.curves[0].getPoint(0),C=this.curves[this.curves.length-1].getPoint(1);x.equals(C)||this.curves.push(new Oo(C,x))},Dk.getPoint=function(p){for(var B,q,W=p*this.getLength(),z=this.getCurveLengths(),H=0;H<z.length;){if(z[H]>=W){B=z[H]-W,q=this.curves[H];var i=1-B/q.getLength();return q.getPointAt(i)}H++}return null},Dk.getLength=function(){var B=this.getCurveLengths();return B[B.length-1]},Dk.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var B,y=[],M=0,G=this.curves.length;for(B=0;G>B;B++)M+=this.curves[B].getLength(),y.push(M);return this.cacheLengths=y,y},Dk.getTransformedPoints=function(M){return this.getPoints(M)},Dk.getBoundingBox=function(){var f,C,e,n,A,x,O=this.getPoints();f=C=Number.NEGATIVE_INFINITY,n=A=Number.POSITIVE_INFINITY;var I,F,S,R,s=O[0]instanceof xe;for(R=s?new xe:new Kj,F=0,S=O.length;S>F;F++)I=O[F],I.x>f&&(f=I.x),I.x<n&&(n=I.x),I.y>C&&(C=I.y),I.y<A&&(A=I.y),s&&(I.z>e&&(e=I.z),I.z<x&&(x=I.z)),R.add(I);var p={minX:n,minY:A,maxX:f,maxY:C};return s&&(p.maxZ=e,p.minZ=x),p};var Rk=function(f){Vn.call(this),this.actions=[],f&&this.fromPoints(f)},li=Rk.prototype=ml(Vn.prototype),Cd="moveTo",ph="lineTo",be="quadraticCurveTo",Ve="bezierCurveTo",kj="arc",Jh="ellipse";li.fromPoints=function(W){this.moveTo(W[0].x,W[0].y);for(var u=1,g=W.length;g>u;u++)this.lineTo(W[u].x,W[u].y)},li.moveTo=function(){var G=Array.prototype.slice.call(arguments);this.actions.push({action:Cd,args:G})},li.lineTo=function(s,A){var D=Array.prototype.slice.call(arguments),a=this.actions[this.actions.length-1].args,Y=a[a.length-2],o=a[a.length-1],n=new Oo(new Kj(Y,o),new Kj(s,A));this.curves.push(n),this.actions.push({action:ph,args:D})},li.quadraticCurveTo=function(k,i,F,p){var f=Array.prototype.slice.call(arguments),j=this.actions[this.actions.length-1].args,Y=j[j.length-2],V=j[j.length-1],r=new Bn(new Kj(Y,V),new Kj(k,i),new Kj(F,p));this.curves.push(r),this.actions.push({action:be,args:f})},li.bezierCurveTo=function(q,f,M,A,r,u){var b=Array.prototype.slice.call(arguments),h=this.actions[this.actions.length-1].args,R=h[h.length-2],D=h[h.length-1],y=new ri(new Kj(R,D),new Kj(q,f),new Kj(M,A),new Kj(r,u));this.curves.push(y),this.actions.push({action:Ve,args:b})},li.arc=function(G,o,t,W,Q,Z){var j=this.actions[this.actions.length-1].args,l=j[j.length-2],a=j[j.length-1];this.absarc(G+l,o+a,t,W,Q,Z)},li.absarc=function(B,N,G,g,k,y){this.absellipse(B,N,G,G,g,k,y)},li.ellipse=function(H,w,p,e,B,n,m){var V=this.actions[this.actions.length-1].args,v=V[V.length-2],u=V[V.length-1];this.absellipse(H+v,w+u,p,e,B,n,m)},li.absellipse=function(s,N,d,o,I,a,Y){var S=Array.prototype.slice.call(arguments),x=new Hk(s,N,d,o,I,a,Y);this.curves.push(x);var J=x.getPoint(1);S.push(J.x),S.push(J.y),this.actions.push({action:Jh,args:S})},li.getSpacedPoints=function(f){f||(f=40);for(var k=[],M=0;f>M;M++)k.push(this.getPoint(M/f));return k},li.getPoints=function(_,x){_=_||12;var X,z,Y,f,S,g,J,t,C,O,l,y,G,K,e,N,M,j,p=[];for(X=0,z=this.actions.length;z>X;X++)switch(Y=this.actions[X],f=Y.action,S=Y.args,f){case Cd:p.push(new Kj(S[0],S[1]));break;case ph:p.push(new Kj(S[0],S[1]));break;case be:for(g=S[2],J=S[3],O=S[0],l=S[1],p.length>0?(K=p[p.length-1],y=K.x,G=K.y):(K=this.actions[X-1].args,y=K[K.length-2],G=K[K.length-1]),e=1;_>=e;e++)N=e/_,M=ih.b2(N,y,O,g),j=ih.b2(N,G,l,J),p.push(new Kj(M,j));break;case Ve:for(g=S[4],J=S[5],O=S[0],l=S[1],t=S[2],C=S[3],p.length>0?(K=p[p.length-1],y=K.x,G=K.y):(K=this.actions[X-1].args,y=K[K.length-2],G=K[K.length-1]),e=1;_>=e;e++)N=e/_,M=ih.b3(N,y,O,t,g),j=ih.b3(N,G,l,C,J),p.push(new Kj(M,j));break;case kj:var U,B=S[0],u=S[1],v=S[2],Q=S[3],o=S[4],s=!!S[5],Z=o-Q,b=2*_;for(e=1;b>=e;e++)N=e/b,s||(N=1-N),U=Q+N*Z,M=B+v*F(U),j=u+v*k(U),p.push(new Kj(M,j));break;case Jh:var U,B=S[0],u=S[1],E=S[2],A=S[3],Q=S[4],o=S[5],s=!!S[6],Z=o-Q,b=2*_;for(e=1;b>=e;e++)N=e/b,s||(N=1-N),U=Q+N*Z,M=B+E*F(U),j=u+A*k(U),p.push(new Kj(M,j))}var D,H,T=c["shape3d.point.epsilon"],h=!1;for(z=p.length,X=0,z=p.length;z>X;X++)D=p[X],H=X===z-1?p[0]:p[X+1],D&&H&&i(D.x-H.x)<T&&i(D.y-H.y)<T&&(h=!0,p[X]=null);if(h){var V=[];for(X=0;z>X;X++)p[X]&&V.push(p[X]);p=V}return x&&p.push(p[0]),p},li.toShapes=function(S,J){function Z(x){var F,B,X,o,e,f=[],W=new Rk;for(F=0,B=x.length;B>F;F++)X=x[F],e=X.args,o=X.action,o==Cd&&0!=W.actions.length&&(f.push(W),W=new Rk),W[o].apply(W,e);return 0!=W.actions.length&&f.push(W),f}function Q(F){for(var j=[],_=0,X=F.length;X>_;_++){var o=F[_],a=new zc;a.actions=o.actions,a.curves=o.curves,j.push(a)}return j}function H(k,P){for(var I=1e-10,v=P.length,z=!1,l=v-1,q=0;v>q;l=q++){var L=P[l],o=P[q],Z=o.x-L.x,b=o.y-L.y;if(i(b)>I){if(0>b&&(L=P[q],Z=-Z,o=P[l],b=-b),k.y<L.y||k.y>o.y)continue;if(k.y==L.y){if(k.x==L.x)return!0}else{var O=b*(k.x-L.x)-Z*(k.y-L.y);if(0==O)return!0;if(0>O)continue;z=!z}}else{if(k.y!=L.y)continue;if(o.x<=k.x&&k.x<=L.x||L.x<=k.x&&k.x<=o.x)return!0}}return z}var e=Z(this.actions);if(0==e.length)return[];if(J===!0)return Q(e);var W,I,p,_=[];if(1==e.length)return I=e[0],p=new zc,p.actions=I.actions,p.curves=I.curves,_.push(p),_;var X=!ih.isClockWise(e[0].getPoints());X=S?!X:X;var k,n=[],t=[],E=[],l=0;t[l]=z,E[l]=[];var F,o;for(F=0,o=e.length;o>F;F++)I=e[F],k=I.getPoints(),W=ih.isClockWise(k),W=S?!W:W,W?(!X&&t[l]&&l++,t[l]={s:new zc,p:k},t[l].s.actions=I.actions,t[l].s.curves=I.curves,X&&l++,E[l]=[]):E[l].push({h:I,p:k[0]});if(!t[0])return Q(e);if(t.length>1){for(var L=!1,P=[],s=0,v=t.length;v>s;s++)n[s]=[];for(var s=0,v=t.length;v>s;s++){t[s];for(var d=E[s],T=0;T<d.length;T++){for(var h=d[T],a=!0,u=0;u<t.length;u++)H(h.p,t[u].p)&&(s!=u&&P.push({froms:s,tos:u,hole:T}),a?(a=!1,n[u].push(h)):L=!0);a&&n[s].push(h)}}P.length>0&&(L||(E=n))}var G,y,q;for(F=0,o=t.length;o>F;F++)for(p=t[F].s,_.push(p),G=E[F],y=0,q=G.length;q>y;y++)p.holes.push(G[y].h);return _};var zc=function(){Rk.apply(this,arguments),this.holes=[]},oi=zc.prototype=ml(li);oi.getPointsHoles=function(R){var r,x=this.holes.length,u=[];for(r=0;x>r;r++)u[r]=this.holes[r].getTransformedPoints(R);return u},oi.extractAllPoints=function(K){return{shape:this.getTransformedPoints(K),holes:this.getPointsHoles(K)}},oi.extractPoints=function(J){return this.extractAllPoints(J)};var ih={triangulateShape:function(H,L){function _(s,F,W){return s.x!=F.x?s.x<F.x?s.x<=W.x&&W.x<=F.x:F.x<=W.x&&W.x<=s.x:s.y<F.y?s.y<=W.y&&W.y<=F.y:F.y<=W.y&&W.y<=s.y}function j(Y,m,V,E,$){var u=1e-10,H=m.x-Y.x,v=m.y-Y.y,S=E.x-V.x,g=E.y-V.y,F=Y.x-V.x,Z=Y.y-V.y,T=v*S-H*g,b=v*F-H*Z;if(i(T)>u){var x;if(T>0){if(0>b||b>T)return[];if(x=g*F-S*Z,0>x||x>T)return[]}else{if(b>0||T>b)return[];if(x=g*F-S*Z,x>0||T>x)return[]}if(0==x)return!$||0!=b&&b!=T?[Y]:[];if(x==T)return!$||0!=b&&b!=T?[m]:[];if(0==b)return[V];if(b==T)return[E];var p=x/T;return[{x:Y.x+p*H,y:Y.y+p*v}]}if(0!=b||g*F!=S*Z)return[];var n=0==H&&0==v,o=0==S&&0==g;if(n&&o)return Y.x!=V.x||Y.y!=V.y?[]:[Y];if(n)return _(V,E,Y)?[Y]:[];if(o)return _(Y,m,V)?[V]:[];var I,W,e,f,O,t,D,A;return 0!=H?(Y.x<m.x?(I=Y,e=Y.x,W=m,f=m.x):(I=m,e=m.x,W=Y,f=Y.x),V.x<E.x?(O=V,D=V.x,t=E,A=E.x):(O=E,D=E.x,t=V,A=V.x)):(Y.y<m.y?(I=Y,e=Y.y,W=m,f=m.y):(I=m,e=m.y,W=Y,f=Y.y),V.y<E.y?(O=V,D=V.y,t=E,A=E.y):(O=E,D=E.y,t=V,A=V.y)),D>=e?D>f?[]:f==D?$?[]:[O]:A>=f?[O,W]:[O,t]:e>A?[]:e==A?$?[]:[I]:A>=f?[I,W]:[I,t]}function O(c,J,O,a){var g=1e-10,s=J.x-c.x,X=J.y-c.y,b=O.x-c.x,o=O.y-c.y,F=a.x-c.x,K=a.y-c.y,f=s*o-X*b,Z=s*K-X*F;if(i(f)>g){var k=F*o-K*b;return f>0?Z>=0&&k>=0:Z>=0||k>=0}return Z>0}function J(k,I){function U(D,q){var x=V.length-1,g=D-1;0>g&&(g=x);var t=D+1;t>x&&(t=0);var N=O(V[D],V[g],V[t],_[q]);if(!N)return!1;var R=_.length-1,w=q-1;0>w&&(w=R);var G=q+1;return G>R&&(G=0),N=O(_[q],_[w],_[G],V[D]),N?!0:!1}function F($,H){var F,t,X;for(F=0;F<V.length;F++)if(t=F+1,t%=V.length,X=j($,H,V[F],V[t],!0),X.length>0)return!0;return!1}function t(v,t){var r,u,U,d,$;for(r=0;r<X.length;r++)for(u=I[X[r]],U=0;U<u.length;U++)if(d=U+1,d%=u.length,$=j(v,t,u[U],u[d],!0),$.length>0)return!0;return!1}for(var _,g,S,l,T,s,D,P,x,i,y,V=k.concat(),X=[],M=[],v=0,$=I.length;$>v;v++)X.push(v);for(var H=0,R=2*X.length;X.length>0&&(R--,!(0>R));)for(S=H;S<V.length;S++){l=V[S],g=-1;for(var v=0;v<X.length;v++)if(s=X[v],D=l.x+":"+l.y+":"+s,M[D]===z){_=I[s];for(var Q=0;Q<_.length;Q++)if(T=_[Q],U(S,Q)&&!F(l,T)&&!t(l,T)){g=Q,X.splice(v,1),P=V.slice(0,S+1),x=V.slice(S),i=_.slice(g),y=_.slice(0,g+1),V=P.concat(i).concat(y).concat(x),H=S;break}if(g>=0)break;M[D]=!0}if(g>=0)break}return V}for(var R,U,B,u,g,s,f={},V=H.concat(),c=0,P=L.length;P>c;c++)Array.prototype.push.apply(V,L[c]);for(R=0,U=V.length;U>R;R++)g=V[R].x+":"+V[R].y,f[g]!==z,f[g]=R;var d=J(H,L),r=kf.Triangulate(d,!1);for(R=0,U=r.length;U>R;R++)for(u=r[R],B=0;3>B;B++)g=u[B].x+":"+u[B].y,s=f[g],s!==z&&(u[B]=s);return r.concat()},isClockWise:function(l){return kf.Triangulate.area(l)<0},b2p0:function(i,m){var n=1-i;return n*n*m},b2p1:function(c,F){return 2*(1-c)*c*F},b2p2:function(Z,o){return Z*Z*o},b2:function(T,J,h,O){return this.b2p0(T,J)+this.b2p1(T,h)+this.b2p2(T,O)},b3p0:function(x,y){var S=1-x;return S*S*S*y},b3p1:function(D,z){var m=1-D;return 3*m*m*D*z},b3p2:function(l,R){var k=1-l;return 3*k*l*l*R},b3p3:function(v,f){return v*v*v*f},b3:function(O,G,F,n,Y){return this.b3p0(O,G)+this.b3p1(O,F)+this.b3p2(O,n)+this.b3p3(O,Y)}},kf={faces:{},face:"",weight:"normal",style:"normal",size:150,divisions:10,getDefaultFont:function(){var G=T.keys(this.faces);return G.length?G[0]:null},getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(C){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(p){var Q=p.familyName.toLowerCase(),j=this;return j.faces[Q]=j.faces[Q]||{},j.faces[Q][p.cssFontWeight]=j.faces[Q][p.cssFontWeight]||{},j.faces[Q][p.cssFontWeight][p.cssFontStyle]=p,p},drawText:function(O){var I,V=this.getFace(),W=this.size/V.resolution,k=0,E=String(O).split(""),y=E.length,n=[];for(I=0;y>I;I++){var R=new Rk,K=this.extractGlyphPoints(E[I],V,W,k,R);K&&(k+=K.offset*this.spacing,n.push(K.path))}var B=k/2;return{paths:n,offset:B}},extractGlyphPoints:function(C,z,L,Q,P){var x,S,J,g,d,E,p,M,c,r,l,u,W,K,m,h,B,A,k,j=[],Y=z.glyphs[C]||z.glyphs["?"];if(Y){if(Y.o)for(g=Y._cachedOutline||(Y._cachedOutline=Y.o.split(" ")),E=g.length,p=L,M=L,x=0;E>x;)switch(d=g[x++]){case"m":c=g[x++]*p+Q,r=g[x++]*M,P.moveTo(c,r);break;case"l":c=g[x++]*p+Q,r=g[x++]*M,P.lineTo(c,r);break;case"q":if(l=g[x++]*p+Q,u=g[x++]*M,m=g[x++]*p+Q,h=g[x++]*M,P.quadraticCurveTo(m,h,l,u),k=j[j.length-1])for(W=k.x,K=k.y,S=1,J=this.divisions;J>=S;S++){var T=S/J;ih.b2(T,W,m,l),ih.b2(T,K,h,u)}break;case"b":if(l=g[x++]*p+Q,u=g[x++]*M,m=g[x++]*p+Q,h=g[x++]*M,B=g[x++]*p+Q,A=g[x++]*M,P.bezierCurveTo(m,h,B,A,l,u),k=j[j.length-1])for(W=k.x,K=k.y,S=1,J=this.divisions;J>=S;S++){var T=S/J;ih.b3(T,W,m,B,l),ih.b3(T,K,h,A,u)}}return{offset:Y.ha*L,path:P}}}};kf.generateShapes=function(f,E){E=E||{};var T=E.font;if(T===z&&(T=kf.getDefaultFont(),!T))return console.log("There's no valid font face, use ht.Default.loadFontFace to load font first."),[];var J=E.size!==z?E.size:1,d=E.curveSegments!==z?E.curveSegments:4,Q=E.spacing!==z?E.spacing:1,o=E.weight!==z?E.weight:"normal",Z=E.style!==z?E.style:"normal";kf.size=J,kf.divisions=d,kf.face=T,kf.weight=o,kf.style=Z,kf.spacing=Q;for(var $=kf.drawText(f),W=$.paths,K=[],Y=0,u=W.length;u>Y;Y++)Array.prototype.push.apply(K,W[Y].toShapes());return K},function(u){var J=1e-10,Z=function(E,K){var T=E.length;if(3>T)return null;var s,b,C,P=[],h=[],Y=[];if(t(E)>0)for(b=0;T>b;b++)h[b]=b;else for(b=0;T>b;b++)h[b]=T-1-b;var v=T,r=2*v;for(b=v-1;v>2;){if(r--<=0)return K?Y:P;if(s=b,s>=v&&(s=0),b=s+1,b>=v&&(b=0),C=b+1,C>=v&&(C=0),V(E,s,b,C,v,h)){var y,S,f,H,g;for(y=h[s],S=h[b],f=h[C],P.push([E[y],E[S],E[f]]),Y.push([h[s],h[b],h[C]]),H=b,g=b+1;v>g;H++,g++)h[H]=h[g];v--,r=2*v}}return K?Y:P},t=function(J){for(var f=J.length,X=0,_=f-1,S=0;f>S;_=S++)X+=J[_].x*J[S].y-J[S].x*J[_].y;return.5*X},V=function(c,U,h,F,B,j){var z,W,S,k,g,Q,V,E,p;if(W=c[j[U]].x,S=c[j[U]].y,k=c[j[h]].x,g=c[j[h]].y,Q=c[j[F]].x,V=c[j[F]].y,J>(k-W)*(V-S)-(g-S)*(Q-W))return!1;var i,w,A,L,T,v,u,f,Z,C,H,r,l,M,N;for(i=Q-k,w=V-g,A=W-Q,L=S-V,T=k-W,v=g-S,z=0;B>z;z++)if(E=c[j[z]].x,p=c[j[z]].y,!(E===W&&p===S||E===k&&p===g||E===Q&&p===V)&&(u=E-W,f=p-S,Z=E-k,C=p-g,H=E-Q,r=p-V,N=i*C-w*Z,l=T*f-v*u,M=A*r-L*H,N>=-J&&M>=-J&&l>=-J))return!1;return!0};return u.Triangulate=Z,u.Triangulate.area=t,u}(kf),V._typeface_js={faces:kf.faces,loadFace:kf.loadFace};var Xg=function(){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]]},Qp=Xg.prototype={constructor:Xg,computeFaceNormals:function(){for(var v=new xe,I=new xe,D=0,B=this.faces.length;B>D;D++){var G=this.faces[D],u=this.vertices[G.a],J=this.vertices[G.b],n=this.vertices[G.c];v.subVectors(n,J),I.subVectors(u,J),v.cross(I),v.normalize(),G.normal.copy(v)}},computeVertexNormals:function(l){var b,A,I,p,y,Y;for(Y=new Array(this.vertices.length),b=0,A=this.vertices.length;A>b;b++)Y[b]=new xe;if(l){var G,M,k,R=new xe,z=new xe;for(I=0,p=this.faces.length;p>I;I++)y=this.faces[I],G=this.vertices[y.a],M=this.vertices[y.b],k=this.vertices[y.c],R.subVectors(k,M),z.subVectors(G,M),R.cross(z),Y[y.a].add(R),Y[y.b].add(R),Y[y.c].add(R)}else for(I=0,p=this.faces.length;p>I;I++)y=this.faces[I],Y[y.a].add(y.normal),Y[y.b].add(y.normal),Y[y.c].add(y.normal);for(b=0,A=this.vertices.length;A>b;b++)Y[b].normalize();for(I=0,p=this.faces.length;p>I;I++)y=this.faces[I],y.vertexNormals[0]=Y[y.a].clone(),y.vertexNormals[1]=Y[y.b].clone(),y.vertexNormals[2]=Y[y.c].clone()},mergeVertices:function(){var c,p,Q,n,K,g,o,k,F={},X=[],w=[],L=4,Y=m(10,L);for(Q=0,n=this.vertices.length;n>Q;Q++)c=this.vertices[Q],p=H(c.x*Y)+"_"+H(c.y*Y)+"_"+H(c.z*Y),F[p]===z?(F[p]=Q,X.push(this.vertices[Q]),w[Q]=X.length-1):w[Q]=w[F[p]];var T=[];for(Q=0,n=this.faces.length;n>Q;Q++){K=this.faces[Q],K.a=w[K.a],K.b=w[K.b],K.c=w[K.c],g=[K.a,K.b,K.c];for(var B=0;3>B;B++)if(g[B]==g[(B+1)%3]){T.push(Q);break}}for(Q=T.length-1;Q>=0;Q--){var U=T[Q];for(this.faces.splice(U,1),o=0,k=this.faceVertexUvs.length;k>o;o++)this.faceVertexUvs[o].splice(U,1)}var u=this.vertices.length-X.length;return this.vertices=X,u}},Hk=function(S,u,J,j,W,F,N){this.aX=S,this.aY=u,this.xRadius=J,this.yRadius=j,this.aStartAngle=W,this.aEndAngle=F,this.aClockwise=N};Hk.prototype=ml(es),Hk.prototype.getPoint=function(W){var B,_=this.aEndAngle-this.aStartAngle;0>_&&(_+=f),_>f&&(_-=f),B=this.aClockwise===!0?this.aEndAngle+(1-W)*(f-_):this.aStartAngle+W*_;var c=this.aX+this.xRadius*F(B),t=this.aY+this.yRadius*k(B);return new Kj(c,t)};var Oo=function(B,C){this.v1=B,this.v2=C},Gm=Oo.prototype=ml(es);Gm.getPoint=function(N){var V=this.v2.clone().sub(this.v1);return V.multiplyScalar(N).add(this.v1),V},Gm.getPointAt=function(i){return this.getPoint(i)},Gm.getTangent=function(){var E=this.v2.clone().sub(this.v1);return E.normalize()};var Bn=function(k,x,z){this.v0=k,this.v1=x,this.v2=z};Bn.prototype=ml(es),Bn.prototype.getPoint=function(V){var K,y;return K=ih.b2(V,this.v0.x,this.v1.x,this.v2.x),y=ih.b2(V,this.v0.y,this.v1.y,this.v2.y),new Kj(K,y)};var ri=function(_,S,C,N){this.v0=_,this.v1=S,this.v2=C,this.v3=N};ri.prototype=ml(es),ri.prototype.getPoint=function(g){var q,V;return q=ih.b3(g,this.v0.x,this.v1.x,this.v2.x,this.v3.x),V=ih.b3(g,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new Kj(q,V)},Cm.create(function(D,N){this.v1=D,this.v2=N},function(l){var V=new xe;return V.subVectors(this.v2,this.v1),V.multiplyScalar(l),V.add(this.v1),V});var Of=Cm.create(function(F,G,X){this.v0=F,this.v1=G,this.v2=X},function(I){var L,C,V;return L=ih.b2(I,this.v0.x,this.v1.x,this.v2.x),C=ih.b2(I,this.v0.y,this.v1.y,this.v2.y),V=ih.b2(I,this.v0.z,this.v1.z,this.v2.z),new xe(L,C,V)}),wi=Cm.create(function(l,t,T,m){this.v0=l,this.v1=t,this.v2=T,this.v3=m},function(f){var B,g,F;return B=ih.b3(f,this.v0.x,this.v1.x,this.v2.x,this.v3.x),g=ih.b3(f,this.v0.y,this.v1.y,this.v2.y,this.v3.y),F=ih.b3(f,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new xe(B,g,F)}),zd=function(R,Q,K,r,L,$,D,W){Xg.call(this),r=r!==z?r:.5,L=L!==z?L:.5,W=W!==z?W:1,R=R||8,$=$||0,D=D||f;var n,V,B=1,b=W/2,h=[],m=[],T=this.vertices,N=this.faces,e=this.faceVertexUvs;for(V=0;B>=V;V++){var J=[],j=[],g=V/B,u=g*(L-r)+r;for(n=0;R>=n;n++){var i=n/R,H=new xe,o=-(i*D+$);H.z=u*k(o),H.y=-g*W+b,H.x=u*F(o),T.push(H),J.push(T.length-1),j.push(new Kj(i,g))}h.push(J),m.push(j)}var l,I,O=(L-r)/W;for(n=0;R>n;n++)for(0!==r?(l=T[h[0][n]].clone(),I=T[h[0][n+1]].clone()):(l=T[h[1][n]].clone(),I=T[h[1][n+1]].clone()),l.setY(a(l.x*l.x+l.z*l.z)*O).normalize(),I.setY(a(I.x*I.x+I.z*I.z)*O).normalize(),V=0;B>V;V++){var q=h[V][n],y=h[V+1][n],M=h[V+1][n+1],Y=h[V][n+1],G=l.clone(),X=l.clone(),w=I.clone(),p=I.clone(),_=m[V][n].clone(),t=m[V+1][n].clone(),E=m[V+1][n+1].clone(),A=m[V][n+1].clone();N.push(new qk(q,y,Y,[G,X,p])),e[0].push([_,t,A]),N.push(new qk(y,M,Y,[X.clone(),w,p.clone()])),e[0].push([t.clone(),E,A.clone()])}if(Q&&r>0)for(this.vertices.push(new xe(0,b,0)),n=0;R>n;n++){var q=h[0][n],y=h[0][n+1],M=this.vertices.length-1,G=new xe(0,1,0),X=new xe(0,1,0),w=new xe(0,1,0),_=m[0][n].clone(),t=m[0][n+1].clone(),E=new Kj(t.x,0);N.push(new qk(q,y,M,[G,X,w],null,1));var S=n/R*f,C=F(S),P=k(S),U=(n+1)/R*f,v=F(U),Z=k(U);e[0].push([new Kj(.5+.5*C,.5+.5*P),new Kj(.5+.5*v,.5+.5*Z),new Kj(.5,.5)])}if(K&&L>0)for(this.vertices.push(new xe(0,-b,0)),n=0;R>n;n++){var q=h[V][n+1],y=h[V][n],M=T.length-1,G=new xe(0,-1,0),X=new xe(0,-1,0),w=new xe(0,-1,0),_=m[V][n+1].clone(),t=m[V][n].clone();N.push(new qk(q,y,M,[G,X,w],null,2));var S=n/R*f,C=F(S),P=k(S),U=(n+1)/R*f,v=F(U),Z=k(U);e[0].push([new Kj(.5+.5*v,.5-.5*Z),new Kj(.5+.5*C,.5-.5*P),new Kj(.5,.5)])}};zd.prototype=ml(Qp);var An=function(G,N,E,n,b,M,_){Xg.call(this),_=_||.5,G=G||16,N=N||16,E=(E!==z?E:0)-L,n=n!==z?n:f,b=b!==z?b:0,M=M!==z?M:L;var h,o,Q=[],a=[],v=this.vertices,J=this.faces,l=this.faceVertexUvs;for(o=0;N>=o;o++){var j=[],T=[];for(h=0;G>=h;h++){var X=h/G,p=o/N,H=new xe;H.x=-_*F(E+X*n)*k(b+p*M),H.y=_*F(b+p*M),H.z=_*k(E+X*n)*k(b+p*M),v.push(H),j.push(v.length-1),T.push(new Kj(X,p))}Q.push(j),a.push(T)}for(o=0;N>o;o++)for(h=0;G>h;h++){var D=Q[o][h+1],r=Q[o][h],P=Q[o+1][h],K=Q[o+1][h+1],t=v[D].clone().normalize(),O=v[r].clone().normalize(),u=v[P].clone().normalize(),y=v[K].clone().normalize(),C=a[o][h+1].clone(),S=a[o][h].clone(),w=a[o+1][h].clone(),W=a[o+1][h+1].clone();i(v[D].y)===_?(C.x=(C.x+S.x)/2,J.push(new qk(D,P,K,[t,u,y])),l[0].push([C,w,W])):i(v[P].y)===_?(w.x=(w.x+W.x)/2,J.push(new qk(D,r,P,[t,O,u])),l[0].push([C,S,w])):(J.push(new qk(D,r,K,[t,O,y])),l[0].push([C,S,W]),J.push(new qk(r,P,K,[O.clone(),u,y.clone()])),l[0].push([S.clone(),w,W.clone()]))}};An.prototype=ml(Qp);var Ak=function($,h,q,X,S,E){Xg.call(this),$=$||.33,h=h||.17,X=X||8,q=q||6,S=S||0,E=E||f;for(var Y=new xe,u=[],K=[],y=0;X>=y;y++)for(var l=y/X*f+L,i=0;q>=i;i++){var n=i/q*E+S;Y.x=$*F(n),Y.z=-$*k(n);var t=new xe,G=$+h*F(l);t.x=G*F(n),t.z=-G*k(n),t.y=h*k(l),this.vertices.push(t),u.push(new Kj(i/q,1-y/X)),K.push(t.clone().sub(Y).normalize())}for(var y=1;X>=y;y++)for(var i=1;q>=i;i++){var N=(q+1)*y+i-1,_=(q+1)*(y-1)+i-1,b=(q+1)*(y-1)+i,C=(q+1)*y+i,D=new qk(N,_,C,[K[N].clone(),K[_].clone(),K[C].clone()]);this.faces.push(D),this.faceVertexUvs[0].push([u[N].clone(),u[_].clone(),u[C].clone()]),D=new qk(_,b,C,[K[_].clone(),K[b].clone(),K[C].clone()]),this.faces.push(D),this.faceVertexUvs[0].push([u[_].clone(),u[b].clone(),u[C].clone()])}this.computeFaceNormals()};Ak.prototype=ml(Qp);var js=function(G,V,w){return G?(Xg.call(this),G=G instanceof Array?G:[G],this.addShapeList(G,V),V.convertYZ!==!1&&Fq(this,w),this.computeFaceNormals(),void 0):(G=[],void 0)},se=js.prototype=ml(Xg.prototype);se.addShapeList=function(g,F){for(var p=g.length,v=0;p>v;v++){var B=g[v];this.addShape(B,F)}},se.addShape=function(U,g){function N(){if(g.bottom)for(var Y=0;m>Y;Y++)u=M[Y],x(u[2],u[1],u[0],!0);if(g.top)for(Y=0;m>Y;Y++)u=M[Y],x(u[0]+_*n,u[1]+_*n,u[2]+_*n,!1)}function O(){var I=0;for(Z(a,I),I+=a.length,w=0,B=Q.length;B>w;w++)E=Q[w],Z(E,I),I+=E.length}function Z($,y){for(var a,D,V=$.length;--V>=0;){a=V,D=V-1,0>D&&(D=$.length-1);var s=0,S=n;for(s=0;S>s;s++){var R=_*s,w=_*(s+1),T=y+a+R,A=y+D+R,e=y+D+w,j=y+a+w;F(T,A,e,j,$,s,S,a,D)}}}function D(w,n,J){k.vertices.push(new xe(w,n,J))}function x(C,q,V,T){C+=J,q+=J,V+=J,k.faces.push(new qk(C,q,V,null,null,T?2:1));var j=T?K.generateBottomUV(k,U,g,C,q,V):K.generateTopUV(k,U,g,C,q,V);k.faceVertexUvs[0].push(j)}function F(c,x,i,h,p,B,E,r,O){c+=J,x+=J,i+=J,h+=J,k.faces.push(new qk(c,x,h)),k.faces.push(new qk(x,i,h));var D=K.generateSideWallUV(k,U,p,g,c,x,i,h,B,E,r,O);k.faceVertexUvs[0].push([D[0],D[1],D[3]]),k.faceVertexUvs[0].push([D[1],D[2],D[3]])}var T,H,X,V,W,r=g.amount,p=g.curveSegments||Eq,n=g.steps||1,o=g.extrudePath,G=!1,K=new Pg(g.repeatUVLength,g.boundingBox);o&&(T=o.getSpacedPoints(n),G=!0,H=g.frames!==z?g.frames:new Bg.FrenetFrames(o,n,!1),X=new xe,V=new xe,W=new xe);var E,w,B,k=this,J=this.vertices.length,I=U.extractPoints(p),j=I.shape,Q=I.holes,h=!ih.isClockWise(j);if(h){for(j=j.reverse(),w=0,B=Q.length;B>w;w++)E=Q[w],ih.isClockWise(E)&&(Q[w]=E.reverse());h=!1}var M=ih.triangulateShape(j,Q),a=j;for(w=0,B=Q.length;B>w;w++)E=Q[w],j=j.concat(E);for(var L,u,_=j.length,m=M.length,A=0;_>A;A++)L=j[A],G?(V.copy(H.normals[0]).multiplyScalar(L.x),X.copy(H.binormals[0]).multiplyScalar(L.y),W.copy(T[0]).add(V).add(X),D(W.x,W.y,W.z)):D(L.x,L.y,0);var t;for(t=1;n>=t;t++)for(A=0;_>A;A++)L=j[A],G?(V.copy(H.normals[t]).multiplyScalar(L.x),X.copy(H.binormals[t]).multiplyScalar(L.y),W.copy(T[t]).add(V).add(X),D(W.x,W.y,W.z)):D(L.x,L.y,r/n*t);
N(),O()};var Bg=function(R,A,w,V,E){function t(f,S,B){return N.vertices.push(new xe(f,S,B))-1}Xg.call(this),A=A||64,w=w||1,V=V||8,E=E||!1;var J,n,o,q,L,h,b,M,C,_,s,Z,l,X,I,x,Q,Y,T,v,r=[],N=this,g=A+1,m=new xe,d=new Bg.FrenetFrames(R,A,E),c=d.tangents,S=d.normals,K=d.binormals;for(this.tangents=c,this.normals=S,this.binormals=K,C=0;g>C;C++)for(r[C]=[],q=C/(g-1),M=R.getPointAt(q),J=c[C],n=S[C],o=K[C],_=0;V>_;_++)L=_/V*f,h=-w*F(L),b=w*k(L),m.copy(M),m.x+=h*n.x+b*o.x,m.y+=h*n.y+b*o.y,m.z+=h*n.z+b*o.z,r[C][_]=t(m.x,m.y,m.z);for(C=0;A>C;C++)for(_=0;V>_;_++)s=E?(C+1)%A:C+1,Z=(_+1)%V,l=r[C][_],X=r[s][_],I=r[s][Z],x=r[C][Z],Q=new Kj(C/A,_/V),Y=new Kj((C+1)/A,_/V),T=new Kj((C+1)/A,(_+1)/V),v=new Kj(C/A,(_+1)/V),this.faces.push(new qk(l,X,x)),this.faceVertexUvs[0].push([Q,Y,v]),this.faces.push(new qk(X,I,x)),this.faceVertexUvs[0].push([Y.clone(),T,v.clone()]);this.computeFaceNormals(),this.computeVertexNormals()};Bg.prototype=ml(Qp),Bg.FrenetFrames=function(_,U,j){function A(){m[0]=new xe,T[0]=new xe,L=Number.MAX_VALUE,P=i(R[0].x),K=i(R[0].y),N=i(R[0].z),L>=P&&(L=P,g.set(1,0,0)),L>=K&&(L=K,g.set(0,1,0)),L>=N&&g.set(0,0,1),v.crossVectors(R[0],g).normalize(),m[0].crossVectors(R[0],v),T[0].crossVectors(R[0],m[0])}var c,L,P,K,N,t,O,g=new xe,R=[],m=[],T=[],v=new xe,z=new qc,n=U+1,E=1e-4;for(this.tangents=R,this.normals=m,this.binormals=T,t=0;n>t;t++)O=t/(n-1),R[t]=_.getTangentAt(O),R[t].normalize();for(A(),t=1;n>t;t++)m[t]=m[t-1].clone(),T[t]=T[t-1].clone(),v.crossVectors(R[t-1],R[t]),v.length()>E&&(v.normalize(),c=p(Lj(R[t-1].dot(R[t]),-1,1)),m[t].applyMatrix4(z.makeRotationAxis(v,c))),T[t].crossVectors(R[t],m[t]);if(j)for(c=p(Lj(m[0].dot(m[n-1]),-1,1)),c/=n-1,R[0].dot(v.crossVectors(m[0],m[n-1]))>0&&(c=-c),t=1;n>t;t++)m[t].applyMatrix4(z.makeRotationAxis(R[t],c*t)),T[t].crossVectors(R[t],m[t])};var Qd=function(W,p,E,G){Xg.call(this),p=p||18,E=E||0,G=G==I?f:G;for(var r=1/(W.length-1),D=1/p,v=0,q=p;q>=v;v++)for(var H=E+v*D*G,C=F(H),U=k(H),s=0,Z=W.length;Z>s;s++){var i=W[s],M=new xe;M.x=C*i.x-U*i.y,M.y=U*i.x+C*i.y,M.z=i.z,this.vertices.push(M)}for(var t=W.length,v=0,q=p;q>v;v++)for(var s=0,Z=W.length-1;Z>s;s++){var A=s+t*v,Q=A,b=A+t,C=A+1+t,Y=A+1,R=v*D,V=s*r,x=R+D,_=V+r;this.faces.push(new qk(Q,Y,b)),this.faceVertexUvs[0].push([new Kj(R,V),new Kj(R,_),new Kj(x,V)]),this.faces.push(new qk(b,Y,C)),this.faceVertexUvs[0].push([new Kj(x,V),new Kj(R,_),new Kj(x,_)])}this.mergeVertices(),Fq(this),this.computeFaceNormals(),this.computeVertexNormals()};Qd.prototype=ml(Qp);var ag=function(O,F){F=F||{};var r=kf.generateShapes(O,F);F.amount=F.amount!==z?F.amount:.5,F.convertYZ=!1,F.fill!==!1&&(F.bottom=!0,F.top=!0),js.call(this,r,F)};ag.prototype=ml(se);var nl=B.Node=function(){yd(nl,this)},Zn={X:Kf,Y:eh,Z:Ao},Uc={X:0,Y:1,Z:2},Ii={xyz:"XYZ",xzy:"XZY",yxz:"YXZ",yzx:"YZX",zxy:"ZXY",zyx:"ZYX"},zq=new Hm,Yc="xzy",Ml=function(T,f,Q){if(f){var l=f[0],C=f[1],L=f[2];"xzy"===Q?(eh(T,C),Ao(T,L),Kf(T,l)):"xyz"===Q?(Ao(T,L),eh(T,C),Kf(T,l)):"yxz"===Q?(Ao(T,L),Kf(T,l),eh(T,C)):"yzx"===Q?(Kf(T,l),Ao(T,L),eh(T,C)):"zxy"===Q?(eh(T,C),Kf(T,l),Ao(T,L)):"zyx"===Q?(Kf(T,l),eh(T,C),Ao(T,L)):(eh(T,C),Ao(T,L),Kf(T,l))}};$e("Node",If,{ms_ac:["rotationMode","anchorElevation"],ms_edge:!0,_adjustChildrenToTop:!0,_icon:"node_icon",_image:"node_image",_rotationMode:Yc,_64O:0,_rotationX:0,_53O:0,_host:I,_position:{x:0,y:0},_anchor:{x:.5,y:.5},_anchorElevation:.5,_scale:{x:1,y:1},_scaleTall:1,_54O:0,getUIClass:function(){return Kg},_22Q:function(){return kt},getX:function(){return this.p().x},setX:function(k){this.p(k,this.p().y)},getY:function(){return this.p().y},setY:function(k){this.p(this.p().x,k)},getAnchorX:function(){return this.getAnchor().x},setAnchorX:function(E){this.setAnchor(E,this.getAnchor().y)},getAnchorY:function(){return this.getAnchor().y},setAnchorY:function(E){this.setAnchor(this.getAnchor().x,E)},getScaleX:function(){return this.getScale().x},setScaleX:function(T){this.setScale(T,this.getScale().y)},getScaleY:function(){return this.getScale().y},setScaleY:function(F){this.setScale(this.getScale().x,F)},p:function(){return 0===arguments.length?this.getPosition():(this.setPosition.apply(this,arguments),this)},p3:function(){return 0===arguments.length?this.getPosition3d():(this.setPosition3d.apply(this,arguments),this)},s3:function(){return 0===arguments.length?this.getSize3d():(this.setSize3d.apply(this,arguments),this)},r3:function(){return 0===arguments.length?this.getRotation3d():(this.setRotation3d.apply(this,arguments),this)},setQuaternion:function(H){var E=(new vb).setFromQuaternion(H,vb.ReverseOrder(this.getRotationMode()));return this._applyClosestR3(E.x,E.y,E.z)},getQuaternion:function(){var Z=new vb,$=new vb,p=new Hm;return function(x){return x||(x=new Hm),this.getEuler(Z),Z.equals($)?x.copy(p):x.copy(p.setFromEuler($.copy(Z)))}}(),getEuler:function(D){var U=this.r3();return D||(D=new vb),D.set(U[0],U[1],U[2],vb.ReverseOrder(this.getRotationMode()))},setEuler:function(h){return h=h.clone().reorder(vb.ReverseOrder(this.getRotationMode())),this.r3(h.x,h.y,h.z)},t3:function(){return this.translate3d.apply(this,arguments),this},translate3dBy:function(T,h){Ee(T,Jg(I,I,this.r3(),this.getRotationMode())),this.translate3d(T[0]*h,T[1]*h,T[2]*h)},translateFront:function(d){this.translate3dBy([0,0,1],d)},translateBack:function(e){this.translate3dBy([0,0,-1],e)},translateLeft:function(z){this.translate3dBy([-1,0,0],z)},translateRight:function(k){this.translate3dBy([1,0,0],k)},translateTop:function(U){this.translate3dBy([0,1,0],U)},translateBottom:function(F){this.translate3dBy([0,-1,0],F)},getPosition3d:function(){return[this._position.x,this._54O,this._position.y]},setPosition3d:function(W,x,y){1===arguments.length&&(x=W[1],y=W[2],W=W[0]),this.p(W,y),this.setElevation(x)},translate3d:function(b,W,O){1===arguments.length&&(W=b[1],O=b[2],b=b[0]),this.translate(b,O),this.setElevation(this._54O+W)},getSize3d:function(){return[this.getWidth(),this.getTall(),this.getHeight()]},setSize3d:function(l,X,t){1===arguments.length&&(X=l[1],t=l[2],l=l[0]),this.setSize(l,t),this.setTall(X)},getRotation3d:function(){return[this._rotationX,-this._64O,this._53O]},setRotation3d:function(S,C,V){var F=this;if(!F._updatingRotation3d){F._updatingRotation3d=1,1===arguments.length&&(C=S[1],V=S[2],S=S[0]);var b=[F._rotationX,-F._64O,F._53O];F._rotationX=S,F._64O=-C,F._53O=V,F.fp("rotation3d",b,[S,C,V]),delete F._updatingRotation3d}},_applyClosestR3:function(){function p(k){return k%=f,0>k&&(k+=f),k>L?f-k:k}function B(W,c){return p(W[0]-c[0])+p(W[1]-c[1])+p(W[2]-c[2])}return function(G,K,i){var e,U,X,d=this.r3(),Y=this.getRotationMode();"xzy"===Y||"yzx"===Y?(e=G>0?G-L:G+L,U=K>0?K-L:K+L,X=i>0?L-i:-L-i):"xyz"===Y||"zyx"===Y?(e=G>0?G-L:G+L,X=i>0?i-L:i+L,U=K>0?L-K:-L-K):("yxz"===Y||"zxy"===Y)&&(X=i>0?i-L:i+L,U=K>0?K-L:K+L,e=G>0?L-G:-L-G),B([e,U,X],d)<B([G,K,i],d)?this.r3(e,U,X):this.r3(G,K,i)}}(),setRotationY:function(S){this.setRotation(-S)},getRotationY:function(){return-this._64O},lookAtDirection:function(s,b){b=b||Uj;var h=this,U=Jc(s);b===Uj?(h.r3([-n(s[1]/U),-Wd(s[2],s[0])+pk,0]),h.setRotationMode("xzy")):b===Dd?(h.r3(0,-Wd(s[2],s[0]),n(s[1]/U)),h.setRotationMode("zyx")):b===xi?(h.r3(0,-Wd(s[2],s[0])+L,-n(s[1]/U)),h.setRotationMode("zyx")):b===Vh?(h.r3([-n(s[1]/U)+pk,-Wd(s[2],s[0])+pk,0]),h.setRotationMode("xzy")):b===dd&&(h.r3([-n(s[1]/U)-pk,-Wd(s[2],s[0])+pk,0]),h.setRotationMode("xzy")),b===Xo&&(h.r3([-n(s[1]/U)+L,-Wd(s[2],s[0])+pk,L]),h.setRotationMode("zxy"))},lookAt:function(g,A){return this.lookAtDirection(Er(g,this.p3()),A)},lookAtX:function(){var P=new Xn,_=new Xn,g=new Xn,u=new qc,$=new qc,s=new vb;return function(H,x){var N=Zi(this);if(u.fromArray(N),g.copy(this.p3()),P.copy(H).sub(g),!(P.lengthSq()<1e-6)){P.normalize(),x=x||Uj,"string"==typeof x?x===Uj?_.set(0,0,1):x===Xo?_.set(0,0,-1):x===xi?_.set(-1,0,0):x===Dd?_.set(1,0,0):x===Vh?_.set(0,1,0):x===dd&&_.set(0,-1,0):_.copy(x).normalize(),_.applyMatrix4(u).sub(g).normalize();var w=Math.acos(P.dot(_));if(w){var q=P.clone().cross(_);q.lengthSq()<1e-6&&(x===Vh||x===dd||0===x[0]&&0===x[1]?q.set(0,0,1).applyMatrix4(u).sub(g):q.set(0,1,0).applyMatrix4(u).sub(g)),q.normalize(),s.set(this.r3(),this.getRotationMode(),!0),u.makeRotationFromEuler(s),$.makeRotationAxis(q,-w),s.setFromRotationMatrix($.multiply(u)),this._applyClosestR3(s.x,s.y,s.z)}}}}(),getHost:function(){return this._host},setHost:function(x){var M=this;if(M!==x&&M._host!==x){var C=M._host;C&&(C._removeAttach(M),C.updateLayoutAttaches()),M._host=x,M._host&&(M._host._addAttach(M),M._host.updateLayoutAttaches()),M.fp("host",C,x),M.onHostChanged(C,x)}},getAttaches:function(){return this._69O},_addAttach:function(K){var k=this;k._69O||(k._69O=new Gk),k._69O.add(K),k.fp("attaches",I,K)},_removeAttach:function(l){var H=this;H._69O.remove(l),H._69O.isEmpty()&&delete H._69O,H.fp("attaches",l,I)},getImage:function(){if(this._pendingCheckImageJSON){var i=R.getImage(this._image);i&&(this._pendingCheckImageJSON=!1,this.getParent()instanceof Ti&&this.getParent().checkPendingUpdateInfo())}return this._image},setImage:function(M){var p=this,f=p._image,s=p.getWidth(),t=p.getHeight();if(p._image=M,p.fp("image",f,M)){if(null!=M&&(Pd(M)||Fc(M)&&/\.json$/i.test(M))&&(this._pendingCheckImageJSON=!0),ol)return;p.fp(xo,s,p.getWidth()),p.fp(jc,t,p.getHeight())}},getElevation:function(){return this._54O},setElevation:function(Y){var M=this;if(!M._50O){M._50O=1;var q=M._54O;M._54O=Y,M.fp(Tl,q,Y),delete this._50O}},getRotation:function(){return this._64O},setRotation:function(r){var M=this;if(!M._49O){M._49O=1;var Z=M._64O;M._64O=r,M.fp(zh,Z,r),delete M._49O}},getRotationX:function(){return this._rotationX},setRotationX:function(p){var R=this;if(!R._51O){R._51O=1;var q=R._rotationX;R._rotationX=p,R.fp("rotationX",q,p),delete R._51O}},getRotationZ:function(){return this._53O},setRotationZ:function(W){var Q=this;if(!Q._52O){Q._52O=1;var x=Q._53O;Q._53O=W,Q.fp("rotationZ",x,W),delete Q._52O}},getPosition:function(){return this._position},setPosition:function(z,O){var M=this;if(!M._50I){M._50I=1;var X;if(X=2===arguments.length?{x:z,y:O}:z,X.x!==M._position.x||X.y!==M._position.y){var I=M._position;M._position=X,M.fp(qo,I,X)}delete M._50I}},translate:function(m,t){var W=this._position;this.p(W.x+m,W.y+t)},hasInheritedSize:function(){var l=this,S=l.getStyle("shape3d");if(S){var D=jm(S);if(D&&D.rawS3)return!0;if(("billboard"===S||"plane"===S)&&Td(l.getStyle("shape3d.image")))return!0}return l.hasOwnProperty("_image")&&Td(l._image)?!0:!1},getWidth:function(){var V=this;if(V._width>=0)return V._width;var s=V.getStyle("shape3d");if(s){var a=jm(s);if(a&&a.rawS3)return a.rawS3[0];if("billboard"===s||"plane"===s){var B=Td(V.getStyle("shape3d.image"));return B?nr(B,V):20}}var B=Td(V._image);return B?nr(B,V):20},setWidth:function(r){var k=this,P=k._width;k._width=r,k.fp(xo,P,r)},getHeight:function(){var h=this;if(h._height>=0)return h._height;var k=h.getStyle("shape3d");if(k){var L=jm(k);if(L&&L.rawS3)return L.rawS3[2];if("plane"===k){var q=Td(h.getStyle("shape3d.image"));return q?kd(q,h):20}if("billboard"===k)return 2}var q=Td(h._image);return q?kd(q,h):20},setHeight:function(t){var B=this,M=B._height;B._height=t,B.fp(jc,M,t)},getTall:function(){var X=this;if(X._tall>=0)return X._tall;var h=X.getStyle("shape3d");if(h){var A=jm(h);if(A&&A.rawS3)return A.rawS3[1];if("billboard"===h){var Q=Td(X.getStyle("shape3d.image"));return Q?kd(Q,X):20}if("plane"===h)return 2}return 20},setTall:function(K){var N=this,U=N._tall;N._tall=K,N.fp("tall",U,K)},setSize:function(Q,l){var b=this;2===arguments.length?(b.setWidth(Q),b.setHeight(l)):(b.setWidth(Q.width),b.setHeight(Q.height))},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},setRect:function(V,z,W,i,C){var j=this,d=j.getAnchor(),r=j.getScale();arguments.length<=2&&(C=z,z=V.y,W=V.width,i=V.height,V=V.x);var J=C&&r.x<0?1-d.x:d.x,o=C&&r.y<0?1-d.y:d.y;j.p(V+W*J,z+i*o),C&&(W/=Math.abs(r.x),i/=Math.abs(r.y)),j.setWidth(W),j.setHeight(i)},getMatrix:function(){var q=this,l=q._64O,G=q._position,L=q.getScale();return new Mc(l,G.x,G.y,L.x,L.y)},getMatrix4:function(){var m=new Xn,o=new Hm,s=new Xn;return function(c){return this.getQuaternion(o),m.copy(this.p3()),s.copy(this.getFinalScale3d()),c||(c=new qc),c.compose(m,o,s)}}(),getAnchorRect:function(){var G=this,S=G.getWidth(),I=G.getHeight(),U=G.getAnchor();return{x:-S*U.x,y:-I*U.y,width:S,height:I}},toLocal:function(K){return this.getMatrix().tfi(K)},toGlobal:function(K){return this.getMatrix().tf(K)},getAttachPosition:function(){var z=new Mc;return function(H,d,M,P){M=M||0,P=P||0;var C=this,I=C.getAnchor(),D=C._64O,i=C._position,J=C.getScale();return z.setFromTransform(D,i.x,i.y).tf({x:M+J.x*C.getWidth()*(H-I.x),y:P+J.y*C.getHeight()*(d-I.y)})}}(),isInRect:function($){$=this.toLocal($);var J=this.getWidth(),X=this.getHeight();return $.x+=J*this.getAnchorX(),$.y+=X*this.getAnchorY(),!($.x<0||$.y<0||$.x>J||$.y>X)},getRect:function(){var P=this,v=P.getWidth(),U=P.getHeight(),S=P.getAnchor(),$={x:-v*S.x,y:-U*S.y,width:v,height:U},x=P.getMatrix();return $=Gj([x.tf($.x,$.y),x.tf($.x+$.width,$.y),x.tf($.x+$.width,$.y+$.height),x.tf($.x,$.y+$.height)])},getAnchorElevation:function(){return this._anchorElevation},getAnchor3d:function(){var A=this,T=A.getAnchor(),s=A._anchorElevation;return{x:T.x,y:s,z:T.y}},setAnchorElevation:function(g){var E=this,M=E._anchorElevation;return M!==g?(E._anchorElevation=g,E.fp("anchorElevation",M,g),!0):!1},setAnchor3d:function(L,E,i,u){var C,Z=this;"number"==typeof L?C={x:L,y:E,z:i}:(C=L.length?{x:L[0],y:L[1],z:L[2]}:L,u=E),Z.beginTransaction();var W=Z.getAnchor3d(),x=Z.setAnchor(C.x,C.z);if(Z.setAnchorElevation(C.y)&&(x=!0),x&&u&&!ol){Z.getAnchor3d();var M=Zi(Z),S=Ee([C.x-W.x,C.y-W.y,C.z-W.z],M);Z.p3(S)}return Z.endTransaction(),x},getAnchor:function(){var f=this;if(f.hasOwnProperty("_anchor"))return f._anchor;var Y=Td(f._image);return Y&&Y.anchorX!==z?{x:Y.anchorX,y:Y.anchorY}:f._anchor},setAnchor:function(z,Q,d){var t,y=this;"number"==typeof z?t={x:z,y:Q}:(t=z.length?{x:z[0],y:z[1]}:z,d=Q);var N=y.getAnchor();if(N.x!==t.x||N.y!==t.y){if(y.beginTransaction(),y._anchor=t,y.fp("anchor",N,t),d&&!ol){var n=y.getPosition(),O=y.getSize(),a=y.getRotation(),E=y.getScale(),X=-O.width*(N.x-t.x)*E.x,u=-O.height*(N.y-t.y)*E.y,G=k(a),A=F(a);y.setPosition(n.x+A*X-G*u,n.y+G*X+A*u)}return y.endTransaction(),!0}return!1},getLocalQuaternion:function(z){var s=this,V=s.getHost();if(!V)return s.getQuaternion(z);var r=V.getQuaternion(),O=s.getQuaternion();return z||(z=new Hm),z.copy(r).inverse().multiply(O)},setLocalQuaternion:function(t){var O=this,J=O.getHost();if(!J)return O.setQuaternion(t);var V=J.getQuaternion();O.setQuaternion(V.clone().multiply(t))},getLocalEuler:function(){var X=new Hm;return function(j){var a=this,m=a.getHost();return m?(a.getLocalQuaternion(X),j||(j=new vb),j.setFromQuaternion(X,vb.ReverseOrder(this.getRotationMode()))):a.getEuler(j)}}(),setLocalEuler:function(){var d=new Hm;return function(v){var Q=this,T=Q.getHost();return T?(d.setFromEuler(v),Q.setLocalQuaternion(d)):Q.setEuler(v)}}(),getLocalPosition3d:function(d){var L=this;d||(d=new Xn),d.copy(L.p3());var v=L.getHost();if(!v)return d;var C=v.getMatrix4();return d.applyMatrix4(C.getInverse(C))},setLocalPosition3d:function(B){var e=this,J=e.getHost();if(!J)return B.x!==z?e.p3(B.x,B.y,B.z):e.p3(B),void 0;var O=J.getMatrix4(),o=new Xn(B);o.applyMatrix4(O),e.p3(o.x,o.y,o.z)},getScale:function(){return this._scale},setScale:function(J,e){var c,$=this;c=2===arguments.length?{x:J,y:e}:J;var W=$.getScale();(W.x!==c.x||W.y!==c.y)&&($._scale=c,$.fp("scale",W,c))},getScaleTall:function(){return this._scaleTall},getScale3d:function(){var N=this,E=N._scaleTall,V=N.getScale();return[V.x,E,V.y]},getFinalScale3d:function(){var r=this,J=r.s3(),P=r._dynamicScale3d,j=r.getScale3d();return J&&(j[0]*=J[0],j[1]*=J[1],j[2]*=J[2]),P&&(j[0]*=P[0],j[1]*=P[1],j[2]*=P[2]),j},getFinalRotation3d:function(){var n=this;return n._dynamicRotation||n.r3()},setScaleTall:function(w){var c=this,b=c._scaleTall;b!==w&&(c._scaleTall=w,c.fp("scaleTall",b,w))},setScale3d:function(U,Z,y){var s,T=this;s="number"==typeof U?{x:U,y:Z,z:y}:U.length?{x:U[0],y:U[1],z:U[2]}:U,T.setScaleTall(s.y),T.setScale(s.x,s.z)},getCorners:function(p,G){p==I&&(p=0),G==I&&(G=p);var D=this,E=D.getAnchor(),$=D.getWidth(),B=D.getHeight(),C=-$*E.x-p,r=-B*E.y-G,u=$+2*p,n=B+2*G,k=D.getMatrix();return[k.tf(C,r),k.tf(C,r+n),k.tf(C+u,r+n),k.tf(C+u,r)]},getEditControlPoints:function(G,n,H){n==I&&(n=0),H==I&&(H=n);var x=this,e=x.getAnchor(),U=x.getWidth(),c=x.getHeight(),B=-U*e.x-n,S=-c*e.y-H,A=U+2*n,K=c+2*H;if(G)return[{x:B,y:S},{x:B,y:0},{x:B,y:S+K},{x:0,y:S+K},{x:B+A,y:S+K},{x:B+A,y:0},{x:B+A,y:S},{x:0,y:S}];var F=x.getMatrix();return[F.tf(B,S),F.tf(B,0),F.tf(B,S+K),F.tf(0,S+K),F.tf(B+A,S+K),F.tf(B+A,0),F.tf(B+A,S),F.tf(0,S)]},rotateAt:function(P,C,g){var Q=this,U=Q._position,M=Q._64O,J=new Mc(M,U.x,U.y).tf(P,C),d=a(P*P+C*C),H=Wd(U.y-J.y,U.x-J.x)+g;Q.setRotation(M+g),Q.p(J.x+d*F(H),J.y+d*k(H))},rotateAroundAxis:function(A,b){this.setQuaternion(this.getQuaternion().multiply(zq.setFromAxisAngle(A,b)))},rotateAroundWorldAxis:function(Z,N){this.setQuaternion(this.getQuaternion().premultiply(zq.setFromAxisAngle(Z,N)))},rotateX:function(D){return this.rotateAroundAxis(Xn.AxisX,D)},rotateY:function(T){return this.rotateAroundAxis(Xn.AxisY,T)},rotateZ:function(w){return this.rotateAroundAxis(Xn.AxisZ,w)},onParentChanged:function(){nl.superClass.onParentChanged.apply(this,arguments),this._8I()},onPropertyChanged:function(){var k={};return"width|height|position|anchor|rotation|scale|s:layout.h|s:layout.v".split("|").forEach(function(g){k[g]=!0}),function(B){var A=this;nl.superClass.onPropertyChanged.call(A,B);var n=B.property;if(k[n]&&!A._layoutUpdating&&A.updateLayoutParameters(null,n),A._69O&&A._69O.each(function(j){j.handleHostPropertyChange(B)}),A._49I&&A._49I.each(function(P){P.fp("agentChange",!0,!1)}),Kb[n]&&this.updateLayoutAttaches(),"a:layout"===n.substring(0,8)){this.updateLayoutAttaches();var t=A._host;t&&t.updateLayoutAttaches()}("s:shape3d.autorotate"===n||"s:autorotate"===n||"s:shape3d.fixSizeOnScreen"===n||"s:fixSizeOnScreen"===n||"s:hide.overlapping.group"===n)&&(A._47Q=A.s("autorotate")||A.s("shape3d.autorotate")||A.s("fixSizeOnScreen")||A.s("shape3d.fixSizeOnScreen")||A.s("hide.overlapping.group"))}}(),onHostChanged:function(){this.updateAttach(),this.updateLayoutParameters()},handleHostPropertyChange:function(U){this.updateAttach(U)},onStyleChanged:function(e){nl.superClass.onStyleChanged.apply(this,arguments),aq[e]&&this.updateAttach()},updateLayoutAttaches:function(){if(!ol&&this.s("vector.layoutable")){var U,o,l=this;return U=Td(l.getImage()),U&&U.layoutAttach&&(o=U.layoutAttach,o&&o(l))?!0:void 0}},updateAttach:function(C){var Q=this;return ol?(Q.updateLayoutParameters(),void 0):(Q._51I||(Q._51I=1,Q._71O(C),delete Q._51I),void 0)},_71O:function(q){var J,O,i,r,$,W,M=this,Q=M._host,K=q?q.property:I,n=q?q.oldValue:I,t=q?q.newValue:I;if(Q instanceof nl&&(!q||Kb[K])){var G;if(G=Td(Q.getImage()),G&&G.layoutAttach)return}if(Q instanceof B.Grid){if(K===Tl)M.setElevation(M._54O+t-n);else if(!q||lq[K]){if(J=M.s("attach.row.index"),O=M.s("attach.column.index"),i=Q.getCellRect(J,O),!i)return;r=M.s("attach.row.span"),$=M.s("attach.column.span"),(1!==r||1!==$)&&(i=xr(i,Q.getCellRect(J+r-1,O+$-1))),vh(i,M,"attach.padding",1),M.setRect(i)}}else if(Q instanceof gi&&(W=M.s("attach.index"))>=0&&(!q||uq[K])){var E=M.s("attach.thickness"),V=Q.getScale(),S=Math.max(V.x,V.y);E>0&&M.setHeight(Q.getThickness()*E*S);var A=M.s("attach.offset"),d=Q.getPoints(),h=d.size();if(h>W){var Z=Q.getPointsMatrix2d(),c=d.get(W),y=h===W+1?d.get(0):d.get(W+1);c=Z.apply(c),y=Z.apply(y);var p=[y.x-c.x,y.y-c.y],P=Jc(p);if(P){M.s("attach.offset.relative")&&(A*=P),M.s("attach.offset.opposite")&&(A=P-A);var l={x:c.x+p[0]/P*A,y:c.y+p[1]/P*A},L=M.s("attach.gap");L&&(M.s("attach.gap.relative")&&(L*=Q.getThickness()*S),l=am(I,l,y,L)),M.p(l),M.setRotation(Wd(p[1],p[0]))}}}else q&&(K===qo?M.translate(t.x-n.x,t.y-n.y):K===Tl?M.setElevation(M._54O+t-n):Un[K]?"rotation3d"===K?M.syncRotation3d(Q,t,n):M._11Q(Q,K,t-n):("anchor"===K||"width"===K||"height"===K||"scale"===K)&&M.layout(Q))},_11Q:function(){var G=new B.Math.Euler,t=B.Math.Euler.ReverseOrder,p=new B.Math.Vector2,a=new B.Math.Vector2;return function(P,R,d){var s=this,W=P.p3(),K=P.r3(),Q=s.p3(),M=s.r3();if(R===zh&&(R="rotationY",d=-d),(R===zh||"rotationY"===R)&&0===M[0]&&0===M[2]&&0===K[0]&&0===K[2]&&0===Q[1]&&0===W[1])return s.setRotation(-M[1]-d),p.set(Q[0],Q[2]).rotateAround(a.set(W[0],W[2]),-d),s.p(p.x,p.y),void 0;var z=Ii[P.getRotationMode()],C=z[0],v=z[1],Y=z[2],w=Zn[C],e=Zn[v],m=Zn[Y],Z=an();R===zh+C?(m(Z,K[Uc[Y]]),e(Z,K[Uc[v]]),w(Z,d),e(Z,-K[Uc[v]]),m(Z,-K[Uc[Y]])):R===zh+v?(m(Z,K[Uc[Y]]),e(Z,d),m(Z,-K[Uc[Y]])):R===zh+Y&&m(Z,d);var X=Er(Q,W);Ee(X,Z),s.p3(W[0]+X[0],W[1]+X[1],W[2]+X[2]);var h=s.getRotationMode();Ml(Z,s.r3(),h),G.setFromRotationMatrix(Z,t(h)),s.r3([G.x,G.y,G.z])}}(),syncRotation3d:function(){var K=new Hm,s=new vb,d=new Xn;return function(S,V,R){var U=this;if(R[0]!==V[0]||R[1]!==V[1]||R[2]!==V[2]){var p=vb.ReverseOrder(S.getRotationMode());zq.setFromEuler(s.set(R[0],R[1],R[2],p)),K.setFromEuler(s.set(V[0],V[1],V[2],p)),K.multiply(zq.inverse());var j=S.p3(),b=U.p3();d.set(b[0]-j[0],b[1]-j[1],b[2]-j[2]).applyQuaternion(K),U.p3(j[0]+d.x,j[1]+d.y,j[2]+d.z),U.setQuaternion(U.getQuaternion(zq).premultiply(K))}}}(),isHostOn:function(r){var S=this;if(S._host&&r&&r._69O)for(var Q={},E=S._host;E&&E!==S&&!Q[E._id];){if(E===r)return!0;Q[E._id]=E,E=E._host}return!1},isLoopedHostOn:function(e){return this.isHostOn(e)&&e.isHostOn(this)},getScaledSize:function(){var G=this.getSize(),u=this.getScale();return G.width*=Math.abs(u.x),G.height*=Math.abs(u.y),G},layout:function(U){if(U=U||this.getHost()){var A=this,b=A.s("layout.h")||"center",f=A.s("layout.v")||"center";if("center"!==b||"center"!==f){var d=new B.Math.Vector2,l=U.getPosition(),c=U.getAnchor(),R=U.getScaledSize();A.getPosition();var i,H,E,W,K,s=1,M=1;switch(A._layoutUpdating=!0,b){case"left":d.setX(A._layoutHValue-c.x*R.width);break;case"right":d.setX((1-c.x)*R.width-A._layoutHValue);break;case"leftright":i=R.width-A._layoutHValue[2],E=A.getRotation()-U.getRotation(),W=Math.abs(Math.sin(E)),K=Math.abs(Math.cos(E)),s+=K*i/A._layoutHValue[3],M+=W*i/A._layoutHValue[4],d.setX(A._layoutHValue[1]+(A._layoutHValue[5]-c.x)*R.width);break;case"center":d.setX((.5-c.x)*R.width-A._layoutHValue);break;case"scale":E=A.getRotation()-U.getRotation(),W=Math.abs(Math.sin(E)),K=Math.abs(Math.cos(E)),d.setX((.5-c.x)*R.width-A._layoutHValue[1]*R.width/A._layoutHValue[0]),H=R.width/A._layoutHValue[2]-1,s+=K*H,M+=W*H}switch(f){case"top":d.setY(A._layoutVValue-c.y*R.height);break;case"bottom":d.setY((1-c.y)*R.height-A._layoutVValue);break;case"topbottom":E||(E=A.getRotation()-U.getRotation(),W=Math.abs(Math.sin(E)),K=Math.abs(Math.cos(E))),i=R.height-A._layoutVValue[2],s+=W*i/A._layoutVValue[3],M+=K*i/A._layoutVValue[4],d.setY(A._layoutVValue[1]+(A._layoutVValue[5]-c.y)*R.height);break;case"center":d.setY((.5-c.y)*R.height-A._layoutVValue);break;case"scale":E||(E=A.getRotation()-U.getRotation(),W=Math.abs(Math.sin(E)),K=Math.abs(Math.cos(E))),d.setY((.5-c.y)*R.height-A._layoutVValue[1]*R.height/A._layoutVValue[0]),H=R.height/A._layoutVValue[2]-1,s+=W*H,M+=K*H}if("leftright"===b||"scale"===b||"topbottom"===f||"scale"===f){var P=this.getScale(),e=Math.abs(P.x),g=Math.abs(P.y);"leftright"===b||"scale"===b?A.setSize(A._layoutHValue[3]*s/e,A._layoutHValue[4]*M/g):A.setSize(A._layoutVValue[3]*s/e,A._layoutVValue[4]*M/g)}d.rotateAround(null,U.getRotation()),this.setPosition(d.x+l.x,d.y+l.y),A._layoutUpdating=z}}},updateLayoutParameters:function(b,F){if(b=b||this.getHost()){var T=this,o=T.s("layout.h"),P=T.s("layout.v");if(o||P){var R,e,I,a,V,D,w=new B.Math.Vector2,m=b.getPosition(),p=b.getAnchor(),L=b.getScaledSize(),x=T.getPosition(),Y=T.getScaledSize();switch(w.set(x.x-m.x,x.y-m.y),w.rotateAround(null,-b.getRotation()),o){case"left":T._layoutHValue=w.x+p.x*L.width;break;case"right":T._layoutHValue=-w.x+(1-p.x)*L.width;break;case"center":T._layoutHValue=-w.x+(.5-p.x)*L.width;break;case"leftright":case"scale":"scale"===o?R=-w.x+(.5-p.x)*L.width:(e=T.getAnchor(),I=T.getRotation()-b.getRotation(),a=Math.cos(I),V=Math.sin(I),D=-Math.min(-e.x*a+e.y*V,-e.x*a-(1-e.y)*V,(1-e.x)*a+e.y*V,(1-e.x)*a-(1-e.y)*V),R=w.x-(D-p.x)*L.width),"position"===F&&"object"==typeof T._layoutHValue?(T._layoutHValue[0]=L.width,T._layoutHValue[1]=R):T._layoutHValue=[L.width,R,L.width,Y.width,Y.height,D]}switch(P){case"top":T._layoutVValue=w.y+p.y*L.height;break;case"bottom":T._layoutVValue=-w.y+(1-p.y)*L.height;break;case"center":T._layoutVValue=-w.y+(.5-p.y)*L.height;break;case"topbottom":case"scale":"scale"===P?R=-w.y+(.5-p.y)*L.height:(I||(e=T.getAnchor(),I=T.getRotation()-b.getRotation(),a=Math.cos(I),V=Math.sin(I)),D=-Math.min(-e.x*V-e.y*a,-e.x*V+(1-e.y)*a,(1-e.x)*V-e.y*a,(1-e.x)*V+(1-e.y)*a),R=w.y-(D-p.y)*L.height),"position"===F&&"object"==typeof T._layoutVValue?(T._layoutVValue[0]=L.height,T._layoutVValue[1]=R):T._layoutVValue=[L.height,R,L.height,Y.width,Y.height,D]}}}},getSerializableProperties:function(){var K=nl.superClass.getSerializableProperties.call(this);return Wn(K,{image:1,host:1,rotation:1,rotationX:1,rotationZ:1,rotationMode:1,position:1,anchor:1,anchorElevation:1,scale:1,scaleTall:1,_width:1,_height:1,_tall:1,elevation:1}),K}});var Qb=B.Edge=function(x,s){var y=this;yd(Qb,y),y.setSource(x),y.setTarget(s)};$e("Edge",If,{ms_edge:!0,_icon:"edge_icon",getUIClass:function(){return Xd},_22Q:function(){return mt},getSource:function(){return this._source},getTarget:function(){return this._target},getSourceAgent:function(){return this._40I},getTargetAgent:function(){return this._41I},canSetSourceTarget:function(G){if(G===this)return!1;if(Dg(G))return!0;for(var y,L,F,M,s,n=[this],S=-1,m=0;m>S;)if(S++,y=n[S],L=y._44I)for(L=L.getArray(),M=0,s=L.length;s>M;M++)if(F=L[M],kh(F)&&!(n.indexOf(F)>=0)){if(F===G)return!1;n.push(F),m++}return!0},setSource:function(E){var G=this;if(G._source!==E&&G.canSetSourceTarget(E)){var m=G._source;G._source=E,m&&m._16I(G),E&&E._2I(G),G._7I(),G.fp("source",m,E)}},setTarget:function(d){var Y=this;if(Y._target!==d&&Y.canSetSourceTarget(d)){var I=Y._target;Y._target=d,I&&I._18I(Y),d&&d._4I(Y),Y._7I(),Y.fp("target",I,d)}},isLooped:function(){var k=this;return k._source===k._target&&Dg(k._source)&&Dg(k._target)},onPropertyChanged:function(){var w={};return["source","target","sourceAgent","targetAgent","edgeGroup","agentChange","s:edge.width","s:edge.type","s:edge.offset","s:edge.center","s:edge.points","s:edge.segments","s:edge.gap","s:edge.source.t3","s:edge.target.t3","s:edge.color","s:edge.gradient.color","s:edge.pattern","s:edge.dash","s:edge.dash.color","s:edge.dash.pattern","s:edge.dash.offset","s:edge.dash","s:edge.dash","s:repeat.uv.length","s:body.color","s:shape3d","s:shape3d.visible","s:shape3d.image","s:shape3d.smooth","s:shape3d.resolution","s:shape3d.color","s:shape3d.blend","s:shape3d.side","s:shape3d.start.angle","s:shape3d.sweep.angle","s:shape3d.top.cap","s:shape3d.top.image","s:shape3d.top.visible","s:shape3d.top.color","s:shape3d.bottom.cap","s:shape3d.bottom.image","s:shape3d.bottom.visible","s:shape3d.bottom.color","s:shape3d.from.visible","s:shape3d.from.color","s:shape3d.to.visible","s:shape3d.to.color","s:shape3d.uv.union"].forEach(function(e){w[e]=!0}),function(I){var U=this;U._49I&&U._49I.each(function(A){A.fp("agentChange",!0,!1)}),("s:alwaysOnTop"===I.property||"s:shape3d.alwaysOnTop"===I.property)&&(I.newValue?this.setRenderLayer("top"):this.setRenderLayer(z)),w[I.property]&&(this._needChangeGeometry=!0)}}(),_7I:function(){var J,R=this,c=Ij(R);R._40I!==c&&(J=this._40I,J&&J._15I(R),R._40I=c,c&&c._1I(R),R.fp("sourceAgent",J,c),Gf(J,R._41I),Gf(c,R._41I));var D=Mi(R);R._41I!==D&&(J=R._41I,J&&J._17I(R),R._41I=D,D&&D._3I(R),R.fp("targetAgent",J,D),Gf(J,R._40I),Gf(D,R._40I))},_22I:function(j){this._52I=j,this.fp("edgeGroup",!0,!1)},getEdgeGroup:function(){return this._52I},isEdgeGroupHidden:function(){var d=this;return d._52I&&d._52I.get(0)!==d&&!d.getStyle(pi)},getEdgeGroupSize:function(){return this._52I?this._52I.size():1},getEdgeGroupIndex:function(){return this._52I?this._52I.indexOf(this):0},isEdgeGroupAgent:function(){var E=this,I=E._52I;return I&&!E.getStyle(pi)&&I.size()>1&&E===I.get(0)},toggle:function(){this.beginTransaction();var a=this._52I,f=!this.s(pi);a&&a.size()>1&&(a.each(function(y){y.s(pi,f)}),a.getSiblings().each(function(d){d!==a&&d.each(function(D){D.fp("edgeGroup",I,d)})})),this.endTransaction()},setStyle:function(w,E){(w===Sd||"edge.segments"===w)&&(E=zk(E)),Qb.superClass.setStyle.call(this,w,E)},onStyleChanged:function(i){Qb.superClass.onStyleChanged.apply(this,arguments),qr[i]&&Gf(this._41I,this._40I)},getSerializableProperties:function(){var N=Qb.superClass.getSerializableProperties.call(this);return Wn(N,{source:1,target:1}),N}});var we=B.Group=function(){yd(we,this)};$e("Group",nl,{_image:"group_image",_icon:"group_icon",_57O:!1,getUIClass:function(){return dk},onChildAdded:function(){we.superClass.onChildAdded.apply(this,arguments),this._81I()},onChildRemoved:function(){we.superClass.onChildRemoved.apply(this,arguments),this._81I()},_81I:function(){var I=this;if(!I._54I&&!ol){var S=I.getChildrenRect();S&&(I._53I=1,I.p(Xc(I.s("group.position"),S,I.getSize())),delete I._53I)}},getChildrenRect:function(){var A,Z=this;return Z.eachChild(function(h){Dg(h)&&(A=xr(A,Z.getChildRect(h)))}),A},getChildRect:function(S){var s;return Dg(S)&&S.s(Uo)&&(wp(S)&&S.isExpanded()&&S.eachChild(function(E){s=xr(s,S.getChildRect(E))}),!s&&S.getRect&&(s=S.getRect())),s},setPosition:function(O,l){var M=this;if(!M._54I){var c;c=2===arguments.length?{x:O,y:l}:O,ol||M._53I||(M._54I=1,wf(M._children,c.x-M._position.x,c.y-M._position.y),delete M._54I),we.superClass.setPosition.call(this,c)}},toggle:function(){this.setExpanded(!this.isExpanded())},isExpanded:function(){return this._57O},setExpanded:function(I){var v=this;if(v._57O!==I){var q=v._57O;v._57O=I,v.fp("expanded",q,v._57O),v._fireInvalidateDeep(),v._8I()}},_fireInvalidateDeep:function(){this.eachChild(function(k){wp(k)?k._fireInvalidateDeep():k.iv()})},_8I:function(){we.superClass._8I.call(this),this.eachChild(function(Y){Dg(Y)&&Y._8I()})},onStyleChanged:function(Y){we.superClass.onStyleChanged.apply(this,arguments),"group.position"===Y&&this._81I()},getSerializableProperties:function(){var Q=we.superClass.getSerializableProperties.call(this);return Q.expanded=1,Q}});var jb=B.Camera=function(){yd(jb,this),this.s({"shadow.cast":!1,"shadow.receive":!1,shape3d:"billboard"}),this._viewMatrix=new jl.Matrix4,this._projectMatrix=new jl.Matrix4,this.setScale3d(1,1,-1),this._projectMatrixDirty=!0};jb.CubeDirectionParam=[1,0,0,0,-1,0,-1,0,0,0,-1,0,0,1,0,0,0,1,0,-1,0,0,0,-1,0,0,1,0,-1,0,0,0,-1,0,-1,0],$e("Camera",nl,{ms_ac:["cullingMask"],_cullingMask:3,_22Q:function(){return Camera3dUI},attachRenderTarget:function(i){this._projectMatrixDirty=!0,this.renderTarget=i},detachRenderTarget:function(){this._projectMatrixDirty=!0,this.renderTarget=null},isLayerVisible:function(W){return Qo(this._cullingMask,W)},isOrtho:function(){return"ortho"===this.s("camera.type")&&!this.isCube()},isCube:function(){return this.renderTarget&&this.renderTarget.isCube()},isPerspective:function(){return!this.isOrtho()},setViewMatrix:function(){var j=new B.Math.Matrix4,f=new B.Math.Euler;return function(l){var O=this;l.isMatrix4?O._viewMatrix.copy(l):O._viewMatrix.fromArray(l),j.getInverse(O._viewMatrix),O.p3(j.getPosition().toArray()),f.set(0,0,0,O.getRotationMode(),!0).setFromRotationMatrix(j),O.r3([f.x,f.y,f.z])}}(),getViewMatrix:function(e){var m=this,O=Jg(null,null,m.r3(),m.getRotationMode(),m.p3()),f=m._viewMatrix;return f.fromArray(O).getInverse(f),f.toArray(e)},setProjectMatrix:function(q){var v=this;q.isMatrix4?v._projectMatrix.copy(q):v._projectMatrix.fromArray(q),q=v._projectMatrix.getElements(),v.isOrtho()?v.s({"camera.near":(q[14]+1)/q[10],"camera.far":(q[14]-1)/q[10],"camera.ortho.width":2/q[0]}):v.s({"camera.near":q[14]/(q[10]-1),"camera.far":q[14]/(q[10]+1),"camera.fovy":2*Math.atan(1/q[5]),"camera.aspect":q[5]/q[0]}),v._projectMatrixDirty=!1
},onPropertyChanged:function(N){var j=this;jb.superClass.onPropertyChanged.call(j,N);var L=N.property;("s:camera.near"===L||"s:camera.far"===L||"s:camera.fovy"===L||"s:camera.aspect"===L||"s:camera.ortho.width"===L)&&(j._projectMatrixDirty=!0)},getProjectMatrix:function(){var Y=this;if(Y._projectMatrixDirty){var $=Y.gv,B=Y.isCube(),F=B?1:Y.s("camera.aspect")||($?$.getAspect():null)||R.graph3dViewAspect,w=Y.s("camera.near")||($?$.getNear():null)||R.graph3dViewNear,s=Y.s("camera.far")||($?$.getFar():null)||R.graph3dViewFar,u=an();if(Y.isOrtho()){var C=Y.s("camera.ortho.width")||($?$.getOrthoWidth():null)||R.graph3dViewOrthoWidth,b=C/2,V=b/F;ap(u,-b,b,-V,V,w,s)}else{var M=B?Math.PI/2:Y.s("camera.fovy")||($?$.getFovy():null)||R.graph3dViewFovy;Kr(u,M,F,w,s)}Y._projectMatrix.fromArray(u),Y._projectMatrixDirty=!1}return Y._projectMatrix.toArray()},lookAt:function(O,e){var o=this.p3();return O.x?this.lookAtDirection([O.x-o[0],O.y-o[1],O.z-o[2]],e):this.lookAtDirection([O[0]-o[0],O[1]-o[1],O[2]-o[2]],e)},lookAtDirection:function(){var k=new B.Math.Matrix4,Z=new B.Math.Euler,R=new B.Math.Vector3,m=new B.Math.Vector3;return function(t,M){k.lookAtDirection(R.copy(t).multiplyScalar(-1),M?m.copy(M):m.set(0,1,0)),Z.set(0,0,0,this.getRotationMode(),!0).setFromRotationMatrix(k),this.r3([Z.x,Z.y,Z.z])}}(),updateAndRender:function(d){return d.syncRenderState(),d.updateScene(),this.render(d)},render:function(k){var Q=this,y=k.getGL();if(!y)return!1;var X,e,_=Q.renderTarget;if(_)X=_.width,e=_.height;else{var B=k.getDevicePixelRatio();X=k.getWidth()*B,e=k.getHeight()*B}Q.gv=k,k._camera=Q,k._18Q=null;var a=k._frameState.renderState.glState,w=a.color.clear.slice(0);go(y,Q.s("camera.background"));var G=k.getEye;if(k.getEye=function(){return Q.p3()},Q.isCube())for(var r=jb.CubeDirectionParam,o=0;6>o;o++)_&&_.bind(y,o),Q.lookAtDirection([r[6*o+0],r[6*o+1],r[6*o+2]],[r[6*o+3],r[6*o+4],r[6*o+5]]),Q.s("camera.clear")!==!1&&y.clear(y.COLOR_BUFFER_BIT),k.setViewport(y,0,0,X,e),Q.s("camera.onlySky")?k.renderSky():k.renderScene({renderAxis:Q.s("camera.renderAxis"),renderGrid:Q.s("camera.renderGrid"),renderEdit:Q.s("camera.renderEdit"),renderReflector:!1}),_&&_.unbind(y);else _&&_.bind(y),Q.s("camera.clear")!==!1&&y.clear(y.COLOR_BUFFER_BIT),k.overlappingBox.clear(),k.setViewport(y,0,0,X,e),Q.s("camera.onlySky")?k.renderSky():k.renderScene({renderAxis:Q.s("camera.renderAxis"),renderGrid:Q.s("camera.renderGrid"),renderEdit:Q.s("camera.renderEdit")}),_&&_.unbind(y);return k.getEye=G,go(y,w),k._18Q=null,k._camera=null,Q.gv=null,!0}});var Xl=B.Block=function(){yd(Xl,this),this.s({"shadow.cast":!1,"shadow.receive":!1})};$e("Block",nl,{_icon:"block_icon",_clickThroughEnabled:!1,_syncSize:!0,_scaleMode:"2d",ms_ac:["clickThroughEnabled","syncSize","scaleMode"],getUIClass:function(){return ic},_22Q:function(){return lt},onChildAdded:function(){Xl.superClass.onChildAdded.apply(this,arguments),this.updateFromChildren()},onChildRemoved:function(){Xl.superClass.onChildRemoved.apply(this,arguments),this.updateFromChildren()},_getBoundingBox:function(){function c(V,R,A){k.fromArray(Zi(R));var p=R.getAnchor3d();V.push((new Xn).set(0-p.x,0-p.y,0-p.z).applyMatrix4(k).applyMatrix4(A)),V.push((new Xn).set(0-p.x,0-p.y,1-p.z).applyMatrix4(k).applyMatrix4(A)),V.push((new Xn).set(0-p.x,1-p.y,0-p.z).applyMatrix4(k).applyMatrix4(A)),V.push((new Xn).set(0-p.x,1-p.y,1-p.z).applyMatrix4(k).applyMatrix4(A)),V.push((new Xn).set(1-p.x,0-p.y,0-p.z).applyMatrix4(k).applyMatrix4(A)),V.push((new Xn).set(1-p.x,0-p.y,1-p.z).applyMatrix4(k).applyMatrix4(A)),V.push((new Xn).set(1-p.x,1-p.y,0-p.z).applyMatrix4(k).applyMatrix4(A)),V.push((new Xn).set(1-p.x,1-p.y,1-p.z).applyMatrix4(k).applyMatrix4(A))}function Q(F,O){var Z=(new qc).makeRotationFromEuler(this.getEuler()).setPosition((new Xn).fromArray(this.p3()));Z.getInverse(Z),F.forEach(function(a){Dg(a)&&c(O,a,Z)})}var k=new qc;return function(g,u){if(g instanceof nl&&(g=[g]),!g||0===g.length)return I;var u=[];Q.call(this,g,u);var U=[1/0,1/0,1/0],D=[-1/0,-1/0,-1/0];return u.forEach(function(w){U[0]=Math.min(w.x,U[0]),U[1]=Math.min(w.y,U[1]),U[2]=Math.min(w.z,U[2]),D[0]=Math.max(w.x,D[0]),D[1]=Math.max(w.y,D[1]),D[2]=Math.max(w.z,D[2])}),{min:U,max:D}}}(),updateFromChildren:function(){var C=this;if(!ol&&!C._updatingToChildren&&C._syncSize&&0!==C.size()&&!C._freezeSyncFromChildren){var w=this._getBoundingBox(C.toChildren(Dg));if(w){C._updatingFromChildren=1;var c=(new Xn).fromArray(this.getScale3d()),s=(new Xn).fromArray(w.min),e=(new Xn).fromArray(w.max),V=R.blockMinSize,v=new Xn,p=e.clone().sub(s);0===p.x&&v.setX(.5),0===p.y&&v.setY(.5),0===p.z&&v.setZ(.5);var $=this._width==I||-1===this._width,l=new Xn(this.getAnchor3d()),K=c.clone().multiply((new Xn).fromArray(this.s3())),k=p.clone();0===k.x&&k.setX(V),0===k.y&&k.setY(V),0===k.z&&k.setZ(V);var o=l.clone().multiply(K),n=o.clone().multiplyScalar(-1).sub(s).divide(k).add(o.divide(k)).add(v),Y=this.s("keepPosition");if($||this._anchorChanged||this._scaleChanged||!Y){!$&&Y&&(l=n);var x=l.clone().multiply(p).add(s).applyEuler(this.getEuler()).add((new Xn).fromArray(this.p3()));this.p3([x.x,x.y,x.z])}else this.setAnchor3d(n.x,n.y,n.z);var b=new Xn(1,1,1).divide(c).multiply(p);this.s3(Math.abs(b.x),Math.abs(b.y),Math.abs(b.z)),delete C._updatingFromChildren}}},setPosition:function(h,B){var c=this;if(!c._updatingToChildren){var t;t=2===arguments.length?{x:h,y:B}:h,ol||c._updatingFromChildren||(c._updatingToChildren=1,wf(c._children,t.x-c._position.x,t.y-c._position.y),delete c._updatingToChildren),Xl.superClass.setPosition.call(this,t)}},setSize3d:function(){this.beginTransaction(),Xl.superClass.setSize3d.apply(this,arguments),this.endTransaction()},setTall:function(e){var b=this;if(!b._updatingToChildren){this.beginTransaction(),e=o(e,R.blockMinSize);var U=b.getTall();if(e!==U&&Xl.superClass.setTall.call(b,e),!ol&&!b._updatingFromChildren){b._updatingToChildren=1;var Z=e/U;b._adjustChildTallOrScale(Z,"size"),delete b._updatingToChildren,b.updateFromChildren()}this.endTransaction()}},setWidth:function(F){return this.setSize(F,this.getHeight())},setHeight:function(b){return this.setSize(this.getWidth(),b)},setSize:function(V,z){var B=R.blockMinSize;V=o(V,B),z=o(z,B);var H=this;if(!H._updatingToChildren){2!==arguments.length&&(z=V.height,V=V.width),this.beginTransaction();var u=H.getWidth(),Y=H.getHeight();if(V!==u&&Xl.superClass.setWidth.call(H,V),z!==Y&&Xl.superClass.setHeight.call(H,z),!ol&&!H._updatingFromChildren){H._updatingToChildren=1;var E=V/u,v=z/Y;H._adjustChildScaleOrSize(E,v,"size"),delete H._updatingToChildren,H.updateFromChildren()}this.endTransaction()}},_adjustChildScaleOrSize:function($,b,p){var w=this;if(w._syncSize){var W=w.getPosition(),x=w.getRotation();w.eachChild(function(Z){if(Dg(Z)){var U=Z.getPosition(),Y=Z.getRotation(),d=Z.getWidth(),L=Z.getHeight(),T=Z.getScale(),f=T.x*d,X=T.y*L;if(0!==f&&0!==X){0>$*b&&Z.setRotation(-1*Y);var H=new Mc(Y,U.x,U.y,f,X);H.translate(-W.x,-W.y),H.rotate(-x),Y=Wd(H.b*Math.sign(f),H.a*Math.sign(f)),H.scale($,b);var j,y,m,v=F(Y);if(Math.abs(v)<.001?(j=k(Y),y=H.b/j,m=-H.c/j):(y=H.a/v,m=H.d/v),"scale"===p)Z.setScale(y/d,m/L);else if("size"===p){var h=y/T.x,g=m/T.y;Z.setScale(oh(y)*Math.abs(T.x),oh(m)*Math.abs(T.y)),Z instanceof B.Shape?(Z.setWidthForce(Math.max(Math.abs(h),1e-5)),Z.setHeightForce(Math.max(Math.abs(g),1e-5))):Z.setSize(Math.max(.01,Math.abs(h)),Math.max(.01,Math.abs(g)))}H.rotate(x),H.translate(W.x,W.y),Z.setPosition(H.tx,H.ty)}}})}},_calcChangeFactor:function(X,c,p,a){var S,n,E,e;return S=i(X),n=i(p),E=S>n?S/n:n/S,S=i(c),n=i(a),e=S>n?S/n:n/S,o(E,e)},setElevation:function(v){var N=this;if(!N._updatingToChildren){var Q=N.getElevation(),f=v-Q;0!==f&&(ol||N._updatingFromChildren||(N._updatingToChildren=1,wf(N._children,0,f,0),delete N._updatingToChildren),Xl.superClass.setElevation.apply(N,arguments))}},setScaleTall:function(p){var h=this;if(!h._updatingToChildren){var I=h.getScaleTall();if(i(p)<.01&&(p=.01*(oh(p)||oh(I))),"3d"===h._scaleMode){var u=h.getScale();return h.setScale3d(u.x,p,u.y),void 0}if(Xl.superClass.setScaleTall.call(h,p),!ol&&!h._updatingFromChildren){h._updatingToChildren=1;var Q=p/I;h._adjustChildTallOrScale(Q,"scale"),delete h._updatingToChildren,h._scaleChanged=1,this.updateFromChildren(),delete h._scaleChanged}}},_adjustChildTallOrScale:function(u,I){var X=this;if(X._syncSize){var E=X.getElevation();X.eachChild(function(p){if(Dg(p)){if("size"===I){var d=p.getTall();0>u&&p.setScaleTall(-1*p.getScaleTall()),p.setTall(Math.max(.01,Math.abs(d*u)))}else{var D=p.getScaleTall();p.setScaleTall(D*u)}p.setElevation(E+(p.getElevation()-E)*u)}})}},setAnchor3d:function(){if(!this._updatingToChildren){this.beginTransaction();var g=Xl.superClass.setAnchor3d.apply(this,arguments);return g&&!ol&&!this._updatingFromChildren&&this._syncSize&&(this._anchorChanged=1,this.updateFromChildren(),delete this._anchorChanged),this.endTransaction(),g}},setAnchor:function(){var u=this;if(!u._updatingToChildren){var l=u.getAnchor(),S=Xl.superClass.setAnchor.apply(u,arguments);if(ol||u._updatingFromChildren||!u._syncSize)return S;u._updatingToChildren=1;var w=u.getAnchor(),M=u.getSize(),r=M.width*(l.x-w.x),N=M.height*(l.y-w.y),J=(new qc).compose(new Xn,this.getQuaternion(),new Xn(this.getScale3d())),H=new Xn(r,0,N).applyMatrix4(J);return u.eachChild(function(h){if(Dg(h)){var y=new Xn(h.p3());h.p3(y.add(H).toArray())}}),delete u._updatingToChildren,S}},setAnchorElevation:function(){var d=this;if(!d._updatingToChildren){var l=d.getAnchorElevation(),J=Xl.superClass.setAnchorElevation.apply(d,arguments);if(ol||d._updatingFromChildren||!d._syncSize)return J;d._updatingToChildren=1;var S=d.getAnchorElevation(),Z=d.getTall()*(l-S),K=(new qc).compose(new Xn,this.getQuaternion(),new Xn(this.getScale3d())),X=new Xn(0,Z,0).applyMatrix4(K);return d.eachChild(function(d){if(Dg(d)){var J=new Xn(d.p3());d.p3(J.add(X).toArray())}}),delete d._updatingToChildren,J}},setRotation:function(C){this._updateChildrenRotation3d("rotation",C)},setRotationX:function(S){this._updateChildrenRotation3d("rotationX",S)},setRotationZ:function(p){this._updateChildrenRotation3d("rotationZ",p)},setRotation3d:function(){var L=this;if(!L._updatingToChildren){var K=L.r3();Xl.superClass.setRotation3d.apply(L,arguments);var b=L.r3();ol||L._updatingFromChildren||(L._updatingToChildren=1,L.eachChild(function(q){Dg(q)&&q.syncRotation3d(L,b,K)}),delete L._updatingToChildren)}},_updateChildrenRotation3d:function(N,R){var y=this;if(!y._updatingToChildren){var d=y[_d(N)]();Xl.superClass[uo(N)].call(y,R),ol||y._updatingFromChildren||this._updateRotationToChildren(N,R-d)}},_updateRotationToChildren:function(J,t){var H=this;H._updatingToChildren=1,H.eachChild(function(s){Dg(s)&&s._11Q(H,J,t)}),delete H._updatingToChildren},setScale:function(k,s){var E=this;if(!E._updatingToChildren){null==s&&(s=k.y,k=k.x);var C=E.getScale();if(i(k)<.01&&(k=.01*(oh(k)||oh(C.x))),i(s)<.01&&(s=.01*(oh(s)||oh(C.y))),"3d"===E._scaleMode)return E.setScale3d(k,E.getScaleTall(),s),void 0;if(Xl.superClass.setScale.call(E,k,s),!ol&&!E._updatingFromChildren){E._updatingToChildren=1;var r=k/C.x,K=s/C.y;E._adjustChildScaleOrSize(r,K,"scale"),delete E._updatingToChildren,E._scaleChanged=1,E.updateFromChildren(),delete E._scaleChanged}}},onPropertyChanged:function(I){Xl.superClass.onPropertyChanged.call(this,I),"s:3d.visible"===I.property&&this._invalidateChildrenBatch()},_invalidateChildrenBatch:function(){this.eachChild(function(M){(M.s("batch")||M.s("wf.geometry")||M.s("wf.visible"))&&M.iv(),M instanceof Xl&&M._invalidateChildrenBatch()})},getSerializableProperties:function(){var I=Xl.superClass.getSerializableProperties.call(this);return I.clickThroughEnabled=1,I.syncSize=1,I.scaleMode=1,I},setScale3d:function(){var O=new Xn,D=new Xn,d=new Xn,u=new qc,o=new Hm,c=new Xn;return function(G,Y,z){var V,Z=this;if(V="number"==typeof G?{x:G,y:Y,z:z}:G.length?{x:G[0],y:G[1],z:G[2]}:G,"3d"!==Z._scaleMode)return Xl.superClass.setScale3d.apply(Z,arguments),void 0;if(Z._syncSize&&0!==Z.size()){var I=Z.getMatrix4();I.getInverse(I),Xl.superClass.setScaleTall.call(Z,V.y),Xl.superClass.setScale.call(Z,V.x,V.z);var M=Z.getMatrix4();ol||Z._updatingFromChildren||(Z._updatingToChildren=1,Z.eachChild(function(J){if(Dg(J)){if(D.fromArray(J.s3()),J instanceof B.Polyline){var K=J.getThickness();D.x=D.x||K,D.y=D.y||K,D.z=D.z||K,c.copy(J.getScale3d()).multiplyScalar(K),J.getQuaternion(o),O.copy(J.p3()),d.copy(J.getFinalScale3d()),d.x=d.x||c.x,d.y=d.y||c.y,d.z=d.z||c.z,u.compose(O,o,d)}else J.getMatrix4(u);u.premultiply(I).premultiply(M),u.decompose(O,o,d),d.divide(D),J.setQuaternion(o),J.p3(O.toArray()),J.setScale3d(d.toArray())}}),delete Z._updatingToChildren,Z._scaleChanged=1,Z.updateFromChildren(),delete Z._scaleChanged)}}}()});var Cf=B.Grid=function(){yd(B.Grid,this)};$e("Grid",nl,{IRotatable:!1,_icon:"grid_icon",_image:I,getUIClass:function(){return Cn},setRotation:function(){},getCellRect:function(f,g){var L=this,Y=L.s("grid.row.count"),k=L.s("grid.column.count");if(0>=Y||0>=k||0>f||f>=Y||0>g||g>=k)return I;var x,V,S,Q=L.getRect(),W=L.s("grid.row.percents"),O=L.s("grid.column.percents");if(vh(Q,L,"grid.border",-1),W&&W._as&&(W=W._as),O&&O._as&&(O=O._as),W&&W.length===Y){for(S=0,x=0;f>x;x++)S+=Q.height*W[x];Q.y+=S,Q.height=Q.height*W[f]}else Q.height=Q.height/Y,Q.y+=Q.height*f;if(O&&O.length===k){for(V=0,x=0;g>x;x++)V+=Q.width*O[x];Q.x+=V,Q.width=Q.width*O[g]}else Q.width=Q.width/k,Q.x+=Q.width*g;return xs(Q,-L.s("grid.gap")),Q}});var _k=B.Text=function(){yd(_k,this),this.setSize(100,50),this.s("text","TEXT")};$e("Text",nl,{_icon:"text_icon",_image:"__text__",getUIClass:function(){return jg},setWidth:function(k){k||(k=.001),_k.superClass.setWidth.call(this,k)},setHeight:function(Y){Y||(Y=.001),_k.superClass.setHeight.call(this,Y)},toLabel:function(){return this._displayName||this._name||this.s("text")}}),Wk("__text__",{width:{value:100,isSafeFunc:!0,func:function(k){return k?k._width:100}},height:{value:50,isSafeFunc:!0,func:function(a){return a?a._height:50}},comps:[{type:"text",relative:!0,rect:[0,0,1,1],text:{func:"style@text"},align:{func:"style@text.align"},vAlign:{func:"style@text.vAlign"},color:{func:"style@text.color"},font:{func:"style@text.font"},shadow:{func:"style@text.shadow"},shadowColor:{func:"style@text.shadow.color"},shadowBlur:{func:"style@text.shadow.blur"},shadowOffsetX:{func:"style@text.shadow.offset.x"},shadowOffsetY:{func:"style@text.shadow.offset.y"},scaleX:{func:"style@text.scale.x"},scaleY:{func:"style@text.scale.y"},gradient:{func:"style@text.gradient"},gradientColor:{func:"style@text.gradient.color"},gradientPack:{func:"style@text.gradient.pack"},decoration:{func:"style@text.decoration"},vertical:{func:"style@text.vertical"},verticalGap:{func:"style@text.vertical.gap"},wrap:{func:"style@text.wrap"},letterGap:{func:"style@text.letter.gap"},borderWidth:{func:"style@text.border.width"},borderColor:{func:"style@text.border.color"}}]});var gi=B.Shape=function(){yd(gi,this),this._59O=new Gk};gi.__de__=hj,$e("Shape",nl,{ms_ac:["thickness","closePath"],_icon:"shape_icon",_thickness:10,_closePath:!1,getUIClass:function(){return Zd},_22Q:function(){return nt},getLength:function(F){return lj(mi(this._59O,this._58O,F,this._closePath))},getSegments:function(){return this._58O},toSegments:function(){var u=this._58O;return u?new Gk(u._as.slice(0)):u},setSegments:function(R){var v=this._58O;R=R?ar(R)?new Gk(R.slice(0)):new Gk(R._as.slice(0)):null,(v&&R&&v._as.join(",")!==R._as.join(",")||v!==R)&&(this._58O=R,this.fp("segments",v,R))},getPoints:function(){return this._59O},toPoints:function(){var r=this._59O;return new Gk(r._as.slice(0))},getPointsMatrix2d:function(){var y=this,u=new jl.Matrix2d,J=y.getPosition(),m=y.getScale(),D=y.getRotation();return u.translate(-J.x,-J.y).scale(m.x,m.y).rotate(D).translate(J.x,J.y),u},getPointsMatrix3d:function(){return function(){var g=this,D=new jl.Matrix4,N=D.getElements(),f=g.p3();uf(N,f),Ml(N,g.getFinalRotation3d(),g.getRotationMode());var x=g.getScale3d(),C=g._dynamicScale3d;return C&&(x[0]*=C[0],x[1]*=C[1],x[2]*=C[2]),xm(N,x),uf(N,Em(f)),D}}(),setPoints:function(u,Z){var z=this,d=z._59O;u=u?ar(u)?new Gk(u.slice(0)):new Gk(u._as.slice(0)):new Gk;var p,s,x,o,$,m;Z&&(p=z.getPosition(),m=new Mc(z.getRotation(),0,0,z.getScale().x,z.getScale().y)),(d&&u&&d._as.join(",")!==u._as.join(",")||d!==u)&&(z._59O=u,z.fs(),z.fp("points",d,u)),Z&&(s=z.getPosition(),x=s.x-p.x,o=s.y-p.y,$=m.tf(x,o),z.setPosition(s.x-x+$.x,s.y-o+$.y))},setPoints3d:function(a,z){var m=new Xn(this.p3()),h=this.getPointsMatrix3d();if(h.setPosition(new Xn),pp.superClass.setPoints.call(this,a),z){var k=new Xn(this.p3()),c=k.clone().sub(m).applyMatrix4(h);m.add(c),this.p3(m.x,m.y,m.z)}},addPoint:function(l,P,V){var e=this.toPoints();e.add(l,P),this.setPoints(e,V)},setPoint:function(x,F,K){var B=this.toPoints();B.set(x,F),this.setPoints(B,K)},removePointAt:function(x){var $=this.toPoints();$.removeAt(x),this.setPoints($)},setWidthForce:function(G){var V=this;if(!V._55I&&!ol&&V.getWidth()){V._55I=1;var n=V._position.x,S=G/V.getWidth(),K=V.toPoints(),P=new Gk;1!==S&&(K.each(function(L){P.add({x:(L.x-n)*S+n,y:L.y,e:L.e})}),V.setPoints(P),Cl(V,[S,0,0,1,n*(1-S),0]),V.fs()),delete V._55I}gi.superClass.setWidth.call(V,G)},setWidth:function(M){return this.setWidthForce(xk>M?xk:M)},setHeightForce:function(j){var P=this;if(!P._55I&&!ol&&P.getHeight()){P._55I=1;var t=P._position.y,v=j/P.getHeight(),J=P.toPoints(),r=new Gk;1!==v&&(J.each(function(P){r.add({x:P.x,y:(P.y-t)*v+t,e:P.e})}),P.setPoints(r),Cl(P,[1,0,0,v,0,t*(1-v)]),P.fs()),delete P._55I}gi.superClass.setHeight.call(P,j)},setHeight:function(u){return this.setHeightForce(xk>u?xk:u)},setAnchorElevation:function(r){var M=this;M._55I=!0;var $=M._updatingAnchor3d,F=!ol&&!$;if(F){var P,e=r,Q=M.getAnchorElevation(),d=M.getTall();P=d*(Q-e),0!==P&&M.shiftPointsElevation(P)}var K=gi.superClass.setAnchorElevation.apply(M,arguments);return $||delete M._55I,K},getShapeElevation:function(){var e=this,j=e._54O;return j-(e.getTall()||0)*(e._anchorElevation-.5)},setAnchor3d:function(L,p,G,E){var O,R=this;if("number"==typeof L?O={x:L,y:p,z:G}:(O=L.length?{x:L[0],y:L[1],z:L[2]}:L,E=p),R._55I=!0,R._updatingAnchor3d=!0,R.beginTransaction(),!ol){var r=R.getAnchor3d(),Q=R.getSize(),A=R.getTall(),z=Q.width*(r.x-O.x),a=Q.height*(r.z-O.z),W=A*(r.y-O.y);E||R.shiftPoints(z,a,W);var v=R.p3()}var b=gi.superClass.setAnchor3d.apply(R,arguments);if(!ol&&E){var V=R.p3();R.shiftPoints(V[0]-v[0]+z,V[2]-v[2]+a,V[1]-v[1]+W)}return R.endTransaction(),delete R._updatingAnchor3d,delete R._55I,b},setAnchor:function(j,Y,w){var e=this;e._55I=!0;var c=e._updatingAnchor3d,m=!ol&&!c;if(m){var R,t,$;"number"==typeof j?$={x:j,y:Y}:($=j.length?{x:j[0],y:j[1]}:j,w=Y);var O=e.getAnchor(),I=e.getSize();R=I.width*(O.x-$.x),t=I.height*(O.y-$.y),w||e.shiftPoints(R,t);var h=e.getPosition()}var S=gi.superClass.setAnchor.apply(e,arguments);if(m){var o=e.getPosition();w&&e.shiftPoints(o.x-h.x+R,o.y-h.y+t)}return c||delete e._55I,S},shiftPoints:function(w,u,X){if(w||u||X){var z=this,Q=z.getElevation()||0,Y=z.toPoints(),e=new Gk;Y.each(function(P){var q=P.e;X&&(q=(q==I?Q:q)+X),e.add({x:P.x+w,y:P.y+u,e:q})}),z.setPoints(e),z.fs()}},shiftPointsElevation:function(Z){return this.shiftPoints(0,0,Z)},setPosition:function(H,B){var e,l=this;if(!l._28Q){if(l._28Q=1,!l._55I&&!ol){e=2===arguments.length?{x:H,y:B}:H;var Q=e.x-l._position.x,E=e.y-l._position.y;if(0===Q&&0===E)return delete l._28Q,void 0;l._55I=1,l.shiftPoints(Q,E),Cl(l,[1,0,0,1,Q,E]),delete l._55I}gi.superClass.setPosition.apply(l,arguments),delete l._28Q}},fs:function(){this.fireShapeChange()},_70I:function(){var $=this;if(2!==$._59O.size())return!1;var h=$._58O;return h?2===h.size()&&1===h.get(0)&&2===h.get(1)?!0:!1:!0},fireShapeChange:function(){var S=this;if(!S._55I&&!ol){var p=Gj(S._59O);p&&(S._55I=1,S.setRect(p),delete S._55I)}S.fp($l,!1,!0)},getSerializableProperties:function(){var M=gi.superClass.getSerializableProperties.call(this);return M.segments=1,M.points=1,M.thickness=1,M.closePath=1,M}});var Df=B.Points=function(){yd(Df,this)};$e("Points",nl,{_59O:[],_colors:[],_sizes:[],_uvoffsets:[],_22Q:function(){return ot},getPoints:function(){return this._59O},setPoints:function(V){var Q=this._59O;V=V?V.slice(0):[];var c=V[0];if(gs(c)){var o=V;V=[];for(var n=0,p=o.length;p>n;n+=3)V.push({x:o[n],e:o[n+1],y:o[n+2]})}this._59O=V,this._pointsDirty=!0,this.fp("points",Q,this._59O)},setPoint:function(B,X){var O=this._59O.slice(0);O[B]=X,this.setPoints(O)},addPoint:function(f){this.setPoint(this._59O.length,f)},getColors:function(){return this._colors},setColors:function(i){var Z=this._colors;i=i?i.slice(0):[],this._colors=i,this._colorsDirty=!0,this.fp("colors",Z,i)},setPointColor:function(Z,t){var i=this._colors.slice(0);i[Z]=t,this.setColors(i)},getSizes:function(){return this._sizes},setSizes:function(N){var M=this._sizes;N=N?N.slice(0):[],this._sizes=N,this._sizesDirty=!0,this.fp("sizes",M,this._sizes)},setPointSize:function(n,N){var X=this._sizes.slice(0);X[n]=N,this.setSizes(X)},getUvoffsets:function(){return this._uvoffsets},setUvoffsets:function(i){var W=this._uvoffsets;i=i?i.slice(0):[],this._uvoffsets=i,this._offsetsDirty=!0,this.fp("uvoffsets",W,this._uvoffsets)},setPointUvoffset:function(w,g,N){var i;"object"==typeof g?(i=g[0],N=g[1]):i=g;var h=this._uvoffsets.slice(0);h[2*w+0]=i,h[2*w+1]=N,this.setUvoffsets(h)},getPointInfo:function($){var s=this.getPoints();if(!s||s[$]==I)return I;var U=s[$],O=[U.x,U.e,U.y],Q=this.mat||Zi(this),K=[O[0],O[1],O[2]];Ee(K,Q);var T=this.getColors(),z=T[$]||this.s("points.color"),A=this.getSizes(),R=A[$];return{size:R==I?this.s("points.size"):R,color:z,local:O,world:K}},getSerializableProperties:function(){var R=Df.superClass.getSerializableProperties.call(this);return R.points=1,R.colors=1,R.sizes=1,R.uvoffsets=1,R},onPropertyChanged:function(t){Df.superClass.onPropertyChanged.call(this,t);var S=t.property;"s:points.color"===S?this._colorsDirty=!0:"s:points.size"===S?this._sizesDirty=!0:"s:points.model"===S&&(this._modelDirty=!0)},getWidth:function(){var k=this;if(k._width>=0)return k._width;var u=k.getStyle("points.model");if(u){var U=jm(u);if(U&&U.rawS3)return U.rawS3[0]}return 1},getHeight:function(){var n=this;if(n._height>=0)return n._height;var A=n.getStyle("points.model");if(A){var l=jm(A);if(l&&l.rawS3)return l.rawS3[2]}return 1},getTall:function(){var M=this;if(M._tall>=0)return M._tall;var q=M.getStyle("points.model");if(q){var v=jm(q);if(v&&v.rawS3)return v.rawS3[1]}return 1}});var pp=B.Polyline=function(){yd(pp,this),this.s({"shape.background":null,"shape.border.width":2})};$e("Polyline",gi,{_icon:"polyline_icon",_22Q:function(){return rt},getUIClass:function(){return Fn},setClosePath:function(){},setTall:function(v){var J=this;if(J.beginTransaction(),!J._55I&&!J._24Q&&!ol&&J.getTall()){J._24Q=1;var j=J._54O,V=v/J.getTall();if(1!==V){var C=J.toPoints(),Y=new Gk;C.each(function(B){Y.add({x:B.x,y:B.y,e:B.e==I?B.e:(B.e-j)*V+j})}),J.setPoints(Y),J.fs()}delete J._24Q}pp.superClass.setTall.call(J,v),J.endTransaction()},setElevation:function(v){var e=this;if(e.beginTransaction(),!e._55I&&!e._24Q&&!ol){e._24Q=1;var z=v-e._54O;0!==z&&e.shiftPointsElevation(z),delete e._24Q}pp.superClass.setElevation.apply(e,arguments),e.endTransaction()},fireShapeChange:function(){var P=this,M=P._59O;if(!P._55I&&!P._24Q&&!ol){var W=M.size();if(W){var z=1,u=M.get(0),j=P._54O;u.e==I&&(u.e=j);for(var w=u.e,p=0;W>z;z++){u=M.get(z),u.e==I&&(u.e=j);var r=X(w,u.e),d=o(w+p,u.e);w=r,p=d-r}P._24Q=1,P.setTall(p),P.setElevation(w+p*P._anchorElevation),delete P._24Q}}pp.superClass.fireShapeChange.apply(P,arguments)},onPropertyChanged:function(){var z={};return["points","segments","thickness","position","elevation","rotation","rotationX","rotationZ","rotationMode","scale","scaleTall","s:shape.border.color","s:shape.border.gradient.color","s:shape.border.pattern","s:shape.dash","s:shape.dash.color","s:shape.dash.pattern","s:shape.dash.offset","s:shape.dash","s:shape.dash","s:3d.clip.direction","s:repeat.uv.length","s:body.color","s:shape3d","s:shape3d.visible","s:shape3d.image","s:shape3d.smooth","s:shape3d.resolution","s:shape3d.color","s:shape3d.blend","s:shape3d.side","s:shape3d.start.angle","s:shape3d.sweep.angle","s:shape3d.top.cap","s:shape3d.top.image","s:shape3d.top.visible","s:shape3d.top.color","s:shape3d.bottom.cap","s:shape3d.bottom.image","s:shape3d.bottom.visible","s:shape3d.bottom.color","s:shape3d.from.visible","s:shape3d.from.color","s:shape3d.to.visible","s:shape3d.to.color","s:shape3d.uv.union"].forEach(function(w){z[w]=!0}),function(x){pp.superClass.onPropertyChanged.call(this,x),z[x.property]&&(this._needChangeGeometry=!0)}}()});var Sr=B.SubGraph=function(){yd(Sr,this)};$e("SubGraph",nl,{ISubGraph:1,_image:"subGraph_image",_icon:"subGraph_icon",_8I:function(){Sr.superClass._8I.call(this),this.eachChild(function(X){Dg(X)&&X._8I()})}}),R.loadingRefGraph=0;var Ti=B.RefGraph=function(){yd(Ti,this)};$e("RefGraph",Xl,{_icon:"refGraph_icon",getRef:function(){return this._ref},setRef:function(V){var M=this._ref;this._ref=V,this.fp("ref",M,V),this.updateRef()},_21I:function(){Ti.superClass._21I.apply(this,arguments),this.updateRef()},updateRef:function(){var V=this;if(R.loadingRefGraph++,V.clearChildrenFromDataModel(),R.loadingRefGraph--,V._ref&&V._dataModel){V._xhrLoadHandler&&(V._xhrLoadHandler.cancel=!0);var f=ol,j=V._xhrLoadHandler=function(I){if(I&&V._dataModel){R.loadingRefGraph++;var y=V._pendingUpdateInfo={needToRestore:f};f&&(y.p3=V.p3(),y.s3=V.s3(),y.r3=V.r3(),y.anchor3d=V.getAnchor3d(),y.scale3d=V.getScale3d()),V.r3(0,0,0),V.setScale3d(1,1,1),V.setAnchor3d(.5,.5,.5),V.p3(0,0,0);var d=R.parse(I),B=V._dataModel.deserialize(d,V,{justDatas:!0});B.each(function(N){N._refGraph=V}),V.checkPendingUpdateInfo(),R.loadingRefGraph--,R.handleRefGraphLoaded(V,B,d)}};j.xhrLoadCalled=!1,R.load(V._ref,function(S){j.cancel||(j.xhrLoadCalled?j(S):ed(function(){j(S)}))}),j.xhrLoadCalled=!0}},checkPendingUpdateInfo:function(){var U=this,w=U._pendingUpdateInfo;if(!w)return U.onPendingUpdated&&(R.loadingRefGraph++,U.onPendingUpdated(),R.loadingRefGraph--),void 0;var k=!0;this.eachChild(function(M){(M._pendingCheckImageJSON||M._pendingUpdateInfo)&&(k=!1)}),k&&(R.loadingRefGraph++,U._pendingUpdateInfo=null,U.updateFromChildren(),w.needToRestore&&(U.setAnchor3d(w.anchor3d),U.setScale3d(w.scale3d),U.r3(w.r3),U.p3(w.p3)),this.getParent()instanceof Ti&&this.getParent().checkPendingUpdateInfo(),U.onPendingUpdated&&U.onPendingUpdated(),R.loadingRefGraph--)},getSerializableProperties:function(){var O=Ti.superClass.getSerializableProperties.call(this);return O.ref=1,O}}),B.EdgeGroup=function(n,g){this._70O=n,this._siblings=g;for(var i,E,Z=0,x=n.size(),o=c[pi];x>Z;Z++)if(i=n.get(Z).getStyle(pi,!1),i!=I){o=i;break}o==I&&(o=!0);var S=R.edgeGroupAgentFunc;for(S&&(E=S(n),E&&E!==n.get(0)&&(n.remove(E),n.add(E,0))),Z=0;x>Z;Z++)n.get(Z).s(pi,o)},$e("EdgeGroup",T,{getEdges:function(){return this._70O},size:function(){return this._70O.size()},get:function(w){return this._70O.get(w)},indexOf:function(k){return this._70O.indexOf(k)},each:function(p,O){this._70O.each(p,O)},getSiblings:function(){return this._siblings},eachSiblingEdge:function(V,R){this._siblings.each(function(d){d._70O.each(V,R)})}});var Ue=function(P,B,j){var L=Hc[P]={type:P,action:B};if(j)for(var _ in j)L[_]=j[_]};Wn(R,{setConnectAction:Ue,getConnectAction:function(S,P){if(!P){if(!S)return null;P=S.getCurrentConnectActionType()}return Hc[P]},doConnectAction:function(k,y,C,f){f=f||k.getCurrentConnectActionType();var a=Hc[f];if(!a)return!1;var s=a.action;return s?(y instanceof me.Group?k.sm().getSelection().each(function(H){s.call(null,k,H,C)}):s.call(null,k,y,C),!0):!1},doDeleteConnectionAction:function(J,i,r){r=r||J.getCurrentConnectActionType();var c=Hc[r];if(!c||!c.delete)return!1;var Q=c.delete.action;return Q?(i instanceof me.Group?J.sm().getSelection().each(function(e){Q.call(null,J,e)}):Q.call(null,J,i),!0):!1}});var ks=B.JSONSerializer=function($,g){this.dm=this._dataModel=$,this._hierarchical=R.forceHierarchicalSerialization?!0:g==I?$.isHierarchicalRendering():g};$e("JSONSerializer",T,{ms_ac:["hierarchical"],serialize:function(t){return R.stringify(this.toJSON(),t)},toJSON:function(){var e,H=this,C=H.dm,s=C.getRoots(),G=H.json={v:R.getVersion(),p:{},a:{},d:[]},j=C.getSerializableAttrs();(e=C.getInit())&&(G.init=e),(e=C.getName())&&(G.p.name=e),(e=C.getBackground())&&(G.p.background=e),(e=C.getLayers())&&(G.p.layers=e),(e=C.getEnvmap())&&(G.p.envmap=e),(e=C.getEnvmapType())&&(G.p.envmapType=e),G.p.autoAdjustIndex=C.isAutoAdjustIndex(),G.p.hierarchicalRendering=C.isHierarchicalRendering();for(var x in j){var S=C.a(x);S!==z&&H[Yd](x,S,G.a)}return Jb(G.a)&&delete G.a,H._hierarchical?s.each(H.serializeData,this):C.each(function(B){H.serializeData(B)}),C.fireSerializeEvent({type:"serialize",json:G}),C.getPostProcessingData()&&(G.p.postProcessingData=C.getPostProcessingData()),G},isSerializable:function(){return!0},getProperties:function(m){return m.getSerializableProperties()},getStyles:function(D){return D.getSerializableStyles()},getAttrs:function(Y){return Y.getSerializableAttrs()},serializeData:function(A){var _=this;if(_.isSerializable(A)&&!A._refGraph){var m,c,H,R,s,f,i=Lo(A.getClassName())||A.getClass(),v=new i,g={c:A.getClassName(),i:A.getId(),p:{},s:{},a:{}};_.json.d.push(g),m=_.getProperties(A);for(c in m)if(/^_/.test(c)){if(H=A[c],!("_width"!==c&&"_height"!==c||H!=I&&-1!==H)){if(s==z){var Z;f=(A.s("layout.h")||A.s("layout.v"))&&A.getHost()||A instanceof B.Node&&(Z=A.getParent())&&Z instanceof B.Block||A.s("fullscreen"),s=A.hasInheritedSize()}f&&s&&(H=A[c]="_width"===c?A.getWidth():A.getHeight())}H!==v[c]&&_[Yd](c.substr(1),H,g.p)}else R=_d(c),A[R]&&(H=A[R](),H!==v[R]()&&_[Yd](c,H,g.p));m=_.getStyles(A);for(c in m)H=A.s(c),H!==v.s(c)&&_[Yd](c,H,g.s);m=_.getAttrs(A);for(c in m)H=A.a(c),H!==v.a(c)&&_[Yd](c,H,g.a);Jb(g.p)&&delete g.p,Jb(g.s)&&delete g.s,Jb(g.a)&&delete g.a}_._hierarchical&&A.getChildren().each(_.serializeData,_)},serializeValue:function(D,K,m){vq(K)?K={__a:K._as}:K instanceof If?K={__i:K.getId()}:K instanceof Og&&(K={__dm:K.serialize(0)}),m[D]=K},deserialize:function(N,I,w){var d=this;return Fc(N)&&/.json$/.test(N)?(R.xhrLoad(N,function(e){d.deserializeImpl(e,I,w)}),void 0):d.deserializeImpl(N,I,w)},deserializeImpl:function(v,$,h){var a=this,N=a.dm;N.setDeserializing(!0),h=ki(h)?{setId:h}:Hn(h)?{finishFunc:h}:h||{},v=a.json=Fc(v)?R.parse(v):v,!h.justDatas&&v.a&&v.a.onPreDeserialize&&!h.disableOnPreDeserialize&&v.a.onPreDeserialize(v,N,h.view),N.beginTransaction(),ol++,a._82I={};var J=new Gk,K=new Gk,T=0,b=v.d.length;if(h.justDatas||(!h.disableInit&&Hn(v.init)&&v.init(N),N.setInit(v.init)),!h.justDatas){for(var u in v.a)N.a(u,a[Xm](v.a[u]));for(var P in v.p)N[uo(P)](v.p[P])}for(;b>T;T++){var A=v.d[T],H=Lo(A.c),c=new H,E=A.i;h.setId&&E!=I&&(c._id=E),a._82I[E]=c,J.add(c),K.add(A)}for(T=0;b>T;T++)a.deserializeData(J.get(T),K.get(T));return J.each(function(O){$&&!O.getParent()&&O.setParent($),N.add(O)}),h.__innerHandler__&&h.__innerHandler__(v,N,h.view,J),N.fireSerializeEvent({type:"deserialize",json:v}),ol--,N.endTransaction(),!h.justDatas&&v.a&&v.a.onPostDeserialize&&!h.disableOnPostDeserialize&&v.a.onPostDeserialize(v,N,h.view,J),h.finishFunc&&h.finishFunc(v,N,h.view,J),N.setDeserializing(!1),J},deserializeData:function(r,g){for(var L in g.p)r[uo(L)](this[Xm](g.p[L]));for(L in g.s)r.s(L,this[Xm](g.s[L]));for(L in g.a)r.a(L,this[Xm](g.a[L]))},deserializeValue:function(x){if(Pd(x)){var Q=x.__i;if(Q!=I)return this._82I[Q];if(Q=x.__dm,Q!=I){var r=new B.DataModel;return r.deserialize(Q),r}if(Q=x.__a,ar(Q))return new Gk(Q)}return x}}),Wn(Og,{serialize:function(i,I){return new ks(this,I).serialize(i)},toJSON:function(x){return new ks(this,x).toJSON()},deserialize:function(q,H,z){return new ks(this).deserialize(q,H,z)}});var Dn=B.OverlappingBox=function(F){this.gv=F,this.boxes={}};$e("OverlappingBox",T,{clear:function(){var X,q,z=this.boxes;for(X in z)q=z[X],q.length=0},isOverlapping:function(c,g){var F,K,n=this,P=n.boxes,y=P[c];
y?(F=y.rects,K=y.length):y=P[c]={rects:F=[],length:K=0};var s,V,g;for(s=0;K>s;s++)if(V=F[s],V.x<g.x+g.w&&V.x+V.w>g.x&&V.y<g.y+g.h&&V.h+V.y>g.y)return!0;return F.length<=K?(F.push(g),y.length++):F[y.length++]=g,!1}}),Wn(R,{fetch:function(D,l){l=l||{},D.open(l.method||"GET",l.url||"",!(null!=l.sync?l.sync:!1)),"json"===l.dataType&&D.setRequestHeader("Content-Type","application/json"),l.responseType&&(D.responseType=l.responseType),D.send(l.data)},convertImageSrc:function(_,H){H&&"function"==typeof H||(H=function(){}),H(_)}});var nc=B.Request=function(){};$e("Request",T,{_mimeType:z,getXhr:function(){return this._xhr||(this._xhr=new XMLHttpRequest,this.overrideMimeType("text/plain")),this._xhr},send:function(x){var l=this.getXhr();x.mimeType&&this.overrideMimeType(x.mimeType),l.onload=this.onload,l.onerror=this.onerror,R.fetch(l,x)},onload:function(){},onerror:function(){},getResponseType:function(){return this.getXhr().responseType},setOverrideMimeType:function(B){this.overrideMimeType(B)},getMimeType:function(){return this._mimeType},overrideMimeType:function(C){this.getXhr().overrideMimeType(this._mimeType=C)},getResponseHeader:function(X){return this.getXhr().getResponseHeader(X)},getResponseText:function(){var s=this.getXhr();return s.response||s.responseText},getStatus:function(){return this.getXhr().status}}),Ap.GraphView=function(X){var r=this;r._24I={},r._34I=new Gk,r.enableDirtyRect(),r._25I={},r._56I={},r._view=Fd(1,r),r._canvas=On(r._view),r.dm(X?X:new Og),this._coreInteractor=new ds(this),r.setEditable(!1),r.setScrollBarVisible(R.graphViewScrollBarVisible),r._initView()},pg("GraphView",T,{ms_v:1,ms_gv:1,ms_bnb:1,ms_tip:1,ms_dm:1,ms_lp:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,_52o:1,_51o:1,ms_ac:[Nr,Pk,Il,vs,"resettable","editInteractor",Oe,"zoomable","pannable","rectSelectable","autoScrollZone",mm,"movableFunc","editableFunc","pointEditableFunc","rectEditableFunc","rotationEditableFunc","anchorEditableFunc","rectSelectBackground","rectSelectBorderColor","editPointSize","editPointBorderColor","editPointBackground","hoverDelay"],_zoomable:R.graphViewZoomable,_resettable:R.graphViewResettable,_pannable:R.graphViewPannable,_rectSelectable:R.graphViewRectSelectable,_autoScrollZone:R.graphViewAutoScrollZone,_rectSelectBackground:R.graphViewRectSelectBackground,_rectSelectBorderColor:R.graphViewRectSelectBorderColor,_editPointSize:R.graphViewEditPointSize,_editPointBorderColor:R.graphViewEditPointBorderColor,_editPointBackground:R.graphViewEditPointBackground,_scrollBarColor:Dr,_scrollBarSize:lm,_autoHideScrollBar:fi,_autoMakeVisible:Fp,_currentActionType:null,getCoreInteractor:function(){return this._coreInteractor},getLayers:function(){return this._dataModel.getLayers()},setLayers:function($){this._dataModel.setLayers($)},setEditable:function(x){var p=this,e=p.__interactorMap__;if(!e){var k=Ap.XEditInteractor;e=p.__interactorMap__={scrollBar:new Oj(p),select:new Cb(p),edit:k?new k(p):new rf(p),text:new de(p),move:new Lg(p),"default":new Zh(p),touch:new zf(p,{editable:!1})}}x?(p._uieditable=!0,p.setInteractors([e.scrollBar,e.select,e.text,e.edit,e.move,e.default,e.touch])):(p._uieditable=!1,p.setInteractors([e.scrollBar,e.select,e.move,e.default,e.touch]))},getCanvas:function(){return this._canvas},_33I:function(H){var k=H.getUIClass();return k?new k(this,H):I},getDataUI:function(u){var A=this,c=A._25I[u._id];return c===z&&(c=A._33I(u),A._25I[u._id]=c),c},getNodeRect:function(B){return R.getNodeRect(this,B)},getFullscreenDatas:function(){return this._dataModel.getFullscreenDatas()},getEdgeInfo:function(S){var $=this.getDataUI(S);return $?($._79o(),$._78o):null},getEdgeSourcePosition:function(i){var F=this,I=F.getDataUI(i),c=I.s,J=I._data._40I;return Hj(F,J,c("edge.source.position"),c("edge.source.offset.x"),c("edge.source.offset.y"),c("edge.source.anchor.x"),c("edge.source.anchor.y"))},getEdgeTargetPosition:function(r){var Y=this,h=Y.getDataUI(r),y=h.s,J=h._data._41I;return Hj(Y,J,y("edge.target.position"),y("edge.target.offset.x"),y("edge.target.offset.y"),y("edge.target.anchor.x"),y("edge.target.anchor.y"))},invalidateAll:function(y){var b=this;if(y){for(var w in b._25I){var A=b._25I[w];A&&A.dispose()}b._25I={},b._56I={},b._24I={},b._34I.clear(),b.redraw()}else b.dm().each(function(n){b.invalidateData(n)})},invalidateSelection:function(){var U=this;U.sm().each(function(X){U.invalidateData(X)})},invalidateData:function(P){var O=this;O._24I[P._id]=P,O._21Q(P),O.iv()},_21Q:function(X){var s=this,H=s._24I;if(kh(X)&&Fj[X.s(bq)]){var Y=X.getSourceAgent();Y&&Y.getAgentEdges().each(function(r){H[r._id]=r}),Y=X.getTargetAgent(),Y&&Y.getAgentEdges().each(function(Q){H[Q._id]=Q}),s.iv()}},redraw:function(U){var b=this;b._32I||(U?b._34I.add(U):(b._32I=1,b._34I.clear()),b.iv())},each:function(D,$){var e,s,Q,U=0,z=this.getLayers(),l=this._dataModel,q=l._datas._as,S=q.length;if(z){var W,P={};l.isHierarchicalRendering()&&l.eachByHierarchical(function(v){Q=v._layer,W=P[Q],W||(W=P[Q]=[]),W.push(v)});for(var I=z.length;I>U;U++)if(Q=z[U],Pd(Q)&&(Q=Q.name),l.isHierarchicalRendering()){W=P[Q];var M,e,h;if(W&&(M=W.length)>0)for(var j=0;M>j;j++)if(e=W[j],h=$?D.call($,e):D(e),h===!1)return}else for(var j=0;S>j;j++)if(e=q[j],e._layer===Q&&(s=$?D.call($,e):D(e),s===!1))return}else if(l.isHierarchicalRendering())this._dataModel.eachByHierarchical(D,null,$);else for(;S>U;U++)if(e=q[U],s=$?D.call($,e):D(e),s===!1)return},reverseEach:function(k,w){var T,l,o,m,t=this._dataModel,q=t._layers,x=t._datas._as,Y=x.length;if(q){var s,z={};for(t.isHierarchicalRendering()&&t.reverseEachByHierarchical(function(S){m=S._layer,s=z[m],s||(s=z[m]=[]),s.push(S)}),T=q.length-1;T>=0;T--)if(m=q[T],Pd(m)&&(m=m.name),t.isHierarchicalRendering()){s=z[m];var B,l,g;if(s&&(B=s.length)>0)for(var N=0;B>N;N++)if(l=s[N],g=w?k.call(w,l):k(l),g===!1)return}else for(var N=Y-1;N>=0;N--)if(l=x[N],l._layer===m&&(o=w?k.call(w,l):k(l),o===!1))return}else if(t.isHierarchicalRendering())t.reverseEachByHierarchical(k,null,w);else for(T=Y-1;T>=0;T--)if(l=x[T],o=w?k.call(w,l):k(l),o===!1)return},getViewRect:function(){return this._29I},getContentRect:function(){var h=this,X=h._84I;if(!X){var w=this.dm().a("width"),p=this.dm().a("height");w>0&&p>0?h._84I={x:0,y:0,width:w,height:p}:(h.each(function(n){h.isVisible(n)&&(X=xr(X,h.getDataUIBounds(n)))}),h._84I=X?X:Mn)}return h._84I},getScrollRect:function(){return xr(this.getContentRect(),this._29I)},makeCenter:function(N,L,C){var O=this;if(!O.getWidth()||!O.getHeight())return C||ed(O.makeCenter,O,[N,L,!0],500),void 0;O.makeVisible(N),O.validate();var p=O.getDataUIBounds(N);if(p){var U=O.getWidth(),d=O.getHeight(),J=p.x+p.width/2,o=p.y+p.height/2,F=-J*O._zoom+U/2,K=-o*O._zoom+d/2;O.setTranslate(F,K,L)}},fitData:function(L,z,H,V,N){var G=this;if(!G.getWidth()||!G.getHeight())return N||ed(G.fitData,G,[L,z,H,V,!0],500),void 0;var h=function(){G.makeVisible(L),G.validate();var J=G.getDataUIBounds(L);J&&(J=sj(J),xs(J,H==I?20:H),G.fitRect(J,z,V))};z?R.callWhenLoaded(h):h()},fitContent:function(u,G,l,N){var B=this;if(!B.getWidth()||!B.getHeight())return N||ed(B.fitContent,B,[u,G,l,!0],500),void 0;var o=function(){B.validate();var w=sj(B.getContentRect());xs(w,G==I?20:G),B.fitRect(w,u,l)};u?R.callWhenLoaded(o):o()},fitRect:function(M,s,H){var A=this,N=A.getWidth(),R=A.getHeight(),l=M.x+M.width/2,n=M.y+M.height/2,f=X(N/M.width,R/M.height),z=A._zoom,t=-l*z+N/2,C=-n*z+R/2;0===f||isNaN(f)||(H&&(f=X(1,f)),s?(A._65I&&(delete A._65I.finishFunc,A._65I.stop(!0)),A._14o&&A._14o.stop(!0),A.setTranslate(t,C,{finishFunc:function(){A.setZoom(f,s)}})):(A.setTranslate(t,C),A.setZoom(f)))},fitSelection:function(e,C,J){var b=this,U=b.sm(),H=null;U.size()&&(U.each(function(k){H=xr(b.getDataUIBounds(k),H)}),e&&xs(H,e),b.fitRect(H,C,J))},toCanvas:function(A,u,n){u=u||this._zoom,this.validateImpl();var V=this,O=V.getContentRect();n&&xs(O,n),O.width||(O.width=10),O.height||(O.height=10);var Y=On(),s=O.x*u,o=O.y*u,x=Math.ceil(O.width*u),d=Math.ceil(O.height*u);Jk(Y,x,d,1);var q=lc(Y);A=A||this._dataModel.getBackground(),A&&gk(q,0,0,x,d,A),or(q,-s,-o),q.scale(u,u);var N=this._zoom;return this._zoom=u,V._42(q),this._zoom=N,q.restore(),Y},toDataURL:function(s,B,F,b){return this.toCanvas(s,F,b).toDataURL(B||"image/png",1)},getClipBounds:function(){return this._74O},_42:function(p,$){var c=this,S=c.dm().getBackground();if(S){var d=c.dm().a("width"),M=c.dm().a("height");d>0&&M>0&&gk(p,0,0,d,M,S)}var v=c.__htmlOrderList,G=[],t=c._forcedLayoutHTML;if(c._93db(p,$),c.each(function(e){var D=c.getDataUI(e);if(D){var S=c._56I[e._id],Y=D._htmlView;if(S){var b=D._79o();if(Y=D._htmlView,B.HtmlNode&&e instanceof B.HtmlNode)D._42(p);else{var q=c.getViewRect(),Z=Y&&Y.layoutHTML;!$||bi($,b)?(Z&&(Y.layoutHTML(),D.__outerLayout&&delete D.__outerLayout),D._42(p)):bi(q,b)||!Z||D.__outerLayout&&!t||(Y.layoutHTML(),D.__outerLayout=!0)}}Y&&(G.push(Y),Y.getView&&(Y=Y.getView()),Y.style.display=S?"block":xj)}}),v&&G.length>0){var n=!1;if(v.length!==G.length)n=!0;else for(var Q=0;Q<G.length;Q++)if(G[Q]!==v[Q]){n=!0;break}n&&(G.forEach(function(C){C.autoAdjustIndex!==!1&&c.appendHTML(C,!0)}),this.__htmlOrderList=G)}else this.__htmlOrderList=G;c._92db(p,$)},disableDirtyRect:function(){this._shouldRedrawAll=w},enableDirtyRect:function(){var R=this;R._shouldRedrawAll=function(){return R._32I}},validateImpl:function(){this.tryUpdateRootData();var I,b,S,u,K,x=this,f=x.tx(),H=x.ty(),X=x._zoom,U=x._canvas,e=this.getWidth(),h=this.getHeight(),k=x._29I,q={x:-f/X,y:-H/X,width:e/X,height:h/X},B={},T=x._34I,s=x._24I,V=x._shouldRedrawAll(),O=x._23I;x._24I={},(e!==U.clientWidth||h!==U.clientHeight)&&(Jk(U,e,h),V=1,x._forcedLayoutHTML=1),V||is(q,k)||(V=1,x._forcedLayoutHTML=1),x._29I=q,x.each(function(O){b=O._id;var X=B[b]=x.isVisible(O);X!==x._56I[b]&&(s[b]=O,S=x.getDataUI(s[b]),S&&S._84o(X),x._84o(O,X))},x);for(b in s)S=x.getDataUI(s[b]),S&&(!V&&x._56I[b]&&(K=S._79o(),K&&T.add(K)),S.invalidate()),x._83I=1;if(x._56I=B,!V)for(b in s)B[b]&&(S=x.getDataUI(s[b]),S&&(K=S._79o(),K&&T.add(K)));if(V?u=q:(T.each(function(B){bi(q,B)&&(u=xr(u,B))}),u&&(xs(u,o(1,1/X)),u.x=C(u.x*X)/X,u.y=C(u.y*X)/X,u.width=$(u.width*X)/X,u.height=$(u.height*X)/X,u=cp(q,u))),x._74O=u,u&&0!==u.width&&0!==u.height){I=lc(U);var R=u.x,w=u.y,c=u.width,j=u.height;R=Math.floor((R*X+f)*Gn),w=Math.floor((w*X+H)*Gn),c=Math.ceil(c*X*Gn)+1,j=Math.ceil(j*X*Gn)+1,V||(u.x=(R/Gn-f)/X,u.y=(w/Gn-H)/X,u.width=c/Gn/X,u.height=j/Gn/X),I.beginPath(),I.rect(R,w,c,j),I.clip(),I.clearRect(R,w,c,j),sp(I,f,H,X),x._42(I,u),I.restore(),delete x._74O}if(T.clear(),delete x._32I,delete x._forcedLayoutHTML,O&&e>0&&h>0){var S=x.getDataUI(O);if(S){var K=S._79o(),J=x._29I,D=J.x,F=J.y,Z=J.width,m=J.height,X=x._zoom;K&&!bi(K,J)&&(K.x+K.width<D&&x.tx(-K.x*X),K.x>D+Z&&x.tx(-(K.x+K.width-Z)*X),K.y+K.height<F&&x.ty(-K.y*X),K.y>F+m&&x.ty(-(K.y+K.height-m)*X))}delete x._23I}x._83I&&(delete x._83I,delete x._84I),x._98O(),x.countFrame(),Jb(x._24I)||ed(x.iv,x)},isValidGuideLineSource:function(){return!0},tryUpdateRootData:function(){if(!this._rootDataUpdating){this._rootDataUpdating=!0;var I,L=this.getFullscreenDatas();for(var D in L)I=L[D],this.scaleRootData(I);this.onRootDataUpdated&&this.onRootDataUpdated(),this._rootDataUpdating=!1}},scaleRootData:function(J){var t=J.s("fullscreen");if("uniform"===t||"fill"===t){J.getRotation()&&J.setRotation(0);var o=J.s("fullscreen.gap")||0,f=this.getWidth(),m=this.getHeight();if(f&&m){var n,y,z,B=f-2*o,H=m-2*o,R=J.getAnchor(),D=J.getScaledSize(),h=D.width,P=D.height,L=J.s("fullscreen.lock");if(L)return"uniform"===t?B/H>h/P?(n=H/P,h=P*B/H):(n=B/h,P=h*H/B):"v"===L?(n=H/P,h=B/n,J.getWidth()!==h&&J.setWidth(h)):(n=B/h,P=H/n,J.getHeight()!==P&&J.setHeight(P)),this.setZoom(n),y=o-(J.getX()-R.x*h)*n,z=o-(J.getY()-R.y*P)*n,y!==this.tx()&&this.tx(y),z!==this.ty()&&this.ty(z),void 0;y=this.tx(),z=this.ty(),n=this._zoom;var k={x:(-y+o)/n,y:(-z+o)/n,width:B/n,height:H/n};if("uniform"===t){var C=h/P,X=Math.min(k.width,k.height*C),T=X/C;k.x+=.5*(k.width-X),k.y+=.5*(k.height-T),k.width=X,k.height=T}B=k.width/J.getScaleX(),H=k.height/J.getScaleY(),(J.getWidth()!=B||J.getHeight()!==H)&&J.setSize(B,H);var q=k.x+R.x*k.width,b=k.y+R.y*k.height,I=J.getPosition();(q!==I.x||b!==I.y)&&J.setPosition(q,b)}}},isScrollBarVisible:function(){return!!this._79O},setScrollBarVisible:function(N){var q=this;N!==q.isScrollBarVisible()&&(N?(Ul(q._view,q._79O=eg()),Ul(q._79O,q._27I=eg()),Ul(q._79O,q._28I=eg())):(Pp(q._79O),delete q._79O,delete q._27I,delete q._28I),q.fp("scrollBarVisible",!N,N))},getDebugTip:function(){return""},showScrollBar:function(){var j=this;j._79O&&(j._85I||(hl(function(){j._86I()},xc),j.iv()),j._85I=new Date)},_86I:function(){var h=this;if(h._85I){var z=new Date,N=z.getTime();N-h._85I.getTime()>=xc?(delete h._85I,h.iv()):hl(function(){h._86I()},xc)}},getVScrollBar:function(){return this._27I},getHScrollBar:function(){return this._28I},_98O:function(){var D=this,b=this._27I,d=this._28I;if(D._79O){if(D._autoHideScrollBar&&!D._85I)return b.style.visibility=dm,d.style.visibility=dm,void 0;var R=D.getScrollBarColor(),r=D._zoom,m=D.getScrollBarSize(),P=D.getViewRect(),h=D.getScrollRect(),A=P.height*r,E=h.height*r,t=P.width*r-m-2,n=A*((P.y-h.y)*r/E),S=A*(A/E),s=b.style;E-.5>A?(ui>S&&(n=n+S/2-ui/2,0>n&&(n=0),n+ui>A&&(n=A-ui),S=ui),Ae(b,t,n,m,S),s.visibility=nb,s.background=R,s.borderRadius=m/2+Mq):s.visibility=dm;var z=P.width*r,F=h.width*r,n=P.height*r-m-2,t=z*((P.x-h.x)*r/F),L=z*(z/F),s=d.style;F-.5>z?(ui>L&&(t=t+L/2-ui/2,0>t&&(t=0),t+ui>z&&(t=z-ui),L=ui),Ae(d,t,n,L,m),s.visibility=nb,s.background=R,s.borderRadius=m/2+Mq):s.visibility=dm}},setDataModel:function(T){var o=this,g=o._dataModel,P=o._selectionModel;g!==T&&(g&&(g.ump(o.handleDataModelPropertyChange,o),g.umm(o.handleDataModelChange,o),g.umd(o.handleDataPropertyChange,o),g.removeIndexChangeListener(o._75O,o),g.removeHierarchyChangeListener(o.handleHierarchyChange,o),P||g.sm().ums(o.handleSelectionChange,o)),o._dataModel=T,T.mp(o.handleDataModelPropertyChange,o),T.mm(o.handleDataModelChange,o),T.md(o.handleDataPropertyChange,o),T.addIndexChangeListener(o._75O,o),T.addHierarchyChangeListener(o.handleHierarchyChange,o),P?P._21I(T):T.sm().ms(o.handleSelectionChange,o),o.invalidateAll(!0),o.fp(Bb,g,T),o.updateBackground())},getLayersInfo:function(){if(this._layersInfo===z){var o=this.getLayers();o?(this._layersInfo={},o.forEach(function(P){var $=Pd(P)?P.name:P;this._layersInfo[$]=P},this)):this._layersInfo=null}return this._layersInfo},calculateEdgePosition:function(e,w,f){var y,Z,h,F,K=this;e instanceof B.Data?(F=K.getDataUI(e),h=yn(F)):(h=yn(null,arguments[0],arguments[1]),w=arguments[2],f=arguments[3]),2===w.length&&(w=new wc(w[0],w[1]));var r=mp(w,function(e){return zs(h,100*e)},100,.001),t=zs(h,100*r);if(!f){var T=F?Gq(F):Gq(arguments[0],arguments[1]),P=new wc(t.x,t.y),g=49/(K._zoom*K._zoom);for(y=0,Z=T.length;Z>y;y++)if(P.distanceToSquared(T[y])<g)return{index:y,point:T[y],distance:Math.sqrt((T[y].x-w.x)*(T[y].x-w.x)+(T[y].y-w.y)*(T[y].y-w.y))}}return{percent:r,point:t,distance:Math.sqrt((t.x-w.x)*(t.x-w.x)+(t.y-w.y)*(t.y-w.y))}},getPercentPositionOfPath:function(f,J){var I;if(f instanceof B.Data){var Y=this.getDataUI(f);I=yn(Y)}else I=yn(null,arguments[0],arguments[1]),J=arguments[2];return zs(I,J)},getNeareastPositionOfPath:function(){return this.calculateEdgePosition.apply(this,arguments)},getPointsOfPath:function(){function F(F,K,I,q,j,A){var w=new wc(K.get(I)),p=A.apply(w);F.push({local:w,world:p,type:j,index:I,realIndex:q})}return function(I){var l,f;if(I instanceof B.Data){var u=this.getDataUI(I),W=Re(u);l=W.points,f=W.segments}else l=arguments[0],f=arguments[1];var d,o,L,y=I instanceof B.Shape?I.getPointsMatrix2d():new jl.Matrix2d,D=[],U=-1,G=-1;for(o=0,L=f?f.length:l.length;L>o;o++)d=f?f.get(o):1,5!==d&&(G++,3===d?(F(D,l,U+1,G,"C",y),F(D,l,U+2,G,"M",y),U+=2):4===d?(F(D,l,U+1,G-1,"R",y),F(D,l,U+2,G,"L",y),F(D,l,U+3,G,"M",y),U+=3):(F(D,l,U+1,G,"M",y),U+=1));return D}}(),calculateAttachPoint:function(){var y=new wc,H=new wc,Q=new wc;return function(V,B){var f=this.getAttachPoints(V);if(!f||!f.length)return null;Q.set(B.x,B.y);for(var g,Z,L,P,s,w=1/0,X=0,A=f.length;A>X;X++)L=f[X],H.x=L.x,H.y=L.y,y.x=L.offsetX||0,y.y=L.offsetY||0,P=Hj(this,V,0,y.x,y.y,H.x,H.y),Z=Q.distanceToSquared(P),w>Z&&(g=X,w=Z,s=P);w=Math.sqrt(w);var W=this.getAttachStyle(V);if("close"===W){var U=V.s("attach.close.threshold")/this._zoom;if(w>U)return null}return{index:g,distance:w,info:f[g],point:s}}}(),getAttachPoints:function(O){var k=O.s("attach.points");if(k)return k;var g=Td(O._image);return g?tp(g.attachPoints,O,this)||null:void 0},getAttachStyle:function(F){var W=F.s("attach.style");if(W)return W;var r=Td(F._image);return r?tp(r.attachStyle,F,this)||"close":void 0},updateLayers:function(){this._layersInfo=z,this.invalidateSelection(),this.redraw()},updateBackground:function(){var I=this.dm().a("width"),t=this.dm().a("height");this._canvas.style.background=I>0&&t>0?"":this.dm().getBackground()||""},handleDataModelPropertyChange:function(S){if("background"===S.property){var j=this._canvas.style.background,O=S.newValue||"";this.updateBackground(),this.fp("canvasBackground",j,O),this.redraw()}else"a:width"===S.property||"a:height"===S.property?(this._83I=1,this.updateBackground(),this.redraw()):"layers"===S.property?this.updateLayers():"hierarchicalRendering"===S.property&&this.redraw()},handleDataPropertyChange:function(e){this.dm().isHierarchicalRendering()&&"parent"===e.property&&e.data.hasChildren()&&this.redraw(),this.invalidateData(e.data)},onPropertyChanged:function(O){var o=this,q=O.property;if(o.redraw(),"zoom"===q){var i=o.sm().getSelection();i.size()&&i.each(function(d){d.invalidate()})}else"dataModel"===q&&(o._83I=1);Jp[q]?o.showScrollBar():q===Oe&&o.onCurrentSubGraphChanged(O)},onCurrentSubGraphChanged:function(){this.sm().cs(),this.reset()},handleDataModelChange:function(O){var $=this,W=O.kind,z=O.data;if($._83I=1,"add"===W)$.invalidateData(z),kh(z)&&z.getEdgeGroup()&&z.getEdgeGroup().eachSiblingEdge($.invalidateData,$),z.getHost&&z.getHost()&&z.getHost().updateLayoutAttaches();else if(W===Ib){$._21Q(z);var H=z._id,V=$._25I[H];if(V){if($._56I[H]){var q=V._79o();q&&$.redraw(q)}V.dispose(),delete $._25I[H],delete $._24I[H],delete $._56I[H]}z===$._currentSubGraph&&$.setCurrentSubGraph(I)}else W===jr&&($.invalidateAll(!0),$.setCurrentSubGraph(I))},_75O:function(F){this.invalidateData(F.data)},handleHierarchyChange:function(f){this.dm().isHierarchicalRendering()&&f.data.hasChildren()&&this.redraw(),this.invalidateData(f.data)},adjustIndex:function(K){var q=this;if(q.isVisible(K)){q.dm().beginTransaction();for(var n=K;n._parent&&q.isVisible(n._parent);)n=n._parent;n&&n!==K&&q._dataModel.adjustIndex(n),q._dataModel.adjustIndex(K),q.dm().endTransaction()}},getImage:function(a){return a.getImage?a.getImage():z},getSelectWidth:function(H){var D=Td(this.getImage(H));return D&&tp(D.disableSelectedBorder,H,this)?0:H.s("select.width")},getSelectColor:function(R){return R.s("select.color")},isSelectable:function(f,l){if(this.isSelected(f))return!0;if(!l&&f.getParent()instanceof Xl&&this.isSelectable(f.getParent(),!0)&&f.getParent().isSyncSize())return!1;var H=this.getLayersInfo();if(H){var K=H[f._layer];if(K&&K.selectable===!1)return!1}return f.s("2d.selectable")&&this.sm().isSelectable(f)},isMovable:function(u){var v=this;if(kh(u)&&u.getStyle(bq)!==vr)return!1;var T=this.getLayersInfo();if(T){var Z=T[u._layer];if(Z&&Z.movable===!1)return!1}return u.s("2d.movable")?v._movableFunc?v._movableFunc(u):!0:!1},isEditable:function(o){var e=this;if(B._uiSerializing)return e._uieditable;if(!e._editInteractor||!e.isSelected(o))return!1;if(wp(o)){var $=e.getDataUI(o);if(!$||$._88I)return!1}if(kh(o)&&o.getStyle(bq)!==vr)return!1;var u=this.getLayersInfo();if(u){var M=u[o._layer];if(M&&M.editable===!1)return!1}return o.s("2d.editable")?e._editableFunc?e._editableFunc(o):!0:!1},handleDelete:function(){this._editInteractor&&(this._editInteractor.handleDelete?this._editInteractor.handleDelete():this.removeSelection())},isPointEditable:function(T){return Dg(T)&&0!==T.getRotation()?!1:this._pointEditableFunc?this._pointEditableFunc(T):!0},isRectEditable:function(q){return this._rectEditableFunc?this._rectEditableFunc(q):!0},isAnchorEditable:function(s){return this._anchorEditableFunc?this._anchorEditableFunc(s):!0},isRotationEditable:function(G){return G.setRotation&&G.IRotatable!==!1?this._rotationEditableFunc?this._rotationEditableFunc(G):!0:!1},isSourceTargetEditable:function(){return!0},getRotationPoint:function(d){var h=d.getAnchor(),m=d.getScale(),v=this._zoom,Z=ij(d.getRotation(),0,-d.getHeight()*m.y*h.y-(m.y<0?-1:1)*(gj?32:16)/v),Q=d.p();return Z.x+=Q.x,Z.y+=Q.y,Z},getLogicalPoint:function(I){var U=this;return Lf(I,U._canvas,U.tx(),U.ty(),U._zoom,U._zoom)},getScreenPoint:function(x,$){var A,y=this;return"object"==typeof x?x.x!==z?(A=x.x,$=x.y):(A=x[0],$=x[1]):A=x,to(A,$,y._canvas,y.tx(),y.ty(),y._zoom,y._zoom)},getSelectedDataAt:function(J){var U=this;return this.getDataAt(J,function(r){return U.isSelected(r)})},getDataInfoAt:function($,b,l){var r,H=this.lp($),e=this.getDataAt(H,b,l);if(e){var A=this.getDataUI(e);r={data:e,ui:A,point:H};var P=A._38o;if(P){var m=P.icons;for(var z in m){var h=m[z],W=P.rects[z];if(W)for(var T=tp(h.names,e,this),Q=T?T.length:0,n=W.rotation,o=Q-1;o>=0;o--){var k=T[o],Z=W[o];if(cj(Z,H,n))return r.part="icons",r.name=z,r.icon=k,r.rect=Z,r.index=o,r.rotation=n,r}}}if(this.isNoteVisible(e)){if(A.note2Info&&cj(A.note2Info.clickRect,H,I,A.note2Info.scale))return r.part="note2",r;if(A.noteInfo&&cj(A.noteInfo.clickRect,H,I,A.noteInfo.scale))return r.part="note",r}if(this.isLabelVisible(e)){if(A.label2Info&&cj(A.label2Info.rect,H,A.label2Info.rotation,A.label2Info.scale))return r.part="label2",r;if(A.labelInfo&&cj(A.labelInfo.rect,H,A.labelInfo.rotation,A.labelInfo.scale))return r.part="label",r}if(e.isInRect&&e.isInRect(H))return r.part="body",r}return r},getDataAt:function(E,c,K){E.target&&(E=this.lp(E));var i,f=this._zoom;return this.reverseEach(function(k){return(c?c(k):this.isSelectable(k))&&this.rectIntersects(k,dp(E.x,E.y,K,f))?(i=k,!1):void 0},this),i},getIconInfoAt:function(t,G){var w=this;if(t.target&&(t=w.lp(t)),G||(G=w.getDataAt(t)),G){var X=w.getDataUI(G);if(X&&X._38o){var C,D=X._38o,i=new Gk;for(C in D.icons)i.add(C);for(var s=i.size()-1;s>=0;s--){C=i.get(s);for(var K=D.rects[C],L=K.rotation,R=K.length-1;R>=0;R--){var v=K[R],J=v.width,e=v.height,F={x:t.x-v.x-J/2,y:t.y-v.y-e/2};L!=I&&(F=ij(-L,F.x,F.y));var v={x:-J/2,y:-e/2,width:J,height:e};if(cj(v,F))return{key:C,index:R,name:D.icons[C].names[R],rect:K[R],point:t,rotation:L,relativeRect:v,relativePoint:F,data:G}}}}}return I},getDatasInRect:function(K,x,m){m===z&&(m=1);var I=this,Z=new Gk;return I.reverseEach(function(g){m&&!I.isSelectable(g)||(x?I.rectIntersects(g,K):I.rectContains(g,K))&&Z.add(g)}),Z},moveSelection:function(d,T){var b=this;b.dm().beginTransaction(),wf(b.sm().toSelection(b.isMovable,b),d,T),b.dm().endTransaction()},moveDatas:function(Z,w,i){var r=this;r.dm().beginTransaction(),Z instanceof Gk||(Z=new Gk(Z)),wf(Z,w,i),r.dm().endTransaction()},getDataUIBounds:function(F){var Z=this.getDataUI(F);return Z?Z._79o():I},drawData:function(_,F,R){var h=this.getDataUI(F);if(h){var w=h._79o();(!R||bi(R,w))&&(h._42(_),F instanceof B.Block&&F.eachChild(function(J){this.isVisible(J)&&this.drawData(_,J,R)},this))}},getBoundsForGroup:function(w){return w.s(Uo)?this.getDataUIBounds(w):I},isPixelPerfect:function(n){return n.s("pixelPerfect")},rectIntersects:function(L,F){this.validate();var f=I;if(this._56I[L._id]){var P=this._25I[L._id];if(P){var t=P._79o();if(Nc(F,t))f=!0;else if((F=cp(F,t))&&(P.rectIntersects&&(f=P.rectIntersects(F)),f==I)){if(!this.isPixelPerfect(L))return!0;var S=F.x,B=F.y,J=F.width,E=F.height,a=this._zoom,v=R.hitMaxArea,r=J*E*a*a;if(r>v){var c=Math.sqrt(v/r);a*=c}J*=a,E*=a,2>J&&(J=2),2>E&&(E=2),S*=a,B*=a;var b=sb(J,E);or(b,-S,-B),b.scale(a,a),this._drawForChecking=!0,this.drawData(b,L,F),this._drawForChecking=!1;try{for(var x=0,K=b.getImageData(0,0,J,E).data;x<K.length;x+=4)if(0!==K[x+3]){f=!0;break}b.restore()}catch(A){bp=I,f=!1}}}}return f?!0:!1},rectContains:function(t,M){if(this._56I[t._id]){var X=this._25I[t._id];if(X)return Nc(M,X._79o())}return!1},reset:function(){this.setZoom(1),this.setTranslate(0,0)},handleKeyDown:function(n){if(!R.isInput(n.target)){var $=this,_=$._focusData,Z=_&&$._25I[_._id],J=0,u=$._dataModel._datas;if(!(_&&_._enabled&&_._editable&&Z&&Z.onKeyDown&&Z.onKeyDown(n)===!0))if(9===n.keyCode&&(_&&(J=u.indexOf(_),Ac(n)?-1===--J&&(J=0):++J===u.size()&&(J=0)),$._focusData=_=u.get(J),$.sm().setSelection(_)),bm(n)?$.selectAll():tl(n)&&$.isResettable()&&$.reset(),$.sm().isEmpty()){if($._editing)return;var q=$.tx(),K=$.ty(),y=!1,s=Ac()?100:10;so(n)&&(q-=s,y=!0),Kc(n)&&(K-=s,y=!0),lf(n)&&(q+=s,y=!0),Yb(n)&&(K+=s,y=!0),y&&$.setTranslate(q,K)}else{Zr(n)&&$.handleDelete(n);var b=Ac()?10:1;so(n)&&($.moveSelection(-b,0),$.fi({kind:"moveLeft"})),Kc(n)&&($.moveSelection(0,-b),$.fi({kind:"moveUp"})),lf(n)&&($.moveSelection(b,0),$.fi({kind:"moveRight"})),Yb(n)&&($.moveSelection(0,b),$.fi({kind:"moveDown"}))}}},handleScroll:function(L,O){if(cl(L),this.isZoomable()){if(!this.getEditInteractor()){var B=this.getDataAt(L);if(B){var Y=Td(this.getImage(B));if(Y&&tp(Y.scrollable,B,this))return}}var D=this.getFullscreenDatas();for(var J in D)if(D[J].s("fullscreen.lock"))return;var X=this.lp(L);O>0?this.scrollZoomIn(X):0>O&&this.scrollZoomOut(X)}},handlePinch:function(Y,e,X){this.isZoomable()&&(Math.abs(e-X)<R.pinchZoomThreshold||(e>X?this.pinchZoomIn(Y):this.pinchZoomOut(Y)))},checkDoubleClickOnNote:function(L,R){var J=this,C=J.lp(L),q=J.getDataUI(R),X=q.note2Info;return X&&R.s("note2.toggleable")&&cj(X.clickRect,C)?(R.s(wq,!R.s(wq)),J.fi({kind:"toggleNote2",event:L,data:R}),!0):(X=q.noteInfo,X&&R.s("note.toggleable")&&cj(X.clickRect,C)?(R.s(yg,!R.s(yg)),J.fi({kind:"toggleNote",event:L,data:R}),!0):!1)},_84o:function(){},isNoteVisible:function(){return this._zoom>.15},isLabelVisible:function(){return this._zoom>.15},isEditVisible:function(){return this._zoom>.15},autoScroll:function(o,G){var q=this,x=q.getAutoScrollZone(),h=x/q.getZoom(),m=x/4,n=q._29I,p=q.lp(o),W={x:q.tx(),y:q.ty()};return p&&x>0&&n&&(p.x-n.x<h?q.translate(m,0):n.x+n.width-p.x<h&&q.translate(-m,0),p.y-n.y<h?q.translate(0,m):n.y+n.height-p.y<h&&q.translate(0,-m)),W.x=q.tx()-W.x,W.y=q.ty()-W.y,G&&(G.x+=W.x,G.y+=W.y),W},getMoveMode:function(R,D){var k=D.s("2d.move.mode");return k?k:_i["88"]?"x":_i["89"]?"y":"xy"},getSerializableProperties:function(){return{scrollBarColor:1,scrollBarSize:1,autoMakeVisible:1,autoHideScrollBar:1,editable:1,resettable:1,pannable:1,rectSelectable:1,autoScrollZone:1,visibleFunc:1,movableFunc:1,editableFunc:1,pointEditableFunc:1,rectEditableFunc:1,anchorEditableFunc:1,rotationEditableFunc:1,rectSelectBackground:1,rectSelectBorderColor:1,editPointSize:1,editPointBorderColor:1,editPointBackground:1,hoverDelay:1,dataModel:1,selectionModel:1,currentSubGraph:1,zoom:1,translateX:1,translateY:1}},serializeProperty:function(f,w,b){var q=this;return"currentSubGraph"===w?{__i:f.getId()}:b.serializeProperty(f,w,q)},deserializeProperty:function(K,J,g){var n=this;if("currentSubGraph"===J){var S=n.dm(),t=S.__idMap;return t[K.__i]}return g.deserializeProperty(K,J,n)},setDefaultCursor:function(T,d){this._defaultCursor=T,d!==!1&&this.setCursor(T)},getCurrentConnectActionType:function(){return this._currentActionType},setCurrentConnectActionType:function(C){return C===I||R.getConnectAction(null,C)?(this._currentActionType=C,this.redraw(),!0):!1},getEditStyle:function(a){var y=this.getEditInteractor();return y?y.getStyle(a):z},setEditStyle:function(D,v,V){var l=this.getEditInteractor();return l?(l.setStyle(D,v,V),!0):!1},isConnectActionVisible:function(Q){var h=R.getConnectAction(this);if(!h)return!1;var X=h.visible;return Hn(X)&&(X=X(this,Q)),X},isInteractive:function(P){if(this._drawForChecking)return!1;var u=Td(this.getImage(P));return u&&tp(u.interactive,P,this)?!0:P.s("interactive")},getRenderingStyleIconName:function(){return $i},appendHTML:function(R,g){var I=this.getView();if(!(g||R&&R.parentNode!==I))return!1;var Y=R.getView&&R.getView(),V=R.beforeCanvas;if(!g&&Y&&Y.parentNode===I)return!1;(R.getView||R.isSelfViewEvent)&&(R=R.getView());var r=this.getEditInteractor();return V?I.insertBefore(R,this.getCanvas()):r&&r._canvas?I.insertBefore(R,r._canvas):this.isScrollBarVisible()?I.insertBefore(R,this.getView().lastChild):Ul(I,R),!0},_layoutHTMLImpl:function(f,F,v){if(arguments.length>1){var L,U=this,Y=U._zoom;if(F.getView&&(L=F,F=F.getView()),F.style.position="absolute",v){var M=f.getRect();Ae(L||F,U.tx()+M.x*Y,U.ty()+M.y*Y,M.width*Y,M.height*Y)}else{var V=new sn,M=f.getAnchorRect(),y=f.getPosition(),X=f.getScale(),b=F.style;Ae(L||F,M),V.appendTranslate(U.tx(),U.ty()),V.appendScale(Y,Y),V.append(new sn(f.getRotation(),y.x,y.y,X.x,X.y)),Od(b,"transform","matrix("+V.a.toFixed(5)+", "+V.b.toFixed(5)+", "+V.c.toFixed(5)+",\n    "+V.d.toFixed(5)+", "+V.tx.toFixed(5)+", "+V.ty.toFixed(5)+")"),Od(b,"transformOrigin",(-M.x).toFixed(5)+"px "+(-M.y).toFixed(5)+"px"),F.updateAppendMatrix=!0}}else this._layoutHTML&&this._layoutHTML()},getTextEditInfo:function(u){return u instanceof _k?{name:"text",accessType:"s",font:u.s("text.font"),isMultiline:!0}:void 0},getState:function(u){var U="state",n=u.s(U);if(n)return n;var A=Td(u._image);return A?tp(A[U],u,this)||null:void 0},getShape:function(d){return d.getStyle($l)}}),T.defineProperties(Ap.GraphView.prototype,{layoutHTML:{get:function(){return this._layoutHTMLImplBind||(this._layoutHTMLImplBind=this._layoutHTMLImpl.bind(this)),this._layoutHTMLImplBind},set:function(i){this._layoutHTML=i}}});var td=function(e,h){var c=this;c.gv=e,c.s=function(G){return h.getStyle(G)},c._data=h,c._87I=new Gk},$i=I;Lp(td,T,{_6I:I,ms_icons:1,_84o:function(){},dispose:function(){},isShadowed:function(){return this.s("shadow")||this.gv.isSelected(this._data)&&"shadow"===this.s("select.type")},getSelectWidth:function(){var E=this,O=E.gv.isSelected(E._data);return!O||E.isShadowed()?0:E.gv.getSelectWidth(E._data)},getSelectColor:function(){return this.gv.getSelectColor(this._data)},getBodyColor:function(H){var G=this._data,z=this.gv.getBodyColor(G);return z?z:H?G.getStyle(H):I},_2Q:function(C){return this.s(C)},_1Q:function(F,X,y,k){var B=this.s,q=B("2d.gray"),Y=B(X+".dash.color");if(q&&(Y=R.toGrayColor(Y)),F.strokeStyle=Y,F.lineWidth=y,F.stroke(),B(X+".dash.3d")){var Q=B(X+".dash.3d.color");sh(F,Y,q?R.toGrayColor(Q):Q,y,this.gv._zoom,B(X+".dash.3d.accuracy"))}vk(F,k)},invalidate:function(){this._6I=I},_79o:function(){var D=this;if(!D._6I){var z=D._data,P=D.gv;D.labelInfo=D.label2Info=D.noteInfo=D.note2Info=D._38o=I,D._87I.clear(),D.interactiveInfo=P.isInteractive(z)?{}:I,D._3O(),D._55O=P.isEditable(z)?{_42O:P.isRectEditable(z),_43O:P.isPointEditable(z),_56O:P.isRotationEditable(z)}:I,D._6I=D._81o()}return D._6I},_3O:function(){},getPosition:function(){return Mn},_68o:function(Z,W){Z&&this._87I.add(Sh(Z,W))},_81o:function(){var m=this,u=m.s;m._24O(sm,"getLabel"),m._24O(zl,"getLabel2"),m._26O(Si,"getNote"),m._26O(bl,"getNote2"),m._15O(),m._55O&&m._48O();var s;if(m._87I.each(function(O){s=xr(s,O)}),s&&u("shadow.interactable")){var V=m.isShadowed(),x=u("shadow2"),g=sj(s);x?(g.x+=u("shadow2.offset.x"),g.y+=u("shadow2.offset.y"),xs(g,u("shadow2.blur"))):V&&(g.x+=u("shadow.offset.x"),g.y+=u("shadow.offset.y"),xs(g,u("shadow.blur"))),s=xr(s,g)}return m._87I.clear(),s},_42:function(E){var U=this,d=U._data,t=U.gv,b=U.s,$=b("opacity"),X=this.isShadowed(),h=b("shadow2");if(X||h){var j=E.shadowOffsetX,n=E.shadowOffsetY,Z=E.shadowBlur,s=E.shadowColor,N=t.getZoom()*R.devicePixelRatio,L=X?"shadow":"shadow2";E.shadowOffsetX=b(L+".offset.x")*N,E.shadowOffsetY=b(L+".offset.y")*N,E.shadowBlur=b(L+".blur")*N,E.shadowColor=X?U.getSelectColor():b(L+".color")}if($!=I){var Y=E.globalAlpha;E.globalAlpha=$}U._80o(E),t.isLabelVisible(d)&&((!t._drawForChecking||b("label.selectable"))&&Gd(E,U.labelInfo),(!t._drawForChecking||b("label2.selectable"))&&Gd(E,U.label2Info)),t.isNoteVisible(d)&&(tg(E,U.noteInfo),tg(E,U.note2Info)),U._99O(E),$!=I&&(E.globalAlpha=Y),(X||h)&&(E.shadowOffsetX=j,E.shadowOffsetY=n,E.shadowBlur=Z,E.shadowColor=s)
},_80o:function(){},_47O:function(){},_24O:function(Y,g){var _=this,z=_._data,$=_.gv,s=_.s,e=$[g](z);if(e!=I){var f=s(Y+".scale"),Q=s(Y+".max"),t=s(Y+".position"),h=_[Y+"Info"]={label:e,scale:f,color:$[g+"Color"](z),font:s(Y+".font"),opacity:s(Y+".opacity"),align:s(Y+".align"),decoration:s(Y+".decoration"),rotation:_.getRotation(s(Y+".rotation"),!1,t),background:$[g+"Background"](z)},V=Yj(h,e);Q>0&&Q<V.width&&(h.labelWidth=V.width,V.width=Q),1!==f&&(V.width*=f,V.height*=f);var G=_.getPosition(t,s(Y+".offset.x"),s(Y+".offset.y"),V,s(Y+".position.fixed"));if(V.x=G.x-V.width/2,V.y=G.y-V.height/2,_._68o(h.rect=V,h.rotation),1!==f){var B=V.width/f,C=V.height/f;h.rect={x:G.x-B/2,y:G.y-C/2,width:B,height:C}}}},_26O:function(t,u){var V=this,S=V.gv,_=V._data,q=V.s,H=S[u](_);if(H!=I){var p,U,Y=q(t+".scale"),d=V[t+"Info"]={note:H,scale:Y,data:_,view:S,expanded:q(t+".expanded"),font:q(t+".font"),color:q(t+".color"),opacity:q(t+".opacity"),align:q(t+".align"),icon:q(t+".icon"),backgroundImage:q(t+".backgroundImage"),borderWidth:q(t+".border.width"),borderColor:q(t+".border.color"),background:S[u+"Background"](_)},F=V.getPosition(q(t+".position"),q(t+".offset.x"),q(t+".offset.y")),K=F.x,e=F.y;if(d.expanded){var n,v=q(t+".max"),B=q(t+".backgroundImage");B?(B=Td(B),n={width:nr(B,_),height:kd(B,_)}):n=Yj(d,H),n.width+=6,n.height+=2,v>0&&v<n.width&&(d.labelWidth=n.width,n.width=v),p=n.width,U=n.height+8,d.clickRect={x:K-p*Y/2,y:e-U*Y,width:p*Y,height:U*Y*n.height/U}}else{var J=q(t+".icon");J?(J=Td(J),p=nr(J,_),U=kd(J,_)):(p=12,U=18),d.clickRect={x:K-p*Y/2,y:e-U*Y,width:p*Y,height:U*Y}}d.rect={x:K-p/2,y:e-U*Y/2-U/2,width:p,height:U};var P=$(d.borderWidth/2)*Y;V._68o({x:K-p*Y/2-P,y:e-U*Y-P,width:p*Y+2*P,height:U*Y+2*P})}},_48O:function(){},_99O:function(W){var Y=this,u=Y._38o;if(u){var e=Y.gv,R=Y._data,E=u.icons,a=Y.interactiveInfo;a&&(a._38o={});for(var J in E){var z=E[J],m=u.rects[J];if(m){a&&(a._38o[J]=[]);var P=tp(z.opacity,R,e),K=tp(z.names,R,e),X=K?K.length:0,b=m.rotation;if(P!=I){var x=W.globalAlpha;W.globalAlpha*=P}for(var O=0;X>O;O++){var A=K[O],w=Td(A),G=m[O];if(b){var Z=G.x+G.width/2,N=G.y+G.height/2;W.save(),or(W,Z,N),Aj(W,b),or(W,-Z,-N)}a&&a._38o[J].push(W.interactiveInfo={compInfos:[],matrix:b?new sn(b,Z,N).appendTranslate(-Z,-N):new sn});var k=$i;$i=J,_n(W,w,tp(z.stretch,R,e),G.x,G.y,G.width,G.height,Y._data,Y.gv),$i=k,W.interactiveInfo=I,b&&W.restore()}P!=I&&(W.globalAlpha=x)}}}}});var Kg=function(T,Y){yd(Kg,this,[T,Y])};Lp(Kg,td,{_checkEmptyRect:!0,_40O:function(I,N){var q=this,W=q.s,s=I.rect;(I.borderColor=q.gv.getBorderColor(q._data))&&(I.borderType=W("border.type"),I.borderWidth=W("border.width"),I.borderPadding=W("border.padding"),N=o(N,I.borderPadding+I.borderWidth/2));var L=q._data.getScale(),G=o(1,o(i(L.x),i(L.y)));if(I.selectWidth=q.getSelectWidth()){var H=q.gv._zoom;I.selectType=W("select.type"),I._97o=q.getSelectColor(),I.selectPadding=W("select.padding"),N=o(N,(I.selectPadding+I.selectWidth/2/H)/G)}N>0&&(N*=G,s=sj(s),xs(s,N)),q._68o(s)},_39O:function(G,L){var $,O=this,w=L.rect;if(L.borderWidth>0&&($=L.borderPadding,G.strokeStyle=L.borderColor,G.lineWidth=L.borderWidth,os(G,L.borderType,{x:w.x-$,y:w.y-$,width:w.width+2*$,height:w.height+2*$}),G.stroke()),L.selectWidth>0){var v=O.gv._zoom;if($=L.selectPadding,G.strokeStyle=L._97o,G.lineWidth=L.selectWidth/v,L.rotation!=I){G.save(),G.translate(L.position.x,L.position.y),G.rotate(L.rotation);var E=O._data,M=E.getWidth(),u=E.getHeight(),r=L.scale,D=L.anchor;w={x:r.x*-M*D.x,y:r.y*-u*D.y,width:r.x*M,height:r.y*u}}os(G,L.selectType,{x:w.x-$,y:w.y-$,width:w.width+2*$,height:w.height+2*$}),L.rotation!=I&&G.restore(),G.stroke()}},dispose:function(){var y=this,M=y._htmlView;Kg.superClass.dispose.call(y),M&&(M.onHTMLRemoved&&M.onHTMLRemoved(),Pp(M))},_3O:function(){var f,q=this,a=q.s,d=q._data,j=q.gv,y=j.getShape(d),A=q.getBodyColor(),v=a("shape.border.color"),G=q._83o=y?{shape:y,_53o:q.getBodyColor("shape.background"),_27Q:Td(a("shape.repeat.image"),A),shapeGradientPack:a("shape.gradient.pack"),shapeBorderGradientPack:a("shape.border.gradient.pack"),_54o:a("shape.border.width"),_55o:v,shapeBorderRepeatImage:Td(a("shape.border.repeat.image"),v),_56o:a("shape.border.3d"),_57o:a("shape.border.3d.color"),_58o:a("shape.border.3d.accuracy"),shapeGradient:a("shape.gradient"),_59o:a("shape.gradient.color"),_60o:a("shape.border.pattern"),_61o:a("shape.border.cap"),_62o:a("shape.border.join"),shapeForeground:a("shape.foreground"),bodyColor:A,gray:a("2d.gray")}:{img:Td(j.getImage(d),A),bodyColor:A,gray:a("2d.gray"),stretch:a("image.stretch")},h=G.img;h&&h.renderHTML?(q._htmlInfo&&q._htmlInfo.img!==h&&(q._htmlInfo=I),q._htmlInfo||(q._htmlInfo={img:h,cache:{}}),f=h.renderHTML(d,j,q._htmlInfo.cache)):q._htmlInfo=I,q._htmlView&&q._htmlView!==f&&(q._htmlView.onHTMLRemoved&&q._htmlView.onHTMLRemoved(),Pp(q._htmlView.getView?q._htmlView.getView():q._htmlView)),(q._htmlView=f)&&j.appendHTML(f)&&(f.onHTMLAddedSync&&f.onHTMLAddedSync(),f.onHTMLAdded&&ed(f.onHTMLAdded)),G.rect=d.getRect(),G.position=d.p(),G.scale=d.getScale(),G.anchor=d.getAnchor(),G.rotation=d.getRotation(),y===fk&&(G._63o=a("shape.depth"));var J=0;if(y)J=Wj(I,G._54o/2,G._62o),q.s("shape.dash")&&(J=o(J,(q.s("shape.dash.width")||G._54o)/2));else if(h&&h.boundExtend)if(J=tp(h.boundExtend,d,j),h.boundExtendAbsolute){var r=d.getScale();J/=j._zoom*o(1,o(i(r.x),i(r.y)))}else if(!tp(h.fitSize,d,j)){var x=tp(h.width,d,j),V=tp(h.height,d,j);J*=o(d.getWidth()/x,d.getHeight()/V)}q._40O(G,J);var n=a("clip.percentage");if(n!=z&&(G.clipRect=ur(d.getAnchorRect(),a("clip.direction"),n)),y){var T=a("shape.fill.clip.percentage");T!=z&&(G.shapeClipRect=ur(d.getAnchorRect(),a("shape.fill.clip.direction"),T));var F=a("shape.foreground.clip.percentage");F!=z&&(G.shapeForegroundClipRect=ur(d.getAnchorRect(),a("shape.foreground.clip.direction"),F))}var N=a("clip.host");N&&d.getHost()&&(G.clipHost=!0)},getPosition:function(l,Y,G,R){var z=Xc(l,this._83o.rect,R);return z.x+=Y,z.y+=G,z},_80o:function(V){var m=this,v=m.s,q=m.gv,G=m._data,d=m._83o,a=d.rect,s=d.position,W=d.rotation,h=d.anchor,O=d.scale,y=d.shape,J=d.clipHost,Q=d.clipRect;if(!m._checkEmptyRect||a.width>0&&a.height>0){if(J){var B=G.getHost().getCorners();V.save(),V.beginPath(),B.forEach(function(X,e){e?V.lineTo(X.x,X.y):V.moveTo(X.x,X.y)}),V.clip()}var D=G.getSize();if(D.x=-D.width*h.x,D.y=-D.height*h.y,yi&&!Jf&&or(V,D.width,D.height),V.save(),or(V,s.x,s.y),Aj(V,W),qs(V,O.x,O.y),Q&&(V.beginPath(),V.rect(Q.x,Q.y,Q.width,Q.height),V.clip()),q._drawForChecking&&d.img&&tp(d.img.pixelPerfect,G,q)===!1)gk(V,D.x,D.y,D.width,D.height,"#888888");else if(m.freeDraw)m.freeDraw(V,D,d);else if(y){var L,x,N,$,P=d._60o,p=tm(V,P),j=d._27Q,f=d._54o,e=d.shapeGradientPack,U=d.gray,r=V.lineJoin,H=V.lineCap,T=function(w){return U?R.toGrayColor(w):w};"roundRect"===y?L=v("shape.corner.radius"):"polygon"===y?(L=v("shape.polygon.side"),x=v("shape.corner.radius"),N=v("shape.regular")):"arc"===y&&(L=v("shape.arc.from"),x=v("shape.arc.to"),N=v("shape.arc.close"),$=v("shape.arc.oval")),V.lineJoin=d._62o,V.lineCap=d._61o;var t=T(d._53o);if(t||j||e){var u=d.shapeClipRect;u&&(V.save(),V.beginPath(),V.rect(u.x,u.y,u.width,u.height),V.clip()),os(V,y,D,L,x,N,$),e?zr(V,e,function($){return pb($,d.bodyColor)},!1,D):j?Dl(V,j,T(d.bodyColor),null,G,q):jp(V,t,d.shapeGradient,T(d._59o),D),V.fill(),e&&V.restore(),u&&V.restore(),V!==p&&os(p,y,D,L,x,N,$)}else os(p,y,D,L,x,N,$);var Z=d.shapeForeground;if(Z){V.save();var C=d.shapeForegroundClipRect;C&&(V.beginPath(),V.rect(C.x,C.y,C.width,C.height),V.clip()),os(V,y,D,L,x,N,$),jp(V,Z,v("shape.foreground.gradient"),T(v("shape.foreground.gradient.color")),D),V.fill(),V.restore()}if(f>0){var l=v("shape.border.width.absolute");l&&(V.save(),V.setTransform(1,0,0,1,0,0)),V.lineWidth=f;var K=T(d._55o),F=d.shapeBorderGradientPack;F?zr(V,F,T,!0,D):d.shapeBorderRepeatImage?Pq(V,d.shapeBorderRepeatImage,K,null,G,q):V.strokeStyle=K,V.stroke(),F&&V.restore(),l&&V.restore(),d._56o&&sh(V,K,T(d._57o),f,q._zoom,d._58o)}if(vk(V,P),v("shape.dash")){var z=v("shape.dash.width")||f;if(z>0){P=v("shape.dash.pattern");var p=tm(V,P,m._2Q("shape.dash.offset"));p!==V&&os(p,y,D,L,x,N,$),m._1Q(V,"shape",z,P)}}Pe(V,t,d._63o,D),V.lineJoin=r,V.lineCap=H}else{var E=m.interactiveInfo;E&&(V.interactiveInfo=E.bodyInfo={compInfos:[],matrix:new sn(W,s.x,s.y,O.x,O.y)}),d.gray&&(V.compGray=!0);var k=d.img;k&&k.cacheRule!=I&&(k=bc(V,k,d.stretch,D.width,D.height,G,q,d.bodyColor)),_n(V,k,d.stretch,D.x,D.y,D.width,D.height,G,q,d.bodyColor),V.compGray=!1,V.interactiveInfo=I}V.restore(),J&&V.restore()}m._39O(V,d)},_48O:function(){},_47O:function(){}});var Xd=function(V,n){yd(Xd,this,[V,n])},mk=function(O,R,I,B){var y=Jc(O,R);return I=B?X(I,y):om(I,y),y?I/=y:I=0,{x:O.x+(R.x-O.x)*I,y:O.y+(R.y-O.y)*I}};Lp(Xd,td,{_3O:function(){var A,Q=this,W=Q._data,v=Q.gv,u=Q.s,B=u(bq),d=W.isLooped(),U=u("edge.width"),D=Q.getBodyColor("edge.color"),m=u("edge.center"),P=u("edge.offset"),k=v.getBorderColor(W),t=k?u("border.width"):0,N=Q.getSelectWidth(),M=W._40I,i=W._41I,w=Q._78o=M&&i?{looped:d,type:B,width:U,center:m,color:D,repeatImage:Td(u("edge.repeat.image"),D),borderColor:k,borderWidth:t,_97o:N?Q.getSelectColor():I,selectWidth:N,pattern:u("edge.pattern"),cap:u("edge.cap"),join:u("edge.join"),is3d:u("edge.3d"),_67o:u("edge.3d.color"),_66o:u("edge.3d.accuracy"),gray:u("2d.gray")}:I;if(w){var j=R.getEdgeType(B);if(j){var V=j(W,Kq(Q,v,W,d,B),v,Q._19Q);V.points&&V.points.size()>1?(w.edgeTypeInfo=V,A=Gj(w.edgeTypeInfo.points)):V[Op]&&V.rect&&(w.edgeTypeInfo=V,A=V.rect)}else{var b=u("edge.source.anchor.x"),K=u("edge.source.anchor.y"),Y=u("edge.target.anchor.x"),G=u("edge.target.anchor.y"),X=Hi(v,W,"source"),O=Hi(v,W,"target");if(B===vr){var a=w.points=u(Sd)||De,Z=a.size();w.segments=u("edge.segments");var r=b!==z||K!==z||kh(M),C=Y!==z||G!==z||kh(i);if(!m)if(P)r||(X=mk(X,Z?a.get(0):O,P,Z)),C||(O=mk(O,Z?a.get(Z-1):X,P,Z));else{var f;r||(f=Mm(X,Z?a.get(0):O,Qj(v,M)),f&&(X={x:f[0],y:f[1]})),C||(f=Mm(Z?a.get(Z-1):X,O,Qj(v,i)),f&&(O={x:f[0],y:f[1]}))}A=xr(Gj(w.points),Gj(X,O))}else{var e=Kq(Q,v,W,d,B);if(Q._19Q||(e=-e),d)X=sj(X),X.x=v.getNodeRect(M).x,w.radius=e,A={x:X.x-e,y:X.y-e,width:2*e,height:2*e};else{var c=Jc(X,O),J=om(P,c),S={x:J,y:e},h={x:c-J,y:e},H=Wd(O.y-X.y,O.x-X.x),F=w.mat=new Mc(H);if(w.orienAngle=H,w.angle=O.x<X.x?H+L:H,w.rect={x:S.x,y:S.y,width:h.x-S.x,height:0},w.origin=X,S=F.tf(S),S.x+=X.x,S.y+=X.y,h=F.tf(h),h.x+=X.x,h.y+=X.y,m){var T={x:c,y:0};T=F.tf(T),T.x+=X.x,T.y+=X.y,A=Gj([X,S,h,T]),w.c1=X,w.c2=T}else A=Gj(S,h);X=S,O=h}}w.sourcePoint=X,w.targetPoint=O,W._lastSourcePoint=X,W._lastTargetPoint=O}var p=0;u("edge.dash")&&(p=u("edge.dash.width")||U);var l="square"===w.cap?.71:.5;Wj(A,o(p*l,U*l+t+N),w.join),Q._68o(A)}},getRotation:function(M,S,V){M=M||0;var n=this._78o;if(n){var f,E=n.angle,L=n.points,O=n.edgeTypeInfo;if(E!=I)return S?n.orienAngle+M:E+M;if(O&&O[Op])return O.getRotation?O.getRotation(this,M,S,V):0;if(O&&O.points){var K=O.points;return f=K.size(),Np[V]?f&&0===f%2?cd(K.get(f/2-1),K.get(f/2),S,M):M:$q[V]?cd(K.get(0),K.get(1),S,M):cd(K.get(f-2),K.get(f-1),S,M)}if(L)return f=L.size(),Np[V]?f&&0===f%2?cd(L.get(f/2-1),L.get(f/2),S,M):0===f?cd(n.sourcePoint,n.targetPoint,S,M):M:$q[V]?cd(n.sourcePoint,f?L.get(0):n.targetPoint,S,M):cd(f?L.get(f-1):n.sourcePoint,n.targetPoint,S,M)}return M},getPosition:function(N,g,$,a,T){var t=this._78o;if(t){var U,V=t.type,e=t.points,p=t.edgeTypeInfo,n=t.sourcePoint,K=t.targetPoint;if(!V)return t.looped?{x:n.x-t.radius+g,y:n.y+$}:(T&&n&&K&&(n.x>K.x||n.x===K.x&&n.y>K.y)&&(N=Zb[N],$=-$),U=Xc(N,t.rect,a),U.x+=g,U.y+=$,U=t.mat.tf(U),U.x+=t.origin.x,U.y+=t.origin.y,U);if(p&&p[Op])return p.getPosition?p.getPosition(this,N,g,$,a,T):{x:(n.x+K.x)/2,y:(n.y+K.y)/2};if(e){var U,I=e.size();if(Np[N]){if(I){var z=I%2;if(0===z)return bk(e.get(I/2-1),e.get(I/2),N,g,$,a,T);U=e.get((I-z)/2)}else U={x:(n.x+K.x)/2,y:(n.y+K.y)/2};return U=Xc(N,{x:U.x,y:U.y,width:0,height:0},a),U.x+=g,U.y+=$,U}return $q[N]?bk(n,I?e.get(0):K,N,g,$,a,T):bk(I?e.get(I-1):n,K,N,g,$,a,T)}if(p){var Z=p.points,I=Z.size();if(Np[N]){var z=I%2;return 0===z?bk(Z.get(I/2-1),Z.get(I/2),N,g,$,a,T):(U=Z.get((I-z)/2),U=Xc(N,{x:U.x,y:U.y,width:0,height:0},a),U.x+=g,U.y+=$,U)}return $q[N]?bk(Z.get(0),Z.get(1),N,g,$,a,T):bk(Z.get(I-2),Z.get(I-1),N,g,$,a,T)}}return Mn},_42:function(v){this._78o&&Xd.superClass._42.call(this,v)},drawPath:function(R,o){R.beginPath();var L=o.type,A=o.points,$=o.segments,k=o.edgeTypeInfo;if(!L||A){var N=o.sourcePoint,m=N.x,M=N.y,I=o.targetPoint,u=I.x,d=I.y;if(L)if($){var O=new Gk({x:m,y:M});O.addAll(A),O.add({x:u,y:d}),fj(R,O,$)}else R.moveTo(m,M),A.each(function(n){R.lineTo(n.x,n.y)}),R.lineTo(u,d);else o.looped?R.arc(m,M,o.radius,0,f,!0):o.center?(R.moveTo(o.c1.x,o.c1.y),R.lineTo(m,M),R.lineTo(u,d),R.lineTo(o.c2.x,o.c2.y)):(R.moveTo(m,M),R.lineTo(u,d))}else k&&(k.points?fj(R,k.points,k.segments):k[Op]&&k[Op](R,k))},_80o:function(g){var k=this,v=k.s,b=k._78o,C=b.width,Z=b.selectWidth,h=b.borderWidth,z=b.repeatImage,u=g.lineJoin,T=g.lineCap,j=b.gray,M=b.pattern;g.lineJoin=b.join,g.lineCap=b.cap,k.drawPath(tm(g,M),b);var P=v("edge.width.absolute");P&&(g.save(),g.setTransform(1,0,0,1,0,0)),Z&&(g.strokeStyle=b._97o,g.lineWidth=C+2*(h+Z),g.stroke()),h&&(g.strokeStyle=j?R.toGrayColor(b.borderColor):b.borderColor,g.lineWidth=C+2*h,g.stroke());var n=j?R.toGrayColor(b.color):b.color;if(z?Pq(g,z,n,null,k._data,k.gv):g.strokeStyle=n,g.lineWidth=C,g.stroke(),b.is3d){var V=j?R.toGrayColor(b._67o):b._67o;sh(g,n,V,C,k.gv._zoom,b._66o)}if(v("edge.dash")){M=v("edge.dash.pattern");var B=tm(g,M,k._2Q("edge.dash.offset"));B!==g&&k.drawPath(B,b),k._1Q(g,"edge",v("edge.dash.width")||C,M)}P&&g.restore(),vk(g,M),g.lineJoin=u,g.lineCap=T},_48O:function(){},_47O:function(){}});var dk=function(u,r){yd(dk,this,[u,r])};Lp(dk,Kg,{_3O:function(){var R,p,Y=this,v=Y.s,l=Y._data,B=Y.gv;if(Y._88I=I,l.isExpanded()&&l.eachChild(function(U){if(Dg(U)){var x=B.getBoundsForGroup(U);x&&(p||(p=[]),p.push(x),R=xr(R,x))}}),R){var O=B.getLabel(l),A=v("group.type"),Q=v("group.border.width")||0,V=v("group.border.width.absolute"),g=Q/2;V&&(Q/=B._zoom),R=Hl(A,p,R),vh(R,l,"group.padding",1),xs(R,Q);var x=Y._88I={type:A,rect:R,_64o:R};if(!A&&O!=I){var k,j=Y.labelInfo={label:O,color:v("group.title.color"),font:v("group.title.font"),align:v("group.title.align")},K=Yj(j,O),M=K.width+Q,X=K.height+Q,s=v("group.title.align"),J=v("group.title.orientation");if(J===Vh||J===dd?(R.height+=Q,M>R.width&&(R.width=M)):(J===xi||J===Dd)&&(R.width+=Q,M>R.height&&(R.height=M)),k=s===xi?R.x:s===Dd?R.x+R.width-M:R.x+R.width/2-M/2,J===dd)x.titleRect={x:R.x,y:R.y+R.height,width:R.width,height:X},x.rect={x:R.x,y:R.y,width:R.width,height:R.height+X},j.rect={x:k,y:R.y+R.height,width:M,height:X};else if(J===xi){var n=x.titleRect={x:R.x-X,y:R.y,width:X,height:R.height};x.rect={x:R.x-X,y:R.y,width:R.width+X,height:R.height},j.rect={x:n.x+X/2-R.height/2,y:n.y+R.height/2-X/2,width:R.height,height:X},j.rotation=-Math.PI/2}else if(J===Dd){var n=x.titleRect={x:R.x+R.width,y:R.y,width:X,height:R.height};x.rect={x:R.x,y:R.y,width:R.width+X,height:R.height},j.rect={x:n.x+X/2-R.height/2,y:n.y+R.height/2-X/2,width:R.height,height:X},j.rotation=Math.PI/2}else x.titleRect={x:R.x,y:R.y-X,width:R.width,height:X},x.rect={x:R.x,y:R.y-X,width:R.width,height:R.height+X},j.rect={x:k,y:R.y-X-g,width:M,height:X+Q}}Y._40O(x,v("group.border.width")/2)}else dk.superClass._3O.call(Y)},getPosition:function(z,T,y,K){var l=this._88I;if(l){var V=Xc(z,l.rect,K);return V.x+=T,V.y+=y,V}return dk.superClass.getPosition.apply(this,arguments)},_24O:function(w,F){var t=this._88I;(!t||t.type||"label2"===w)&&dk.superClass._24O.call(this,w,F)},_80o:function(Y){var S=this,G=S._88I;if(G){var c=S._data,r=S.s,T=S.gv,E=G.type,u=G.rect,h=G._64o,z=G.titleRect,w=S.getBodyColor(),s=Td(r("group.image"),w),O=r("group.image.stretch"),U=S.getBodyColor("group.background"),t=Td(r("group.repeat.image"),w),b=r("group.gradient.pack"),H=r("group.gradient"),d=r("group.gradient.color"),g=r("group.border.width"),$=r("group.border.color"),Q=r("group.border.pattern"),I=r("group.title.orientation"),D=r("group.depth"),y=r("group.border.radius"),_=r("group.border.join"),n=r("group.border.cap"),K=r("group.border.width.absolute");K&&(g/=T._zoom);var F=$,V=r("group.border.repeat.image");if(V&&(V=Td(V,$))&&(F=pq(Y,V,$,null,c,T)),E){var a=Y.lineJoin,P=Y.lineCap;if(Y.lineJoin=_,Y.lineCap=n,s){if(Y.save(),os(Y,E,u,y),Y.clip(),_n(Y,s,O,u.x,u.y,u.width,u.height,c,T,w),Y.restore(),g>0){var j=tm(Y,Q);os(j,E,u,y),Y.lineWidth=g,Y.strokeStyle=F,Y.stroke(),vk(Y,Q)}}else{var j=tm(Y,Q);U||t||b?(os(Y,E,u,y),b?zr(Y,b,function(Z){return pb(Z,w)},!1,u):t?Dl(Y,t,w,null,c,T):jp(Y,U,H,d,u),Y.fill(),b&&Y.restore(),Y!==j&&os(j,E,u,y)):os(j,E,u,y),g>0&&(Y.lineWidth=g,Y.strokeStyle=F,Y.stroke()),vk(Y,Q),E===fk&&Pe(Y,U,D,u)}Y.lineJoin=a,Y.lineCap=P}else{var N=r("group.title.background");if((!y||0>y)&&(y=0),s)_n(Y,s,O,h.x,h.y,h.width,h.height,c,T,S.getBodyColor());else if(U||t)if(t?Dl(Y,t,w,null,c,T):jp(Y,U,H,d,h),0===g)os(Y,fk,h),Y.fill(),Pe(Y,U,D,h);else{switch(Y.beginPath(),I){case dd:wo(Y,h.x,h.y,h.width,h.height,y,y,0,0);break;case xi:wo(Y,h.x,h.y,h.width,h.height,0,y,0,y);break;case Dd:wo(Y,h.x,h.y,h.width,h.height,y,0,y,0);break;case Vh:wo(Y,h.x,h.y,h.width,h.height,0,0,y,y)}Y.fill()}if(z&&N)if(0===g)gk(Y,z.x,z.y,z.width,z.height,N),Pe(Y,N,D,z);else{switch(Y.beginPath(),Y.fillStyle=N,I){case dd:wo(Y,z.x,z.y,z.width,z.height,0,0,y,y);break;case xi:wo(Y,z.x,z.y,z.width,z.height,y,0,y,0);break;case Dd:wo(Y,z.x,z.y,z.width,z.height,0,y,0,y);break;case Vh:wo(Y,z.x,z.y,z.width,z.height,y,y,0,0)}Y.fill()}if(g>0){var j=tm(Y,Q);if(os(j,"roundRect",u,y),Y.save(),Y.lineWidth=g,Y.strokeStyle=F,Y.lineJoin=_,Y.lineCap=n,Y.closePath(),Y.stroke(),z&&r("group.splitLine")){var q=z.x,X=z.y,L=z.width,k=z.height;Y.beginPath(),I===dd?(Y.moveTo(q,X),Y.lineTo(q+L,X)):I===xi?(Y.moveTo(q+L,X),Y.lineTo(q+L,X+k)):I===Dd?(Y.moveTo(q,X),Y.lineTo(q,X+k)):(Y.moveTo(q,X+k),Y.lineTo(q+L,X+k))}Y.stroke(),Y.restore(),vk(j,Q)}}S._39O(Y,G)}else dk.superClass._80o.call(S,Y)}});var ic=function(Y,A){yd(ic,this,[Y,A])};Lp(ic,Kg,{_80o:function(X){this._39O(X,this._83o)}});var Zd=function(f,V){yd(Zd,this,[f,V])};Lp(Zd,Kg,{_3O:function(){var $=this,g=$._data,k=$.s,A=$.gv,Y=g.getPoints(),_=A.getBorderColor(g),K=_?k("border.width"):0,m=$.getSelectWidth(),q=k("shape.border.width"),s=g.getRect(),r=g.getAnchorRect(),G=A.getBodyColor(g),j=k("shape.border.color"),t=$._99o=Y.isEmpty()?I:{rect:s,rotation:g.getRotation(),fillRule:k("shape.fill.rule"),scale:g.getScale(),position:g.p(),points:Y,segments:g.getSegments(),bodyColor:G,borderColor:_,borderWidth:K,_94o:k("shape.border.3d"),_95o:k("shape.border.3d.color"),_96o:k("shape.border.3d.accuracy"),_97o:m?$.getSelectColor():I,selectWidth:m,_53o:k("shape.background"),_27Q:Td(k("shape.repeat.image"),G),shapeGradientPack:k("shape.gradient.pack"),shapeBorderGradientPack:k("shape.border.gradient.pack"),_54o:q,_55o:j,shapeBorderRepeatImage:Td(k("shape.border.repeat.image"),j),shapeGradient:k("shape.gradient"),_59o:k("shape.gradient.color"),_60o:k("shape.border.pattern"),_61o:k("shape.border.cap"),_62o:k("shape.border.join"),shapeForeground:k("shape.foreground"),gray:k("2d.gray")};if(t){r.x+=t.position.x,r.y+=t.position.y,t.gradientRect=r;var w=g.getScale(),W=o(1,o(i(w.x),i(w.y)));k("shape.dash")&&k("shape.dash.width")>q&&(q=k("shape.dash.width"));var T,l=k("shape.border.width.absolute");T=l?(q+K+m)/$.gv._zoom/W:q*("square"===t._61o?.71:.5)+K+m/$.gv._zoom/W,T&&(T*=W,s=sj(s),Wj(s,T,t._62o)),$._68o(s);var b=k("clip.percentage");b!=z&&(t.clipRect=ur(g.getAnchorRect(),k("clip.direction"),b));var H=k("shape.fill.clip.percentage");H!=z&&(t.shapeClipRect=ur(g.getAnchorRect(),k("shape.fill.clip.direction"),H));var d=k("shape.foreground.clip.percentage");d!=z&&(t.shapeForegroundClipRect=ur(g.getAnchorRect(),k("shape.foreground.clip.direction"),d))}},getPosition:function(t,P,M,d){var l=this._99o;if(l){var C=Xc(t,l.rect,d);return C.x+=P,C.y+=M,C}return Mn},_42:function(M){this._99o&&Zd.superClass._42.call(this,M)},_80o:function(z){var Y,$=this,k=$.s,r=$._99o,n=r.position,M=r.scale,K=r.rotation,q=r.borderWidth,j=$.gv._zoom,y=r.selectWidth/j,f=r._27Q,I=r.shapeGradientPack,J=r._54o,u=r.clipRect,m=r.shapeClipRect,E=r.points,w=r.segments,L=$._data.isClosePath(),b=r.fillRule,s=r.gray,d=function(W){return s?R.toGrayColor(W):W},P=d(r._53o),U=P||f||I;z.save(),or(z,n.x,n.y),Aj(z,K),qs(z,M.x,M.y),u&&(z.beginPath(),z.rect(u.x,u.y,u.width,u.height),z.clip()),U&&m&&(z.save(),z.beginPath(),z.rect(m.x,m.y,m.width,m.height),z.clip());var _=sj(r.rect);B.Default.extractShapeTranslation?(E=sj(E),E.forEach(function(l){l.x-=n.x,l.y-=n.y}),_.x-=n.x,_.y-=n.y):or(z,-n.x,-n.y);var p=k("shape.border.width.absolute"),H=r._60o;p&&H&&(H=H.map(function(X){return X*j}));var V=tm(z,H),N=z.lineJoin,X=z.lineCap;z.lineJoin=r._62o,z.lineCap=r._61o;var e=d(r.bodyColor);U?(fj(z,E,w,L),I?zr(z,I,function(H){return pb(H,r.bodyColor)},!1,_):f?Dl(z,f,e,null,$._data,$.gv):(Y=e?e:P,jp(z,Y,r.shapeGradient,d(r._59o),r.gradientRect)),z.fill(b),I&&z.restore(),m&&(z.restore(),or(z,-n.x,-n.y)),V!==z&&fj(V,E,w,L)):fj(V,E,w,L);var a=r.shapeForeground;if(a){z.save();var o=r.shapeForegroundClipRect;o&&(or(z,n.x,n.y),z.beginPath(),z.rect(o.x,o.y,o.width,o.height),z.clip(),or(z,-n.x,-n.y)),fj(z,E,w,L),jp(z,a,k("shape.foreground.gradient"),d(k("shape.foreground.gradient.color")),r.gradientRect),z.fill(b),z.restore()}if(p&&(z.save(),z.setTransform(1,0,0,1,0,0)),y&&(z.strokeStyle=r._97o,z.lineWidth=J+2*(q+y),z.stroke()),q&&(z.strokeStyle=d(r.borderColor),z.lineWidth=J+2*q,z.stroke()),J){Y=d(r._55o);var x=r.shapeBorderGradientPack;x?zr(z,x,d,!0,_):r.shapeBorderRepeatImage?Pq(z,r.shapeBorderRepeatImage,Y,null,$._data,$.gv):(!P&&e&&(Y=e),z.strokeStyle=Y),z.lineWidth=J,z.stroke(),x&&z.restore(),r._94o&&sh(z,Y,d(r._95o),J,j,r._96o)}if(vk(z,H),k("shape.dash")){var g=k("shape.dash.width")||J;if(g>0){H=k("shape.dash.pattern"),p&&(H=H.map(function(z){return z*j}));var V=tm(z,H,$._2Q("shape.dash.offset"));V!==z&&fj(V,E,w,L),$._1Q(z,"shape",g,H)}}p&&z.restore(),z.lineJoin=N,z.lineCap=X,z.restore()},_48O:function(){},_47O:function(){}});var Fn=function($,p){yd(Fn,this,[$,p])};Lp(Fn,Zd,{getRotation:function(){var B=new wc,E=new wc,N=new sn;return function(C,s,n){C=C||0;var S=this._data,L=S.getPoints(),x=L.size();if(x>1){var h,Z,q=S.p(),o=S.getScale();if(N.identity().translate(-q.x,-q.y).scale(o.x,o.y).translate(q.x,q.y),Np[n]){var J=x%2,u=(x-J)/2;h=L.get(u-1),Z=L.get(u)}else $q[n]?(h=L.get(0),Z=L.get(1)):(h=L.get(x-2),Z=L.get(x-1));return N.apply(h,B),N.apply(Z,E),cd(B,E,s,C)}return C}}(),getPosition:function(){var d=new wc,R=new wc,c=new wc;return function(a,k,r,B,V){var Y=this._data,F=Y.getPoints(),i=F.size();if(i>1){var Z,D,I=Y.getPointsMatrix2d();if(Np[a]){var w=i%2,E=(i-w)/2;if(Z=F.get(E-1),D=F.get(E),0!==w){var q=Xc(a,Mn,B);return q.x+=k,q.y+=r,I.apply(Z,d),I.apply(D,R),I.identity().rotate(c.copy(R).sub(d).angle()).apply(q,d).add(R)}}else $q[a]?(Z=F.get(0),D=F.get(1)):(Z=F.get(i-2),D=F.get(i-1));return I.apply(Z,d),I.apply(D,R),bk(d,R,a,k,r,B,V)}return Mn}}()});var Cn=function(J,w){yd(Cn,this,[J,w])};Lp(Cn,Kg,{_3O:function(){var O=this;Cn.superClass._3O.call(O);var M=O.s,r=O._83o;O._82o=r.img||r.shape?I:{background:O.getBodyColor("grid.background"),depth:M("grid.depth"),rect:r.rect,_88o:M("grid.cell.depth"),cellBorderColor:M("grid.cell.border.color"),_89o:M("grid.row.count"),_90o:M("grid.column.count"),block:M("grid.block"),_91o:M("grid.block.color"),_92o:M("grid.block.padding"),_93o:M("grid.block.width")}},_80o:function(N){var s=this,z=s._82o;if(!z)return Cn.superClass._80o.call(s,N),void 0;var Z,r,R=s._data,H=z.background,d=z.rect,t=z.block,I=z._91o,c=z._92o,$=z._93o,k=z._88o,f=z.cellBorderColor,i=z._89o,U=z._90o;if(H)if(gk(N,d.x,d.y,d.width,d.height,H),Pe(N,H,z.depth,d),k)for(Z=0;i>Z;Z++)for(r=0;U>r;r++)d=R.getCellRect(Z,r),d&&Pe(N,H,k,d);else if(f){for(N.beginPath(),Z=0;i>Z;Z++)for(r=0;U>r;r++)d=R.getCellRect(Z,r),d&&N.rect(d.x,d.y,d.width,d.height);N.strokeStyle=f,N.lineWidth=1,N.stroke()}if("h"===t)for(Z=0;i>Z;Z++)d=xr(R.getCellRect(Z,0),R.getCellRect(Z,U-1)),xs(d,c),jn(N,I,d.x,d.y,d.width,d.height,$);else if("v"===t)for(r=0;U>r;r++)d=xr(R.getCellRect(0,r),R.getCellRect(i-1,r)),xs(d,c),jn(N,I,d.x,d.y,d.width,d.height,$);s._39O(N,s._83o)}});var jg=function(E,V){yd(jg,this,[E,V])},dr=e?On().getContext("2d"):I;Lp(jg,Kg,{_checkEmptyRect:!1,_81o:function(){var t=this._data,V=jg.superClass._81o.call(this),q=t.s("text");if(q!=I){q+="";var U,D=t.s("text.font"),M=t.s("text.align"),z=t.s("text.vAlign"),K=t.s("text.wrap"),k=t.s("text.vertical"),b=t.s("text.vertical.gap"),T=t.s("text.letter.gap")||0,c=t.getWidth(),B=t.getHeight();if(null==b&&(b=1),k){var X;X=K?qm(q,B,D,T,k,b):[q];var h=(X.length-1)*T,r=0;dr.textBaseline=Vh,dr.font=D,X.forEach(function($){for(var I=$.length,U=0,q=(I-1)*b,X=0;I>X;X++){var A=dr.measureText($[X]);q+=A.fontBoundingBoxDescent||Pb(D,$[X]).height,U=o(U,A.width)}h+=U,r=o(q,r)});var S=(X.length-1)*T;X.forEach(function(y){S+=y}),U={width:h,height:r}}else{var X=K?qm(q,c,D,T,k,b):q.split("\n"),d=X.length;if(d>1){var $=Pb(D,q).height,h=0,r=$*d+b*(d-1);X.forEach(function(u){h=o(h,Pb(D,u).width)}),U={width:h,height:r}}else U=Pb(D,q),T&&(U.width+=(q.length-1)*T)}var W,J,v=U.width,Y=U.height,j=t.getAnchor();"left"===M?W=-c*j.x:"center"===M?W=-c*j.x+(c-v)/2:"right"===M&&(W=c*(1-j.x)-U.width),"top"===z?J=-B*j.y:"middle"===z?J=-B*j.y+(B-Y)/2:"bottom"===z&&(J=B*(1-j.y)-U.height);var y,p=t.getMatrix();if(y=Gj([p.tf(W,J),p.tf(W+v,J),p.tf(W+v,J+Y),p.tf(W,J+Y)]),V=xr(V,y),V&&t.s("text.shadow")){var _=sj(V);_.x+=t.s("text.shadow.offset.x"),_.y+=t.s("text.shadow.offset.y"),xs(_,t.s("text.shadow.blur")),V=xr(V,_)}}return V}});var Nb=Ap.Interactor=function(J){this.gv=this._graphView=J};pg("Interactor",T,{ms_listener:1,getView:function(){return this.gv.getView()},setUp:function(){this.addListeners()},tearDown:function(){this.removeListeners(),this.clear()},clear:function(){},fi:function(k){this.gv.fi(k)},setCursor:function(F){gj||this.gv.setCursor(F)},startDragging:function(u){var w=this;w._lastClientPoint=Po(u),w._lastLogicalPoint=w.gv.lp(u),ii(w,u)},clearDragging:function(){var J=this;J._lastClientPoint=J._lastLogicalPoint=J._logicalPoint=I},autoScroll:function(C){return this.gv.autoScroll(C,this._lastClientPoint)}});var Ah=I,mr=function(h){Ah.handleWindowTouchMove(h)},di=function(R){Ah.handleWindowTouchEnd(R),W(V,vj,mr),W(V,qd,di),Ah=I},Hg=function(B){Ah.handleWindowMouseMove(B)},Hp=function(Z){Ah.handleWindowMouseUp(Z),W(V,ho,Hg),W(V,ec,Hp),Ah=I},Ef=function(y,b){if(y!==Ah){var f=gp(b);Ah?f?Ah.handleWindowTouchEnd(b):Ah.handleWindowMouseUp(b):f?(j(V,vj,mr),j(V,qd,di)):(j(V,ho,Hg),j(V,ec,Hp)),Ah=y}},ds=function(C){var O=this;O.gv=C,O._is2d=C instanceof Ap.GraphView,O._eventListeners={},["mousedown","mousemove","mouseleave","touchstart","touchmove",Im,"wheel"].forEach(function(A){O.addListener(A)}),O.initImageResource()};Lp(ds,Nb,{enableVR:function(v){var Q=this;!!Q._vrEnable!==v&&(Q._vrEnable=v,v?Q.gv.vr.mp(Q.onVRControllerChange,Q):Q.gv.vr.ump(Q.onVRControllerChange,Q))},onVRControllerChange:function(l){var q=this,k=l.property,L=l.newValue,w=L.id,h=q.gv.vr.getController(w),_=h.getRay();if(_){_.controllerId=w;var B=q.gv.vr.getRayEventType(_,k,L._62O);switch(B){case"down":q.handle_mousedown(_);break;case"up":Ah&&Hp(_);break;case"move":q.handle_mousemove(_),Ah&&q.handleWindowMouseMove(_)}}},setPreventEventDefault:function(k,h){var b=this,t=b._eventListeners[k];t?t._prevent=h:b._eventListeners[k]=t={_removal:z,_prevent:h}},removeListener:function(p){var Y=this,k=Y._eventListeners[p];k&&k._removal&&(k._removal(),k._removal=z)},addListener:function(t){var X=this,g=X._eventListeners[t];if(g||(X._eventListeners[t]=g={_removal:z,_prevent:!0}),!g||!g._removal){var x=function(e){g._prevent&&R.preventDefault(e),X.disabled||X.gv._48Q||("wheel"===t?Sm(X,e):X["handle_"+t](e))};j(X.gv.getView(),t,x),g._removal=function(){W(X.gv.getView(),t,x)}}},handleWindowTouchMove:function(L){this.handleWindowMouseMove(L)},handleWindowMouseMove:function(F){return!this.downInfo||gp(F)&&1!==Gg(F)?(this.isDragging&&(this.handleDownInfo("onEndDrag",F),this.isDragging=!1),void 0):(this.isDragging?this.handleDownInfo("onDrag",F):(this.handleDownInfo("onBeginDrag",F),this.isDragging=!0),void 0)},handleWindowTouchEnd:function(g){this.handleWindowMouseUp(g)},handleWindowMouseUp:function(a){if(this.isDragging&&(this.handleDownInfo("onEndDrag",a),this.isDragging=!1),this.downInfo){var _=this.handle("onUp",a);if(_&&_.data===this.downInfo.data){this.handleMissingUp(a);var V=this,m=2===a.button?"onContextMenu":"onClick",u=_.data;if(u.s("disableDoubleClick")||!V._dbclickTimer)return V._dbclickTimer=hl(function(){delete V._dbclickTimer,V.handleClick(a,m,_),this.downInfo=I},R.clickDelay),void 0;xq(V._dbclickTimer),delete V._dbclickTimer,m="onDoubleClick",V.handleClick(a,m,_)}else this.handleDownInfo("onUp",a);this.downInfo=I,this.downComps=I}},handle_mouseleave:function(g){var H=this,i=H.gv;H._hoverTimer&&(xq(H._hoverTimer),delete H._hoverTimer);var h=H.currentInfo?H.currentInfo.data:I;if(h){h.s("onLeave")&&h.s("onLeave")(g,h,i),H.fire("data","onLeave",g,h);var Q=H.currentInfo?H.currentInfo.hits:I;if(Q)for(var V in Q)H.handleLeave(g,V);H.currentInfo=I}},handle_mousewheel:function(_){_.scrollDelta=_.wheelDelta/40,this.handle("onScroll",_)},handle_DOMMouseScroll:function(Z){Z.scrollDelta=2===Z.axis?-Z.detail:0,this.handle("onScroll",Z)},handle_touchstart:function(P){this.handle_mousedown(P)},handle_touchmove:function(W){this.handle("onMove",W)},handle_mousedown:function(A){this.isDragging&&(this.handleDownInfo("onEndDrag",A),this.isDragging=!1),this.downComps=[],this.downInfo=this.handle("onDown",A),this.downInfo&&Ef(this,A)},handle_mousemove:function(v){var u=this,P=u.gv;if(u._hoverTimer&&(xq(u._hoverTimer),delete u._hoverTimer),!P._panning&&!P._moving){var A,f,m,L=u.handle("onMove",v),b=this.currentInfo?this.currentInfo.data:I,j=this.currentInfo?this.currentInfo.hits:I;if(L&&(f=L.data,m=L.hits,u._hoverTimer=hl(function(){xq(u._hoverTimer),delete u._hoverTimer,u.handle("onHover",v,L)},P.getHoverDelay()||R.hoverDelay)),f!==b){if(b&&(b.s("onLeave")&&b.s("onLeave")(v,b,P),this.fire("data","onLeave",v,b)),f&&(f.s("onEnter")&&f.s("onEnter")(v,f,P),this.fire("data","onEnter",v,f)),j)for(A in j)this.handleLeave(v,A);if(m)for(A in m){var a=m[A],Q=f._interactPrefix=a.prefix,c=Q&&f.a(Q+"onEnter")||a.target.onEnter;c&&c.call(a.target,v,f,P,a.point,a.width,a.height),this.fire(a.type,"onEnter",a.event,a.data,a.image,a.comp,a.point,a),f._interactPrefix=null}}else{if(j)for(A in j)m&&m[A]||this.handleLeave(v,A);if(m)for(A in m)if(!j||!j[A]){var a=m[A],Q=f._interactPrefix=a.prefix,c=Q&&f.a(Q+"onEnter")||a.target.onEnter;c&&c.call(a.target,v,f,P,a.point,a.width,a.height),this.fire(a.type,"onEnter",a.event,a.data,a.image,a.comp,a.point,a),f._interactPrefix=null}}this.currentInfo=L}},handle:function(Y,s,y){var a,r=this,E=r.gv;if(r._is2d){if(y=y||E.getDataInfoAt(s),!y||!E.isInteractive(y.data))return;if(a=y.ui.interactiveInfo){var c,l=y.data;if(l.s(Y)&&l.s(Y)(s,l,E),this.fire("data",Y,s,l),"body"===y.part&&a.bodyInfo)c="body",y.hits=this.handleImage(c,E.getImage(l),Y,s,l,y.point,a.bodyInfo);else if("icons"===y.part&&a._38o){var v=a._38o[y.name];v&&v[y.index]&&(c="icons|"+y.name+"|"+y.index,y.hits=this.handleImage(c,y.icon,Y,s,l,y.point,v[y.index]))}}return y}var l,U;if(!y)if(s&&s instanceof B.Math.Ray&&E.isVREnabled()){var $=E.vr.intersectWorld(s);if(l=$.data,U=$.intersect,E.vr.renderRayDuringInteraction(s,l,U),!l)return;var K=E.getData3dUI(l);if(a=K.interactiveInfo,!a)return;y={data:l,part:U.part,ui:K}}else{if(y=this.getDataInfoAt(s),!y)return;y&&(y={data:y.data,part:y.part})}if(E.isInteractive(y.data)){if(!U){l=y.data;var K=E.getData3dUI(l);if(y.ui=K,a=K.interactiveInfo,!a)return y;if(U=E.intersectObject(s,l),!U)return y}l.s(Y)&&l.s(Y)(s,l,E),this.fire("data",Y,s,l);var N,k=U.part;return"body"!==k&&(N=l.s(k+".image")||l.s("shape3d."+k+".image")),N||(N=l.s("all.image")||l.s("shape3d.image")),N?(a="object"==typeof N?a[N.uuid]:a[N],a&&a.bodyInfo?(y.part="body",y.interactiveInfo=a,y.point=this._convertUVToPoint(U.uv,a),y.image=N,y.hits=this.handleImage("body",N,Y,s,l,y.point,a.bodyInfo),y):y):y
}},_handleLeaveOrMissing:function(J,A,b){var v="leave"===J?this.currentInfo:this.downInfo;if(v){var $=v.interactiveInfo||v.ui.interactiveInfo;if($){var F,Q,q=v.data;if(this._is2d){if(Q=this.gv.lp(A),"body"===v.part&&$.bodyInfo)F="body","leave"===J?this.handleLeaveImage(b,F,this.gv.getImage(q),A,q,Q,$.bodyInfo):this.handleMissingUpImage(F,this.gv.getImage(q),A,q,Q,$.bodyInfo);else if("icons"===v.part&&$._38o){var O=$._38o[v.name];O&&O[v.index]&&(F="icons|"+v.name+"|"+v.index,"leave"===J?this.handleLeaveImage(b,F,v.icon,A,q,Q,O[v.index]):this.handleMissingUpImage(F,v.icon,A,q,Q,O[v.index]))}}else{if(!$.bodyInfo)return;var V=this.gv.intersectObject(A,q);Q=V&&V.uv?this._convertUVToPoint(V.uv,$):{x:1/0,y:1/0},"leave"===J?this.handleLeaveImage(b,"body",v.image,A,q,Q,$.bodyInfo):this.handleMissingUpImage("body",v.image,A,q,Q,$.bodyInfo)}}}},handleClick:function(B,S,h){var Y=this,n=this.downInfo;if(n&&h){var U,q=h.interactiveInfo||h.ui.interactiveInfo,W=h.data,s=this.gv;if(W.s(S)&&W.s(S)(B,W,s),Y.fire("data",S,B,W),q)if(this._is2d){if(n.part===h.part){var t=s.lp(B);"body"===h.part&&q.bodyInfo&&(U="body",this.handleClickImage(U,s.getImage(W),S,B,W,t,q.bodyInfo,h))}}else{if(!q.bodyInfo)return;var N=s.intersectObject(B,W);if(!N)return;t=this._convertUVToPoint(N.uv,q),this.handleClickImage("body",n.image,S,B,W,t,q.bodyInfo,h)}}},handleDownInfo:function(Y,j){if(this.downInfo){var W=this.downInfo,h=this.gv,f=W.interactiveInfo||W.ui.interactiveInfo;if(f){var g,w=W.data;if(w.s(Y)&&w.s(Y)(j,w,h),this.fire("data",Y,j,w),this._is2d){var r=h.lp(j);if("body"===W.part&&f.bodyInfo)g="body",this.handleDownInfoImage(g,h.getImage(w),Y,j,w,r,f.bodyInfo);else if("icons"===W.part&&f._38o){var _=f._38o[W.name];_&&_[W.index]&&(g="icons|"+W.name+"|"+W.index,this.handleDownInfoImage(g,W.icon,Y,j,w,r,_[W.index]))}}else{if(!f.bodyInfo)return;var K;if("onBeginDrag"===Y?(K=h._raycaster.intersectObjectAndRecordTriangle(j,w),K&&(f.beginDragIntersectInfo=K.triangleInfo)):K=h.intersectObject(j,w),!K&&("onDrag"!==Y&&"onEndDrag"!==Y||!f.beginDragIntersectInfo||(K=h._raycaster.intersectLastTriangle(j,f.beginDragIntersectInfo)),!K))return;r=this._convertUVToPoint(K.uv,f),this.handleDownInfoImage("body",W.image,Y,j,w,r,f.bodyInfo)}}}},fire:function(u,V,W,$,w,P,I,y){this.gv.fi({kind:V,type:u,event:W,data:$,image:w,comp:P,view:this.gv,point:I,width:y?y.width:z,height:y?y.height:z})},handleImage:function(w,n,m,W,r,s,l){var h={};if(n&&(n=Td(n))){var X=this.gv,I=l.rect,i=this.convertPoint(s,l);i.inRect&&(n[m]&&n[m](W,r,X,i,I.width,I.height),this.fire("image",m,W,r,n,z,i,I),h[w+"|image"]={target:n,type:"image",image:n,data:r,event:W,point:i,width:I.width,height:I.height});for(var x,M=l.compInfos,o=n,S=M.length-1;S>=0;S--){var j=M[S],p=j.comp;if(i=this.convertPoint(s,j,o,p,X,r),i.inRect){I=j.rect;var T=r._interactPrefix=j.prefix,K=T&&r.a(T+m)||p[m];if(K&&(x=K.call(p,W,r,X,i,I.width,I.height)),this.fire("comp",m,W,r,n,p,i,I),x!==!0&&(n=I.image)&&(n[m]&&(x=n[m](W,r,X,i,I.width,I.height)),this.fire("image",m,W,r,n,z,i,I)),r._interactPrefix=null,h[w+"|"+S]={target:p,type:"comp",comp:p,image:n,data:r,event:W,point:i,width:I.width,height:I.height,prefix:T},this.downComps&&this.downComps.push(p),n&&(h[w+"|"+S+"|image"]={target:n,type:"image",image:n,data:r,event:W,point:i,width:I.width,height:I.height,prefix:T}),x===!0)break}}}return h},handleLeave:function(z,l){return this._handleLeaveOrMissing("leave",z,l)},handleMissingUp:function(R){return this._handleLeaveOrMissing("missing",R)},handleLeaveImage:function(k,Y,Q,s,C,f,N){if(Q&&(Q=Td(Q))){var S=this.gv,h=N.rect,v=this.convertPoint(f,N);k===Y+"|image"&&(Q.onLeave&&Q.onLeave(s,C,S,v,h.width,h.height),this.fire("image","onLeave",s,C,Q,z,v,h));for(var K,m=N.compInfos,w=Q,A=m.length-1;A>=0;A--){var V=m[A],W=V.comp;v=this.convertPoint(f,V,w,W,S,C),h=V.rect;var x=C._interactPrefix=V.prefix;if(k===Y+"|"+A){var F=x&&C.a(x+"onLeave")||W.onLeave;F&&(K=F.call(W,s,C,S,v,h.width,h.height)),this.fire("comp","onLeave",s,C,Q,W,v,h)}if(K!==!0&&(Q=h.image)&&k===Y+"|"+A+"|image"&&(Q.onLeave&&(K=Q.onLeave(s,C,S,v,h.width,h.height)),this.fire("image","onLeave",s,C,Q,z,v,h)),C._interactPrefix=null,K===!0)break}}},handleMissingUpImage:function(T,Z,r,h,X,s){var P="onUp",a=this.downInfo.hits;if(a&&Z&&(Z=Td(Z))){var D=this.gv,q=s.rect,k=this.convertPoint(X,s);!k.inRect&&a[T+"|image"]&&(Z[P]&&Z[P](r,h,D,k,q.width,q.height),this.fire("image",P,r,h,Z,z,k,q));for(var C,o=s.compInfos,t=Z,A=o.length-1;A>=0;A--){var G=o[A],U=G.comp;if(k=this.convertPoint(X,G,t,U,D,h),!k.inRect){q=G.rect;var Y=h._interactPrefix=G.prefix;if(a[T+"|"+A]){var N=Y&&h.a(Y+P)||U[P];N&&(C=N.call(U,r,h,D,k,q.width,q.height)),this.fire("comp",P,r,h,Z,U,k,q)}if(C!==!0&&(Z=q.image)&&a[T+"|"+A+"|image"]&&(Z[P]&&(C=Z[P](r,h,D,k,q.width,q.height)),this.fire("image",P,r,h,Z,z,k,q)),h._interactPrefix=null,C===!0)break}}}},handleDownInfoImage:function(k,U,O,F,b,i,h){var o=this.downInfo.hits;if(o&&U&&(U=Td(U))){var t=this.gv,E=h.rect,R=this.convertPoint(i,h);o[k+"|image"]&&(U[O]&&U[O](F,b,t,R,E.width,E.height),this.fire("image",O,F,b,U,z,R,E));for(var q,T=h.compInfos,P=U,y=T.length-1;y>=0;y--){var N=T[y],e=N.comp;R=this.convertPoint(i,N,P,e,t,b),E=N.rect;var _=b._interactPrefix=N.prefix,L=["onDrag","onEndDrag"].indexOf(O)>=0;if(!L&&o[k+"|"+y]||L&&this.downComps&&this.downComps.indexOf(e)>=0){var K=_&&b.a(_+O)||e[O];K&&(q=K.call(e,F,b,t,R,E.width,E.height)),this.fire("comp",O,F,b,U,e,R,E)}if(q!==!0&&(U=E.image)&&o[k+"|"+y+"|image"]&&(U[O]&&(q=U[O](F,b,t,R,E.width,E.height)),this.fire("image",O,F,b,U,z,R,E)),b._interactPrefix=null,q===!0)break}}},handleClickImage:function(r,K,Z,P,$,o,g,U){var _=this.downInfo.hits,v=U.hits;if(_&&K&&(K=Td(K))){var H=this.gv,A=g.rect,x=this.convertPoint(o,g);_[r+"|image"]&&(K[Z]&&K[Z](P,$,H,x,A.width,A.height),this.fire("image",Z,P,$,K,z,x,A));for(var I,l=g.compInfos,W=K,E=l.length-1;E>=0;E--){var L=l[E],D=L.comp;x=this.convertPoint(o,L,W,D,H,$),A=L.rect;var j=$._interactPrefix=L.prefix;if(_[r+"|"+E]&&v[r+"|"+E]){var w=j&&$.a(j+Z)||D[Z];w&&(I=w.call(D,P,$,H,x,A.width,A.height)),this.fire("comp",Z,P,$,K,D,x,A)}if(I!==!0&&(K=A.image)&&_[r+"|"+E+"|image"]&&(K[Z]&&(I=K[Z](P,$,H,x,A.width,A.height)),this.fire("image",Z,P,$,K,z,x,A)),$._interactPrefix=null,I===!0)break}}},initImageResource:function(){R.setImage("coreInteractorRayHitImage",{width:16,height:16,comps:[{type:"oval",background:"rgb(255,0,0)",borderWidth:1,borderColor:"rgb(250,120,120)",opacity:.3,rotation:-1.593,rect:[.73315,.6933,14.5337,14.61341]},{type:"oval",background:"rgb(255,0,0)",borderWidth:1,borderColor:"rgb(250,120,120)",rotation:-1.593,rect:[3.56695,3.75073,8.8661,8.49856]}]})},_convertUVToPoint:function(P,I){if(!P)return{x:1/0,y:1/0};var B=I.bodyInfo.rect,$=P.clone(),x=P.multiply({x:B.width,y:B.height});return x.local=$,x},convertPoint:function(b,t,$,S,k,a){var U=t.rect,F=t.matrix.applyInverse(b).sub(U),G=F.x>=0&&F.y>=0&&F.x<=U.width&&F.y<=U.height;if(!G)return F;if(S&&tp(S.pixelPerfect,a,k)){var U,V=1;this._is2d?(V=k.getZoom(),U=dp(b.x,b.y,z,V)):U=dp(b.x,b.y);var J=!1,_=U.x,C=U.y,o=U.width,M=U.height,W=R.hitMaxArea,P=o*M*V*V;if(P>W){var j=Math.sqrt(W/P);V*=j}o*=V,M*=V,2>o&&(o=2),2>M&&(M=2),_*=V,C*=V;var D=sb(o,M),g=new sn(0,-_,-C,V,V);g.append(t.matrix),k._drawForChecking=!0,S.transform=g;var X=$.fitSize;t.refRect&&t.refRect.fitSize?(S.refRect=t.refRect,$.fitSize=!0):$.fitSize=!1;var E=$.comps;$.comps=[S],cq(D,$,0,0,o,M,a,self),$.comps=E,$.fitSize=X,delete S.refRect,delete S.unionRect,delete S.transform,k._drawForChecking=!1;try{for(var A=0,Q=D.getImageData(0,0,o,M).data;A<Q.length;A+=4)if(0!==Q[A+3]){J=!0;break}D.restore()}catch(e){bp=I,J=!1}F.inRect=J}else F.inRect=!0;return F},getDataInfoAt:function(O,t){return Ps.prototype.getDataInfoAt.call(this,O,t)}});var Zh=Ap.DefaultInteractor=function(g){yd(Zh,this,[g])};pg("DefaultInteractor",Nb,{handle_mousedown:function(M){cl(M);var Y=this,r=Y.gv,g=r.getDataAt(M);if(r.setFocus(M)&&!r._editing&&!r._scrolling){Fe(M)?r.handleDoubleClick(M,g):r.handleClick(M,g);var J=Ie(M);!tl()&&!J&&g&&(r.isMovable(g)||r._39Q(g))||!r.isPannable()||!fb(M)&&!J||Bl(M)||(Y._tx=r.tx(),Y._ty=r.ty(),Y.startDragging(M))}},handleWindowMouseUp:function(P){var j=this,X=j.gv;X._panning&&(delete X._panning,X.onPanEnded(),j.fi({kind:"endPan",event:P})),delete j._tx,delete j._ty,j.clearDragging()},handle_mousemove:function(h){var J=this,B=J.gv;J._hoverTimer&&(xq(J._hoverTimer),delete J._hoverTimer),J._hoverTimer=hl(function(){J.fi({kind:"hover",event:h}),xq(J._hoverTimer),delete J._hoverTimer},B.getHoverDelay()||R.hoverDelay)},handle_mouseleave:function(){var K=this;K._hoverTimer&&(xq(K._hoverTimer),delete K._hoverTimer)},handleWindowMouseMove:function(W){var L=this,l=L.gv;L.fi({kind:l._panning?"betweenPan":"beginPan",event:W}),l._panning=1;var E=tn(l,W,L._lastClientPoint);l.setTranslate(L._tx+E.x,L._ty+E.y)},handle_mousewheel:function(s){this.gv.handleScroll(s,s.wheelDelta)},handle_DOMMouseScroll:function(Y){2===Y.axis&&this.gv.handleScroll(Y,-Y.detail)},handle_keydown:function(e){this.gv.handleKeyDown(e)}});var Cb=Ap.SelectInteractor=function(k){yd(Cb,this,[k])};pg("SelectInteractor",Nb,{_42:function(){var E=this,_=E.gv,u=_.getZoom(),R=E.mark,g=E.div;g||(g=E.div=eg(),Ul(E.getView(),g));var j={};j.x=R.x*u+_.tx(),j.y=R.y*u+_.ty(),j.width=R.width*u,j.height=R.height*u,Ae(g,j),this.intersects()?(g.style.border="",g.style.background=_.getRectSelectBackground()):(g.style.background="",g.style.border="1px solid "+_.getRectSelectBorderColor())},handle_mousedown:function(Z){var c=this,j=c.gv;if(c._57I=I,c.pendingClickThrough=I,!(j._editing||j._scrolling||tl()||Ie(Z))){var N=j.getDataAt(Z),x=j.sm();N?Bl(Z)?x.co(N)?x.rs(N):x.as(N):x.co(N)?N instanceof Xl&&N.isClickThroughEnabled()&&fb(Z)&&(c.pendingClickThrough=Po(Z)):x.ss(N):Bl(Z)||!j.isPannable()?fb(Z)&&(Bl(Z)||x.cs(),j.isRectSelectable()&&(c.startDragging(Z),j._77O=1)):fb(Z)&&(c._57I=Po(Z))}},handle_mouseup:function(k){var q=this,W=q.gv,V=q._57I;if(V&&(Jc(V,Po(k))<=1&&W.sm().cs(),q._57I=I),q.pendingClickThrough){if(Jc(q.pendingClickThrough,Po(k))<=1){var A=W.getDataAt(k);if(A instanceof Xl&&A.isClickThroughEnabled()){var x=W.getDataAt(k,function(p){var y=p.getParent()===A&&W.isSelectable(p,!0);return y});x&&(k.clickThrough=!0,W.sm().ss(x))}}q.pendingClickThrough=I}},handleWindowMouseUp:function(d){this.clear(d)},handleWindowMouseMove:function(j){var O=this,R=O.gv;O._logicalPoint=R.lp(j),O.mark?(O.fi({kind:"betweenRectSelect",event:j}),R.isPannable()&&O.autoScroll(j),O.redraw()):O.fi({kind:"beginRectSelect",event:j}),O.mark=Gj(O._lastLogicalPoint,O._logicalPoint),O.redraw()},intersects:function(){var t=this,P=t._lastLogicalPoint,e=t._logicalPoint;return P.x>e.x||P.y>e.y},clear:function(Q){var e=this,_=e.gv,D=e.mark;if(e._57I=I,e.pendingClickThrough=I,e._lastLogicalPoint){if(D){if(0!==D.width&&0!==D.height){var b=_.getDatasInRect(D,e.intersects());if(!b.isEmpty()){var w=_.sm(),E=w.toSelection(),d=Ac(Q),s=Q.altKey;b.each(function(b){w.co(b)?(!d||d&&s)&&E.remove(b):(!s||d&&s)&&E.add(b)}),w.ss(E)}}Pp(e.div),delete e.div,delete e.mark,e.redraw(),e.fi({kind:"endRectSelect",event:Q}),_.onRectSelectEnded()}e.clearDragging(),delete _._77O}},redraw:function(){var r=this;r._draw||(r._draw=1,hl(function(){r.mark&&r._42(),delete r._draw},16))}});var Lg=Ap.MoveInteractor=function(A){yd(Lg,this,[A])};pg("MoveInteractor",Nb,{handle_mousedown:function(o){var m=this,c=m.gv;if(fb(o)&&!c._editing&&!c._scrolling&&!tl()){var B=c.getSelectedDataAt(o);!B||c._39Q(B)&&!c.isMovable(B)?c._focusData=I:(m._data=B,c.handleMouseDown&&c.handleMouseDown(o,B),m.startDragging(o),c.isMovable(B)&&(c._moving=1))}},handleWindowMouseUp:function(A){var F=this,m=F.gv;m.handleMouseUp&&m.handleMouseUp(A,F._data),F.clear(A)},handleWindowMouseMove:function(Z){var I=this,U=I._data,L=I.gv;if((!L._93O||!L._93O(Z,U))&&L._moving){I._logicalPoint||I.fi({kind:"prepareMove",event:Z});var J=I._logicalPoint?"betweenMove":"beginMove",s={kind:J,event:Z},G=I._logicalPoint=L.lp(Z);"beginMove"!==J||I._alreadyBeginTransaction||(I._alreadyBeginTransaction=!0,L.getDataModel().beginTransaction());var o=I._calcShift(J,Z),F=o.x,d=o.y,g=I.gv.getMoveMode(Z,U);g&&("x"===g?d=0:"y"===g?F=0:"xy"!==g&&(F=d=0)),L.moveSelection(F,d),I._lastLogicalPoint=G,I.autoScroll(Z),I.fi(s)}},_calcShift:function(){var n=this,y=n._logicalPoint,Q=n._lastLogicalPoint,x=y.x-Q.x,L=y.y-Q.y;return{x:x,y:L}},clear:function(O){var x=this,Z=x.gv;x._lastLogicalPoint&&(x._lastLogicalPoint=x._data=Z._moving=I,x._logicalPoint&&(x.fi({kind:"endMove",event:O}),Z.onMoveEnded()),x.clearDragging()),x._alreadyBeginTransaction&&(x._alreadyBeginTransaction=!1,Z.getDataModel().endTransaction())}});var de=Ap.TextEditInteractor=function(Z){yd(de,this,[Z]),this.init()};pg("TextEditInteractor",Nb,{setUp:function(){var N=this;de.superClass.setUp.call(N),N.gv.mp(N.handleGvPropertyChange,N)},teatDown:function(){var G=this;de.superClass.teatDown.call(G),G.gv.ump(G.handleGvPropertyChange,G)},handleGvPropertyChange:function(){this._editTarget&&this.endTextEdit()},init:function(){var G=this,F=this.input=e.createElement("input"),c=F.style;F.text="text",c.border="1px solid #d8d8d8",c.position="absolute",c.padding="2px 3px",c.outline="none",c.marginLeft="-90px",c.marginTop="-16px",c.backgroundColor="rgba(255,255,255, 1)",c.fontSize="14px",c.width="180px",c.height="32px",c.boxShadow="0 0 13px rgba(16,142,233, 0.5)",c.textAlign="center",c.boxSizing="border-box",j(F,"keyup",function(B){return $r(B)&&G.endTextEdit(),Nn(B)?(G.endTextEdit(!0),void 0):void 0}),j(F,"focus",function(){F.select()});var z=this.textarea=e.createElement("textarea"),Y=this.wrap=e.createElement("div");Y.appendChild(z),c=z.style,c.margin=0,c.padding="4px",c.overflow="hidden",c.boxSizing="border-box",c.position="absolute",c.outline="none",c.backgroundColor="transparent",c.resize="none",c.textAlign="center",c.fontSize="14px",c.borderWidth=0,c.width="100%",c=Y.style,c.boxSizing="border-box",c.margin=0,c.padding=0,c.position="absolute",c.boxShadow="0 0 13px rgba(16,142,233, 0.5)",c.border="1px solid #d8d8d8",c.backgroundColor="rgba(255,255,255, 1)",c.zIndex="10",j(z,"keydown",function(Y){return(Ac()||Bl())&&$r(Y)?(G.endTextEdit(),void 0):Nn(Y)?(G.endTextEdit(!0),void 0):(G._editTarget instanceof _k||G.calculateTextareaHeight(String.fromCharCode(Y.keyCode)),void 0)}),j(z,"focus",function(){z.select()});var r=function(b){b.stopPropagation()};j(F,"mousedown",r),j(F,"touchstart",r),j(z,"mousedown",r),j(z,"touchstart",r),j(z,"click",r),G.SIZING_STYLE=["letter-spacing","line-height","padding-top","padding-bottom","font-family","font-weight","font-size","text-rendering","text-transform","width","text-indent","padding-left","padding-right","border-width","box-sizing"],G.HIDDEN_TEXTAREA_STYLE="visibility:hidden; min-height:0 !important;max-height:none !important;height:0 !important;visibility:hidden !important;overflow:hidden !important;position:absolute !important;z-index:-1000 !important;top:0 !important;right:0 !important",G.handleWindowClick=function(B){var k=G._editingDOM;if(k){var m=k.getBoundingClientRect(),l=Po(B);cj(m,l)||G.endTextEdit()}}},handle_mousedown:function(l){var F=this,e=F.gv;if(Fe(l)&&!e._editing){var t=e.getDataAt(l);if(t){var q=e.getTextEditInfo(t);q&&(this._editInfo=q,this._editTarget=t,e._editing=!0,q.isMultiline?this.handleMultilineEdit():this.handleTextEdit())}}},handleMultilineEdit:function(){var F=this,h=F.gv,a=F._editTarget,t=F.getTargetValue(),p=F.textarea,k=F.wrap,g=this._editInfo;this.hiddenTextarea||this.createHiddenTextarea(),(null===t||t===z)&&(t=""),p.value=t,g.font&&(p.style.font=g.font),F._editingDOM=p,h.appendHTML(k),this.layoutHTML(k,a),a instanceof _k?p.style.height="100%":(p.style.height="auto",this.calculateTextareaHeight()),hl(function(){p.focus(),j(V,"mousedown",F.handleWindowClick),j(V,"touchstart",F.handleWindowClick)},10)},handleTextEdit:function(){var s=this,W=s.gv,b=s._editTarget,M=s.getTargetValue(),v=s.input;(null===M||M===z)&&(M=""),v.value=M,s._editingDOM=v,W.getView().appendChild(v),this.layoutHTML(v,b),hl(function(){v.focus(),j(V,"mousedown",s.handleWindowClick),j(V,"touchstart",s.handleWindowClick)},10)},layoutHTML:function(P,D){var N=this.gv,J=N.getZoom();if(D instanceof _k){var W=N.getDataUI(D),G=W._6I,y=D.getScale(),e=P.style;P.style.left=G.x*J+N.tx()+"px",P.style.top=G.y*J+N.ty()+"px",P.style.width=W._6I.width+"px",P.style.height=W._6I.height+"px",Od(e,"transform","scale("+J*y.x+","+J*y.y+")"),Od(e,"transformOrigin","0px 0px")}else if(D instanceof nl){var G=D.getRect(),F=G.width*J;P.style.left=(G.x+G.width/2)*J+N.tx()+"px",P.style.top=(G.y+G.height/2)*J+N.ty()+"px",P.style.width=F+"px",P.style.marginLeft=-F/2+"px"}else if(D instanceof B.Edge){var W=N.getDataUI(D),G=W._6I;P.style.left=(G.x+G.width/2)*J+N.tx()+"px",P.style.top=(G.y+G.height/2)*J+N.ty()+"px"}},endTextEdit:function(c){var i=this,F=i._editInfo.isMultiline?i.wrap:i.input,R=i._editInfo.isMultiline?i.textarea:i.input;c||i.setTargetValue(R.value),i.gv.getView().removeChild(F),i.gv._editing=!1,delete i._editingDOM,delete i._editTarget,W(V,"mousedown",i.handleWindowClick),W(V,"touchstart",i.handleWindowClick)},setTargetValue:function(q){var n=this,Z=n._editTarget,l=n._editInfo,K=l.accessType,o=l.name;if(o&&K||(K="p",o="name"),"p"===K){var r=B.Default.setter(o);Z[r](q)}else"a"===K?Z.a(o,q):Z.s(o,q)},getTargetValue:function(){var q=this,V=q._editTarget,J=q._editInfo,Y=J.accessType,S=J.name;if(S&&Y||(Y="p",S="name"),"p"===Y){var O=B.Default.getter(S);return V[O]()}return"a"===Y?V.a(S):V.s(S)},createHiddenTextarea:function(){this.hiddenTextarea=e.createElement("textarea"),this.hiddenTextarea.setAttribute("style","margin:0; padding:0; position:absolute; overflowY:scroll; resize:none; box-sizing:border-box;pointer-events: none;opacity:0;"),this.hiddenTextarea.setAttribute("rows","1"),this.gv.getView().appendChild(this.hiddenTextarea)},calculateHTMLStyle:function(m,o){if(o&&this.computedStyleCache)return this.computedStyleCache;var T=this,D=V.getComputedStyle(m),k=D.getPropertyValue("box-sizing")||D.getPropertyValue("-moz-box-sizing")||D.getPropertyValue("-webkit-box-sizing"),f=parseFloat(D.getPropertyValue("padding-bottom"))+parseFloat(D.getPropertyValue("padding-top")),O=parseFloat(D.getPropertyValue("border-bottom-width"))+parseFloat(D.getPropertyValue("border-top-width")),E=T.SIZING_STYLE.map(function(B){return B+":"+D.getPropertyValue(B)}).join(";"),u={sizingStyle:E,paddingSize:f,borderSize:O,boxSizing:k};return o&&(this.computedStyleCache=u),u},calculateTextareaHeight:function(L){L=L||"";var x=this,m=x.textarea,U=x.hiddenTextarea,D=x.wrap,_=32,u=x.calculateHTMLStyle(m,!1),F=u.paddingSize,o=u.borderSize,t=u.boxSizing,c=u.sizingStyle;U.setAttribute("style",c+";"+x.HIDDEN_TEXTAREA_STYLE),U.value=m.value+L;var v=U.scrollHeight;"border-box"===t?v+=o:"content-box"===t&&(v-=F),m.style.height=v+"px",D.style.height=Math.max(v,_)+"px",D.style.marginTop=v*-.5+"px"}});var Oj=Ap.ScrollBarInteractor=function(V){yd(Oj,this,[V])};pg("ScrollBarInteractor",Nb,{_41o:function(){return this.gv.getViewRect().height<this.gv.getScrollRect().height},_40o:function(){return this.gv.getViewRect().width<this.gv.getScrollRect().width},isV:function(V){var f=this.gv.getViewRect();return this._41o()&&(f.x+f.width-this.gv.lp(V).x)*this.gv.getZoom()<Ud},isH:function(r){var K=this.gv.getViewRect();return this._40o()&&(K.y+K.height-this.gv.lp(r).y)*this.gv.getZoom()<Ud},handle_mousemove:function(e){this.handle_touchmove(e)},handle_touchmove:function(g){if(!_l&&fb(g)&&this.gv.isScrollBarVisible()){var S=this,I=S.isV(g),k=S.isH(g);(I||k)&&S.gv.showScrollBar(),S.gv._scrolling=I||k}},handleWindowMouseUp:function(I){this.handleWindowTouchEnd(I)},handleWindowTouchEnd:function(s){this._state=this._cp=this._tx=this._ty=this.gv._scrolling=I,this.fi({kind:"endScroll",event:s})},handle_mousedown:function(v){this.handle_touchstart(v)},handle_touchstart:function(w){var g=this;if(g.gv.setFocus(w),cl(w),g.handle_touchmove(w),!(Gg(w)>1)&&g.gv._scrolling&&g.gv.isScrollBarVisible()){g._cp=Po(w),g._tx=g.gv.tx(),g._ty=g.gv.ty();var q=g.isV(w);g._state=q?"vScroll":"hScroll",ii(g,w),g.fi({kind:"beginScroll",event:w})}},handleWindowMouseMove:function(n){this.handleWindowTouchMove(n)},handleWindowTouchMove:function(w){var U=Po(w),a=this.gv.getViewRect(),m=this.gv.getScrollRect();"vScroll"===this._state?this.gv.ty(this._ty+(this._cp.y-U.y)*m.height/a.height):"hScroll"===this._state&&this.gv.tx(this._tx+(this._cp.x-U.x)*m.width/a.width),this.fi({kind:"betweenScroll",event:w})}});var zf=Ap.TouchInteractor=function(D,N){N=N||{},N.selectable===z&&(N.selectable=!0),N.movable===z&&(N.movable=!0),N.pannable===z&&(N.pannable=!0),N.pinchable===z&&(N.pinchable=!0),N.editable===z&&(N.editable=!0),this.params=N,yd(zf,this,[D])};pg("TouchInteractor",Nb,{ms_edit:1,setUp:function(){var N=this;zf.superClass.setUp.call(N),gj&&N.params.editable&&N.gv.setEditInteractor(N)},tearDown:function(){var X=this;zf.superClass.tearDown.call(X),gj&&X.params.editable&&X.gv.setEditInteractor(I)},clear:function(Y){var S=this,J=S.gv;J._moving&&(S.fi({kind:"endMove",event:Y}),delete J._moving,J.onMoveEnded(),J.dm().endTransaction()),J._panning&&(S.fi({kind:"endPan",event:Y}),delete J._panning,J.onPanEnded()),J._pinching&&(S.fi({kind:"endPinch",event:Y}),delete J._pinching,J.onPinchEnded()),J._editing&&(S._46O(Y),S._77I=S._node=S._edge=S._shape=S._rect=S._89I=S._index=J._editing=I),S.pendingClickThrough=S._moving=S._panning=S._pinching=S._editing=S._57I=S._data=S._beginHistory=I,S.clearDragging()},handle_touchstart:function(m){var B=this;if(!B.gv._editing){cl(m),B._57I=I,B.pendingClickThrough=I;var T=B.params,g=B.gv,l=g.sm(),K=g.getDataAt(m),P=Gg(m);if(1===P){if(Fe(m))return g.handleDoubleClick(m,K),void 0;g.handleClick(m,K),K&&(g.handleMouseDown&&g.handleMouseDown(m,K),B._data=K),T.selectable||(K=I),K&&(l.co(K)?K instanceof Xl&&K.isClickThroughEnabled()&&(B.pendingClickThrough=Po(m)):l.ss(K),T.editable&&g.isEditable(K)&&B._79I(m,K,!0)?(B._editing=1,B.startDragging(m)):T.movable&&g.isMovable(K)&&(B._moving=1,B.startDragging(m))),K&&(g.isMovable(K)||g._39Q(K))||(B._57I=Po(m),T.pannable&&g.isPannable()&&(B._panning=1,B.startDragging(m),B._translate={x:g.tx(),y:g.ty()}))}else if(T.pinchable&&2===P){if(!g.getEditInteractor()&&K){var Z=Td(g.getImage(K));if(Z&&tp(Z.scrollable,K,this))return}B._pinching=1,B.startDragging(m);var u=g.getView(),G=g.getZoom(),_=u.getBoundingClientRect(),i=m.touches[0],U=m.touches[1],D={x:(i.clientX+U.clientX)/2-_.left,y:(i.clientY+U.clientY)/2-_.top};D.x-=g.tx(),D.y-=g.ty(),D.x/=G,D.y/=G,B._p=D,B._d=ej(m)}}},handle_touchend:function(n){var p=this,o=p.gv,d=p._57I,E=p._data;if(d&&(Jc(d,Po(n))<=1&&!o.getDataAt(n)&&o.sm().cs(),p._57I=I),E&&o.handleMouseUp&&o.handleMouseUp(n,E),p.pendingClickThrough){if(Jc(p.pendingClickThrough,Po(n))<=1){var E=o.getDataAt(n);if(E instanceof Xl&&E.isClickThroughEnabled()){var M=o.getDataAt(n,function(y){var j=y.getParent()===E&&o.isSelectable(y,!0);return j});M&&(n.clickThrough=!0,o.sm().ss(M))}}p.pendingClickThrough=I}},handleWindowTouchEnd:function(A){this.clear(A)},handleWindowTouchMove:function($){var H=this,Q=H.gv,w=Gg($);if(1===w){var r=Po($),d=tn(Q,r,H._lastClientPoint),n=Jc({x:0,y:0},d);if(H._editing&&(H._beginHistory||(H._beginHistory=1,Q.dm().beginTransaction()),Q._editing=1,H._78I($)),H._moving){if(!Q._moving&&n<R.touchMoveThreshold)return;H._beginHistory||(H._beginHistory=1,Q.dm().beginTransaction()),H.handleMove($)}else if(H._panning){if(!Q._panning&&n<R.touchMoveThreshold)return;Q.setTranslate(H._translate.x+d.x,H._translate.y+d.y),H.fi({kind:Q._panning?"betweenPan":"beginPan",event:$}),Q._panning=1}}else if(2===w&&H._pinching){var N=ej($);Q.handlePinch(H._p,N,H._d),H._d=N,H.fi({kind:Q._pinching?"betweenPinch":"beginPinch",event:$}),Q._pinching=1}},handleMove:function(z){var R=this,$=R.gv,a=$.lp(z);$._93O&&$._93O(z,R._data)||($.moveSelection(a.x-R._lastLogicalPoint.x,a.y-R._lastLogicalPoint.y),R._lastLogicalPoint=a,R.autoScroll(z),R.fi({kind:$._moving?"betweenMove":"beginMove",event:z}),$._moving=1)}});var B=V.ht,me=B.graph._editor={Math:B.Math,Guide:{}};me.getStyle=function(c){var f,J=me.StyleMap;return J&&(f=J[c],f!==z)?f:me.DefaultStyleMap[c]},me.setStyle=function(k,r){var b=me.StyleMap;b||(b=me.StyleMap={}),b[k]=r},me.inEdit=function(R){return R._inXEdit===!0},me.startEdit=function(d){d._inXEdit=!0,me.Inject.doInject(d)},me._46O=function(r){r._inXEdit=!1,me.Inject.undoInject(r)},me.toScreenPosition=function(U,T){var a=U.tx(),Y=U.ty(),k=U._zoom;return new me.Math.Vector2(T.x*k+a,T.y*k+Y)},me.checkHit=function(u,h,c){return u.distanceTo(h)<c?!0:!1},me.toWorldPosition=function(X,K){var W=X.tx(),o=X.ty(),e=X._zoom;return{x:(K.x-W)/e,y:(K.y-o)/e}},me.setAntialias=function(o,q){for(var r,u=["imageSmoothingEnabled","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","oImageSmoothingEnabled","msImageSmoothingEnabled"],j=0,W=u.length;W>j&&(r=u[j],!(r in o));j++);o[r],o[r]=q},me.getTargetCornersOnScreen=function(l,y){if(!y)return null;var e,z=[];if(ke(y,l)){var u=Qj(l,y);e=[{x:u.x,y:u.y},{x:u.x+u.width,y:u.y},{x:u.x+u.width,y:u.y+u.height},{x:u.x,y:u.y+u.height}]}else{if(!y.getCorners)return null;e=y.getCorners()}return e.forEach(function(K){var w=me.toScreenPosition(l,K);z.push(w.x,w.y)}),z},me.log=function(){};var Qr;me.updateTipInfo=function(h,q,w){if(w){var G=B.Default.getLogicalPoint(h,q._canvas);G.x+=me.Icons.TipShiftX,G.y+=me.Icons.TipShiftY,Qr={helperPos:G,text:w,size:w.length}}else Qr=I},me.drawTip=function(D,d){Qr&&me.Icons.DrawIcon(d,D,me.Icons.TipHelper,Qr)};var rg=me.Inject={_modules:[]};rg.registAsModule=function(Z,c){var D={},f={};for(var s in Z){var B=c.prototype[s];D[s]=B}Z.getBackup=function(C){return D[C]},Z.getBackups=function(){return D},f.doInject=function(){for(var R in Z)"getBackup"!==R&&(c.prototype[R]=Z[R])},f.undoInject=function(){for(var H in Z)"getBackup"!==H&&(c.prototype[H]=D[H])},rg._modules.push(f)},rg.doInject=function(j){for(var h,D=rg._modules,Z=0,c=D.length;c>Z;Z++)h=D[Z],h.doInject(j)},rg.undoInject=function(k){for(var S,w=rg._modules,Y=0,$=w.length;$>Y;Y++)S=w[Y],S.undoInject(k)};var Nb=B.graph.EditInteractor=function(W){var k=this,C=e.createElement("canvas");C.className="editCanvas",C.style.position="absolute",k._uuid=B.Math.generateUUID(),k._styleMap={},k._canvas=C,k._context=C.getContext("2d"),Nb.superClass.constructor.call(k,W),this._editDetail=!1,me.setAntialias(k._context,!1),k._subModules=k.initSubModule(),k._gridGuide=new me.Guide.Grid(k),k._rectGuide=new me.Guide.Rect(k),k._hoverGuide=new me.Guide.Hover(k)},rf=Nb;B.Default.def(Nb,B.graph.Interactor,{ms_edit:1,ms_fire:1}),T.defineProperties(Nb.prototype,{editDetail:{get:function(){var p=!!this._editDetail;return p},set:function(S){var e=this,L=e._editDetail;L!==S&&(e._editDetail=S,e.gv._editing=S,e.fp("editDetail",L,S),e.fp("pointsEditingMode",L,S),e.fi({kind:S?"beginEditPoints":"endEditPoints"}))}},gvEditing:{get:function(){return this.gv._editing},set:function(V){(!this._editDetail||V)&&(this.gv._editing=V,V||(this.editDetail=!1))}},editing:{get:function(){return this._editing},set:function(E){this._editing=E,this.gvEditing=E}},editingModule:{get:function(){return this._editMod}},pointsEditingMode:{get:function(){return this.editDetail},set:function(n){var i=this;i.editDetail!==n&&(n?i._tryEnterEditDetailMode():i._tryQuitEditDetailMode())}},gridEnabled:{get:function(){var o=this._gridEnabled;if(!o)return!1;var q=this.gv;return q?!0:!0},set:function(H){H!==this._gridEnabled&&(this._gridEnabled=H,this._42())}},alignmentGuideEnabled:{get:function(){return this._agEnabled},set:function(b){b!==this._agEnabled&&(this._agEnabled=b,this._42())}},gridGuide:{get:function(){return this._gridGuide}},rectGuide:{get:function(){return this._rectGuide}},hoverGuide:{get:function(){return this._hoverGuide}}}),Nb.prototype.initSubModule=function(){var z=this;return[new me.Anchor(z),new me.RotateX(z),new me.MoveDummy(z),new me.Rect(z),new me.Curve(z),new me.MoveHelper(z)]},Nb.prototype.getSubModule=function(L){var K,r,a,S=this._subModules;for(r=0,a=S.length;a>r;r++)if(K=S[r],K.catalog===L)return K},Nb.prototype.invokeSubModule=function(y,w){for(var $,I,s,T=this,Y=T._subModules,m=Array.prototype.slice.call(arguments,2),M=0,h=Y.length;h>M;M++)if($=Y[M],I=$[y],I&&(s=I.apply($,m),s!=z&&w))return $},Nb.prototype.invokeSubModuleInverse=function(f,q){var y=this,a=y._subModules;if(a)for(var D,x,$,k=Array.prototype.slice.call(arguments,2),Y=a.length-1;Y>=0;Y--)if(D=a[Y],x=D[f],x&&($=x.apply(D,k),$!=z&&q))return D},Nb.prototype.setUp=function(){me.log("setUp");var v=this,b=v.gv,Y=b.getView(),J=v._canvas;Nb.superClass.setUp.call(v),b.setEditInteractor(v),b._79O?Y.insertBefore(J,b._79O):Y.appendChild(J),me.startEdit(b),v.invokeSubModule("setUp"),b.dm().mm(v._onDataModelChanged,v),b.dm().md(v._onDataPropertyChanged,v)},Nb.prototype.tearDown=function(){me.log("tearDown");var U=this,K=U.gv,N=K.getView();U._resetCustomCursorStyle(),Nb.superClass.tearDown.call(U),K.dm().umm(U._onDataModelChanged,U),K.dm().umd(U._onDataPropertyChanged,U),K.setEditInteractor(null),N.removeChild(U._canvas),U._drawTimer&&(xq(U._drawTimer),U._drawTimer=null),me._46O(K),U.invokeSubModule("tearDown")},Nb.prototype._onDataModelChanged=function(Q){var V=this;("clear"===Q.kind||"remove"===Q.kind&&V.editDetail&&Q.data===V.getSubModule("Curve").target)&&(V.editDetail=!1,V._42())},Nb.prototype._onDataPropertyChanged=function(x){var U=this;if(U.editDetail){var i=U.getSubModule("Curve"),C=x.data;C===i.target&&(C._writing||i._handleDataChanged(x))}},Nb.prototype.clear=function(){me.log("clear")},Nb.prototype.redraw=function(){this._42()},Nb.prototype._42=function(){var n=this;n._drawTimer||(n._drawTimer=hl(function(){n._drawTimer=null,n.drawImpl()},0))},Nb.prototype.drawImpl=function(){var d;for(d in{_42:!0})break;return function(){var K=this,t=K._canvas,A=K.gv,J=A.getWidth(),w=A.getHeight(),E=K._context,e=B.Default.getInternal(),_=R.devicePixelRatio;(t.width!==J||t.height!==w)&&e.setCanvas(t,J,w,_),E.clearRect(0,0,t.width,t.height);var Q=K._getValidSelection();E.save(),E.scale(_,_),K._gridGuide._42(),K.invokeSubModuleInverse(d,!1,E,A,Q),K._rectGuide._42(),K._hoverGuide._42(),E.restore()}}(),Nb.prototype._getValidSelection=function(){var G=this,M=G.gv,B=M.sm().getSelection(),Y=[];return B.each(function(G){M.isVisible(G)&&M.isEditable(G)&&Y.push(G)}),Y},Nb.prototype.handle_touchmove=function(S){return this.handle_mousemove(S)},Nb.prototype.handle_mousemove=function(O){if(!B.Default.isDragging()){var I=this;if((I.editDetail||!tl()&&!Ie(O))&&!I.gv._externalEditing){if(I.gvEditing=!1,I._checkEdit(O))I.gvEditing=!0;else{if(!I.getStyle("hoverGuideVisible"))return;I.hoverData=I.gv.getDataAt(O)}I._42()}}},Nb.prototype.handle_touchstart=function(M){return this.handle_mousedown(M)},Nb.prototype.handle_mousedown=function(N){cl(N);var K=this;if((K.editDetail||!tl()&&!Ie(N))&&!K.gv._externalEditing){if(Fe(N)&&!N.clickThrough){if(K.editDetail){if(K._tryQuitEditDetailMode(N))return}else if(K._tryEnterEditDetailMode())return;K.gv.dm().beginTransaction();var k=K.invokeSubModule("handleDoubleClick",!0,N);if(K.gv.dm().endTransaction(),k)return}var A=K._checkEdit(N);A&&(K._downPosition=K._getLogicalPoint(N),K.gv.dm().beginTransaction(),A.startEdit(K,N),K.editing=!0)}},Nb.prototype._checkEdit=function(D){var g=this,A=g.gv,n=g._getLogicalPoint(D),v=g.invokeSubModule("check",!0,A,D,n)||null;return g._editMod=v,v},Nb.prototype.handleWindowTouchMove=function(h){return this.handleWindowMouseMove(h)},Nb.prototype.handleWindowMouseMove=function(Q){var A=this,K=A._downPosition;if(K){var p=A._getLogicalPoint(Q);if(p.distanceTo(K)<A.getStyle("moveSensitivity"))return;delete A._downPosition}var F=A._editMod;F&&F.handleEdit(A.gv,Q),A.redraw()},Nb.prototype._getLogicalPoint=function(W){var N=this,R=B.Default.getLogicalPoint(W,N._canvas);return new me.Math.Vector2(R)},Nb.prototype.handleWindowTouchEnd=function(T){return this.handleWindowMouseUp(T)},Nb.prototype.handleWindowMouseUp=function(){var X;for(X in{_46O:!0})break;return function(F){var x=this;x.editing=!1,x.setCursor("default"),x.invokeSubModule(X,!1,F),x._42(),x.gv.dm().endTransaction()
}}(),Nb.prototype.handle_mousewheel=function(b){var v=this;cl(b),v.invokeSubModule("preHandleScroll",!0)||v.gv.handleScroll(b,b.wheelDelta)},Nb.prototype.handleDelete=function(){var j=this;if(!j.editDetail){j.gv.dm().beginTransaction();var k=j.invokeSubModule("handleNormalStateDelete",!0);return j.gv.dm().endTransaction(),k||j.gv.removeSelection(),void 0}j.gv.dm().beginTransaction(),j.invokeSubModule("handleDelete",!0),j.gv.dm().endTransaction(),j._42()},Nb.prototype.handle_keydown=function(s){var B=this;if((s.metaKey||s.ctrlKey)&&B._42(),tl(s)&&!B.editing)return B.gvEditing=!1,B.setCursor("default"),B._42(),void 0;var g=$r(s);return B.editDetail?((g||Nn(s))&&(B.editDetail=!1,B._42()),B.gv.dm().beginTransaction(),B.invokeSubModule("handle_keydown",!0,s),B.gv.dm().endTransaction(),void 0):(B.gv.dm().beginTransaction(),B.invokeSubModule("handleNormalStateKeyDown",!0,s),B.gv.dm().endTransaction(),g&&B._tryEnterEditDetailMode(),void 0)},Nb.prototype.handle_keyup=function(D){this.gv.dm().beginTransaction(),this.invokeSubModule("handle_keyup",!0,D),this.gv.dm().endTransaction()},Nb.prototype._tryEnterEditDetailMode=function(){var z=this;return!z.editDetail&&z.invokeSubModule("canEnterEditDetailMode",!0)&&1===z._getValidSelection().length?(z.editDetail=!0,z._42(),!0):void 0},Nb.prototype._tryQuitEditDetailMode=function(Y){var P=this;return P.editDetail?!Y||P.invokeSubModule("canQuitEditDetailMode",!0,Y)?(P.editDetail=!1,P._42(),!0):!1:!1},Nb.prototype.setStyle=function(d,w,y){var V=this;y?me.setStyle(d,w):V._styleMap[d]=w,"baseColor"===d&&(Yf=w),V.fp("styleChanged",null,{key:d,value:w,base:y}),V._42()},Nb.prototype.getStyle=function(K){var D=this,t=D._styleMap[K];return t!==z?t:me.getStyle(K)},Nb.prototype.setCursor=function(W){this._resetCustomCursorStyle(),B.graph.EditInteractor.superClass.setCursor.call(this,W)},Nb.prototype._drawHostGuide=function(W){var j=this,M=j._context,I=j.gv;me.Icons.DrawIcon(j,M,me.Icons.NodeHoverGuide,W.corners);var b=W.host;if(b){var u=I.getAttachPoints(b);if(u&&u.length)for(var d=0,T=u.length;T>d;d++){var R=u[d],G=Hj(I,b,0,R.offsetX||0,R.offsetY||0,R.x,R.y);G=me.toScreenPosition(I,G),G.isAttach=W.attach===d,me.Icons.DrawIcon(j,M,me.Icons.AttachPoint,G)}}},Nb.prototype._resetCustomCursorStyle=function(){var A=this;if(A._customStyle){var Z=this.gv.getView();Z.classList&&Z.classList.remove&&Z.classList.remove(A._customStyle),A._customStyle=null}},Nb.prototype._setRotateCursor=function(w){var l=this,z=l._cursorFactory;z||(z=l._cursorFactory=new me.CursorFactory(l));var X=z.getRotateCursor(w),r=l.gv.getView();l._resetCustomCursorStyle(),l._customStyle=X,r.classList&&r.classList.add&&r.classList.add(X)};var hf=me.Group=function(q){var M=this;M._entities=q,M._64O=0,M._position={x:0,y:0},M._scale={x:1,y:1},M._anchor={x:.5,y:.5},M._anchor2={x:.5,y:.5}};hf.prototype={},hf.prototype.constructor=hf;var lh=null,xd=null;hf.findOrCreateGroup=function(b,$){if(xd===$&&lh&&lh.checkIsMe(b))return lh;xd=$;var Y=new me.Group(b);return Y.getKeyOb()?(lh=Y,Y):void 0},hf.prototype.checkIsMe=function(p){var e=this._entities;if(e.length!==p.length)return!1;var u,i={},F=p.length;for(u=0;F>u;u++)i[p[u]._id]=!0;for(u=0;F>u;u++)if(!i[e[u]._id])return!1;return!0},hf.prototype.getRotation=function(){return this._64O},hf.prototype.getPosition=function(){return this._position},hf.prototype.getAnchor=function(){return this._anchor},hf.prototype.getWidth=function(){return this._width},hf.prototype.getScale=function(){return this._scale},hf.prototype.getSize=function(){return{width:this._width,height:this._height}},hf.prototype.getHeight=function(){return this._height},hf.prototype.getKeyOb=function(){for(var E=this._entities,X=E.length-1;X>=0;X--){var H=E[X];if(this.isNode(H))return H}},hf.prototype.getAnchor2=function(){var l=this,S=l.rotateCenter;if(S)return S;var c=l.getKeyOb();if(!c)return l._anchor;var X=l._anchor2,z=c.getMatrix();return z.tf({x:c.getWidth()*(X.x-c.getAnchor().x),y:c.getHeight()*(X.y-c.getAnchor().y)})},hf.prototype.setAnchor2=function(p,C){var P=this,R=P.getKeyOb();if(R){var f,T=R.getMatrix();f="number"==typeof p?{x:p,y:C}:p;var K=T.tfi(f);P._anchor2={x:R.getAnchor().x+K.x/R.getWidth(),y:R.getAnchor().y+K.y/R.getHeight()}}},hf.prototype.setRotation=function(){},hf.prototype.beginRotate=function(l){this.rotateCenter=l.pos,this.rotateMode=l.groupRotateMode},hf.prototype.endRotate=function(){delete this.rotateCenter,delete this.rotateMode},hf.prototype.addRotation=function(L,k,E){return"batch"===k?this._addRotationInBatchMode(L,E):"block"===k?this._addRotationInBlockMode(L,E):void 0},hf.prototype._addRotationInBlockMode=function(T,a){var s=this,C=s.rotateCenter||s.getPosition();s._entities.forEach(function(Q){if(s.isNode(Q)&&(!a||a(Q))){var Y=Q.getMatrix();Y.translate(-C.x,-C.y),Y.rotate(T),Y.translate(C.x,C.y);var c=Math.sign(Q.getScale().x);Q.setRotation(Wd(Y.b*c,Y.a*c)),Q.setPosition(Y.tx,Y.ty)}})},hf.prototype._addRotationInBatchMode=function(l,h){var N=this,y=N._anchor2;N._entities.forEach(function(o){if(N.isNode(o)&&(!h||h(o))){var k=o.getAnchor(),m=o.getMatrix(),Y=m.tf({x:o.getWidth()*(y.x-k.x),y:o.getHeight()*(y.y-k.y)}),V=new me.Math.Matrix2d;V.set(m.a,m.b,m.c,m.d,m.tx,m.ty),V.translate(-Y.x,-Y.y),V.rotate(l),V.translate(Y.x,Y.y);var B=Math.sign(o.getScale().x);o.setRotation(Wd(V.b*B,V.a*B)),o.setPosition(V.tx,V.ty)}})},hf.prototype.setPosition=function(T){var Z,S,k,A,j=this,g=j._position,e=T.x-g.x,Q=T.y-g.y,b=j._entities;for(S=0,k=b.length;k>S;S++)Z=b[S],Dg(Z)&&(A=Z.getPosition(),Z.setPosition(A.x+e,A.y+Q));j._position=T},hf.prototype.setScale=function(A,c){var V=this,g=A/V._scale.x,O=c/V._scale.y;V._adjustChildScaleOrSize(g,O,"size"),V._scale={x:A,y:c}},hf.prototype.getRect=function(){var w=this,t=w._position,Y=w._width,r=w._height;return{x:t.x-Y/2,y:t.y-r/2,width:Y,height:r}},hf.prototype.setSize=function(P,F){var x=this,P=Math.max(1,P),F=Math.max(1,F),R=P/x._width,W=F/x._height;x._adjustChildScaleOrSize(R,W,"size"),x._width=P,x._height=F},hf.prototype._adjustChildScaleOrSize=function(O,d,t){var Y,g,H,J,$,F,r,k,z,Q,X,E,D,_,c=this,e=c._position,P=c._entities,M=new me.Math.Matrix2d;for(g=0,H=P.length;H>g;g++)if(Y=P[g],c.isNode(Y)){if(J=Y.getPosition(),$=Y.getRotation(),F=Y.getWidth(),r=Y.getHeight(),k=Y.getScale(),X=k.x*F,E=k.y*r,M.identity().scale(X,E).rotate($).translate(J.x,J.y).translate(-e.x,-e.y).rotate(-c._64O),$=Wd(M.b*Math.sign(X),M.a*Math.sign(X)),M.scale(O,d),z=Math.cos($),Q=Math.sin($),Math.abs(z)<.001?(D=M.b/Q,_=-M.c/Q):(D=M.a/z,_=M.d/z),"scale"===t)Y.setScale(D/F,_/r);else if("size"===t){var I=D/k.x,l=_/k.y;Y.setScale(oh(D)*Math.abs(k.x),oh(_)*Math.abs(k.y)),Y.setSize(Math.max(.1,Math.abs(I)),Math.max(.1,Math.abs(l)))}M.rotate(c._64O).translate(e.x,e.y),Y.setPosition(M.tx,M.ty)}},hf.prototype.getMatrix=function(){var D=this,a=D._position,X=B.Default.getInternal(),A=D._scale;return new X.Mat(D._64O,a.x,a.y,A.x,A.y)},hf.prototype.toGlobal=function(s){return this.getMatrix().tf(s)},hf.prototype.getCorners=function(){var I=this,T=I._width,L=I._height,g=I._anchor,U=-T*g.x,W=-L*g.y,l=I.getMatrix();return[l.tf(U,W),l.tf(U,W+L),l.tf(U+T,W+L),l.tf(U+T,W)]},hf.prototype.calcInfo=function(){var E,d,R,c,B,z,w=this,M=[],f=w._entities,H=w._64O;for(c=0,B=f.length;B>c;c++)z=f[c],w.isNode(z)&&z.getCorners&&M.push.apply(M,z.getCorners());if(M.length){var $=Math.cos(-H),L=Math.sin(-H),p=1/0,C=-1/0,t=1/0,u=-1/0;for(c=0,B=M.length;B>c;c++)R=M[c],E=R.x,d=R.y,R.x=$*E-L*d,R.y=L*E+$*d,p=Math.min(p,R.x),C=Math.max(C,R.x),t=Math.min(t,R.y),u=Math.max(u,R.y);w._width=(C-p)/w._scale.x,w._height=(u-t)/w._scale.y,$=Math.cos(H),L=Math.sin(H);var k=w._anchor;E=p+(C-p)*k.x,d=t+(u-t)*k.y,w._position={x:$*E-L*d,y:L*E+$*d}}},hf.prototype.isNode=function(v){return Dg(v)?ke(v)?v.size()?!1:!0:!0:!1},hf.prototype._42=function(i,d,V){var Y,q,b,M,k,g,u,E,v=this,W=v._entities,p=v.rotateMode;for("batch"===p&&(E=v.getKeyOb()),Y=0,q=W.length;q>Y;Y++)b=W[Y],v.isNode(b)&&(g=b.getRect(),M=me.toScreenPosition(V,{x:g.x,y:g.y}),k=me.toScreenPosition(V,{x:g.x+g.width,y:g.y+g.height}),u={min:M,max:k},b===E&&(u.isKeyOb=!0),me.Icons.DrawIcon(i,d,me.Icons.GroupSubEntityRect,u))};var Qh=me.CurveActiving=function(d,c){this._curve=d,this._interactor=d._interactor,this.silent=!0;for(var f in c)this[f]=c[f];delete this.silent};Qh.prototype={},Qh.prototype.constructor=Qh,T.defineProperties(Qh.prototype,{point:{get:function(){return this._point},set:function(T){var p=this;p._point=T,p.editingCtrl||p.silent||p._firePointChange()}},pairs:{get:function(){return this._pairs},set:function(U){var Y=this;Y._pairs=U,Y.editingCtrl&&!Y.silent&&Y._firePointChange()}}}),Qh.prototype._firePointChange=function(){var U=this,k=U.getCurrentEditingPoint(),I=U._interactor;if(!k)return I.fi({kind:"selectPoint"}),void 0;var r=this._curve.target;if(r){var M=me.getDataMatrix(r).invert(),E=k.e;k=M.apply(me.toWorldPosition(I.gv,k)),k.e=E;var Q=U._lastFirePoint;Q&&Math.abs(k.x-Q.x)<1e-5&&Math.abs(k.y-Q.y)<1e-5&&(k.e==z&&Q.e==z||Math.abs(k.e-Q.e)<1e-5)||(U._lastFirePoint=k,I.fi({kind:"selectPoint",x:k.x,y:k.y,e:k.e}))}},Qh.prototype.dispose=function(){this._interactor.fi({kind:"selectPoint"})},Qh.prototype.getCurrentEditingPoint=function(){var q=this,L=q.editingCtrl;if(L){var R=q.pairs;if(R){var h=R[L.pairId];if(h){var G=h[L.type];if(G)return G}}}return q._point};var Sg=me.CursorFactory=function(Y){var t=this;t._interactor=Y,t._rotateCursorStyles={}};Sg.prototype={},Sg.prototype.constructor=Sg,Sg.prototype.getRotateCursor=function(k){var s=this;0>k&&(k+=2*Math.PI);var X=s._interactor,T=X.getStyle("rotateCursorSize"),G=X.getStyle("rotateCursorRound"),W=Math.round(180*(k/Math.PI)/G);W*G>=360&&(W=0);var z=s._rotateCursorStyles,H="htCustomRotateStyle_"+T+"_"+G+"_"+W;return z[H]||(s._produceRotateCursor(H,T,G,W),z[H]=!0),H},Sg.prototype._produceRotateCursor=function(s,b,M,U){var V=this;V._interactor;var X=V._canvas;X||(X=V._canvas=e.createElement("canvas"));var G=R.devicePixelRatio;X.width=X.height=b*G,X.style.width=X.style.height=b+" px";var n=X.getContext("2d");me.setAntialias(n,!1),n.scale(G,G);var H,h,$,t,D,j=Math.round(b/2),u=""+j+" "+j+",auto !important;",l=4;H=Math.PI/180*U*M,n.clearRect(0,0,b,b),n.save(),n.scale(b/32,b/32),n.translate(16,15),n.rotate(H+Math.PI/2),n.beginPath(),n.moveTo(-8,0),n.lineTo(-8,l),n.lineTo(-8+l,l),n.moveTo(8,0),n.lineTo(8,l),n.lineTo(8-l,l),n.moveTo(-8,l),n.quadraticCurveTo(0,-6,8,l),n.restore(),n.lineCap="round",n.lineJoin="miter",n.strokeStyle="white",n.lineWidth=4,n.stroke(),n.strokeStyle="black",n.lineWidth=2,n.stroke(),h=JSON.stringify(X.toDataURL()),t="cursor:url("+h+")"+u,1!==G&&($='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+b+'px" height="'+b+'px"><image xlink:href='+h+' width="'+b+'" height="'+b+'"/></svg>',t+="cursor:url(data:image/svg+xml;base64,"+btoa($)+")"+u,t+="cursor:-webkit-image-set(url("+h+")"+G+"x,url("+h+")1x)"+u),D=e.createElement("style"),D.textContent="body."+s+" *, ."+s+"{"+t+"}",e.head.appendChild(D)};var Cf=me.Guide.Grid=function(y){var m=this;m._interactor=y,m._alignmentGuideId=0,m._xAlignmentGuide=[],m._yAlignmentGuide=[]};Cf.prototype={},Cf.prototype.constructor=Cf,T.defineProperties(Cf.prototype,{gridBlockSize:{get:function(){var N=this;return N._gridBlockSize||N._interactor.getStyle("gridBlockSize")},set:function(f){this._gridBlockSize=f,this._interactor._42()}},gridThickLinesEvery:{get:function(){var h=this;return h._gridThickLinesEvery||h._interactor.getStyle("gridThickLinesEvery")},set:function(j){this._gridThickLinesEvery=j,this._interactor._42()}},gridEnabled:{get:function(){var G=this,Q=G._interactor;return Q.gridEnabled&&G.isValidGrid()}}}),Cf.prototype._42=function(){var F=this,u=F._interactor;F.gridEnabled&&F.drawGrid(),u.alignmentGuideEnabled&&F.drawAlignmentGuide()},Cf.prototype.makeMatrix=function(){var L=this,V=L._interactor.getStyle("gridAngle"),v=L._interactor.getStyle("gridRotation"),F=new me.Math.Matrix2d,z=Math.sin(V),q=Math.cos(V);return F.set(1,0,q,z,0,0),F.rotate(v),F},Cf.prototype.isValidGrid=function(){var g=this,C=Math.PI,j=g._interactor,S=j.gv;if(S._zoom<j.getStyle("gridZoomThreshold"))return!1;var s=j.getStyle("gridAngle"),b=Math.abs(180*(s%C/C)),Z=1-1e-8;return Z>b||b>180-Z?!1:!0},Cf.prototype.drawAlignmentGuide=function(){var F=this,I=F._interactor,X=I.gv,G=I._canvas,l=I._context,U=G.width,y=G.height,N=X.tx(),R=X.ty(),d=X._zoom;l.beginPath(),l.strokeStyle=I.getStyle("gridAlignmentGuideColor"),l.lineWidth=1,F._xAlignmentGuide.forEach(function(g){var I=g.p*d+N;l.moveTo(I,0),l.lineTo(I,y)}),F._yAlignmentGuide.forEach(function(q){var t=q.p*d+R;l.moveTo(0,t),l.lineTo(U,t)}),l.stroke()},Cf.prototype.drawGrid=function(){function Q(a,i,G,I){var t=me.toScreenPosition(r,e.apply({x:a,y:i})),D=me.toScreenPosition(r,e.apply({x:G,y:I}));E.moveTo(t.x,t.y),E.lineTo(D.x,D.y)}var z=this,h=z._interactor,w=z.gridBlockSize,N=z.gridThickLinesEvery,B=h.getStyle("gridThickColor"),y=h.getStyle("gridLightColor"),r=h.gv,x=h._canvas,E=h._context,l=x.width,R=x.height,e=z.makeMatrix(),U=e.applyInverse(me.toWorldPosition(r,{x:0,y:0})),b=e.applyInverse(me.toWorldPosition(r,{x:l,y:0})),j=e.applyInverse(me.toWorldPosition(r,{x:0,y:R})),$=e.applyInverse(me.toWorldPosition(r,{x:l,y:R})),F=Math.min(U.x,b.x,j.x,$.x),C=Math.max(U.x,b.x,j.x,$.x),t=Math.min(U.y,b.y,j.y,$.y),S=Math.max(U.y,b.y,j.y,$.y);l=C-F,R=S-t;var m=Math.ceil(F/w),T=Math.floor(C/w),k=Math.ceil(t/w),H=Math.floor(S/w);r.tx(),r.ty(),r._zoom;var O,A,i;for(E.save(),E.lineWidth=1,E.beginPath(),E.strokeStyle=B,i=Math.ceil(m/N)*N;T>=i;i+=N)O=i*w,Q(O,t,O,S);for(i=Math.ceil(k/N)*N;H>=i;i+=N)A=i*w,Q(F,A,C,A);for(E.stroke(),E.beginPath(),E.strokeStyle=y,i=m;T>=i;i++)0!==i%N&&(O=i*w,Q(O,t,O,S));for(i=k;H>=i;i++)0!==i%N&&(A=i*w,Q(F,A,C,A));E.stroke(),E.restore()},Cf.prototype.getAlignmentGuides=function(){var V=this;return{x:V._xAlignmentGuide,y:V._yAlignmentGuide}},Cf.prototype.addAlignmentGuide=function(v,p,s){var T=this,I="x"===v?T._xAlignmentGuide:T._yAlignmentGuide,s=s?s:++T._alignmentGuideId,i={p:p,id:s};if(I.length){var Z=T._findClosestAlignmentGuide(i.p,I);Z.dis<0?I.splice(Z.index+1,0,i):I.splice(Z.index,0,i)}else I.push(i);return T._interactor._42(),s},Cf.prototype.findClosest=function(X,d,$){var O=this,E=O._interactor,v=E.gv;$&&(X=me.toWorldPosition(v,X));var z,G,L,m=1/0,Q=1/0,I=X.x,Z=X.y;if(O.gridEnabled){var T=O.gridBlockSize,e=O.makeMatrix(),D=e.applyInverse(X);D=e.apply({x:Math.round(D.x/T)*T,y:Math.round(D.y/T)*T}),m=D.x-I,Q=D.y-Z,L=!0}if(E.alignmentGuideEnabled&&(z=O._findClosestAlignmentGuide(I,O._xAlignmentGuide).dis,G=O._findClosestAlignmentGuide(Z,O._yAlignmentGuide).dis,Math.abs(z)<Math.abs(m)&&(m=z,L=!0),Math.abs(G)<Math.abs(Q)&&(Q=G,L=!0)),L){L=!1;var i=v._zoom,c=E.getStyle("smartGuideThreshold")/i,h={};if(Math.abs(m)<c&&"y"!==d&&(h.x=$?m*i:m,L=!0),Math.abs(Q)<c&&"x"!==d&&(h.y=$?Q*i:Q,L=!0),L)return h}},Cf.prototype._findClosestAlignmentGuide=function(P,u){if(!u.length)return{dis:1/0};for(var v,g=0,U=u.length-1;U-g>1;)v=Math.floor((g+U)/2),u[v].p<P?g=v:U=v;var c=u[g].p-P,T=u[U].p-P;return Math.abs(c)<=Math.abs(T)?{line:u[g],dis:c,index:g}:{line:u[U],dis:T,index:U}},Cf.prototype.removeAllAlignmentGuide=function(m){var g=this;"y"!==m&&(g._xAlignmentGuide=[]),"x"!==m&&(g._yAlignmentGuide=[]),g._interactor._42()},Cf.prototype.removeAlignmentGuide=function(Q){for(var x,T,O,V=this,g=V._xAlignmentGuide,f=0;2>f;f++)for(g=0===f?V._xAlignmentGuide:V._yAlignmentGuide,x=0,T=g.length;T>x;x++)if(O=g[x],O.id===Q)return g.splice(x,1),V._interactor._42(),{axis:0===f?"x":"y",position:O.p};return!1},Cf.prototype.adjustAlignmentGuide=function(B,W){var l=this,m=l.removeAlignmentGuide(B);return m?(l.addAlignmentGuide(m.axis,W,B),!0):!1};var Bk=me.Guide.Rect=function(K){var S=this;S._interactor=K};Bk.prototype={},Bk.prototype.constructor=Bk,Bk.prototype.gatherRects=function(){var q,R,u,Z,_=this,n=_._interactor.gv,K=[],c=[],o={x:K,y:c},t={},v=n.getDataModel(),M=v.a("width"),a=v.a("height");M&&a&&(q=0,R=0,u=M,Z=a,K.push({node:v,type:0,p:q},{node:v,type:1,p:q+u/2},{node:v,type:2,p:q+u}),c.push({node:v,type:0,p:R},{node:v,type:1,p:R+Z/2},{node:v,type:2,p:R+Z}),t[v._id||0]={x:q,y:R,width:u,height:Z}),v.each(function(x){if(Dg(x)&&!n.isSelected(x)&&n.isVisible(x)&&n.isValidGuideLineSource(x)){var V=!1;if(n.sm().getSelection().each(function(J){V||(x.isHostOn(J)?V=!0:x.isDescendantOf(J)&&(V=!0))}),!V){var T=x.getRect();q=T.x,R=T.y,u=T.width,Z=T.height,K.push({node:x,type:0,p:q},{node:x,type:1,p:q+u/2},{node:x,type:2,p:q+u}),c.push({node:x,type:0,p:R},{node:x,type:1,p:R+Z/2},{node:x,type:2,p:R+Z}),t[x._id]=T}}}),K.sort(function(K,z){return K.p-z.p}),c.sort(function(x,S){return x.p-S.p}),_._grid=o,_._87I=t},Bk.prototype.gatherLines=function(y,k,l){var $,Y,O,L,e,I,N,J,E,v,o,T,a=this,D=[a.findClosest({x:y.x,y:y.y},k),a.findClosest({x:y.x+y.w/2,y:y.y+y.h/2},k),a.findClosest({x:y.x+y.w,y:y.y+y.h},k)],u={},f=a._87I;l=l||255;var j,M;for(a._guideLine=[],$=0;2>$;$++)for(u={},0===$?(L="y",J=y.x,E=J+y.w):(L="x",J=y.y,E=J+y.h),Y=0;3>Y;Y++)e=D[Y],e&&isFinite(e[L])&&(j=1<<3*$+Y,l&j&&(I=e[L+"Line"],N=I.node,M=N._id||0,u[M]||(u[M]=!0,T=f[M],"y"===L?(v=T.x,o=T.x+T.width):(v=T.y,o=T.y+T.height),O=I.p,a._guideLine.push({type:L,a:J,b:E,c:v,d:o,p:O,center:1===I.type}))))},Bk.prototype._binarySearchClosest=function(n,A){if(!A.length)return{dis:1/0};for(var w,q=0,I=A.length-1;I-q>1;)w=Math.floor((q+I)/2),A[w].p<n?q=w:I=w;var F=A[q].p-n,e=A[I].p-n;return Math.abs(F)<=Math.abs(e)?{line:A[q],dis:F}:{line:A[I],dis:e}},Bk.prototype.findClosest=function(f,B,V){var v=this,u=v._interactor,k=u.gv,A=v._grid;V&&(f=me.toWorldPosition(k,f));var E,T=v._binarySearchClosest(f.x,A.x),H=v._binarySearchClosest(f.y,A.y),y=T.dis,M=H.dis,Y=k._zoom,Z=u.getStyle("smartGuideThreshold")/Y,q={};return Math.abs(y)<Z&&"y"!==B&&(q.x=V?y*Y:y,q.xLine=T.line,E=!0),Math.abs(M)<Z&&"x"!==B&&(q.y=V?M*Y:M,q.yLine=H.line,E=!0),E?q:void 0},Bk.prototype._42=function(){var m=this,Y=m._guideLine;if(Y&&!B.Default.isCtrlDown()){var k=m._interactor;if(k.getStyle("guideLineVisible")){var X,$,z,w,C,o,J,O,b,g,H,u,P,n,M,L,l,N=k.gv,y=k._context,d=N.tx(),F=N.ty(),G=N._zoom,T=k.getStyle("guideLineTextSpacing");for(X=0,$=Y.length;$>X;X++)z=Y[X],O=z.type,b=z.p,g=z.a,H=z.b,u=z.c,P=z.d,n=Math.min(g,u),M=Math.max(H,P),"x"===O?(w=b*G+d,C=n*G+F,o=w,J=M*G+F):(w=n*G+d,C=b*G+F,o=M*G+d,J=C),me.Icons.DrawIcon(k,y,me.Icons.MoveLineGuide,{rect:[w,C,o,J],center:z.center}),P>=g&&H>=u||(n=g>P?P:H,M=g>P?g:u,l=M-n,"x"===O?(z.center2center||(w-=T,o=w),C=n*G+F,J=M*G+F,L=me.Icons.MoveLineGuideDistanceV):"y"===O&&(z.center2center||(C-=T,J=C),w=n*G+d,o=M*G+d,L=me.Icons.MoveLineGuideDistanceH),me.Icons.DrawIcon(k,y,L,{x0:w,y0:C,x1:o,y1:J,dis:l}))}}},Bk.prototype.clear=function(){this._guideLine=null};var zi=me.Guide.Hover=function(s){var t=this;t._interactor=s};zi.prototype={},zi.prototype.constructor=zi,T.defineProperties(zi.prototype,{}),zi.prototype._42=function(){var Q=this._interactor;if(Q.getStyle("hoverGuideVisible")&&!Q.gvEditing){var J=Q.hoverData,s=Q.gv;if(!Dg(J)||s.isSelected(J))return Q.hoverData=null,void 0;var l=Qj(s,J),R=me.toScreenPosition(s,{x:l.x,y:l.y}),I=me.toScreenPosition(s,{x:l.x+l.width,y:l.y+l.height});me.Icons.DrawIcon(Q,Q._context,me.Icons.HoverDataRect,{min:R,max:I,color:Q.getStyle("hoverGuideColor")||Q.getStyle("baseColor"),borderWidth:Q.getStyle("hoverGuideBorderWidth")||1,borderPattern:Q.getStyle("hoverGuideBorderPattern")||[1,4]})}},me.DefaultStyleMap={baseColor:"rgb(51,153,255)",pointSize:[24,9],checkSize:7,rotateCheckSize:10,moveSensitivity:10,moveDummyThreshold:32,moveDummyPosition:[0,0,-16,-16],moveDummyLineExtraShift:[-32,0],moveDummySensitivity:16,keepAspectRatio:!1,rotateRound:Math.PI/2,shiftRotateRound:Math.PI/12,rotateSensitivity:Math.PI/60,rotateAsClock:!1,rotateTipVisible:!0,shiftLineRotateRound:Math.PI/4,anchorMovable:!0,anchorVisible:!0,anchorHideThreshold:25,anchorOutsideVisibleThreshold:.25,anchorRound:.25,anchorSensitivity:.02,smartGuideThreshold:8,curveIntersectSize:5,curvePointIntersectSize:8,edgeHostDetectPerFrame:!0,edgeHostEdgeMaxDistance:12,edgeHostEdgeHighlighColor:"#5d5d5d",edgeHostPointHighlighColor:"red",edgeHostHighlighPeriod:1500,edgeElevationEditable:!1,attachThreshold:25,guideLineVisible:!0,guideLineTextSpacing:0,hoverGuideVisible:!1,hoverGuideColor:null,gridBlockSize:40,gridThickLinesEvery:10,gridThickColor:"#5d5d5d",gridLightColor:"#d0d0d0",gridZoomThreshold:.25,gridAlignmentGuideColor:"#ff0000",gridAngle:Math.PI/2,gridRotation:0,groupRotateModeDefault:"block",groupRotateModeKey:["ctrlKey","metaKey"],rotateCursorSize:32,rotateCursorRound:45,tipTextColor:"#ffffff",tipBackground:"#333333",curveHighlightColor:"#30599e",rectPointBackground:"white",rectPointBorderColor:"#666666",rectPointShadowColor:"rgba(0,0,0,0.35)",shapeCtrlPointBackground:"white",shapeCtrlPointBorderColor:null,shapeCtrlPointHighlightBorder:null,shapeHighlighPointBackground:"#30599e",curveElevationVisible:!0,curveElevationIntersectSize:8,curveElevationGuideShift:[20,0],curveTipVisible:!0,connectGuideVisible:!0,connectGuideShift:[1,.25,8,0],connectGuideIntersectSize:8,connectGuideGarbageIntersectsize:25,connectGuideGarbageShift:[1,1,-48,-48]};var ns=me.Icons={},Md=1e4,ko=null,Yf=me.DefaultStyleMap.baseColor,Ug="rgb(183,232,135)",Nl="rgb(255,204,153)",Am=6;B.Default.setImage("Icons.RectPoint",{width:Am,height:Am,comps:[{type:"rect",background:"rgb(247,247,247)",borderWidth:1,borderColor:{func:function(){return Yf}},rect:[0,0,Am,Am]}]}),ns.GroupSubEntityRect={comps:[{type:"shape",points:{func:function(){var h=ns.GroupSubEntityRect.data;if(!h)return[];var E=h.min,K=h.max;return[E.x,E.y,E.x,K.y,K.x,K.y,K.x,E.y]}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:{func:function(){return ns.GroupSubEntityRect.data.isKeyOb?Yf:Yf}}}]};var gh=4;ns.HoverDataRect={comps:[{type:"shape",points:{func:function(){var W=ns.HoverDataRect.data;if(!W)return[];var y=W.min,u=W.max,d=gh;return y.x-=d,y.y-=d,u.x+=d,u.y+=d,[y.x,y.y,y.x,u.y,u.x,u.y,u.x,y.y]}},segments:[1,2,2,2,5],background:null,borderWidth:{func:function(){return ns.HoverDataRect.data.borderWidth}},borderColor:{func:function(){return ns.HoverDataRect.data.color}},borderCap:"butt",borderPattern:{func:function(){return ns.HoverDataRect.data.borderPattern}}}]},ns.Line={comps:[{type:"image",name:"Icons.RectPoint",rect:{func:function(){return[[ns.Line.data.P1.x,ns.Line.data.P1.y],Am,Am]}}},{type:"image",name:"Icons.RectPoint",rect:{func:function(){return[[ns.Line.data.P2.x,ns.Line.data.P2.y],Am,Am]}}}]},ns.NodeHoverGuide={comps:[{type:"shape",points:{func:function(){return ns.NodeHoverGuide.data}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:"#3399FF"}]},ns.Rect={comps:[{type:"shape",points:{func:function(){var _=ns.Rect.data;if(!_)return[];var h=_.LT,B=_.LB,r=_.RB,x=_.RT;return[h.x,h.y,B.x,B.y,r.x,r.y,x.x,x.y]}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:{func:function(){return Yf}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return ns.Rect.data.rotation}},rect:{func:function(){return[[ns.Rect.data.LT.x,ns.Rect.data.LT.y],Am,Am]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return ns.Rect.data.rotation}},rect:{func:function(){return[[ns.Rect.data.LB.x,ns.Rect.data.LB.y],Am,Am]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return ns.Rect.data.rotation}},rect:{func:function(){return[[ns.Rect.data.RB.x,ns.Rect.data.RB.y],Am,Am]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return ns.Rect.data.rotation}},rect:{func:function(){return[[ns.Rect.data.RT.x,ns.Rect.data.RT.y],Am,Am]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return ns.Rect.data.rotation}},visible:{func:function(){return ns.Rect.data.L?!0:!1}},rect:{func:function(){return[[ns.Rect.data.L.x,ns.Rect.data.L.y],Am,Am]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return ns.Rect.data.rotation}},visible:{func:function(){return ns.Rect.data.R?!0:!1}},rect:{func:function(){return[[ns.Rect.data.R.x,ns.Rect.data.R.y],Am,Am]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return ns.Rect.data.rotation}},visible:{func:function(){return ns.Rect.data.T?!0:!1}},rect:{func:function(){return[[ns.Rect.data.T.x,ns.Rect.data.T.y],Am,Am]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return ns.Rect.data.rotation}},visible:{func:function(){return ns.Rect.data.B?!0:!1}},rect:{func:function(){return[[ns.Rect.data.B.x,ns.Rect.data.B.y],Am,Am]}}}]};var Xq=16;B.Default.setImage("Icons.Anchor",{width:12,height:12,comps:[{type:"shape",borderWidth:1,borderColor:{func:function(){return Yf}},borderCap:"round",shadowColor:"#1ABC9C",points:[.50928,6,11.49072,6,6,6,6,.50928,6,11.49072]},{type:"circle",borderWidth:1,borderColor:{func:function(){return Yf}},shadowColor:"#1ABC9C",rect:[2.84391,2.84391,6.53697,6.53697]}]}),ns.Anchor={comps:[{type:"image",name:"Icons.Anchor",rect:{func:function(){return[[ns.Anchor.data.POS.x,ns.Anchor.data.POS.y],Xq,Xq]}}}]},ns.TipShiftX=12,ns.TipShiftY=12;var xp=[8,28];ns.TipHelper={comps:[{type:"roundRect",rect:{func:function(){return[ns.TipHelper.data.helperPos.x,ns.TipHelper.data.helperPos.y,xp[0]*ns.TipHelper.data.size,xp[1]]}},background:{func:function(){return ko.getStyle("tipBackground")}},opacity:.6},{type:"text",text:{func:function(){return ns.TipHelper.data.text}},rect:{func:function(){return[ns.TipHelper.data.helperPos.x,ns.TipHelper.data.helperPos.y,xp[0]*ns.TipHelper.data.size,xp[1]]}},color:{func:function(){return ko.getStyle("tipTextColor")}},font:"bold 12px Arial",align:"center"}]};var bn=7;ns.ShapePoint={comps:[{type:"circle",visible:{func:function(){return!!ns.ShapePoint.data.dynamicVisible}},rect:{func:function(){var F=ns.ShapePoint.data.point,H=ns.ShapePoint.data.size||bn;return[F,H+10,H+10]}},background:{func:function(){var B=Date.now(),E=ns.ShapePoint.data.dynamicPeriod||1500,L=Math.sin(B%E/E*Math.PI);return"rgba(27,124,22,"+.5*L+")"}},borderWidth:0},{type:"circle",rect:{func:function(){var J=ns.ShapePoint.data.point,s=ns.ShapePoint.data.size||bn;return[J,s,s]}},background:{func:function(){var K=ns.ShapePoint.data.isEnd;return K?"rgba(27,124,222,0.7)":"#ffffff"}},borderWidth:1,borderColor:{func:function(){return ns.ShapePoint.data.color||Yf}}},{type:"rect",visible:{func:function(){return!!ns.ShapePoint.data.dynamicVisible}},background:"red",borderWidth:0,rotation:Math.PI/4,borderColor:{func:function(){return Yf}},rect:{func:function(){var a=5;return[ns.ShapePoint.data.point,a,a]}}}]},ns.ShapeBgCurve={comps:[{type:"shape",visible:{func:function(){return!!ns.ShapeBgCurve.data.dynamicVisible}},points:{func:function(){return ns.ShapeBgCurve.data.P}},segments:{func:function(){return ns.ShapeBgCurve.data.S}},background:null,borderWidth:6,borderColor:{func:function(){var j=Date.now(),G=ns.ShapeBgCurve.data.dynamicPeriod||1500,D=Math.sin(j%G/G*Math.PI);return"rgba(27,124,22,"+.3*D+")"}}},{type:"shape",points:{func:function(){return ns.ShapeBgCurve.data.P}},segments:{func:function(){return ns.ShapeBgCurve.data.S}},background:null,borderWidth:1,borderColor:{func:function(){return ns.ShapeBgCurve.data.color||Yf}}}]};var jh=8;ns.ShapeHighlighPoint={comps:[{type:"circle",rect:{func:function(){var Z=ns.ShapeHighlighPoint.data;return[[Z.x,Z.y],jh,jh]}},background:{func:function(){return ko.getStyle("shapeHighlighPointBackground")}},borderWidth:0}]};var $n=10;ns.ShapeHighlighRealPoint={comps:[{type:"circle",rect:{func:function(){var q=ns.ShapeHighlighRealPoint.data;return[[q.x,q.y],$n,$n]}},background:"#ffffff",borderWidth:2,borderColor:{func:function(){return Yf}}}]};var Dh=8;ns.ShapeHighlighCtrlPoint={comps:[{type:"shape",points:{func:function(){var c=ns.ShapeHighlighCtrlPoint.data,j=c.x,t=c.y,L=Dh/2;return[j-L,t-L,j-L,t+L,j+L,t+L,j+L,t-L]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return ko.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return ko.getStyle("shapeCtrlPointBorderColor")||Yf}}}]};var Zo=3;ns.ShapeHighlightCurve={comps:[{type:"shape",points:{func:function(){return ns.ShapeHighlightCurve.data}},segments:[1,4],background:null,borderWidth:Zo,borderColor:{func:function(){return ko.getStyle("curveHighlightColor")}}}]},ns.ShapeGuideLine={comps:[{type:"shape",points:{func:function(){return ns.ShapeGuideLine.data}},background:null,borderWidth:1,borderColor:"rgb(255,204,153)"}]},ns.MoveLineGuide={comps:[{type:"shape",points:{func:function(){return ns.MoveLineGuide.data.rect}},background:null,borderWidth:1,borderColor:{func:function(){return ns.MoveLineGuide.data.center?Ug:Nl}}}]};var Zf=5;ns.MoveLineGuideDistanceH={comps:[{type:"shape",points:{func:function(){var H=ns.MoveLineGuideDistanceH.data,x=H.x0,S=H.y0;return[x,S-Zf,x,S+Zf]}},rotation:-Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:Nl},{type:"shape",points:{func:function(){var $=ns.MoveLineGuideDistanceH.data,U=$.x1,o=$.y1;return[U,o-Zf,U,o+Zf]}},rotation:-Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:Nl},{type:"text",text:{func:function(){return Math.round(ns.MoveLineGuideDistanceH.data.dis)}},rect:{func:function(){var C=ns.MoveLineGuideDistanceH.data;return[[(C.x0+C.x1)/2,C.y0-10],20,20]}},color:Nl,font:"12px Arial",align:"center"}]},ns.MoveLineGuideDistanceV={comps:[{type:"shape",points:{func:function(){var h=ns.MoveLineGuideDistanceV.data,j=h.x0,y=h.y0;return[j-Zf,y,j+Zf,y]}},rotation:Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:Nl},{type:"shape",points:{func:function(){var Y=ns.MoveLineGuideDistanceV.data,X=Y.x1,o=Y.y1;return[X-Zf,o,X+Zf,o]}},rotation:Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:Nl},{type:"text",text:{func:function(){return Math.round(ns.MoveLineGuideDistanceV.data.dis)}},rect:{func:function(){var M=ns.MoveLineGuideDistanceV.data;return[[M.x0-10,(M.y0+M.y1)/2],20,20]}},color:Nl,font:"12px Arial",align:"center"}]},B.Default.setImage("Icons.EdgeElevationGuideImage",{width:16,height:16,comps:[{type:"oval",background:"rgb(255,255,255)",borderWidth:1,borderColor:"rgb(138,138,138)",rect:[.5,.5,15,15]},{type:"shape",borderWidth:2,borderColor:"rgb(44,44,44)",borderCap:"round",points:[4,8,8,4,12,8,8,4,8,13],segments:[1,2,2,1,2]}]}),ns.EdgeElevationGuide={comps:[{type:"image",name:"Icons.EdgeElevationGuideImage",rect:{func:function(){var R=ns.EdgeElevationGuide.data,r=R.x,x=R.y,g=ko.getStyle("curveElevationIntersectSize"),C=ko.getStyle("curveElevationGuideShift");return r+=C[0],x+=C[1],[r-g,x-g,2*g,2*g]}}}]},B.Default.setImage("Icons.ConnectGuideBgImage",{width:12,height:12,comps:[{type:"shape",background:"#3399ff",fillRule:"evenodd",shadowColor:"#1ABC9C",rotation:3.14159,points:[6.00001,11.99999,6.00001,11.99999,2.6863,11.99999,1e-5,9.30695,1e-5,5.99999,1e-5,5.99999,1e-5,2.68628,2.69305,-1e-5,6.00001,-1e-5,12.00001,-1e-5,11.99998,12.00001,6.00001,11.99999],segments:[1,2,4,2,4,2,2,2]}]}),B.Default.setImage("Icons.ConnectGuideHeaderImage",{width:12,height:12,comps:[{type:"oval",background:"#3399FF",borderColor:"#3399FF",shadowColor:"#1ABC9C",rect:[0,0,12,12]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[4.76,2.56,8.2,5.98,4.76,9.44]}]}),ns.ConnectGuide={comps:[{type:"image",name:"Icons.ConnectGuideBgImage",rotation:{func:function(){return ns.ConnectGuide.data.rotation}},rect:{func:function(){var U=ns.ConnectGuide.data.connect;U.x,U.y;var a=ko.getStyle("connectGuideIntersectSize");return[[U.x,U.y],2*a,2*a]}}},{type:"image",name:"Icons.ConnectGuideHeaderImage",rect:{func:function(){var X=ns.ConnectGuide.data.cursorPos||ns.ConnectGuide.data.connect,m=ko.getStyle("connectGuideIntersectSize");return[[X.x,X.y],2*m-2,2*m-2]}}},{type:"shape",background:null,borderColor:"#3399ff",borderWidth:2,segments:[1,4],points:{func:function(){var W=ns.ConnectGuide.data.connect,$=ns.ConnectGuide.data.cursorPos||W;return[W.x,W.y,W.x+.5*($.x-W.x),W.y,$.x+.5*(W.x-$.x),$.y,$.x,$.y]}}}]},B.Default.setImage("Icons.ConnectGuideGarbageImage",{width:48,height:48,comps:[{type:"oval",background:"rgba(0,0,0,0.1)",borderColor:"#979797",shadowColor:"#1ABC9C",rect:[0,0,48,48]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[19.84721,19.69091,19.84721,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[24.10371,19.69091,24.10371,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[28.15279,19.69091,28.15279,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[11.23055,15.22377,36.76945,15.189,19.12302,15.17121,20.94722,11.5228,26.41985,11.5228,28.24406,15.17121]},{type:"rect",borderWidth:2,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[15.48702,15.22377,17.02595,21.25344]}]}),B.Default.setImage("Icons.ConnectGuideDeletingImage",{width:56,height:56,comps:[{type:"oval",background:"rgba(232,0,0,0.75)",borderColor:"#979797",shadowColor:"#1ABC9C",rect:[0,0,56,56]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[22.67939,27.69091,22.67939,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[26.93588,27.69091,26.93588,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[30.98497,27.69091,30.98497,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",anchorX:0,anchorY:1,rotation:5.65062,points:[14.06272,23.22377,39.60163,23.189,21.9552,23.17121,23.7794,19.5228,29.25203,19.5228,31.07623,23.17121]},{type:"rect",borderWidth:2,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[18.3192,23.22377,17.02595,21.25344]}]}),ns.ConnectGuideGarbage={comps:[{type:"image",name:{func:function(){var k=ns.ConnectGuideGarbage.data.hover;
return k?"Icons.ConnectGuideDeletingImage":"Icons.ConnectGuideGarbageImage"}},rect:{func:function(){var P=ns.ConnectGuideGarbage.data,j=ko.getStyle("connectGuideGarbageIntersectsize");return P.hover&&(j+=5),[[P.x,P.y],2*j,2*j]}}}]};var Tg=6;ns.ShapeActivingCtrl={comps:[{type:"shape",visible:{func:function(){return ns.ShapeActivingCtrl.data.c1?!0:!1}},points:{func:function(){var X=ns.ShapeActivingCtrl.data;return[X.point.x,X.point.y,X.c1.x,X.c1.y]}},segments:[1,2],background:null,borderWidth:1,borderColor:{func:function(){return Yf}}},{type:"shape",visible:{func:function(){return ns.ShapeActivingCtrl.data.c2?!0:!1}},points:{func:function(){var H=ns.ShapeActivingCtrl.data;return[H.point.x,H.point.y,H.c2.x,H.c2.y]}},segments:[1,2],background:null,borderWidth:1,borderColor:{func:function(){return Yf}}},{type:"shape",visible:{func:function(){return ns.ShapeActivingCtrl.data.c1?!0:!1}},points:{func:function(){var T=ns.ShapeActivingCtrl.data.c1,v=T.x,t=T.y,Q=Tg/2;return"c1"===ns.ShapeActivingCtrl.data.hl&&(Q+=.5),[v-Q,t-Q,v-Q,t+Q,v+Q,t+Q,v+Q,t-Q]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return ko.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return"c1"===ns.ShapeActivingCtrl.data.hl?ko.getStyle("shapeCtrlPointHighlightBorder")||Yf:ko.getStyle("shapeCtrlPointBorderColor")||Yf}}},{type:"shape",visible:{func:function(){return ns.ShapeActivingCtrl.data.c2?!0:!1}},points:{func:function(){var U=ns.ShapeActivingCtrl.data.c2,D=U.x,t=U.y,o=Tg/2;return"c2"===ns.ShapeActivingCtrl.data.hl&&(o+=.5),[D-o,t-o,D-o,t+o,D+o,t+o,D+o,t-o]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return ko.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return"c2"===ns.ShapeActivingCtrl.data.hl?ko.getStyle("shapeCtrlPointHighlightBorder")||Yf:ko.getStyle("shapeCtrlPointBorderColor")||Yf}}}]},ns.RoundPoint={comps:[{type:"circle",background:"rgb(247,247,247)",borderWidth:1,borderColor:{func:function(){return Yf}},rect:{func:function(){return[[ns.RoundPoint.data.x,ns.RoundPoint.data.y],Am,Am]}}}]},ns.AttachPoint={comps:[{type:"rect",background:{func:function(){return ns.AttachPoint.data.isAttach?"rgb(51,153,255)":"rgb(247,247,247)"}},borderWidth:1,rotation:Math.PI/4,borderColor:{func:function(){return Yf}},rect:{func:function(){var K=ns.AttachPoint.data.isAttach?Am+4:Am;return[[ns.AttachPoint.data.x,ns.AttachPoint.data.y],K,K]}}}]},ns.SimpleRect={comps:[{type:"rect",background:null,borderWidth:{func:function(){return ns.SimpleRect.data.borderWidth||1}},borderColor:{func:function(){return ns.SimpleRect.data.color||Yf}},rect:{func:function(){var C=ns.SimpleRect.data;return[C.x,C.y,C.width,C.height]}}}]},B.Default.setImage("Icons.MoveDummyImage",{width:32,height:32,boundExtend:12,attachStyle:"close",comps:[{type:"oval",background:"rgb(255,255,255)",borderColor:"#979797",shadow:!0,shadowColor:"rgba(0,0,0,0.25)",shadowOffsetX:0,rect:[0,0,32,32]},{type:"shape",background:"rgb(51,153,255)",pixelPerfect:!0,points:[8.65079,11.90713,9.05502,11.46921,9.70629,11.46921,10.11052,11.90713,10.51476,12.28891,10.51476,12.92895,10.11052,13.34441,8.49359,14.97258,12.2889,14.97258,12.85034,14.97258,13.29949,15.42172,13.29949,15.99439,13.29949,16.57828,12.85034,17.0162,12.2889,17.0162,8.49359,17.0162,10.11052,18.6556,10.51476,19.0486,10.51476,19.7111,10.11052,20.09288,9.70629,20.50834,9.05502,20.50834,8.65079,20.09288,5.32709,16.76917,5.28217,16.71303,4.87794,16.32002,4.87794,15.67998,5.28217,15.26452,8.65079,11.90713,8.65079,11.90713,8.65079,11.90713,13.3444,10.09931,13.3444,10.09931,12.94017,10.50354,12.2889,10.50354,11.88467,10.09931,11.48043,9.69507,11.48043,9.0438,11.88467,8.63957,15.27574,5.25973,15.66874,4.86672,16.32001,4.86672,16.73547,5.25973,16.76917,5.31586,20.10409,8.63957,20.50832,9.0438,20.50832,9.68385,20.10409,10.09931,19.69986,10.49231,19.07105,10.50354,18.64436,10.09931,17.02742,8.45991,17.02742,12.26646,17.02742,12.83912,16.55581,13.31072,15.99438,13.31072,15.43295,13.31072,14.98379,12.83912,14.98379,12.26646,14.96134,8.45991,13.3444,10.09931,13.3444,10.09931,13.3444,10.09931,21.90069,13.33318,21.90069,13.33318,21.49646,12.91771,21.49646,12.27768,21.90069,11.89591,22.31615,11.45798,22.94497,11.45798,23.36043,11.89591,26.72904,15.2533,27.12205,15.66876,27.12205,16.3088,26.72904,16.7018,26.6729,16.75794,23.36043,20.08165,22.94497,20.49711,22.31615,20.49711,21.90069,20.08165,21.49646,19.69987,21.49646,19.03737,21.90069,18.64437,23.51763,17.00498,19.72231,17.00498,19.14965,17.00498,18.71173,16.56705,18.71173,15.98316,18.71173,15.41049,19.14965,14.96135,19.72231,14.96135,23.51763,14.96135,21.90069,13.33318,21.90069,13.33318,21.90069,13.33318,11.88467,23.32675,11.88467,23.32675,11.48043,22.94498,11.48043,22.27125,11.88467,21.88948,12.2889,21.48523,12.94017,21.48523,13.3444,21.88948,14.96134,23.52887,14.98379,19.7111,14.98379,19.14966,15.43295,18.67805,15.99438,18.67805,16.55581,18.67805,17.02742,19.14966,17.02742,19.7111,17.02742,23.52887,18.64436,21.88948,19.07105,21.48523,19.69986,21.48523,20.10409,21.88948,20.50832,22.27125,20.50832,22.94498,20.10409,23.32675,16.76917,26.65045,16.73547,26.72905,16.32001,27.13329,15.66874,27.13329,15.27574,26.72905,11.88467,23.32675,11.88467,23.32675,11.88467,23.32675],segments:[1,4,4,2,2,4,4,2,2,4,4,2,2,4,2,2,2,1,2,4,4,2,4,2,2,4,4,2,2,4,4,2,2,2,2,1,2,4,4,2,4,2,2,4,4,2,2,4,4,2,2,2,2,1,2,4,4,2,2,4,4,2,2,4,4,2,2,4,2,2,2]}]}),ns.MoveDummy={comps:[{type:"image",name:"Icons.MoveDummyImage",rect:{func:function(){var C=ns.MoveDummy.data;return[[C.pos.x,C.pos.y],2*C.size,2*C.size]}}}]},me.Icons.DrawIcon=function(b,q,Z,f){Z.width=Z.height=Md,Z.data=f,ko=b,B.Default.drawImage(q,Z,0,0,Md,Md),ko=z},me.Icons.MapPoints=function(m,$){for(var A=0,Y=m.length;Y>A;A++)m[A]/=$},me.roundTo=function(v,n,y){var C=Math.abs(v%n);return y>C||y>n-C?n*Math.round(v/n):v},me.toFixed=function(Z){return Math.round(100*Z)/100},me.getDataMatrix=function(p){if(p instanceof B.Shape){var C=new B.Math.Matrix2d,I=p.getPosition();return C.translate(-I.x,-I.y).scale(p.getScale().x,p.getScale().y).rotate(p.getRotation()).translate(I.x,I.y),C}return p.getMatrix?p.getMatrix():new B.Math.Matrix2d};var Tk=me.Math.Curve=function(){this._curves=[]};Tk.prototype={},Tk.prototype.constructor=Tk,Tk.prototype.createFromHtShape=function(a,l,K){l instanceof B.List&&(l=l.toArray());var Q,j,g,h,u,R,m,W=this,L=null,V=null,Z=0,w=me.Math.Vector2,f=me.Math.CubicBezier,p=function(N){return new w(a[N],a[N+1],K?K[N/2]:z)};for(j=0,g=l.length;g>j;j++){switch(h=l[j],u=null,h){case 1:V=p(Z),L=V,Z+=2;break;case 2:Q=p(Z),Z+=2,u=new f(V,V.clone(),Q.clone(),Q),V=Q;break;case 3:R=p(Z),Q=p(Z+2),Z+=4,u=new f(V,R.clone().sub(V).multiplyScalar(2/3).add(V),R.clone().sub(Q).multiplyScalar(2/3).add(Q),Q),V=Q;break;case 4:R=p(Z),m=p(Z+2),Q=p(Z+4),Z+=6,u=new f(V,R,m,Q),V=Q;break;case 5:if(!L)break;u=new f(V,V.clone(),L.clone(),L),V=null,L=null}u&&(u._index=W._curves.length,W._curves.push(u))}},Tk.prototype.checkPoint=function(a,f){var L,j,I,K,b,p=this,W=p._curves;for(L=0,j=W.length;j>L;L++)if(K=W[L],b=K.intersectRect(a,f,f),b.length)return I=0,b.forEach(function(f){I+=f.t}),I/=b.length,a=K.getPointAt(I),a.t=I,{bezier:K,intersection:a}},Tk.prototype.insertKnot=function(N,Z){var I=N.insertKnot(Z),J=this,v=J._curves;v.splice(N._index,1,I[0],I[1])},Tk.prototype._isCloseEnough=function(P,O){return Math.abs(P.x-O.x)<1e-6&&Math.abs(P.y-O.y)<1e-6},Tk.prototype._isSamePoint=function(F,O){return F===O},Tk.prototype.moveRealPoint=function(m,w){var c=this,y=c._curves,l=w.clone().sub(m);y.forEach(function(A){var $=A._p1;A._p2,A._p3;var y=A._p4;c._isSamePoint($,m)&&(A._p2.add(l),A._p1=w),c._isSamePoint(y,m)&&(A._p3.add(l),A._p4=w)})},Tk.prototype.moveCtrlDueToRealPointMovement=function(d,L){var t=this,r=t._curves,x=function(H){H.add(L),H.e&&L.e&&(H.e+=L.e)};r.forEach(function(X){var s=X._p1;X._p2,X._p3;var n=X._p4;t._isSamePoint(s,d)&&x(X._p2),t._isSamePoint(n,d)&&x(X._p3)})},Tk.prototype.moveCtrlPoint=function(L,g,x){var p=L[x];if(p){p.e!==z&&(g.e=p.e);var F=this,h=F._curves;g.clone().sub(p),h.forEach(function(T){var Y;"c2"===x?Y="_p2":"c1"===x&&(Y="_p3"),F._isSamePoint(T[Y],p)&&(T[Y]=g)}),L[x]=g}},Tk.prototype.deleteRealPoint=function(K,V){var _,Q,a,M,P,q,R,z=this,m=z._curves,w={},k=[],e=me.Math.CubicBezier;for(Q=0,a=m.length;a>Q;Q++)_=m[Q],M=_._p1,P=_._p2,q=_._p3,R=_._p4,(w[Q]||!z._isSamePoint(M,K))&&(z._isSamePoint(R,K)?a>Q+1&&z._isSamePoint(m[Q+1]._p1,K)&&(V||k.push(new e(M,P,m[Q+1]._p3,m[Q+1]._p4))):k.push(_));z._curves=k},Tk.prototype.findPairs=function(Y,I){var y,A,s,F,g,w,G,Q,l=this,U=l._curves,p={},E=[];for(A=0,s=U.length;s>A;A++)y=U[A],F=y._p1,g=y._p2,w=y._p3,G=y._p4,!p[A]&&l._isSamePoint(F,Y)&&(I?E.push({point:F,r2:G}):E.push({point:F,c2:g})),l._isSamePoint(G,Y)&&(Q=I?{point:G,r1:F}:{point:G,c1:w},s>A+1&&l._isSamePoint(U[A+1]._p1,Y)&&(I?Q.r2=U[A+1]._p4:Q.c2=U[A+1]._p2,p[A+1]=!0),E.push(Q));return E},Tk.prototype.toHtShape=function(){var f=this,e=f._curves,z=[],S=[],B={x:1/0,y:1/0};return e.forEach(function(g){var $=g._p1,Y=g._p2,n=g._p3,C=g._p4;return f._isCloseEnough($,B)||(z.push(1),S.push($.clone())),B=C,f._isCloseEnough($,Y)&&f._isCloseEnough(n,C)?(z.push(2),S.push(C.clone()),void 0):(z.push(4),S.push(Y.clone(),n.clone(),C.clone()),void 0)}),{segments:z,points:S}};var Sb=me.Math.CubicBezier=function(E,U,e,T){var Z=this;Z._id=me.Math.CubicBezier._globalId++,Z._p1=E,Z._p2=U,Z._p3=e,Z._p4=T};Sb._globalId=1,Sb.prototype={},Sb.prototype.constructor=Sb,Sb.prototype.toString=function(){return this._id},Sb.prototype.intersectRect=function(b,w,V){var K=w/2,s=V/2,a=b.x,l=b.y,L=me.Math.Vector2,g=new L(-K+a,-s+l),T=new L(K+a,s+l),r=new L(T.x,g.y),u=new L(g.x,T.y),p=this,Y=p.intersectLine(g,r),z=p.intersectLine(r,T),J=p.intersectLine(T,u),f=p.intersectLine(u,g),G=Y.concat(z).concat(J).concat(f);return G},Sb.prototype.intersectLine=function(I,j){var y,Z,H,A,N,f,E,k,v,i,e,X,p,r=this,x=I.clone().min(j),B=I.clone().max(j);A=r._p1,N=r._p2,f=r._p3,E=r._p4,y=A.clone().multiplyScalar(-1),Z=N.clone().multiplyScalar(3),H=f.clone().multiplyScalar(-3),e=y.add(Z).add(H).add(E),y=A.clone().multiplyScalar(3),Z=N.clone().multiplyScalar(-6),H=f.clone().multiplyScalar(3),i=y.add(Z).add(H),y=A.clone().multiplyScalar(-3),Z=N.clone().multiplyScalar(3),v=y.add(Z),k=A.clone(),p=new me.Math.Vector2(I.y-j.y,j.x-I.x),X=I.x*j.y-j.x*I.y;for(var D=r.getRoots(p.dot(e),p.dot(i),p.dot(v),p.dot(k)+X),Q=new Array,R=0,b=D.length;b>R;R++){var z=D[R];if(!(0>z||z>1)){var V=r.getPointAt(z);V.t=z,I.x==j.x?x.y<=V.y&&V.y<=B.y&&Q.push(V):I.y==j.y?x.x<=V.x&&V.x<=B.x&&Q.push(V):V.x>=x.x&&V.y>=x.y&&V.x<=B.x&&V.y<=B.y&&Q.push(V)}}return Q},Sb.prototype.solveTForPoint=function(N){var J,Z,S,d,x=this;J=x._p1.x-N.x,Z=x._p2.x-N.x,S=x._p3.x-N.x,d=x._p4.x-N.x;for(var l=x.getRoots(d-3*S+3*Z-J,3*S-6*Z+3*J,3*Z-3*J,J),Y=z,h=1/0,o=0,D=l.length;D>o;o++){var s=l[o];if(!(0>s||s>1)){var K=x.getPointAt(s);K.t=s;var n=Math.abs(K.y-N.y);h>n&&(h=n,Y=K)}}return Y},Sb.prototype.getPointAt=function(T){var G=this,l=G._p1,n=G._p2,f=G._p3,M=G._p4,_=l.clone().lerp(n,T),$=n.clone().lerp(f,T),c=f.clone().lerp(M,T),P=_.lerp($,T),N=$.lerp(c,T);return P.lerp(N,T)},Sb.prototype.getPointByPercentage=function(t){var v=this.length*t,s=this._cacheLength,J=s.length;if(0===v)return s[0].point;if(t>=1)return s[J-1].point;for(var x=0;J>x;x++){var i=s[x];if(!(i.len<v)){var B=s[x-1];return i.point.clone().sub(B.point).setLength(v-B.len).add(B.point)}}},Sb.prototype.getTByPercentage=function(b){var c=this.length*b,Z=this._cacheLength,K=Z.length;if(0===c||0>=b)return Z[0].t;if(b>=1)return Z[K-1].t;for(var G=0;K>G;G++){var P=Z[G];if(!(P.len<c)){var i=Z[G-1];return(c-i.len)/(P.len-i.len)*(P.t-i.t)+i.t}}},Sb.prototype.getRoots=function(R,A,r,S){var N,o,M,m,e,z=new Array;if(Math.abs(R)<1e-6){var N=A,o=r/N,M=S/N,m=o*o-4*M;if(m>0){var e=Math.sqrt(m);z.push(.5*(-o+e)),z.push(.5*(-o-e))}else 0==m&&z.push(.5*-o)}A/=R,r/=R,S/=R,N=(3*r-A*A)/3,o=(2*A*A*A-9*r*A+27*S)/27;var E=A/3,O=o*o/4+N*N*N/27,b=o/2;if(Math.abs(O)<=1e-6&&(O=0),O>0){var K,Q,e=Math.sqrt(O);K=-b+e,Q=K>=0?Math.pow(K,1/3):-Math.pow(-K,1/3),K=-b-e,K>=0?Q+=Math.pow(K,1/3):Q-=Math.pow(-K,1/3),z.push(Q-E)}else if(0>O){var J=Math.sqrt(-N/3),_=Math.atan2(Math.sqrt(-O),-b)/3,Z=Math.cos(_),F=Math.sin(_),C=Math.sqrt(3);z.push(2*J*Z-E),z.push(-J*(Z+C*F)-E),z.push(-J*(Z-C*F)-E)}else{var K;K=b>=0?-Math.pow(b,1/3):Math.pow(-b,1/3),z.push(2*K-E),z.push(-K-E)}return z},Sb.prototype._70I=function(){var l=this;return l._p1.distanceToSquared(l._p2)<1e-10&&l._p3.distanceToSquared(l._p4)<1e-10},Sb.prototype.insertKnot=function(_){var U=this,v=U._p1,J=U._p2,l=U._p3,b=U._p4,f=v.clone().lerp(J,_),O=J.clone().lerp(l,_),Z=l.clone().lerp(b,_),w=f.clone().lerp(O,_),C=O.clone().lerp(Z,_),F=w.clone().lerp(C,_);return U._70I()?(v.clone().lerp(b,_),[new me.Math.CubicBezier(v,v.clone(),F.clone(),F),new me.Math.CubicBezier(F,F.clone(),b.clone(),b)]):[new me.Math.CubicBezier(v,f,w,F),new me.Math.CubicBezier(F,C,Z,b)]},T.defineProperties(Sb.prototype,{length:{get:function(){var G=this._cacheLength;if(!G){G=this._cacheLength=[];for(var S=this._p1,F=0,v=0;1>=F;){var U=this.getPointAt(F+=.001);v+=U.clone().sub(S).length(),S=U,G.push({len:v,t:F,point:U.clone()})}}return G[G.length-1].len}},p1:{get:function(){return this._p1},set:function(O){this._p1=O,this._cacheLength=z}},p2:{get:function(){return this._p2},set:function(e){this._p2=e,this._cacheLength=z}},p3:{get:function(){return this._p3},set:function(N){this._p3=N,this._cacheLength=z}},p4:{get:function(){return this._p4},set:function(l){this._p4=l,this._cacheLength=z}}});var Xd=B.Default.getInternal().ui().EdgeUI,Bq={_47O:function(e){var R=this,$=Bq.getBackups()._47O;me.inEdit(R.gv)||$.call(R,e)}};me.Inject.registAsModule(Bq,Xd);var Kg=B.Default.getInternal().ui().NodeUI,Jn={_47O:function($){var C=this,f=Jn.getBackups()._47O;me.inEdit(C.gv)||f.call(C,$)},getSelectWidth:function(){var r=this,L=r.gv,o=r._data;if(L.isEditable(o)&&me.inEdit(L))return 0;var j=Jn.getBackup("getSelectWidth");return j.call(r)}};me.Inject.registAsModule(Jn,Kg);var Nk=B.graph.GraphView,Cs={_editPointSize:function(){var z=B.Default.isTouchable,l=me.getStyle("pointSize");return l[z?0:1]}(),isPointEditable:function(Q){var c=this;if(me.inEdit(c))return c._pointEditableFunc?c._pointEditableFunc(Q):!0;var W=Cs.getBackup("isPointEditable");W.call(c,Q)},isEditable:function(z){var Q,Y=this,h=Cs.getBackup("isEditable");if(Q=z instanceof me.Group?!0:h.call(Y,z),!me.inEdit(Y))return Q;if(!(z instanceof B.Edge))return Q;if(!z.s("2d.editable"))return!1;var C=Y.getEditableFunc();return C?C(z):!0},_42:function(v,W){var n=this,l=Cs.getBackups()._42;if(l.call(n,v,W),me.inEdit(n)){var X=n.getEditInteractor();X.drawImpl()}}};me.Inject.registAsModule(Cs,Nk);var Zd=B.Default.getInternal().ui().ShapeUI,ad={_47O:function(p){var j=this,k=ad.getBackups()._47O;me.inEdit(j.gv)||k.call(j,p)}};me.Inject.registAsModule(ad,Zd);var Zh=B.graph.DefaultInteractor,nq={handle_mousewheel:function(q){var V=this,$=nq.getBackup("handle_mousewheel");me.inEdit(V.gv)||$.call(V,q)}};me.Inject.registAsModule(nq,Zh);var Lg=B.graph.MoveInteractor,Ec={_calcShift:function(P,y){var j=this,R=Ec.getBackup("_calcShift"),A=j.gv;if(!me.inEdit(A))return R.call(j,P,y);var Z=A.getEditInteractor(),c=Z.getSubModule("Move").calcShift(P,y,j);return c||R.call(j,P,y)},clear:function(l){var m=this,Z=Ec.getBackup("clear");Z.call(m,l);var P=m.gv;if(me.inEdit(P)){var C=P.getEditInteractor();C.getSubModule("Move").clear(l)}}};me.Inject.registAsModule(Ec,Lg);var Bk=me.Rect=function(T){this.catalog="Rect",this._interactor=T};Bk.prototype={},Bk.prototype.constructor=Bk,Bk.prototype.gatherInfo=function(u,a){var H=this;if(1===a.length){var V=a[0];return V instanceof B.Shape&&V._70I()?H.gatherLine(u,V):ke(V,u)?!1:H.gatherSingleTarget(u,V)}return a.length>1?H.gatherMultiTargets(u,a):!1},Bk.prototype.gatherSingleTarget=function(c,d){if(d.getCorners){var i,H=this,f=H.info;H.target=d,i=H.screenInfo={};var T=d.getCorners();f.LT=new me.Math.Vector2(T[0]),f.LB=new me.Math.Vector2(T[1]),f.RB=new me.Math.Vector2(T[2]),f.RT=new me.Math.Vector2(T[3]),f.T=f.LT.clone().add(f.RT).divideScalar(2),f.B=f.LB.clone().add(f.RB).divideScalar(2),f.L=f.LT.clone().add(f.LB).divideScalar(2),f.R=f.RT.clone().add(f.RB).divideScalar(2);for(var k in f)i[k]=me.toScreenPosition(c,f[k]);var q=H._interactor,h=q.getStyle("checkSize"),M=function(N,A,m){var L=A.clone().sub(N).setLength(-h),B=m.clone().sub(N).setLength(-h),Z=L.add(B).add(N);return Z};return i.rotLT=M(i.LT,i.RT,i.LB),i.rotLB=M(i.LB,i.LT,i.RB),i.rotRB=M(i.RB,i.LB,i.RT),i.rotRT=M(i.RT,i.LT,i.RB),i.rotT=i.rotLT.clone().add(i.rotRT).divideScalar(2),i.rotB=i.rotLB.clone().add(i.rotRB).divideScalar(2),i.rotL=i.rotLT.clone().add(i.rotLB).divideScalar(2),i.rotR=i.rotRT.clone().add(i.rotRB).divideScalar(2),i.rotation=d.getRotation(),H.gatherConnectInfo(),!0}},Bk.prototype.gatherConnectInfo=function(){var n=this,Q=n.target,g=n._interactor,G=n.screenInfo,Z=g.gv;if(Z.isConnectActionVisible(Q)&&g.getStyle("connectGuideVisible")){var f;Q.s&&(f=Q.s("connectGuideShift")),f||(f=g.getStyle("connectGuideShift"));var X=Q.getAnchor(),l=Q.getSize(),_=Q.toGlobal({x:l.width*(f[0]-X.x),y:l.height*(f[1]-X.y)});_=me.toScreenPosition(Z,_),G.P1?_.add(G.P2.clone().sub(G.P1).setLength(f[2])):(_.add(G.RT.clone().sub(G.LT).setLength(f[2])),_.add(G.LB.clone().sub(G.LT).setLength(f[3]))),G.connect=_}},Bk.prototype.gatherMultiTargets=function(S,p){var l=me.Group.findOrCreateGroup(p,this._interactor._uuid);if(!l)return!1;var M=this;return M.editing&&"rotate"!==M.editing.mode||l.calcInfo(),M.gatherSingleTarget(S,l)},Bk.prototype.gatherLine=function(u,V){this.target=V;var f=this.screenInfo={},b=V.getPoints(),i=me.getDataMatrix(V);return f.P1=me.toScreenPosition(u,i.apply(b.get(0))),f.P2=me.toScreenPosition(u,i.apply(b.get(1))),this.gatherConnectInfo(),!0},Bk.ResizeKeys=["LT","RB","LB","RT","L","R","B","T"],Bk.ResizeDirection=[{x:-1,y:-1},{x:1,y:1},{x:-1,y:1},{x:1,y:-1},{x:-1,y:0},{x:1,y:0},{x:0,y:1},{x:0,y:-1}],Bk.RotateKeys=["rotLT","rotRB","rotLB","rotRT","rotL","rotR","rotB","rotT"],Bk.prototype.check=function(Q,i,k){if(B.Default.isLeftButton(i)){var P=this;if(P.editing=null,P.tipInfo=null,P.screenInfo){var Z=P.target,V=Q.isEditable(Z),s=P.screenInfo;if(V&&s.connect){var j=P._checkConnect(k);if(j)return j}if(s.P1)return P._checkLine(k);var D,c,g,y=null,p=P._interactor,d=p.getStyle("checkSize");if(V&&Q.isRectEditable(Z))for(c=0;c<me.Rect.ResizeKeys.length;c++)if(g=me.Rect.ResizeKeys[c],me.checkHit(k,s[g],d)){y=g,D="resize";break}if(!y&&V&&Q.isRotationEditable(Z)&&!p.getStyle("rotateAsClock")){var S=p.getStyle("rotateCheckSize");for(c=0;c<me.Rect.RotateKeys.length;c++)if(g=me.Rect.RotateKeys[c],me.checkHit(k,s[g],S)){y=g,D="rotate";break}}if(!y)return p.setCursor("default"),void 0;if("rotate"===D){var x,t=Q.lp(i);if(Z instanceof me.Group){var z=p.getStyle("groupRotateModeKey");"string"==typeof z&&(z=[z]);for(var E=!1,w=0,l=z.length;l>w;w++)if(i[z[w]]){E=!0;break}var G=p.getStyle("groupRotateModeDefault");x=E?"batch"===G?"block":"batch":G}var J="batch"===x?Z.getAnchor2():Z.getPosition(),n=Math.atan2(t.y-J.y,t.x-J.x);p._setRotateCursor(n),P.editing={mode:D,key:y,pos:J,flipY:Z.getScale().y<0,rotation:Z.getRotation(),hitRot:n},x&&(P.editing.groupRotateMode=x)}else{var W=me.Rect.ResizeKeys.indexOf(y),I=me.Rect.ResizeDirection[W],$=Math.cos(Z.getRotation()),q=Math.sin(Z.getRotation()),o=I.x*Math.sign(Z.getScale().x),A=I.y*Math.sign(Z.getScale().y),C=Math.atan2(-q*o-$*A,$*o-q*A),X=(Math.round(C/(Math.PI/4))+8)%8,F=["ew-resize","nesw-resize","ns-resize","nwse-resize","ew-resize","nesw-resize","ns-resize","nwse-resize"][X];this._interactor.setCursor(F);var U=Z.getWidth(),h=Z.getHeight(),e=Z.getAnchor();P.editing={mode:D,key:y,rect:{x:-U*e.x,y:-h*e.y,width:U,height:h},anchor:e,matrix:Z.getMatrix()}}return y}}},Bk.prototype._checkLine=function(H){var r=this;r.screenInfo;var c,i=r._interactor.getStyle("checkSize");if(me.checkHit(H,r.screenInfo.P1,i))c="P1";else{if(!me.checkHit(H,r.screenInfo.P2,i))return this._interactor.setCursor("default"),void 0;c="P2"}return r.editing={mode:"line",key:c},c},Bk.prototype._checkConnect=function(d){var u=this,F=u.screenInfo,r=u._interactor,C=r.getStyle("connectGuideIntersectSize"),I=F.connect,i=d.x,Y=I.x;if(Y>i&&C>Y-i&&Math.abs(I.y-d.y)<C||i>=Y&&me.checkHit(d,I,C)){var G="connect",w=R.getConnectAction(r.gv);if(u.editing={mode:G},w&&w.delete)if(u.target instanceof me.Group){var J=!0;r.gv.sm().getSelection().each(function(N){w.delete.visible.call(null,r.gv,N)||(J=!1)}),u.editing.hasDeleteAction=J}else w.delete.visible.call(null,r.gv,u.target)&&(u.editing.hasDeleteAction=!0);return r.setCursor("default"),G}},Bk.prototype._fireEditEvent=function(l,N){var Y=this._interactor,o=this.editing;if(o){var i=o.mode;i="rotate"===i?"Rotation":"connect"===i?"Connection":"resize"===i?"Rect":i[0].toUpperCase()+i.slice(1),Y.fi({kind:l+"Edit"+i,event:N})}},Bk.prototype.startEdit=function(N,f){N.startDragging(f);var r=this;r._interactor.fi({kind:"prepareEdit",event:f});var R=r.editing,c=r.target;if(R){if(r._fireEditEvent("begin",f),R.started=!0,"rotate"===R.mode)return R.groupRotateMode&&c.beginRotate(R),N._42(),void 0;if("connect"!==R.mode)("line"===R.mode||c&&0===c.getRotation())&&(r._inSmartGuide=!0,r._interactor.rectGuide.gatherRects());else if(R.hasDeleteAction){var S=N.gv,h=r._interactor.getStyle("connectGuideGarbageShift");R.garbageInfo={x:S.getWidth()*h[0]+h[2],y:S.getHeight()*h[1]+h[3],size:r._interactor.getStyle("connectGuideGarbageIntersectsize")},N._42()}}},Bk.prototype._46O=function(t){var r,q,Q=this,b=Q.editing,g=Q.target;if(b){if("connect"===b.mode&&!b.canceled&&!b.deleted)try{b.garbageInfo&&b.garbageInfo.hover?R.doDeleteConnectionAction(Q._interactor.gv,g):R.doConnectAction(Q._interactor.gv,g,b.target)}catch(L){console.error(L)}q=b.freezeFlag,r=Q.editing.groupRotateMode,Q._fireEditEvent("end",t),Q.editing=null}Q.tipInfo=null,Q._inSmartGuide&&(Q._interactor.rectGuide.clear(),Q._inSmartGuide=!1),r&&g&&g.endRotate(),g instanceof B.Block&&(q===z?delete g._freezeSyncFromChildren:g._freezeSyncFromChildren=q,g.updateFromChildren())},Bk.prototype.handleNormalStateDelete=function(){var D=this,V=D.editing;if(V&&"connect"===V.mode&&!V.canceled&&!V.deleted){if(V.garbageInfo){try{R.doDeleteConnectionAction(D._interactor.gv,D.target)}catch(u){console.error(u)}V.garbageInfo=null}return V.cursorPos=null,V.targetCorners=null,V.deleted=!0,D._interactor._42(),!0}},Bk.prototype.handleNormalStateKeyDown=function(c){var H=this,D=H.editing;return!D||"connect"!==D.mode||D.canceled||D.deleted?void 0:B.Default.isEsc(c)?(D.cursorPos=null,D.targetCorners=null,D.canceled=!0,H._interactor._42(),!0):void 0},Bk.prototype.handleEdit=function(z,O){var b=this,X=b.editing;if(X){var c,M,m,C,P,q=b.target,n=X.key,D=X.mode,V=z.lp(O),R=b._interactor;if("connect"===D){if(X.canceled)return;if(X.deleted)return;X.cursorPos=R._getLogicalPoint(O);var T=X.garbageInfo;return T&&me.checkHit(X.cursorPos,T,T.size)?(T.hover=!0,X.target=null,X.targetCorners=null):(T&&(T.hover=!1),X.target=z.getDataAt(V,function(f){return z.isSelectable(f)?Dg(f)?!0:!1:!1})||null,X.targetCorners=me.getTargetCornersOnScreen(z,X.target)),R._42(),void 0}if("rotate"===D){var l,f,s=X.pos,H=Math.atan2(V.y-s.y,V.x-s.x);if(X.groupRotateMode?f=H-X.hitRot:(l=H-X.hitRot,f=X.rotation+l),f%=2*Math.PI,0>f&&(f+=2*Math.PI),!B.Default.isCtrlDown(O)){var L,j;Ac(O)?(L=R.getStyle("shiftRotateRound"),j=L/2):(L=R.getStyle("rotateRound"),j=R.getStyle("rotateSensitivity")),f=me.roundTo(f,L,j)}X.groupRotateMode?(l=f-(X.lastRotation||0),0!==l&&(q.addRotation(l,X.groupRotateMode,function(X){return z.isRotationEditable(X)}),X.lastRotation=f)):q.setRotation(f),R._setRotateCursor(H),f>Math.PI&&(f-=2*Math.PI);var K=180*(f/Math.PI);K=K.toFixed(2),c=""+K+"°"}else if("resize"===D){var o=X.rect;m=o.x,C=o.y;var Z,S=o.width,W=o.height,p=X.anchor,J=X.matrix,x=q.s&&q.s("keepAspectRatio")||R.getStyle("keepAspectRatio");Ac(O)&&(x=!x);var t=b._unionPointMode1,u=b._unionPointMode2;if(b._inSmartGuide&&!B.Default.isCtrlDown(O)&&!x){var v;"L"===n||"R"===n?v="x":("T"===n||"B"===n)&&(v="y"),b._adsorbedToClosest(V,v),P=!0}Z=J.tfi(V);var Y;"LT"===n?(o=t(Z,{x:m+S,y:C+W},S,W,x),Y=9):"T"===n?(o=u({x:m,y:Z.y},{x:m+S,y:C+W},S,W,x,"v"),Y=1):"RT"===n?(o=t(Z,{x:m,y:C+W},S,W,x),Y=33):"L"===n?(o=u({x:Z.x,y:C},{x:m+S,y:C+W},S,W,x,"h"),Y=8):"R"===n?(o=u({x:m,y:C},{x:Z.x,y:C+W},S,W,x,"h"),Y=32):"LB"===n?(o=t(Z,{x:m+S,y:C},S,W,x),Y=12):"B"===n?(o=u({x:m,y:C},{x:m+S,y:Z.y},S,W,x,"v"),Y=4):"RB"===n&&(o=t(Z,{x:m,y:C},S,W,x),Y=36);var h=J.tf(o.x+o.width*p.x,o.y+o.height*p.y);q instanceof B.Block&&(X.hasOwnProperty("freezeFlag")||(X.freezeFlag=q._freezeSyncFromChildren,q._freezeSyncFromChildren=!0)),q.setPosition(h),q.setSize(o.width,o.height),P&&(M=q.getRect(),R.rectGuide.gatherLines({node:q,x:M.x,y:M.y,w:M.width,h:M.height},v,Y)),c=""+Math.round(o.width)+" * "+Math.round(o.height)}else if("line"===D){if(Ac(O)){var i=q.getPoints(),E="P1"===n?i.get(1):i.get(0),$={x:V.x-E.x,y:V.y-E.y},U=R.getStyle("shiftLineRotateRound"),g=b._shiftDirList;if(!g||b._shiftRotateRound!==U){b._shiftRotateRound=U,b._shiftDirList=g=[];for(var w=0;w<Math.PI;w+=U)g.push({x:k(w),y:F(w)})}for(var A,y=0,_=0,I=g.length;I>_;_++){var d=g[_],r=d.x*$.x+d.y*$.y;Math.abs(r)>Math.abs(y)&&(y=r,A=d)}V={x:E.x+A.x*y,y:E.y+A.y*y},R.rectGuide.clear()}else b._inSmartGuide&&!B.Default.isCtrlDown(O)&&(b._adsorbedToClosest(V),P=!0);var G=me.getDataMatrix(q).applyInverse(V);q.setPoint("P1"===n?0:1,G,!0);var N=q.getPoints(),a=N.get(0),e=N.get(1);m=a.x-e.x,C=a.y-e.y,c=" "+Math.round(Math.sqrt(m*m+C*C))+" ",P&&(M=q.getRect(),R.rectGuide.gatherLines({node:q,x:M.x,y:M.y,w:M.width,h:M.height}))}if(c){var Q=B.Default.getLogicalPoint(O,R._canvas);Q.x+=me.Icons.TipShiftX,Q.y+=me.Icons.TipShiftY,b.tipInfo={helperPos:Q,text:c,size:c.length}}b._fireEditEvent("between",O)}},Bk.prototype._unionPointMode1=function(Q,y,g,L,C){if(C&&g&&L){var o=Q.x-y.x,Y=Q.y-y.y;Math.abs(o*L)<Math.abs(Y*g)?(Y=Math.sign(Y)*Math.abs(o*L/g),Q.y=y.y+Y):(o=Math.sign(o)*Math.abs(Y*g/L),Q.x=y.x+o)}return B.Default.unionPoint(Q,y)},Bk.prototype._unionPointMode2=function(V,r,v,T,D,y){var Y=B.Default.unionPoint(V,r);if(D&&v&&T){var z;"v"===y?(z=Y.x+Y.width/2,Y.width=v*Y.height/T,Y.x=z-Y.width/2):(z=Y.y+Y.height/2,Y.height=T*Y.width/v,Y.y=z-Y.height/2)}return Y},Bk.prototype._adsorbedToClosest=function(A,b){var N=this,a=N._interactor,W=a.rectGuide.findClosest(A,b),H=a.gridGuide.findClosest(A,b),g=1/0,U=1/0;W&&(isFinite(W.x)&&(g=W.x),isFinite(W.y)&&(U=W.y)),H&&(isFinite(H.x)&&Math.abs(H.x)<Math.abs(g)&&(g=H.x),isFinite(H.y)&&Math.abs(H.y)<Math.abs(U)&&(U=H.y)),isFinite(g)&&(A.x+=g),isFinite(U)&&(A.y+=U)},Bk.prototype._42=function(P,q,C){var b=this;b.info={},b.screenInfo=null;var Q=b._interactor;if(!Q.editDetail&&b.gatherInfo(q,C)){var T=b.editing,f=T?T.groupRotateMode:null,A=b.screenInfo;if("block"!==f||!T||!T.started){if(A.P1?me.Icons.DrawIcon(Q,P,me.Icons.Line,A):me.Icons.DrawIcon(Q,P,me.Icons.Rect,A),A.connect&&(me.Icons.DrawIcon(Q,P,me.Icons.ConnectGuide,{rotation:A.rotation,connect:A.connect,cursorPos:T?T.cursorPos:null}),T)){if(T.targetCorners){for(var j={x:1/0,y:1/0},y={x:-1/0,y:-1/0},H=0,z=T.targetCorners.length;z>H;H+=2)j.x=Math.min(j.x,T.targetCorners[H]),y.x=Math.max(y.x,T.targetCorners[H]),j.y=Math.min(j.y,T.targetCorners[H+1]),y.y=Math.max(y.y,T.targetCorners[H+1]);me.Icons.DrawIcon(Q,P,me.Icons.HoverDataRect,{min:j,max:y,color:Q.getStyle("hoverGuideColor")||Q.getStyle("baseColor")})}T.garbageInfo&&me.Icons.DrawIcon(Q,P,me.Icons.ConnectGuideGarbage,T.garbageInfo)}Q.getStyle("rotateTipVisible")&&b.tipInfo&&me.Icons.DrawIcon(Q,P,me.Icons.TipHelper,b.tipInfo)}b.target instanceof me.Group&&b.target._42(Q,P,q)}};var _q=me.Anchor=function(a){this.catalog="Anchor",this._interactor=a};_q.prototype={},_q.prototype.constructor=_q,_q.prototype.gatherInfo=function(j,c){var i=this;if(1===c.length){var m=c[0];if(!m.getAnchor)return;if(m instanceof B.Shape&&m._70I())return;if(ke(m,j))return;return i.gatherSingleTarget(j,c[0])}return c.length>1?i.gatherMultiTargets(j,c):!1},_q.prototype.gatherSingleTarget=function(p,g){var S=this;return S.info.POS=g.getPosition(),S.screenInfo.POS=me.toScreenPosition(p,S.info.POS),S.target=g,!0},_q.prototype.gatherMultiTargets=function(F,m){var y=this,j=me.Group.findOrCreateGroup(m,this._interactor._uuid);return j?(y.screenInfo.POS=me.toScreenPosition(F,j.getAnchor2()),y.target=j,!0):!1},_q.prototype.isVisible=function(){var U=this,V=U._interactor;if(V.getStyle("anchorVisible")===!1)return!1;var n=U.target;if(n){if(this.editing)return!0;var _=n.getAnchor(),k=V.getStyle("anchorOutsideVisibleThreshold");if(_.x<-k||_.x>1+k||_.y<-k||_.y>1+k)return!0;var y=n.getSize(),g=n.getScale(),h=Math.min(Math.abs(y.width*g.x),Math.abs(y.height*g.y));if(h*V.gv._zoom<V.getStyle("anchorHideThreshold"))return!1}return!0},_q.prototype.check=function(X,V,L){if(B.Default.isLeftButton(V)){var T=this,d=T._interactor;if(T.isVisible()&&d.getStyle("anchorMovable")!==!1){T.editing=null,T.tipInfo=null;var i=T.target;if(i&&X.isAnchorEditable(i)&&X.isEditable(i)){var l;if(T.screenInfo&&(l=T.screenInfo.POS)&&me.checkHit(L,new me.Math.Vector2(l),d.getStyle("checkSize"))){if(i instanceof me.Group)return T.editing={},!0;var m=i.getWidth(),y=i.getHeight(),t=i.getAnchor();return T.editing={rect:{x:-m*t.x,y:-y*t.y,width:m,height:y},anchor:t,matrix:i.getMatrix()},!0}}}}},_q.prototype.startEdit=function(l,i){l.startDragging(i),l.fi({kind:"beginEditAnchor",event:i})},_q.prototype._46O=function(v){var Z=this;Z.editing&&(Z.editing=null,Z._interactor.fi({kind:"endEditAnchor",event:v})),Z.tipInfo=null},_q.prototype.handleEdit=function(M,y){var X=this,U=X.target;if(U){var Q=X.editing;if(Q){var d=M.lp(y),o=X._interactor;if(U instanceof me.Group)return U.setAnchor2(d),o._42(),void 0;var $=Q.matrix,_=$.tfi(d),h=Q.rect,i=(_.x-h.x)/h.width,u=(_.y-h.y)/h.height;if(!B.Default.isCtrlDown(y)){var n=o.getStyle("anchorRound"),K=o.getStyle("anchorSensitivity");i=me.roundTo(i,n,K),u=me.roundTo(u,n,K)}U.setAnchor(i,u,!0);var G=B.Default.getLogicalPoint(y,o._canvas);G.x+=me.Icons.TipShiftX,G.y+=me.Icons.TipShiftY;var a=""+i.toFixed(2)+", "+u.toFixed(2);X.tipInfo={helperPos:G,text:a,size:a.length},o.fi({kind:"betweenEditAnchor",event:y})}}},_q.prototype._42=function(L,G,X){var N=this;N.info={},N.screenInfo={};var i=N._interactor;i.editDetail||N.gatherInfo(G,X)&&N.isVisible()&&(me.Icons.DrawIcon(i,L,me.Icons.Anchor,N.screenInfo),N.tipInfo&&me.Icons.DrawIcon(i,L,me.Icons.TipHelper,N.tipInfo))};var Vm=me.MoveDummy=function(r){this.catalog="MoveDummy",this._interactor=r};Vm.prototype={},Vm.prototype.constructor=Vm,Vm.prototype.gatherInfo=function(){var x=this,S=this._interactor.getSubModule("Rect");if(S){var s=S.screenInfo;if(s){var A=x._interactor,P=x.getMovableTarget(S.target);if(P){var Y=A.getStyle("moveDummyThreshold");if(Y!==!1){var y=s.LT||s.P1,U=s.RT||s.P2,n=s.LB||y;if(y){var I=s.P1,e=Math.min(y.distanceTo(n),y.distanceTo(U));if(!(Y!==!0&&e>Y)){var u=A.getStyle("moveDummyPosition"),i=U.clone().sub(y),p=n.clone().sub(y),B=u[2],T=u[3];if(I){var f=A.getStyle("moveDummyLineExtraShift");f&&(B+=f[0],T+=f[1])}var h=y.clone().add(i.clone().multiplyScalar(u[0])).add(i.setLength(B)).add(p.clone().multiplyScalar(u[1])).add(p.setLength(T));return x.screenInfo.pos=h,x.screenInfo.size=A.getStyle("moveDummySensitivity"),!0}}}}}}},Vm.prototype.getMovableTarget=function(o){var $=this._interactor.gv;if(Dg(o)){if($.isMovable(o))return o}else if(o instanceof me.Group)for(var A=o._entities,W=A.length-1;W>=0;W--){var w=A[W];if(Dg(w)&&$.isMovable(w))return w}return null},Vm.prototype.getMoveInteractor=function(){for(var S,I,A,C=this._interactor.gv,y=C.getInteractors(),S=0,I=y.length;I>S;S++)if(A=y.get(S),A instanceof Lg)return A},Vm.prototype.startEdit=function(g,Y){g.startDragging(Y);var r=this.getMoveInteractor();if(r){var B=this.selectedTarget,K=g.gv;K._moving=1,r._data=B,K.handleMouseDown&&K.handleMouseDown(Y,B)}},Vm.prototype._46O=function(K){var $=this,O=$.getMoveInteractor();O&&(O.handleWindowMouseUp(K),$.selectedTarget=null)},Vm.prototype.handleEdit=function(X,b){var f=this.getMoveInteractor();
f&&f.handleWindowMouseMove(b)},Vm.prototype.check=function(v,z,C){if(this.selectedTarget=null,B.Default.isLeftButton(z)&&!v._scrolling&&!tl()){var Y=this;if(Y.screenInfo){var y=Y.screenInfo.pos;if(y&&!(C.distanceTo(y)>Y.screenInfo.size)){var W=Y._interactor;return Y.selectedTarget=Y.getMovableTarget(W.getSubModule("Rect").target),W.setCursor("default"),!0}}}},Vm.prototype._42=function($,N,o){var e=this;e.screenInfo={};var d=e._interactor;d.editDetail||e.gatherInfo(N,o)&&(!d.editing||e.selectedTarget)&&me.Icons.DrawIcon(d,$,me.Icons.MoveDummy,e.screenInfo)};var ib=me.RotateX=function(D){this.catalog="RotateX",this._interactor=D};ib.prototype={},ib.prototype.constructor=ib,ib.prototype.gatherInfo=function(v,F){var U=this;if(1===F.length){var r=F[0];return r instanceof B.Shape&&r._70I()||ke(r,v)?!1:U.gatherSingleTarget(v,r)}return F.length>1?U.gatherMultiTargets(v,F):!1},ib.prototype.gatherSingleTarget=function(){var t=new B.Math.Vector2,c=new B.Math.Vector2,L=new B.Math.Vector2,G=new B.Math.Vector2,w=function(W,R){var C=W.x-R.x,A=W.y-R.y;return C*C+A*A};return function(Q,Z){if(Z.getCorners){var R=this,V=Z.getCorners(),i=15,m=Z.getPosition();t.copy(V[0]),L.copy(V[1]),G.copy(V[3]),c.copy(t).add(G).divideScalar(2).add(t.sub(L).setLength(i/Q.getZoom()));var j=Math.max(w(m,V[0]),w(m,V[1]),w(m,V[2]),w(m,V[3]));return R.info.POS=c.clone(),R.screenInfo.POS=me.toScreenPosition(Q,R.info.POS),R.screenInfo.LEN=Math.sqrt(j)*Q.getZoom()+i,R.screenInfo.CENTER=me.toScreenPosition(Q,m),R.target=Z,!0}}}(),ib.prototype.gatherMultiTargets=function(G,S){var E=this,z=me.Group.findOrCreateGroup(S,this._interactor._uuid);if(!z)return!1;var E=this;return E.gatherSingleTarget(G,z)},ib.prototype.isVisible=function(){var e=this._interactor;if(!e.getStyle("rotateAsClock"))return!1;var M=this.target;if(!M)return!0;var E=e.gv;return E.isEditable(M)&&E.isRotationEditable(M)?!0:!1},ib.prototype.check=function(T,D,j){var L=this,d=L._checkImpl(T,D,j);return(d||L._clockPainted)&&L._interactor._42(),d},ib.prototype._checkImpl=function(L,J,C){if(B.Default.isLeftButton(J)){var D=this;D.editing=null,D.tipInfo=null;var c;if(D.screenInfo&&(c=D.screenInfo.POS)&&D.isVisible()){var G=D._interactor;if(me.checkHit(C,c,G.getStyle("checkSize"))){var E=D.target,z=L.lp(J),V=E.getPosition(),j=Math.atan2(z.y-V.y,z.x-V.x);return G._setRotateCursor(j),D.editing={pos:V,rotation:E.getRotation(),hitRot:j,groupRotateMode:"block",screenInfo:{CENTER:D.screenInfo.CENTER,LEN:D.screenInfo.LEN}},!0}}}},ib.prototype.startEdit=function(o,T){o.startDragging(T),o.fi({kind:"beginEditRotation",event:T}),this.target instanceof me.Group&&this.target.beginRotate(this.editing)},ib.prototype._46O=function(r){var A=this;A.editing&&(A.editing=null,A._interactor.fi({kind:"endEditRotation",event:r})),A.target instanceof me.Group&&A.target.endRotate(),A.tipInfo=null},ib.prototype.handleEdit=function(n,U){var h=this,v=h.editing;if(v){var p,I,L=h.target,o=n.lp(U),r=h._interactor,R=v.pos,A=Math.atan2(o.y-R.y,o.x-R.x),J=L instanceof me.Group;if(J?I=A-v.hitRot:(p=A-v.hitRot,I=v.rotation+p),I%=2*Math.PI,0>I&&(I+=2*Math.PI),!B.Default.isCtrlDown(U)){var O,i;Ac(U)?(O=r.getStyle("shiftRotateRound"),i=O/2):(O=r.getStyle("rotateRound"),i=r.getStyle("rotateSensitivity")),I=me.roundTo(I,O,i)}J?(p=I-(v.lastRotation||0),0!==p&&(L.addRotation(p,v.groupRotateMode,function(V){return n.isRotationEditable(V)}),v.lastRotation=I)):L.setRotation(I),r._setRotateCursor(A),I>Math.PI&&(I-=2*Math.PI);var C=180*(I/Math.PI),E=""+C.toFixed(2)+"°",S=B.Default.getLogicalPoint(U,r._canvas);S.x+=me.Icons.TipShiftX,S.y+=me.Icons.TipShiftY,h.tipInfo={helperPos:S,text:E,size:E.length},r.fi({kind:"betweenEditRotation",event:U})}},ib.prototype._42=function(a,c,X){var n=this;n._clockPainted=!1,n.info={},n.screenInfo={};var k=n._interactor;k.editDetail||n.gatherInfo(c,X)&&n.isVisible()&&(me.Icons.DrawIcon(k,a,me.Icons.RoundPoint,n.screenInfo.POS),k.getStyle("rotateTipVisible")&&n.tipInfo&&me.Icons.DrawIcon(k,a,me.Icons.TipHelper,n.tipInfo),n.editing&&n.drawClock(a))},ib.prototype.drawClock=function(Q){Q.save();var x=this;x._clockPainted=!0;var $=x.editing||{},p=$.screenInfo||x.screenInfo,T=p.LEN,i=T+8,j=T+18;Q.save(),Q.translate(p.CENTER.x,p.CENTER.y),Q.beginPath(),Q.strokeStyle="rgb(150, 150, 150)";for(var v,S,B,K,R,M=0;360>M;M++)v=M*Math.PI/180,0===M%5&&(S=F(v)*T,B=k(v)*T,K=F(v)*i,R=k(v)*i,Q.moveTo(S,B),Q.lineTo(K,R)),0===M%45&&(S=F(v)*T,B=k(v)*T,K=F(v)*j,R=k(v)*j,Q.moveTo(S,B),Q.lineTo(K,R));Q.stroke(),Q.rotate(-pk);var L=$.lastRotation||x.target.getRotation();Q.beginPath(),Q.fillStyle="rgba(255, 0, 0, 0.1)",Q.strokeStyle="rgb(157, 157, 157)",Q.moveTo(0,0),Q.arc(0,0,j,0,L,!1),Q.fill(),Q.beginPath(),Q.moveTo(0+j,0),Q.arc(0,0,j,0,L,!1),Q.stroke(),Q.restore()};var Tk=me.Curve=function(g){this.catalog="Curve",this._interactor=g};Tk.prototype={},Tk.prototype.constructor=Tk,T.defineProperties(Tk.prototype,{activing:{get:function(){return this._activing},set:function(R){var H=this;if(R)H._activing=new me.CurveActiving(this,R),H.gatherSingleTarget(H._interactor.gv,H.target);else{var o=H._activing;o&&o.dispose(),H._activing=null}}}}),Tk.PointType={Mirrored:0,Straight:1,Disconnected:2,Asymmetric:3},Tk.prototype.setUp=function(){var _=this,M=_._interactor;M&&M.gv.mp(_._onGraphviewPropertyChanged,_)},Tk.prototype._onGraphviewPropertyChanged=function(s){("zoom"===s.property||"translateX"===s.property||"translateY"===s.property)&&this._handleDataChanged()},Tk.prototype.tearDown=function(){var Z=this,V=Z._interactor;V&&V.gv.ump(Z._onGraphviewPropertyChanged,Z)},Tk.prototype.canEnterEditDetailMode=function(){var n=Gh(this._interactor);return n?this.target=n:void 0},Tk.prototype.canQuitEditDetailMode=function(h){var L=this,P=L._interactor._getLogicalPoint(h);return L._checkEditRealPoint(P)?void 0:L._interactor.gv.getDataAt(h)!==L.target?!0:void 0},Tk.prototype.preHandleScroll=function(){var d=this.editing;return d&&d.inEdit?!0:void 0},Tk.prototype.getCurrentSelectintStatus=function(){var c=this;if(c.activing&&!c.activing.selections){if(c.activing.status!=z)return c.activing.status;var X=function(b){var r=c.activing.status;c.activing.status=b,c._interactor.fp("shapePointStatus",r,b)},o=me.Curve.PointType,t=c.activing.point,v=c.activing.pairs;if(!v||1!==v.length)return X(o.Mirrored);var m=v[0],D=m.c1&&m.c1.isNearEnough(t),Q=m.c2&&m.c2.isNearEnough(t);if(!m.c1||!m.c2)return D||Q?X(o.Straight):X(o.Disconnected);if(D&&Q)return X(o.Straight);if(D||Q)return X(o.Asymmetric);var R=m.c1.clone().sub(t),g=m.c2.clone().sub(t);return Math.abs(R.x*g.y-R.y*g.x)>1e-5||R.x*g.x>0?X(o.Disconnected):Math.abs(R.length()-g.length())>1e-5?X(o.Asymmetric):X(o.Mirrored)}},Tk.prototype.handle_keydown=function(D){var F=this;if(F._interactor.editDetail){var r=me.Curve.PointType;"1"===D.key?F._setCurrentSelectionStatus(r.Straight):"2"===D.key?F._setCurrentSelectionStatus(r.Mirrored):"3"===D.key?F._setCurrentSelectionStatus(r.Disconnected):"4"===D.key&&F._setCurrentSelectionStatus(r.Asymmetric)}},Tk.prototype.setCurrentSelectionStatus=function(W){var N=this,E=N._interactor;if(E){var w=E.gv;w.dm().beginTransaction(),this._setCurrentSelectionStatus(W),w.dm().endTransaction()}},Tk.prototype._setCurrentSelectionStatus=function(K){var v=this,w=v.activing;if(w){var f=v.getCurrentSelectintStatus();if(null!==f&&f!==K){w.status=K;var s=v.activing.point,y=v.activing.pairs;if(y&&1===y.length){var m=y[0],e=v.screenInfo.curve,D=me.Curve.PointType,W=v._interactor,P=function(){v._writeToHt(),W.fp("shapePointStatus",f,K),v.check(W.gv,null,new me.Math.Vector2(W._lastLogicalPoint))};if(K===D.Straight)return e.moveCtrlPoint(m,s,"c1"),e.moveCtrlPoint(m,s,"c2"),P(),void 0;if(f===D.Straight){var x=e.findPairs(s,!0),l=x[0],c=l.r1||s,H=l.r2||s,g=H.clone().sub(c).multiplyScalar(.25);return e.moveCtrlPoint(m,s.clone().sub(g),"c1"),e.moveCtrlPoint(m,s.clone().add(g),"c2"),P(),void 0}var _=m.c1,L=m.c2;if(_&&L){if(K===D.Mirrored)return e.moveCtrlPoint(m,s.clone().multiplyScalar(2).sub(L),"c1"),P(),void 0;if(K===D.Asymmetric&&f===D.Disconnected){var E=_.clone().sub(s).length(),g=s.clone().sub(L).setLength(E).add(s);return e.moveCtrlPoint(m,g,"c1"),P(),void 0}}w._firePointChange(),W.fp("shapePointStatus",f,K),v.check(W.gv,null,new me.Math.Vector2(W._lastLogicalPoint))}}}},Tk.prototype._handleDataChanged=function(){var Y="s:edge.points,s:edge.segments,points,segments,shape,position,rotation,scale".split(",");return function(V){var H=this;if(H.screenInfo&&H.target){if(V&&Y.indexOf(V.property)<0)return;var g=H._interactor;H.gatherSingleTarget(g.gv,H.target,!0),H.check(g.gv,null,new me.Math.Vector2(g._lastLogicalPoint)),g._42()}}}(),Tk.prototype.gatherSingleTarget=function(j,w,c){var L,$,Y=this;Y.screenInfo&&Y.screenInfo.curve&&($=Y.screenInfo.curve._curves);var X=Y.editing;L=X?Y.screenInfo:Y.screenInfo={};var M,f,i=w instanceof B.Edge;i?(M=w.s("edge.segments"),f=w.s("edge.points")||new B.List):(M=w._58O,f=w._59O),L.S=M;var m,E=L.P=[],V=me.getDataMatrix(w);if(w instanceof B.Polyline||w instanceof B.Edge&&Y._interactor.getStyle("edgeElevationEditable"))m=w.getElevation&&w.getElevation()||0,L.E=[];else{var a=!1;f.each(function(n){n.e!==z&&(a=!0)}),a&&(L.E=[])}if(f.each(function(Q){L.E&&L.E.push(Q.e!=z?Q.e:m),Q=V.apply(Q);var s=me.toScreenPosition(j,Q);E.push(s.x,s.y)}),i){var t=E.length,N=me.toScreenPosition(j,w._lastSourcePoint||(t?{x:E[0],y:E[1]}:{x:0,y:0})),R=me.toScreenPosition(j,w._lastTargetPoint||(t?{x:E[t-2],y:E[t-1]}:{x:0,y:0}));if(E.splice(0,0,N.x,N.y),E.push(R.x,R.y),L.E){var k=w.getSourceAgent();k instanceof B.Edge?L.E.splice(0,0,w.s("edge.source.offset.elevation")):L.E.splice(0,0,((w.s("edge.source.anchor.elevation")||.5)-.5)*k.getTall()*k.getScaleTall()+k.getElevation()+w.s("edge.source.offset.elevation"));var l=w.getTargetAgent();l instanceof B.Edge?L.E.push(w.s("edge.target.offset.elevation")):L.E.push(((w.s("edge.target.anchor.elevation")||.5)-.5)*l.getTall()*l.getScaleTall()+l.getElevation()+w.s("edge.target.offset.elevation"))}}if(!L.S||!L.S.size()){L.S=new B.List,L.S.add(1);for(var D=0;D<E.length/2-1;D++)L.S.add(2)}if((!X||c)&&Y.convertToCubicBezier($),Y.activing&&(c||!Y.editing||"realPoint"===Y.editing.type)){var o=L.curve.findPairs(Y.activing.point);Y.activing.pairs=o}},Tk.prototype._convertToNewPoint=function(B,d,o,b){var t,w,j;for(t=0,w=d.length;w>t;t++){if(j=d[t],j._p1.isNearEnough(B)&&(!b||b.indexOf(j._p1)<0))return j._p1;if(j._p4.isNearEnough(B)&&(!b||b.indexOf(j._p4)<0))return j._p4}if(o)for(t=0,w=Math.min(o.length,w);w>t;t++){if(j=o[t],j._p1===B&&(!b||b.indexOf(d[t]._p1)<0))return d[t]._p1;if(j._p4===B&&(!b||b.indexOf(d[t]._p4)<0))return d[t]._p4}},Tk.prototype.convertToCubicBezier=function(U){var d,k,K=this,s=new me.Math.Curve,V=K.screenInfo;if(s.createFromHtShape(V.P,V.S,V.E),V.curve=s,K.activing){var D=s._curves;d=K.activing.point,k=K._convertToNewPoint(d,D,U);var e=[];if(k&&(K.activing.point=k,e.push(k)),K.activing.selections){var _=-1,p=K.activing.selections;p.forEach(function(Y){_++,k=K._convertToNewPoint(Y,D,U,e),k&&(p[_]=k,e.push(k))})}}},Tk.prototype.check=function(p,o,$){if(!o||fb(o)||Ie(o)){var t=this;if(t._interactor.setCursor("default"),t.editing=null,t.highlight=null,t.tipInfo=null,t.edgeEditResult=null,t.screenInfo){if(tl()||o&&Ie(o))return t._interactor._42(),!0;if(t._checkEditCtrlPoint($))return t._interactor._42(),!0;if(t._checkEditRealPoint($))return t._interactor._42(),!0;if(t._checkEditElevation($))return t._interactor._42(),!0;var Y=t.screenInfo.curve,D=Y.checkPoint($,t._interactor.getStyle("curveIntersectSize"));if(D){var y=t.highlight={};y.type="insertKnot",y.bezier=D.bezier,y.point=D.intersection}return t._interactor._42(),!0}}},Tk.prototype.getAdjacentBeziers=function(Y){var J=this.screenInfo;if(J){var c,O,U,X=J.curve._curves,N=[],$=z;for(c=0,O=X.length;O>c;c++)if(U=X[c],$===z){if(U._p4.isNearEnough(Y)){N.push(U),$=c;continue}}else{if(U._p1.isNearEnough(Y))return N.push(U),N;if(U._p4.isNearEnough(Y)){N[0]=U,$=c;continue}}}},Tk.prototype.roundCorner=function(F){if(this.activing&&this.screenInfo){var _=this.screenInfo.curve,O=_._curves,c=this.getAdjacentBeziers(this.activing.point),s=c[1],G=s._index;s=s.insertKnot(s.getTByPercentage(F/s.length))[1],O[G]=s;var z=s.p1,D=c[0],v=D._index;D=D.insertKnot(D.getTByPercentage(1-F/D.length))[0],O[v]=D;var M=D.p4,j=this.activing.point,n=new me.Math.CubicBezier(M,j.clone().sub(M).multiplyScalar(2/3).add(M),j.clone().sub(z).multiplyScalar(2/3).add(z),z);O.splice(G,0,n),this._writeToHt(),this.activing=null,this._interactor._42()}},Tk.prototype._checkEditRealPoint=function(m){var d,s,j,O,h,A,w=this,R=w.screenInfo.curve._curves,S=w._interactor.getStyle("curvePointIntersectSize"),g=1/0;for(S*=S,j=0,O=R.length;O>j;j++)d=R[j],h=d._p1,A=m.distanceToSquared(h),g>A&&(g=A,s=h),h=d._p4,A=m.distanceToSquared(h),g>A&&(g=A,s=h);if(g>S)return!1;var H=w.highlight={};return H.type="changeRealPoint",H.point=s,w.editing={type:"realPoint",point:s,shiftGuide:{point:s.clone(),dir:"x",limit:0}},w._interactor.setCursor("crosshair"),!0},Tk.prototype._checkEditElevation=function(S){var o=this;if(!o._interactor.getStyle("curveElevationVisible"))return!1;var p=o.target;if(p instanceof B.Edge&&!o._interactor.getStyle("edgeElevationEditable"))return!1;var h=o.activing;if(!h)return!1;var Z=h.getCurrentEditingPoint();if(!Z)return!1;var P=o._interactor,m=P.getStyle("curveElevationGuideShift"),z=P.getStyle("curveElevationIntersectSize"),O=S.distanceToSquared({x:Z.x+m[0],y:Z.y+m[1]});if(!(O>z*z)){var e=o.highlight={};e.type="elevation";var M=new me.Math.Vector2(S.x,S.y,Z.e);return o.editing={type:"elevation",startPoint:M},o._interactor.setCursor("crosshair"),!0}},Tk.prototype._checkEditCtrlPoint=function(H){var K=this;if(K.activing&&!K.activing.selections){var Y=K.getCurrentSelectintStatus();if(Y!==me.Curve.PointType.Straight){var m=K.activing.pairs;if(m){var z=K._interactor.getStyle("curvePointIntersectSize");z*=z;var N,$,o,F,d,u,b,Z,_,j=1/0;for(b=0,_=m.length;_>b;b++)for(F=m[b],Z=0;2>Z;Z++)d=0===Z?"c1":"c2",F[d]&&(u=H.distanceToSquared(F[d]),j>u&&(j=u,N=F,$=b,o=d));if(j>z)return!1;K.activing.hlpair=N,K.activing.hltype=o;var C=K.highlight={};return C.type="changeCtrlPoint",C.point=N[o],K.editing={type:"ctrlPoint",pair:N,pairId:$,ctrlType:o,direction:N[o].clone().sub(K.activing.point).normalize()},K._interactor.setCursor("crosshair"),!0}}}},Tk.prototype.startEdit=function(l,i){l.startDragging(i);var h=this;h.highlight&&"insertKnot"===h.highlight.type&&(h.insertKnot(),h.gatherSingleTarget(h._interactor.gv,h.target),h.activing=null,h._checkEditRealPoint(h._interactor._getLogicalPoint(i)));var U=h._activing;if(U){var $=h.editing?h.editing.type:null;"ctrlPoint"===$?U.editingCtrl={pairId:h.editing.pairId,type:U.hltype}:"realPoint"===$&&(U.editingCtrl=!1)}var V=h.highlight,L=B.Default.isCtrlDown(i);if(!V||tl()||Ie(i)){var m=h._interactor.gv;if(!m.setFocus(i)||m._scrolling)return;return L?h._multiSelect={startPoint:m.lp(i)}:m.isPannable()&&(fb(i)||Ie(i))&&(h._pan={tx:m.tx(),ty:m.ty()},l.fi({kind:"beginPan",event:i})),void 0}if("changeRealPoint"===V.type){var y,j=h.activing?h.activing.point:null,H=h.activing?h.activing.selections:null;if(L&&h.activing)j===V.point?(H?(h.activing={point:H[0]},H.length>1&&(H.splice(0,1),h.activing.selections=H)):h.activing=null,h.editing=null):H&&(y=H.indexOf(V.point))>=0?(H.length>1?H.splice(y,1):delete h.activing.selections,h.editing=null):H?(H.push(j),h.activing={point:V.point,selections:H}):h.activing={point:V.point,selections:[j]};else if(H)j===V.point||((y=H.indexOf(V.point))>=0?(H.splice(y,1,j),h.activing={point:V.point,selections:H}):h.activing={point:V.point});else{var r;j===V.point&&(r=h.activing.status),h.activing={point:V.point},r&&(h.activing.status=r)}l.fi({kind:"beginEditPoint",event:i})}},Tk.prototype.insertKnot=function(){var l=this,p=l.highlight,m=l.screenInfo.curve;m.insertKnot(p.bezier,p.point.t),l._writeToHt()},Tk.prototype._writeToHt=function(){var b,W,D=this,C=D.screenInfo.curve,O=C.toHtShape(),N=O.points,$=[],A=O.segments,P=D._interactor.gv;P.dm().beginTransaction();var d,G,F=D.target,U=F instanceof B.Edge,I=me.getDataMatrix(F).invert();G=F instanceof B.Polyline||U&&D._interactor.getStyle("edgeElevationEditable"),G&&(d=F.getElevation&&F.getElevation()||0);for(var p=0,x=N.length;x>p;p++)b=N[p],W=me.toWorldPosition(P,b),W=I.apply(W),isFinite(b.e)&&b.e!==d&&(W.e=b.e),$.push(W);if(F._writing=!0,U){F.s("edge.type","points"),F.setStyle("edge.segments",A),F.setStyle("edge.points",$.slice(1,$.length-1)),F.setStyle("edge.source.offset.x",0),F.setStyle("edge.source.offset.y",0),F.setStyle("edge.target.offset.x",0),F.setStyle("edge.target.offset.y",0);var H=D._nextChangeEdgeHost;delete D._nextChangeEdgeHost,H&&("source"===H.type?F.setSource(H.host):F.setTarget(H.host)),D._writeEdgeHostAnchor("source",$[0]),D._writeEdgeHostAnchor("target",$[$.length-1])}else $.length?(F.setSegments(A),F.setPoints($,!0)):F.removeFromDataModel();P.dm().endTransaction(),delete F._writing},Tk.prototype._writeEdgeHostAnchor=function(b,T){var a=this,M=a.target,Z=a._calcHostAnchor(M,b,T);Z.index!==z?(M.setStyle("edge."+b+".index",Z.index),M.setStyle("edge."+b+".percent",z),M.setStyle("edge."+b+".anchor.x",z),M.setStyle("edge."+b+".anchor.y",z),M.setStyle("edge."+b+".anchor.elevation",z),M.setStyle("edge."+b+".offset.elevation",T.e)):Z.percent!==z?(M.setStyle("edge."+b+".percent",Z.percent),M.setStyle("edge."+b+".index",z),M.setStyle("edge."+b+".anchor.x",z),M.setStyle("edge."+b+".anchor.y",z),M.setStyle("edge."+b+".anchor.elevation",z),M.setStyle("edge."+b+".offset.elevation",T.e)):(M.s("edge."+b+".anchor.x",Z.x),M.s("edge."+b+".anchor.y",Z.y),M.s("edge."+b+".anchor.elevation",Z.e),Z.offsetX||Z.offsetY||Z.offsetElevation?(M.s("edge."+b+".offset.x",Z.offsetX),M.s("edge."+b+".offset.y",Z.offsetY),M.s("edge."+b+".offset.elevation",Z.offsetElevation)):(M.s("edge."+b+".offset.x",0),M.s("edge."+b+".offset.y",0),M.s("edge."+b+".offset.elevation",0)))},Tk.prototype._calcHostAnchor=function(s,x,j,E){E||(E="source"===x?s.getSource():s.getTarget());var n=this._interactor.gv,N=n.calculateAttachPoint(E,j);if(N)return N.info;if(kh(E)){var R=n.calculateEdgePosition(E,j);return R}var J=E.getRotation(),W=E.getAnchor();ke(E,n)&&(J=0);var F=E.getElevation(),I=E.getTall()*E.getScaleTall();F=((j.e||0)-s.s("edge."+x+".offset.elevation")-F)/I+.5;var m=E.getScale();if(J||m.x<0||m.y<0){var o=E.getMatrix(),H=o.tfi(j),O=E.getSize();return{x:H.x/O.width+W.x,y:H.y/O.height+W.y,e:F}}var d=Qj(n,E),M={x:(j.x-d.x)/d.width,y:(j.y-d.y)/d.height,e:F};return M},Tk.prototype._handlePanning=function(h){var G=this,n=G._pan;if(n){n.started=!0;var D=G._interactor,Q=D.gv,z=D._lastClientPoint,u=Po(h),T=tn(Q,u,z);Q.setTranslate(n.tx+T.x,n.ty+T.y),G.gatherSingleTarget(D.gv,G.target),D._42(),D.fi({kind:"betweenPan",event:h})}},Tk.prototype.handleEdit=function(L,i){var $=this,D=$.editing;if($._pan)return $._handlePanning(i),void 0;if($._multiSelect)return $._multiSelect.endPoint=L.lp(i),$._interactor.redraw(),void 0;if(D){D.inEdit=!0;var h,j,e,F=$._interactor._getLogicalPoint(i),H=B.Default.isCtrlDown(i),K=B.Default.isShiftDown(i),O=D.type,t=$.activing;if($._guideInfo=null,"ctrlPoint"===O&&K){var q=$.editing.direction.clone();h=t.point;var P=q.dot(F.clone().sub(h));F=q.setLength(P).add(h)}else if("ctrlPoint"===O||"realPoint"===O){var q;if("realPoint"===O&&K){var k=$.editing.shiftGuide;j=k.point;var y=Math.abs(F.x-j.x),o=Math.abs(F.y-j.y);y>o&&y>k.limit&&"y"===k.dir&&(k.dir="x"),o>y&&o>k.limit&&"x"===k.dir&&(k.dir="y"),q=k.dir,"x"===q?(F.y=j.y,k.limit=Math.max(k.limit,y)):"y"===q&&(F.x=j.x,k.limit=Math.max(k.limit,o))}if(!H){var n,G=$._isEditEdgeSourceTarget();G&&(n=F.clone());var r=$._guidingToEdit(F,q),C="realPoint"===O?$._interactor.gridGuide.findClosest(F,q,!0):null,Z=1/0,u=1/0;C&&(C.x&&(Z=C.x),C.y&&(u=C.y));var w=!1;if(r&&(r.xList&&(Math.abs(r.x)<=Math.abs(Z)?(w=!0,Z=r.x):delete r.xList),r.yList&&(Math.abs(r.y)<=Math.abs(u)?(w=!0,u=r.y):delete r.yList),w&&($._guideInfo=r)),isFinite(Z)&&(F.x+=Z),isFinite(u)&&(F.y+=u),w&&(r.v=F),G){var R=w?F.clone():null;F.copy(n);var m=$._editEdgeSourceTarget(G,F,H,R);m&&($.edgeEditResult=m,e=m.tipText,m.isFixed&&($._guideInfo=null))}}}var T=$.screenInfo.curve;if("realPoint"===D.type){h=D.point,h.e!==z&&(F.e=h.e),T.moveRealPoint(h,F),D.point=F,$.highlight.point=F;var V=t.status,v=t.selections;if($.activing={point:F,status:V},v){var p=F.clone().sub(h),c=0;v.forEach(function(h){var y=h.clone().add(p);T.moveRealPoint(h,y),v[c++]=y}),$.activing.selections=v}}else if("ctrlPoint"===D.type){var J=t.pairs,g=J[D.pairId];T.moveCtrlPoint(g,F,D.ctrlType);var b=t.status,f=me.Curve.PointType;if((b===f.Mirrored||b===f.Asymmetric)&&g.c1&&g.c2){var h=new me.Math.Vector2(t.point),Y="c1"===D.ctrlType?"c2":"c1";if(b===me.Curve.PointType.Mirrored)T.moveCtrlPoint(g,h.clone().multiplyScalar(2).sub(F),Y);else if(b===f.Asymmetric){var P=g[Y].clone().sub(h).length(),M=h.clone().sub(g[D.ctrlType]).setLength(P).add(h);isNaN(M.x)||T.moveCtrlPoint(g,M,Y)}}t._firePointChange()}else if("elevation"===D.type){j=D.startPoint;var X=j.e+(j.y-F.y)/L._zoom;$._setCurrentPointImpl("e",X),t._firePointChange(),e="E: "+me.toFixed(X)}var A=B.Default.getLogicalPoint(i,$._interactor._canvas);if(A.x+=me.Icons.TipShiftX,A.y+=me.Icons.TipShiftY,!e){var U=me.toWorldPosition(L,F);e=""+me.toFixed(U.x)+", "+me.toFixed(U.y)}$.tipInfo={helperPos:A,text:e,size:e.length},$._writeToHt(),$._interactor.fi({kind:"betweenEditPoint",event:i})}},Tk.prototype._setCurrentPointImpl=function(y,M){var n=this,u=n._activing;if(!u)return!1;var B=n.target;if(!B)return!1;var U=u.getCurrentEditingPoint();if(!U)return!1;var t=u.editingCtrl;if(!t)var j=U.clone();if("e"===y)U.e=M;else{var Q;if("x"===y||"y"===y){var T=u._lastFirePoint;Q="x"===y?{x:M,y:T?T.y:0}:{x:T?T.x:0,y:M}}else"object"==typeof y?(Q=y,y.e!==z&&(U.e=y.e)):(Q={x:arguments[0],y:arguments[1]},arguments[2]!==z&&(U.e=arguments[2]));var r=me.getDataMatrix(B);Q=me.toScreenPosition(n._interactor.gv,r.apply(Q)),U.x=Q.x,U.y=Q.y}if(!t){var D=j.multiplyScalar(-1).add(U);gs(U.e)&&gs(j.e)&&(D.e=U.e-j.e);var E=n.screenInfo.curve;E.moveCtrlDueToRealPointMovement(U,D);var J=u.selections;if(J){var w=0;J.forEach(function(q){var b=q.clone().add(D);isFinite(D.e)&&(b.e=(isFinite(q.e)?q.e:B.getElevation()||0)+D.e),E.moveRealPoint(q,b),J[w++]=b}),u.selections=J}}return!0},Tk.prototype.setCurrentPoint=function(U,c){return this._setCurrentPointImpl(U,c)?(this._writeToHt(),!0):!1},Tk.prototype._isEditEdgeSourceTarget=function(){var J=this,m=J.target;if(!(m instanceof B.Edge))return!1;var L=J.editing.point,d=J.screenInfo.curve._curves;return L===d[0]._p1?"source":L===d[d.length-1]._p4?"target":!1},Tk.prototype._editEdgeSourceTarget=function(I,r,$,t){var G,y=this,c=y.target;if(G="source"===I?c.getSource():c.getTarget()){var K,v=y._interactor.gv,p=me.toWorldPosition(v,r),U=y._calcHostAnchor(c,I,p,G);if(K=U.index!==z||U.percent!==z?U.distance*v.getZoom()>y._interactor.getStyle("edgeHostEdgeMaxDistance"):y._interactor.getStyle("edgeHostDetectPerFrame")?!0:U.x<0||U.x>1||U.y<0||U.y>1?!0:!1){var g=v.getDataAt(p,function(F){return v.isSelectable(F)?v.isSourceTargetEditable(c,F,I)?c.canSetSourceTarget(F,I)?!0:!1:!1:!1});if(g){var V=y._calcHostAnchor(c,I,p,g);G=g,y._nextChangeEdgeHost={type:I,host:g},U=V}}var h,b,o,X=!1;if($||U.x===z)(U.percent!==z||U.index!==z)&&(X=!0,b=U.point);else{var m=y._interactor.getStyle("anchorRound"),k=y._interactor.getStyle("anchorSensitivity");h=v.calculateAttachPoint(G,p),h?(U=h.info,X=!0):(t&&(U=y._calcHostAnchor(c,I,me.toWorldPosition(v,t),G)),U.x=me.roundTo(U.x,m,k),U.y=me.roundTo(U.y,m,k)),b=Hj(v,G,0,U.offsetX||0,U.offsetY||0,U.x,U.y)}b&&(o=me.toScreenPosition(v,b),r.x=o.x,r.y=o.y),y._edgeHostGuideInfo={corners:me.getTargetCornersOnScreen(v,G),attach:h?h.index:-1,host:G};var f;return U.percent!==z?f="percent: "+U.percent.toFixed(2):U.index!==z?f="index: "+U.index:(f=""+U.x.toFixed(2)+", "+U.y.toFixed(2),(U.offsetX||U.offsetY)&&(f+=" offset: "+U.offsetX.toFixed(2)+", "+U.offsetY.toFixed(2))),{host:G,anchor:U,tipText:f,isFixed:X}}},Tk.prototype._guidingToEdit=function(J,i){var h,F,U=this;if(h=U.screenInfo.curve){F=h._curves;var S,y,I,$,Y,e,P,f,s=1/0,E=1/0,w=[];for(U.editing&&"realPoint"===U.editing.type&&(f=U.editing.point),Y=0,e=2*F.length;e>Y;Y++)P=F[Math.floor(Y/2)][Y%2?"_p4":"_p1"],w.indexOf(P)>=0||(w.push(P),f&&f===P||(I=P.x-J.x,$=P.y-J.y,Math.abs(I)<Math.abs(s)?(s=I,S=[P]):I===s&&S.push(P),Math.abs($)<Math.abs(E)?(E=$,y=[P]):$===E&&y.push(P)));var n=U._interactor.getStyle("smartGuideThreshold");if((Math.abs(s)>n||"y"===i)&&(S=null),(Math.abs(E)>n||"x"===i)&&(y=null),S||y){var u=!1,W={};if(S&&(u=!0,W.xList=S,W.x=s),y&&(u=!0,W.yList=y,W.y=E),u)return W}}},Tk.prototype._46O=function(k){var u=this;u.editing&&(u.editing=null,u._interactor.fi({kind:"endEditPoint",event:k})),u._guideInfo=null,u._edgeHostGuideInfo=null,u._pan&&(u._pan=null,u._interactor.fi({kind:"endPan",event:k})),u._multiSelect&&(u._handleMultiSelect(u._multiSelect,k),u._multiSelect=null),u.tipInfo=null,u.edgeEditResult=null},Tk.prototype._handleMultiSelect=function(I,t){if(I.startPoint&&I.endPoint){var Z,d,T,K,S,b,m=this,c=m._interactor,Y=c.gv,D=me.toScreenPosition(Y,I.startPoint),y=me.toScreenPosition(Y,I.endPoint),F=B.Default.unionPoint(D,y),w=m.screenInfo.curve._curves,L=[],i=function(u){u.x>=F.x&&u.y>=F.y&&u.x<=F.x+F.width&&u.y<=F.y+F.height&&L.indexOf(u)<0&&L.push(u)};for(Z=0,d=w.length;d>Z;Z++)S=w[Z],i(S._p1),i(S._p4);if(L.length){var q=m.activing||{},e=q.selections||[];q.point&&e.push(q.point);var J=B.Default.isShiftDown(t),$=t.altKey;if($&&!J)for(b=L,L=[],Z=0,d=b.length;d>Z;Z++)T=b[Z],K=e.indexOf(T),K>=0&&L.push(T);for(Z=0,d=e.length;d>Z;Z++)T=e[Z],K=L.indexOf(T),K>=0?(!J||J&&$)&&(L[K]=z):L.push(T);for(b=L,L=[],Z=0,d=b.length;d>Z;Z++)b[Z]&&L.push(b[Z]);d=L.length,0===d?m.activing=null:1===d?m.activing={point:L[0]}:(T=L[d-1],m.activing={point:T,selections:L.splice(0,d-1)}),c.redraw()}}},Tk.prototype._canDeletePoint=function(g,$){var U=this.target;if(!(U instanceof B.Edge))return!0;var b=g._curves[0],z=g._curves[g._curves.length-1];return b._p1===$||z._p4===$?!1:!0},Tk.prototype.handleDelete=function(){var P=this;if(P.activing&&P.screenInfo){var b=B.Default.isShiftDown(),H=P.screenInfo.curve;P._canDeletePoint(H,P.activing.point)&&H.deleteRealPoint(P.activing.point,b),P.activing.selections&&P.activing.selections.forEach(function(g){P._canDeletePoint(H,g)&&H.deleteRealPoint(g,b)}),P.activing=null,delete P.editing,delete P.tipInfo,delete P.edgeEditResult,delete P._pan,delete P._multiSelect,P._writeToHt(),P._interactor.fp("deleteShapePoint",!1,!0)}},Tk.prototype.handleDoubleClick=function(H){var o=this,F=o._interactor._getLogicalPoint(H);if(o.screenInfo&&o._checkEditRealPoint(F)){var k=o.getCurrentSelectintStatus(),I=me.Curve.PointType;return k=k===I.Mirrored?I.Straight:I.Mirrored,o._setCurrentSelectionStatus(k),o._interactor._42(),!0}},Tk.prototype._drawHighlight=function(l){var J=this,w=J.highlight;if(w){var Q=w.bezier,n=J._interactor;Q&&me.Icons.DrawIcon(n,l,me.Icons.ShapeHighlightCurve,[Q._p1.x,Q._p1.y,Q._p2.x,Q._p2.y,Q._p3.x,Q._p3.y,Q._p4.x,Q._p4.y]);var a=w.point;a&&"insertKnot"===w.type&&me.Icons.DrawIcon(n,l,me.Icons.ShapeHighlighPoint,a)}},Tk.prototype._drawGuide=function(n){var P=this,F=P._guideInfo;if(F){var u,M,v,y,I=F.v;for(u=0;2>u;u++)if(y=0===u?F.xList:F.yList)for(M=0,v=y.length;v>M;M++)me.Icons.DrawIcon(P._interactor,n,me.Icons.ShapeGuideLine,[I.x,I.y,y[M].x,y[M].y])}},Tk.prototype._drawCurrentPoint=function(H){var Q=this;if(Q.activing){var X=Q.activing,D=Q.getCurrentSelectintStatus(),v=Q._interactor;if(D!==me.Curve.PointType.Straight){var P=X.pairs;X.hlpair,X.hltype;var C=X.selections,f=X.editingCtrl;if(P&&!C){var $,x,q;for(x=0,q=P.length;q>x;x++)$=P[x],f&&x===f.pairId&&$[f.type]?me.Icons.DrawIcon(v,H,me.Icons.ShapeActivingCtrl,{point:$.point,c1:$.c1,c2:$.c2,hl:f.type}):me.Icons.DrawIcon(v,H,me.Icons.ShapeActivingCtrl,$)}}me.Icons.DrawIcon(v,H,me.Icons.ShapeHighlighRealPoint,Q.activing.point),C&&C.forEach(function(b){me.Icons.DrawIcon(v,H,me.Icons.ShapeHighlighRealPoint,b)})}},Tk.prototype.clear=function(){var n=this;n.editing=null,n._guideInfo=null,n.activing=null,n.highlight=null},Tk.prototype._42=function(v){var c=this;c.info={},c.editing||(c.screenInfo=null);var r=c._interactor;if(!r.editDetail)return c.clear(),void 0;var g=r.gv;if(!c.target||!g.isSelected(c.target)||!g.isVisible(c.target))return r.editDetail=!1,c.clear(),void 0;if(c.gatherSingleTarget(g,c.target),me.Icons.DrawIcon(r,v,me.Icons.ShapeBgCurve,c.screenInfo),c._interactor.getStyle("curveElevationVisible")&&(c.target instanceof B.Polyline||c.target instanceof B.Edge&&c._interactor.getStyle("edgeElevationEditable"))&&c.activing){var e=c.activing.getCurrentEditingPoint();e&&"string"!=typeof e.e&&me.Icons.DrawIcon(r,v,me.Icons.EdgeElevationGuide,e)}if(c._drawHighlight(v),c._drawCurrentPoint(v),c._getRealPoint().forEach(function(q){me.Icons.DrawIcon(r,v,me.Icons.ShapePoint,q)}),c._drawGuide(v),c.tipInfo&&c._interactor.getStyle("curveTipVisible")&&me.Icons.DrawIcon(r,v,me.Icons.TipHelper,c.tipInfo),c._edgeHostGuideInfo&&r._drawHostGuide(c._edgeHostGuideInfo),c.edgeEditResult&&c._drawEdgeHostHighlight(v,c.edgeEditResult.host,c.edgeEditResult.anchor),c._multiSelect&&c._multiSelect.endPoint){var n=B.Default.unionPoint(me.toScreenPosition(g,c._multiSelect.startPoint),me.toScreenPosition(g,c._multiSelect.endPoint));n.color=g.getRectSelectBorderColor(),v.save(),v.setTransform(1,0,0,1,0,0);var s=R.devicePixelRatio,h=n.borderWidth=Math.round(s);h/=2,n.x=Math.round(n.x*s)+h,n.y=Math.round(n.y*s)+h,n.width=Math.round(n.width*s),n.height=Math.round(n.height*s),me.Icons.DrawIcon(r,v,me.Icons.SimpleRect,n),v.restore()}},Tk.prototype._drawEdgeHostHighlight=function(x,s,y){this.drawEdgeHostHighlight(x,s,y),this._interactor.redraw()},Tk.prototype.drawEdgeHostHighlight=function(_,P,H){if(kh(P)){var k,o,C,l,N=this,L=N._interactor,w=L.gv,v=w.getDataUI(P),b=Re(v),p=[];for(C=0,l=b.points.length;l>C;C++)o=me.toScreenPosition(w,b.points.get(C)),p.push(o.x,o.y);b.segments&&(k=b.segments.toArray());var q=L.getStyle("edgeHostHighlighPeriod"),B=L.getStyle("edgeHostEdgeHighlighColor");me.Icons.DrawIcon(L,_,me.Icons.ShapeBgCurve,{P:p,S:k,color:B,dynamicVisible:H.index===z,dynamicPeriod:q}),B=L.getStyle("edgeHostPointHighlighColor");var r=Gq(v);for(C=0,l=r.length;l>C;C++){var K=r[C],Z=me.toScreenPosition(w,K);me.Icons.DrawIcon(L,_,me.Icons.ShapePoint,{point:{x:Z.x,y:Z.y},color:B,size:12,dynamicVisible:C===H.index,dynamicPeriod:q})}}},Tk.prototype._getRealPoint=function(){var Q,K=this.screenInfo,O=K.P,o=K.S,j=-1,E=[],G=-1,z=o.length;return o.each(function(R){G++;var Z=1;if(3===R)Z=2;else if(4===R)Z=3;else if(5===R)return;j+=Z,Q=G+1>=z?!0:1===o.get(G+1)?!0:!1,E.push({point:{x:O[2*j],y:O[2*j+1]},segmentIndex:G,pointIndex:j,isEnd:Q})}),E},Tk.prototype.getEditingPointsInfo=function(G){var O=this,d=O.activing;if(!d)return!1;var Z=d.point;if(!Z)return!1;var L=this._getRealPoint(),z=[{screen:Z}];d.selections&&d.selections.forEach(function(Q){z.push({screen:Q})});var n,q,x=L.length;return z.forEach(function(f){for(n=0;x>n;n++)if(q=L[n],f.screen.isNearEnough(q.point)){f.segmentIndex=q.segmentIndex,f.pointIndex=q.pointIndex,f.point=O.target.getPoints().get(q.pointIndex);break}}),G&&z.sort(function(l,P){return l.segmentIndex-P.segmentIndex}),z};var Ck=me.MoveHelper=function(V){var C=this;C.catalog="Move",C._interactor=V};Ck.prototype={},Ck.prototype.constructor=Ck,Ck.prototype.calcShift=function(w,T,v){var _,i,s=this,Q=s._interactor.gv,P=Q.lp(T);if("beginMove"===w&&s._gatherGridInfo(v._lastLogicalPoint||P),_=s._target){var j=_.downPosition;if(j){var N=s._interactor.getStyle("moveSensitivity")/Q._zoom;if(j.distanceTo(P)<N)return{x:0,y:0};delete _.downPosition}var M;i=B.Default.isShiftDown(T),i&&(P=s._dealShiftDown(P),M=_.shiftGuide.dir);var p,g=_.rawPos={x:_.pos.x+P.x-_.lp.x,y:_.pos.y+P.y-_.lp.y};if(B.Default.isCtrlDown(T)){if(p=s._calcShiftByAddon(),s._target.node instanceof me.Group){var k=s._target.node;k._position.x+=p.x,k._position.y+=p.y}return p}var D=s._interactor.rectGuide;if(_.node instanceof B.Data&&_.node.s("2d.attachable")){var u=s._calcAttachNodeShift(_.node,g);
if(D.clear(),u)return u}for(var I,V=_.x+g.x,z=_.y+g.y,m={x:V,y:z},Z={x:V+_.w/2,y:z+_.h/2},a={x:V+_.w,y:z+_.h},O=s._interactor.gridGuide,A=[D.findClosest(m,M),D.findClosest(Z,M),D.findClosest(a,M),O.findClosest(m,M),O.findClosest(Z,M),O.findClosest(a,M)],c=1/0,G=1/0,C=0,r=A.length;r>C;C++)I=A[C],I&&(V=I.x,z=I.y,isFinite(V)&&Math.abs(V)<Math.abs(c)&&(c=V),isFinite(z)&&Math.abs(z)<Math.abs(G)&&(G=z));if(isFinite(c)||(c=0),isFinite(G)||(G=0),p=s._calcShiftByAddon(c,G),s._target.node instanceof me.Group){var k=s._target.node;k._position.x+=p.x,k._position.y+=p.y}var x=_.node;if(!ke(x,Q)){var E=g.x+c,W=g.y+G;s._interactor.rectGuide.gatherLines({node:x,x:_.x+E,y:_.y+W,w:_.w,h:_.h},M)}return p}},Ck.prototype._calcShiftByAddon=function(k,p){var j=this._target,l=j.rawPos,r=j.node.getPosition();return k=k||0,p=p||0,{x:l.x-r.x+k,y:l.y-r.y+p}},Ck.prototype._dealShiftDown=function(r){var s=this,T=s._target.shiftGuide,u=s._target.lp,N=Math.abs(r.x-u.x),q=Math.abs(r.y-u.y);N>q&&N>T.limit&&"y"===T.dir&&(T.dir="x"),q>N&&q>T.limit&&"x"===T.dir&&(T.dir="y");var x=T.dir;return"x"===x?(r.y=u.y,T.limit=Math.max(T.limit,N)):"y"===x&&(r.x=u.x,T.limit=Math.max(T.limit,q)),r},Ck.prototype._isAttachableLineShape=function(L){if(!L.getSegments)return!1;var R=L.getSegments();if(!R)return!0;R instanceof B.List&&(R=R.getArray());for(var $=1,T=R.length;T>$;$++)if(2!==R[$])return!1;return!0},Ck.prototype._calcAttachNodeShift=function(){var j=new wc,t=new wc,Y=new wc,d=new wc;return function(Q,a){var K=this._interactor.gv,O=Q.getHost(),T=K.getDataAt(a,function(I){return I.s("2d.hostable")?!0:!1});if(T&&O!==T&&Q.setHost(T),!T)return this._edgeHostGuideInfo=null,Q.setHost(null);var I=this._edgeHostGuideInfo={corners:me.getTargetCornersOnScreen(K,T),host:T,attach:-1};if(this._isAttachableLineShape(T)){for(var v,R,k,z,r,o,E=T.getPoints(),e=E.size(),_=T.getPointsMatrix2d(),V=1/0,p=0;e>p&&(p!==e-1||T.isClosePath());p++)0!==p?t.copy(Y):_.apply(E.get(p),t),_.apply(p===e-1?E.get(0):E.get(p+1),Y),j.copy(a).sub(t),d.copy(Y).sub(t),v=d.length(),d.divideScalar(v),R=j.dot(d),0>R?R=0:R>v&&(R=v),d.multiplyScalar(R).add(t),k=j.copy(a).sub(d).lengthSq(),V>k&&(V=k,o=p,z=R,r=v);return Math.sqrt(V)*K.getZoom()>this._interactor.getStyle("attachThreshold")?(Q.s({"attach.index":-1}),Q.setHost(null),void 0):(Q.s("attach.offset.opposite")&&(z=r-z),Q.s({"attach.index":o,"attach.offset":Q.s("attach.offset.relative")?z/r:z}),{x:0,y:0})}var N=K.calculateAttachPoint(T,a);if(N){var f=N.point;return I.attach=N.index,this._calcShiftByAddon(f.x-a.x,f.y-a.y)}}}(),Ck.prototype._gatherGridInfo=function(p){var _,c=this,f=c._interactor,R=f._getValidSelection();if(R.length){if(1===R.length){if(_=R[0],!_.getRect)return c._target=null,void 0}else if(_=me.Group.findOrCreateGroup(R,f._uuid),!_)return c._target=null,void 0}else{var R=f.gv.sm().getSelection();if(R.length&&(_=R.get(0),!_.getRect))return c._target=null,void 0}if(_){var m=_.getPosition(),$=_.getRect();c._target={node:_,x:$.x-m.x,y:$.y-m.y,w:$.width,h:$.height,lp:{x:p.x,y:p.y},pos:{x:m.x,y:m.y},shiftGuide:{dir:"x",limit:0},downPosition:new me.Math.Vector2(p)},f.rectGuide.gatherRects()}},Ck.prototype.clear=function(){var z=this;z._edgeHostGuideInfo=null,z._interactor.rectGuide.clear(),z._interactor._42()},Ck.prototype._42=function(){var A=this._edgeHostGuideInfo;A&&this._interactor._drawHostGuide(A)};var Te=T.freeze({DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,HALF_FLOAT_OES:36193,DOUBLE:5130,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,COLOR:6144,DEPTH:6145,STENCIL:6146,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,MAX_3D_TEXTURE_SIZE:32883,UNSIGNED_INT_2_10_10_10_REV:33640,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,MAX_TEXTURE_LOD_BIAS:34045,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,VERTEX_ATTRIB_ARRAY_INTEGER:35069,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,UNSIGNED_INT_10F_11F_11F_REV:35899,RGB9_E5:35901,UNSIGNED_INT_5_9_9_9_REV:35902,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,RASTERIZER_DISCARD:35977,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,UNSIGNED_INT_24_8:34042,DEPTH24_STENCIL8:35056,UNSIGNED_NORMALIZED:35863,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,MAX_SAMPLES:36183,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,VERTEX_ARRAY_BINDING:34229,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,SIGNED_NORMALIZED:36764,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,INVALID_INDEX:4294967295,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,SAMPLER_BINDING:35097,RGB10_A2UI:36975,INT_2_10_10_10_REV:36255,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497,TEXTURE_IMMUTABLE_FORMAT:37167,MAX_ELEMENT_INDEX:36203,TEXTURE_IMMUTABLE_LEVELS:33503,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047}),Jj=function(){function A(c,v){var T=z;return function(){return T||(T=c.getExtension(v)),T}}function v(P,G){G==z&&(G={}),G.version=Y&&(P instanceof WebGL2RenderingContext||T.prototype.toString.call(P)===W)?2:1,G.extensions=function(){for(var Q={},L=P.getSupportedExtensions(),c=L.length;c--;)Q[L[c]]=A(P,L[c]);return Q}();for(var S=T.keys(h),V=0,q=S.length;q>V;++V){var Q=S[V];G[Q]=P.getParameter(h[Q])}if(G.version>1){S=T.keys(L);for(var V=0,q=S.length;q>V;++V){var Q=S[V];G[Q]=P.getParameter(L[Q])}}return G}var Y="undefined"!=typeof WebGL2RenderingContext,W="[object WebGL2RenderingContext]",h={aliasedLineWidthRange:Te.ALIASED_LINE_WIDTH_RANGE,aliasedPointSizeRange:Te.ALIASED_POINT_SIZE_RANGE,maxCombinedTextureImageUnits:Te.MAX_COMBINED_TEXTURE_IMAGE_UNITS,maxCubeMapTextureSize:Te.MAX_CUBE_MAP_TEXTURE_SIZE,maxFragmentUniformVectors:Te.MAX_FRAGMENT_UNIFORM_VECTORS,maxRenderBufferSize:Te.MAX_RENDERBUFFER_SIZE,maxTextureImageUnits:Te.MAX_TEXTURE_IMAGE_UNITS,maxTextureSize:Te.MAX_TEXTURE_SIZE,maxVaryingVectors:Te.MAX_VARYING_VECTORS,maxVertexAttribs:Te.MAX_VERTEX_ATTRIBS,maxVertexTextureImageUnits:Te.MAX_VERTEX_TEXTURE_IMAGE_UNITS,maxVertexUniformVectors:Te.MAX_VERTEX_UNIFORM_VECTORS,maxViewportDIMs:Te.MAX_VIEWPORT_DIMS},L={max3DTextureSize:Te.MAX_3D_TEXTURE_SIZE,maxArrayTextureLayers:Te.MAX_ARRAY_TEXTURE_LAYERS,maxColorAttachments:Te.MAX_COLOR_ATTACHMENTS,maxCombinedFragmentUniformComponents:Te.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS,maxCombinedUniformBlocks:Te.MAX_COMBINED_UNIFORM_BLOCKS,maxCombinedVertexUniformComponents:Te.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS,maxDrawBuffers:Te.MAX_DRAW_BUFFERS,maxElementIndex:Te.MAX_ELEMENT_INDEX,maxElementsIndices:Te.MAX_ELEMENTS_INDICES,maxElementsVertices:Te.MAX_ELEMENTS_VERTICES,maxFragmentInpuComponents:Te.MAX_FRAGMENT_INPUT_COMPONENTS,maxFragmentUniformBlocks:Te.MAX_FRAGMENT_UNIFORM_BLOCKS,maxFragmentUniformComponents:Te.MAX_FRAGMENT_UNIFORM_COMPONENTS,maxProgramTexelOffset:Te.MAX_PROGRAM_TEXEL_OFFSET,maxSamples:Te.MAX_SAMPLES,maxTextureLODBias:Te.MAX_TEXTURE_LOD_BIAS,maxTransformFeedbackInterleavedComponents:Te.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS,maxTransformFeedbackSeparateAttribs:Te.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS,maxTransformFeedbackSeparateComponents:Te.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS,maxUniformBlockSize:Te.MAX_UNIFORM_BLOCK_SIZE,maxUniformBufferBindings:Te.MAX_UNIFORM_BUFFER_BINDINGS,maxVaryingComponents:Te.MAX_VARYING_COMPONENTS,maxVertexOutputComponents:Te.MAX_VERTEX_OUTPUT_COMPONENTS,maxVertexUniformBlocks:Te.MAX_VERTEX_UNIFORM_BLOCKS,maxVertexUniformComponents:Te.MAX_VERTEX_UNIFORM_COMPONENTS,minProgramTexelOffset:Te.MIN_PROGRAM_TEXEL_OFFSET};return{"for":function(f){var c=f._info;return c||(f._info=c=v(f,c)),c}}}(),So=function(){function X(j,O,V){return{def:j,getter:V?function(P){var p=Jj.for(P);return p.version>1?P.getParameter(O):j}:function(g){return g.getParameter(O)},setter:V?function(V,g){var S=Jj.for(V);S.version>1&&V.pixelStorei(O,g)}:function(c,J){c.pixelStorei(O,J)}}}function B(S){return"string"==typeof S?$m(S):S.r!==z?(C[0]=S.r,C[1]=S.g,C[2]=S.b,C[3]=S.a,C):S.red!==z?(C[0]=S.red,C[1]=S.green,C[2]=S.blue,C[3]=S.alpha,C):S}function M(r){return A(r)?Array.prototype.slice.call(r,0):r}function q(I,P,i){this.gl=P,this._record=i||{},this._branches={},this._leafSync={},this._struct=I;for(var Z=I.children,a=Z.length;a--;){var N=Z[a],u=N.name;N.isLeaf?(this._leafSync[u]=!1,this._record[u]=M(N.desc.def)):this._record[u]={}}}function s(J){function R(x,d){q.call(this,J,x,d);for(var $=t.length;$--;){var s=t[$];this._branches[s._name]=new s._type(x,this._record[s._name])}}function a(J,l){function j(C,x){for(var m=X,Y=!1;m--;)C[m]!==x[m]&&(C[m]=x[m],Y=!0);return Y}var f=J.name,K=A(J.desc.def),X=K&&J.desc.def.length;if(J.isLeaf){var G=J.desc.setter,w=J.desc.parse;T.defineProperty(l,f,{configurable:!1,enumerable:!0,get:function(){return this._record[f]},set:K?function(r){w&&(r=w(r)),(j(this._record[f],r)||!this._leafSync[f])&&(G(this.gl,this._record[f]),this._leafSync[f]=!0)}:function(m){this._record[f]===m&&this._leafSync[f]||(G(this.gl,m),this._record[f]=m,this._leafSync[f]=!0)}})}else t.push({_name:f,_type:s(J)}),T.defineProperty(l,f,{configurable:!1,enumerable:!0,get:function(){return this._branches[f]},set:function(u){this._branches[f].apply(u)}})}var t=[];return O(R,q),J.forEach(a,R.prototype),R}var C="undefined"!=typeof Float32Array&&new Float32Array(4),r={viewport:{def:[0,0,0/0,0/0],getter:function(E){return E.getParameter(E.VIEWPORT)},setter:function(X,u){var i=u[2]!==u[2]?X.drawingBufferWidth-u[0]:u[2],O=u[3]!==u[3]?X.drawingBufferHeight-u[1]:u[3];X.viewport(u[0],u[1],i,O)}},dither:{def:!1,getter:function(n){return n.isEnabled(n.DITHER)},setter:function(l,X){X?l.enable(l.DITHER):l.disable(l.DITHER)}},rasterizerDiscard:{def:!1,getter:function(Y){var N=Jj.for(Y);return N.version>1&&Y.isEnabled(Y.RASTERIZER_DISCARD)},setter:function(v,o){var n=Jj.for(v);1!==n.version&&(o?v.enable(v.RASTERIZER_DISCARD):v.disable(v.RASTERIZER_DISCARD))}},lineWidth:{def:1,getter:function(g){return g.lineWidth?g.getParameter(g.LINE_WIDTH):1},setter:function(S,z){S.lineWidth&&S.lineWidth(z)}},color:{clear:{def:[0,0,0,0],getter:function(Z){return Z.getParameter(Z.COLOR_CLEAR_VALUE)},setter:function(S,C){S.clearColor(C[0],C[1],C[2],C[3])},parse:B},mask:{def:[!0,!0,!0,!0],getter:function(S){return S.getParameter(S.COLOR_WRITEMASK)},setter:function(N,g){N.colorMask(g[0],g[1],g[2],g[3])}}},blend:{enabled:{def:!1,getter:function(A){return A.isEnabled(A.BLEND)},setter:function(n,g){g?n.enable(n.BLEND):n.disable(n.BLEND)}},color:{def:[0,0,0,0],getter:function(O){return O.getParameter(O.BLEND_COLOR)},setter:function(h,U){h.blendColor(U[0],U[1],U[2],U[3])},parse:B},equation:{def:[Te.FUNC_ADD,Te.FUNC_ADD],getter:function($){return[$.getParameter($.BLEND_EQUATION_RGB),$.getParameter($.BLEND_EQUATION_ALPHA)]},setter:function(t,k){t.blendEquationSeparate(k[0],k[1])},parse:function(S){var p=S.length;return p>1?S:1===p?(C[1]=C[0]=S[0],C):(C[1]=C[0]=S,C)}},func:{def:[Te.ONE,Te.ZERO,Te.ONE,Te.ZERO],getter:function(g){return[g.getParameter(g.BLEND_SRC_RGB),g.getParameter(g.BLEND_DST_RGB),g.getParameter(g.BLEND_SRC_ALPHA),g.getParameter(g.BLEND_DST_ALPHA)]},setter:function(H,r){H.blendFuncSeparate(r[0],r[1],r[2],r[3])},parse:function(q){var k=q.length;return k>3?q:(C[2]=C[0]=q[0],C[3]=C[1]=q[1],C)}}},cullFace:{enabled:{def:!1,getter:function(w){return w.isEnabled(w.CULL_FACE)},setter:function(U,b){b?U.enable(U.CULL_FACE):U.disable(U.CULL_FACE)}},mode:{def:Te.BACK,getter:function(N){return N.getParameter(N.CULL_FACE_MODE)},setter:function(o,E){o.cullFace(E)}},frontFace:{def:Te.CCW,getter:function(f){return f.getParameter(f.FRONT_FACE)},setter:function(G,P){G.frontFace(P)}}},scissor:{enabled:{def:!1,getter:function($){return $.isEnabled($.SCISSOR_TEST)},setter:function(p,l){l?p.enable(p.SCISSOR_TEST):p.disable(p.SCISSOR_TEST)}},box:{def:[0,0,0/0,0/0],getter:function(b){return b.getParameter(b.SCISSOR_BOX)},setter:function(o,b){var V=b[2]!==b[2]?o.drawingBufferWidth-b[0]:b[2],M=b[3]!==b[3]?o.drawingBufferHeight-b[1]:b[3];o.scissor(b[0],b[1],V,M)}}},depth:{enabled:{def:!1,getter:function(J){return J.isEnabled(J.DEPTH_TEST)},setter:function(u,X){X?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST)}},clear:{def:1,getter:function(x){return x.getParameter(x.DEPTH_CLEAR_VALUE)},setter:function(f,y){f.clearDepth(y)}},mask:{def:!0,getter:function(F){return F.getParameter(F.DEPTH_WRITEMASK)},setter:function(E,y){E.depthMask(y)}},range:{def:[-1,1],getter:function(X){return X.getParameter(X.DEPTH_RANGE)},setter:function(Z,f){Z.depthRange(f[0],f[1])}},func:{def:Te.LESS,getter:function(x){return x.getParameter(x.DEPTH_FUNC)},setter:function(T,A){T.depthFunc(A)}}},stencil:{enabled:{def:!1,getter:function(S){return S.isEnabled(S.STENCIL_TEST)},setter:function(o,G){G?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST)}},clear:{def:0,getter:function(x){return x.getParameter(x.STENCIL_CLEAR_VALUE)},setter:function(K,f){K.clearStencil(f)}},frontMask:{def:255,getter:function(u){return u.getParameter(u.STENCIL_WRITEMASK)},setter:function(Y,p){Y.stencilMaskSeparate(Y.FRONT,p)}},frontOp:{def:[Te.KEEP,Te.KEEP,Te.KEEP],getter:function(N){return[N.getParameter(N.STENCIL_FAIL),N.getParameter(N.STENCIL_PASS_DEPTH_FAIL),N.getParameter(N.STENCIL_PASS_DEPTH_PASS)]},setter:function(j,A){j.stencilOpSeparate(j.FRONT,A[0],A[1],A[2])}},frontFunc:{def:[Te.ALWAYS,0,255],getter:function(B){return[B.getParameter(B.STENCIL_FUNC),B.getParameter(B.STENCIL_REF),B.getParameter(B.STENCIL_VALUE_MASK)]},setter:function(Q,Y){Q.stencilFuncSeparate(Q.FRONT,Y[0],Y[1],Y[2])}},backMask:{def:255,getter:function(l){return l.getParameter(l.STENCIL_BACK_WRITEMASK)},setter:function(E,D){E.stencilMaskSeparate(E.BACK,D)}},backOp:{def:[Te.KEEP,Te.KEEP,Te.KEEP],getter:function(V){return[V.getParameter(V.STENCIL_BACK_FAIL),V.getParameter(V.STENCIL_BACK_PASS_DEPTH_FAIL),V.getParameter(V.STENCIL_BACK_PASS_DEPTH_PASS)]},setter:function(m,N){m.stencilOpSeparate(m.BACK,N[0],N[1],N[2])}},backFunc:{def:[Te.ALWAYS,0,255],getter:function(K){return[K.getParameter(K.STENCIL_BACK_FUNC),K.getParameter(K.STENCIL_BACK_REF),K.getParameter(K.STENCIL_BACK_VALUE_MASK)]},setter:function(o,z){o.stencilFuncSeparate(o.BACK,z[0],z[1],z[2])}}},hint:{generateMipmap:{def:Te.DONT_CARE,getter:function(k){return k.getParameter(k.GENERATE_MIPMAP_HINT)},setter:function(f,X){f.hint(f.GENERATE_MIPMAP_HINT,X)}},fragmentShaderDerivative:{def:Te.DONT_CARE,getter:function(f){var I=Jj.for(f);return 1!==I.version||I.extensions.OES_standard_derivatives?f.getParameter(Te.FRAGMENT_SHADER_DERIVATIVE_HINT):Te.DONT_CARE},setter:function(y,m){var b=Jj.for(y);return b.version>1||b.extensions.OES_standard_derivatives?(y.hint(Te.FRAGMENT_SHADER_DERIVATIVE_HINT,m),void 0):void 0}}},pixelStore:{packAlignment:X(4,Te.PACK_ALIGNMENT,!1),unpackAlignment:X(4,Te.UNPACK_ALIGNMENT,!1),unpackFlipY:X(!1,Te.UNPACK_FLIP_Y_WEBGL,!1),unpackPremultiplyAlpha:X(!1,Te.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),unpackColorspaceConversion:X(Te.BROWSER_DEFAULT_WEBGL,Te.UNPACK_COLORSPACE_CONVERSION_WEBGL,!1),packRowLength:X(0,Te.PACK_ROW_LENGTH,!0),packSkipPixels:X(0,Te.PACK_SKIP_PIXELS,!0),packSkipRows:X(0,Te.PACK_SKIP_ROWS,!0),unpackRowLength:X(0,Te.UNPACK_ROW_LENGTH,!0),unpackImageHeight:X(0,Te.UNPACK_IMAGE_HEIGHT,!0),unpackSkipPixels:X(0,Te.UNPACK_SKIP_PIXELS,!0),unpackSkipRows:X(0,Te.UNPACK_SKIP_ROWS,!0),unpackSkipImages:X(0,Te.UNPACK_SKIP_IMAGES,!0)},polygonOffset:{enabled:{def:!1,getter:function(f){return f.isEnabled(f.POLYGON_OFFSET_FILL)},setter:function(A,u){u?A.enable(A.POLYGON_OFFSET_FILL):A.disable(A.POLYGON_OFFSET_FILL)}},value:{def:[0,0],getter:function(t){return[t.getParameter(t.POLYGON_OFFSET_FACTOR),t.getParameter(t.POLYGON_OFFSET_UNITS)]},setter:function(i,B){i.polygonOffset(B[0],B[1])}}},sampleCoverage:{enabled:{def:!1,getter:function(c){return c.isEnabled(c.SAMPLE_COVERAGE)},setter:function(m,$){$?m.enable(m.SAMPLE_COVERAGE):m.disable(m.SAMPLE_COVERAGE)}},alpha:{def:!1,getter:function(F){return F.isEnabled(F.SAMPLE_ALPHA_TO_COVERAGE)},setter:function(O,P){P?O.enable(O.SAMPLE_ALPHA_TO_COVERAGE):O.disable(O.SAMPLE_ALPHA_TO_COVERAGE)}},value:{def:[1,!1],getter:function(k){return[k.getParameter(k.SAMPLE_COVERAGE_VALUE),k.getParameter(k.SAMPLE_COVERAGE_INVERT)]},setter:function(g,I){g.sampleCoverage(I[0],I[1])}}}},u=qq.create(r,function(u){return"def"in u});q.prototype.reset=function(){for(var W=this._struct.children,L=W.length;L--;){var n=W[L],i=n.name;n.isLeaf?this[i]=n.desc.def:this._branches[i].reset()}},q.prototype.save=function(j){j==z&&(j={});for(var R=this._struct.children,Q=R.length;Q--;){var u=R[Q],K=u.name;if(u.isLeaf)j[K]=M(this._record[K]);else{var v=j[K];v==z&&(j[K]=v={}),this._branches[K].save(v)}}return j},q.prototype.sync=function(Y,N){for(var c=this._struct.children,b=c.length;b--;){var m=c[b],o=m.name;m.isLeaf?(N||!this._leafSync[o])&&(Y?(this._record[o]=m.desc.getter(this.gl),this._leafSync[o]=!0):(m.desc.setter(this.gl,this._record[o]),this._leafSync[o]=!0)):this._branches[o].sync(Y,N)}},q.prototype.syncLoss=function(){for(var w=this._struct.children,W=w.length;W--;){var U=w[W];U.isLeaf?this._leafSync[U.name]=!1:this._branches[U.name].syncLoss()}},q.prototype.apply=function(w){for(var t=this._struct.children,T=t.length;T--;){var L=t[T],D=L.name;D in w&&(L.isLeaf?this[D]=w[D]:this._branches[D].apply(w[D]))}},q.prototype.append=function(e){var B=this._struct.childMap;for(var k in e){var P=B[k];P&&(P.isLeaf?this[k]=e[k]:this._branches[k].append(e[k]))}};var F=s(u);return function(L){var b=L._state;return b||(L._state=b=new F(L)),b}}(),Xi=function(){function s(p,b,M,x){if(p){var K=p.length;if(K!=z)for(var C=0;x>C;++C)b[M+C]=p[C];else p.toArray&&p.toArray(b,M)}else for(var C=0;x>C;++C)b[M+C]=0}function g(M,A,c){var N=M[0];if(0>=N||N>0)return M;var C=A*c,T=R[C];if(T==z&&(R[C]=T=new Float32Array(C)),0!==A){s(N,T,0,c);for(var n=1,E=0;n!==A;++n)E+=c,s(M[n],T,E,c)}return T}function v(H,F){H.uniform1f(this.addr,F)}function C(o,l){o.uniform1fv(this.addr,l)}function d(s,C){if(C.x!=z)s.uniform2f(this.addr,C.x,C.y);else{var O=R[2];O.set(C,0),s.uniform2fv(this.addr,O)}}function Y(l,p){l.uniform2fv(this.addr,g(p,this.size,2))}function _(A,r){if(r.x!=z)A.uniform3f(this.addr,r.x,r.y,r.z);else if(r.r!=z)A.uniform3f(this.addr,r.r,r.g,r.b);else if(r.red!=z)A.uniform3f(this.addr,r.red,r.green,r.blue);else{var u=R[3];u.set(r,0),A.uniform3fv(this.addr,u)}}function Q(I,v){I.uniform3fv(this.addr,g(v,this.size,3))}function F(w,X){if("string"==typeof X&&(X=$m(X)),X.x!=z)w.uniform4f(this.addr,X.x,X.y,X.z,X.w);else if(X.r!=z)w.uniform4f(this.addr,X.r,X.g,X.b,X.a);else if(X.red!=z)w.uniform4f(this.addr,X.red,X.green,X.blue,X.alpha);else{var P=R[4];P.set(X,0),w.uniform4fv(this.addr,P)}}function h(R,Q){R.uniform4fv(this.addr,g(Q,this.size,4))}function q(M,F){M.uniform1i(this.addr,F)}function G(g,A){g.uniform1iv(this.addr,A)}function Z(r,J){r.uniform2iv(this.addr,J)}function b(S,D){S.uniform3iv(this.addr,D)}function S(L,X){L.uniform4iv(this.addr,X)}function W(v,U){v.uniform1i(this.addr,H[U?1:0])}function n(Z,d){var $=R[4];$.set(d,0),Z.uniformMatrix2fv(this.addr,!1,$)}function r(M,_){M.uniformMatrix2fv(this.addr,!1,g(_,this.size,4))}function J(w,u){var i=R[9];i.set(u,0),w.uniformMatrix3fv(this.addr,!1,i)}function p(J,G){J.uniformMatrix3fv(this.addr,!1,g(G,this.size,9))}function c(o,Z){var D=R[16];D.set(Z,0),o.uniformMatrix4fv(this.addr,!1,D)}function k(v,z){v.uniformMatrix4fv(this.addr,!1,g(z,this.size,16))}function K(H,M){H.uniform1i(this.addr,this.slots[0]),H.activeTexture(H.TEXTURE0+this.slots[0]),H.bindTexture(H.TEXTURE_2D,M||H._emptyTexture)}function l(J,b){J.uniform1iv(this.addr,this.slots);for(var S=this.slots.length;S--;)J.activeTexture(J.TEXTURE0+this.slots[S]),J.bindTexture(J.TEXTURE_2D,b[S]||J._emptyTexture)}function D(O,y){O.uniform1i(this.addr,this.slots[0]),O.activeTexture(O.TEXTURE0+this.slots[0]),O.bindTexture(O.TEXTURE_CUBE_MAP,y||O._emptyCubeTexture)}function B(r,u){r.uniform1iv(this.addr,this.slots);for(var Z=this.slots.length;Z--;)r.activeTexture(r.TEXTURE0+this.slots[Z]),r.bindTexture(r.TEXTURE_CUBE_MAP,u[Z]||r._emptyCubeTexture)}function A(M,V,F){f[M]=[V,F]}function e(n,L,S){switch(n.type){case 35678:case 35680:if("uSampler"===S)return[0];if("uBlendSampler"===S)return[1];for(var o=n.size,W=new Int32Array(o),k=0;o>k;++k)W[k]=L.usedTextureSlot++;
return W}return z}function m(G,o,q,p,u){this.name=G,this.addr=o,this.size=p?q.size:0,this.activeInfo=q,this.setter=f[q.type][p?1:0],this.slots=e(q,u,G),fc(this)}function x(r,s,x,R){var o=r.name,k=o.length;for($.lastIndex=0;;){var n=$.exec(o),l=$.lastIndex,W=n[1],Z="]"===n[2],j=n[3];if(Z&&(W=0|W),j===z||"["===j&&l+2===k){x[W]=new m(W,s,r,j!==z,R);break}var X=x[W];X==z&&(x[W]=X={}),x=X}}function o(f,x,S){this.gl=x,this._program=S,this._leaves={},this._branches={},this._struct=f}function L(J){function z(W,b){o.call(this,J,W,b);for(var T=C.length;T--;){var E=C[T];this._branches[E._name]=new E._type(W,b)}this.uuid=jl.generateUUID()}function B(S,z){var a=S.name;if(S.isLeaf){var s=u("d.setter(this.gl, v);",["v"],["d"],[S.desc]);T.defineProperty(z,a,{configurable:!1,enumerable:!0,get:function(){return s},set:s})}else C.push({_name:a,_type:L(S)}),T.defineProperty(z,a,{configurable:!1,enumerable:!0,get:function(){return this._branches[a]},set:function(i){this._branches[a].apply(i)}})}var C=[];return O(z,o),J.forEach(B,z.prototype),z}function I(Y,h){for(var B=Y.getProgramParameter(h,Y.ACTIVE_UNIFORMS),J={},c={usedTextureSlot:2};B--;){var R=Y.getActiveUniform(h,B),W=R.name,s=Y.getUniformLocation(h,W);x(R,s,J,c)}var d=qq.create(J,function(m){return"addr"in m}),Q=L(d);return T.defineProperty(Q.prototype,"textureCount",{configurable:!1,enumerable:!1,writable:!1,value:c.usedTextureSlot}),new Q(Y,h)}var R=[];if("function"==typeof Float32Array)for(var M=1;17>M;++M)R[M]=new Float32Array(M);var H=[0,1],f=[];A(Te.FLOAT,v,C),A(Te.FLOAT_VEC2,d,Y),A(Te.FLOAT_VEC3,_,Q),A(Te.FLOAT_VEC4,F,h),A(Te.INT,q,G),A(Te.INT_VEC2,Z,Z),A(Te.INT_VEC3,b,b),A(Te.INT_VEC4,S,S),A(Te.BOOL,W,G),A(Te.BOOL_VEC2,Z,Z),A(Te.BOOL_VEC3,b,b),A(Te.BOOL_VEC4,S,S),A(Te.FLOAT_MAT2,n,r),A(Te.FLOAT_MAT3,J,p),A(Te.FLOAT_MAT4,c,k),A(Te.SAMPLER_2D,K,l),A(Te.SAMPLER_CUBE,D,B);var $=/([\w\d_]+)(\])?(\[|\.)?/g;return o.prototype.apply=function(x){for(var r=this._struct.children,$=r.length;$--;){var v=r[$],K=v.name;K in x&&(v.isLeaf?this[K]=x[K]:this._branches[K].apply(x[K]))}},o.prototype.append=function(m){var q=this._struct.childMap;for(var S in m){var h=q[S];h&&(h.isLeaf?this[S]=m[S]:this._branches[S].append(m[S]))}},function(V,Q){var v=Q._uniforms;return v||(Q._uniforms=v=I(V,Q)),v}}(),pc=function(){function w(r,t,o){t.vertexAttrib1f(r.addr,o)}function q(f,X,K){if(K.x!=z)X.vertexAttrib2f(f.addr,K.x,K.y);else{var V=a[2];V.set(K,0),X.vertexAttrib2fv(f.addr,V)}}function M(W,l,L){if(L.x!=z)l.vertexAttrib3f(W.addr,L.x,L.y,L.z);else if(L.r!=z)l.vertexAttrib3f(W.addr,L.r,L.g,L.b);else if(L.red!=z)l.vertexAttrib3f(W.addr,L.red,L.green,L.blue);else{var T=a[3];T.set(L,0),l.vertexAttrib3fv(W.addr,T)}}function C(d,k,J){if("string"==typeof J&&(J=$m(J)),J.x!=z)k.vertexAttrib4f(d.addr,J.x,J.y,J.z,J.w);else if(J.r!=z)k.vertexAttrib4f(d.addr,J.r,J.g,J.b,J.a);else if(J.red!=z)k.vertexAttrib4f(d.addr,J.red,J.green,J.blue,J.alpha);else{var M=a[4];M.set(J,0),k.vertexAttrib4fv(d.addr,M)}}function N(Z,B,W){W=W.el||W;for(var u=0,v=0;2>u;++u)B.vertexAttrib2f(Z.addr,W[v++],W[v++])}function t(d,b,U){U=U.el||U;for(var l=0,W=0;3>l;++l)b.vertexAttrib3f(d.addr,U[W++],U[W++],U[W++])}function j(n,m,d){d=d.el||d;for(var p=0,R=0;4>p;++p)m.vertexAttrib4f(n.addr,d[R++],d[R++],d[R++],d[R++])}function X(n,y,J,e){for(var M,g=J?1:0,s=y.addr,c=n._divisorState,F=0;e>F;F++)M=c[s+F]||0,M!==g&&(c[s+F]=g,n.vertexAttribDivisor(s+F,g))}function y(d,l,a,w,K,p,n){l.bindBuffer(l.ARRAY_BUFFER,a);var i=d.addr;l.enableVertexAttribArray(i),X(l,d,a.instanced,1),l.vertexAttribPointer(i,1,w||l.FLOAT,!!K,p||0,n||0),l.bindBuffer(l.ARRAY_BUFFER,null)}function c(s,i,$,y,r,h,O){i.bindBuffer(i.ARRAY_BUFFER,$);var W=s.addr;i.enableVertexAttribArray(W),X(i,s,$.instanced,1),i.vertexAttribPointer(W,2,y||i.FLOAT,!!r,h||0,O||0),i.bindBuffer(i.ARRAY_BUFFER,null)}function Y(y,E,r,D,x,s,U){E.bindBuffer(E.ARRAY_BUFFER,r);var o=y.addr;E.enableVertexAttribArray(o),X(E,y,r.instanced,1),E.vertexAttribPointer(o,3,D||E.FLOAT,!!x,s||0,U||0),E.bindBuffer(E.ARRAY_BUFFER,null)}function H(V,B,U,O,Q,z,D){B.bindBuffer(B.ARRAY_BUFFER,U);var j=V.addr;B.enableVertexAttribArray(j),X(B,V,U.instanced,1),B.vertexAttribPointer(j,4,O||B.FLOAT,!!Q,z||0,D||0),B.bindBuffer(B.ARRAY_BUFFER,null)}function R(o,s,p,F,y,l,r){var l=l||16,r=r||0,J=o.addr;s.bindBuffer(s.ARRAY_BUFFER,p),s.enableVertexAttribArray(J),s.vertexAttribPointer(J,2,F||s.FLOAT,!!y,l,r),s.enableVertexAttribArray(J+1),s.vertexAttribPointer(J+1,2,F||s.FLOAT,!!y,l,r+8),X(s,o,p.instanced,2),s.bindBuffer(s.ARRAY_BUFFER,null)}function G(N,e,D,W,c,L,G){var L=L||36,G=G||0,p=N.addr;e.bindBuffer(e.ARRAY_BUFFER,D);for(var F=0;3>F;F++)e.enableVertexAttribArray(p+F),e.vertexAttribPointer(p+F,3,W||e.FLOAT,!!c,L,G+12*F);X(e,N,D.instanced,3),e.bindBuffer(e.ARRAY_BUFFER,null)}function I(R,o,y,m,x,z,f){var z=z||64,f=f||0,E=R.addr;o.bindBuffer(o.ARRAY_BUFFER,y);for(var t=0;4>t;t++)o.enableVertexAttribArray(E+t),o.vertexAttribPointer(E+t,4,m||o.FLOAT,!!x,z,f+16*t);X(o,R,y.instanced,4),o.bindBuffer(o.ARRAY_BUFFER,null)}function L(b,R,D,M){P[b]=function(C,X,B,p,r,Y){this.addr==z||this.addr<0||(X==z||X===!1?M(C,this.addr):uk(X)===W?D(this,C,X,B,p,r,Y):(M(C,this.addr),R(this,C,X)))}}function p(T,w){T.disableVertexAttribArray(w)}function Q(t,A){t.disableVertexAttribArray(A),t.disableVertexAttribArray(A+1)}function s(G,K){G.disableVertexAttribArray(K),G.disableVertexAttribArray(K+1),G.disableVertexAttribArray(K+2)}function r(m,u){m.disableVertexAttribArray(u),m.disableVertexAttribArray(u+1),m.disableVertexAttribArray(u+2),m.disableVertexAttribArray(u+3)}function b(U,a,p){this.name=U,this.addr=a,this.activeInfo=p,this.setter=P[p.type],fc(this)}function U(j,_,K){this.gl=_,this.program=K,this._branches={},this._struct=j}function n(S){function Z(d,y){U.call(this,S,d,y);for(var I=K.length;I--;){var s=K[I];this._branches[s._name]=new s._type(d,y)}}function A(Q,F){var h=Q.name;if(Q.isLeaf){var Z=u("d.setter(this.gl, v);",["v"],["d"],[Q.desc]);T.defineProperty(F,h,{configurable:!1,enumerable:!0,get:function(){return Z},set:Z})}else K.push({_name:h,_type:n(Q)}),T.defineProperty(F,h,{configurable:!1,enumerable:!0,get:function(){return this._branches[h]},set:function(G){this._branches[h].apply(G)}})}var K=[];return O(Z,U),S.forEach(A,Z.prototype),Z}function D(j,i){for(var d=j.getProgramParameter(i,j.ACTIVE_ATTRIBUTES),Z={};d--;){var E=j.getActiveAttrib(i,d),p=E.name,D=j.getAttribLocation(i,p);Z[p]=new b(p,D,E)}var V=qq.create(Z,function(x){return"addr"in x}),v=n(V);return new v(j,i)}for(var a=[],h=1;17>h;++h)a[h]=new Tb(h);var P=[],W="undefined"!=typeof WebGLBuffer&&WebGLBuffer.prototype;return L(Te.FLOAT,w,y,p),L(Te.FLOAT_VEC2,q,c,p),L(Te.FLOAT_VEC3,M,Y,p),L(Te.FLOAT_VEC4,C,H,p),L(Te.FLOAT_MAT2,N,R,Q),L(Te.FLOAT_MAT3,t,G,s),L(Te.FLOAT_MAT4,j,I,r),U.prototype.disable=function(){for(var $=this._struct.children,Z=$.length;Z--;){var y=$[Z],S=y.name;y.isLeaf?this[S]=z:this._branches[S].disable()}},U.prototype.apply=function(n){for(var e=this._struct.children,X=e.length;X--;){var M=e[X],R=M.name;R in n&&(M.isLeaf?this[R]=n[R]:this._branches[R].apply(n[R]))}},U.prototype.append=function(k){var r=this._struct.childMap;for(var T in k){var F=r[T];F&&(F.isLeaf?this[T]=k[T]:this._branches[T].append(k[T]))}},function(R,s){var y=s._attribs;return y||(s._attribs=y=D(R,s)),y}}(),Jm=function(U){var O=this;T.defineProperties(this,{gl:{configurable:!1,enumerable:!1,value:U,writable:!1},glState:{configurable:!1,enumerable:!1,value:So(U),writable:!1}}),O._currProgram=z,O._currUniforms=z,O._currAttribs=z,O._sync=!0};T.defineProperties(Jm.prototype,{program:{configurable:!1,enumerable:!1,get:function(){return this._currProgram},set:function(I){var i=this;i._sync&&I===i._currProgram||(i.gl.useProgram(I),i._currProgram=I,i._currUniforms=Xi(i.gl,I),i._currAttribs=pc(i.gl,I),i._sync=!0)}},uniforms:{configurable:!1,enumerable:!1,get:function(){var g=this;return g._currProgram&&!g._sync&&(g.gl.useProgram(g._currProgram),g._sync=!0),g._currUniforms},set:function(c){var a=this;a._currUniforms&&(a._currProgram&&!a._sync&&(a.gl.useProgram(a._currProgram),this._sync=!0),a._currUniforms.apply(c))}},attribs:{configurable:!1,enumerable:!1,get:function(){var u=this;return u._currProgram&&!u._sync&&(u.gl.useProgram(u._currProgram),u._sync=!0),u._currAttribs},set:function(d){var V=this;V._currUniforms&&(V._currProgram&&!V._sync&&(V.gl.useProgram(V._currProgram),this._sync=!0),V._currAttribs.apply(d))}}}),Jm.prototype.useProgram=function(N){var A=this;A._sync&&N===A._currProgram||(A.gl.useProgram(N),A._currProgram=N,A._currUniforms=Xi(A.gl,N),A._currAttribs=pc(A.gl,N),A._sync=!0)},Jm.prototype.directState=function(){return this.glState},Jm.prototype.directUniforms=function(){return this._currUniforms},Jm.prototype.directAttribs=function(){return this._currAttribs},Jm.prototype.syncLoss=function(){this._sync=!1,this.glState.syncLoss()},Jm.for=function(T){var $=T._renderState;return $||(T._renderState=$=new Jm(T)),$};var Ur="directional",Ag="point",Wh="spot",tj="light.color",fg=4294967295,Wg=0,gl={},Cj=[],Qn=0,Sl=function(k,P){Fc(P)&&Wl.test(P)?Up(k,P):Pd(P)&&P.modelType?Yq(k,P):P===z?delete rp[k]:rp[k]=P},Dp=function(U){return U},jm=function(l){l=R.convertShape3dModelName(l);var J;if(Pd(l)){if(l.modelType){if(l.uuid){if(J=rp[l.uuid])return J}else l.uuid=B.Math.generateUUID();return J===z&&(En&&En[l.uuid]||Yq(l.uuid,l)),z}return l}return J=rp[l],l&&J===z&&Wl.test(l)&&(En&&En[l]||Up(l,l)),J},Ol=function(z,V){z.frameStack?z.frameStack.push(V):z.frameStack=[V],z.bindFramebuffer(z.FRAMEBUFFER,V)},Mo=function(d){var G=d.frameStack;if(G){if(G.pop(),G.length)return d.bindFramebuffer(d.FRAMEBUFFER,G[G.length-1]),void 0;d.frameStack=null}d.bindFramebuffer(d.FRAMEBUFFER,null)};Wn(R,{graph3dViewAttributes:I,graph3dViewFirstPersonMode:!1,graph3dViewMouseRoamable:!0,graph3dViewMoveStep:15,graph3dViewRotateStep:L/60,graph3dViewSortable:!1,graph3dViewBlockSelectable:!0,graph3dViewEditHelperDisabled:!1,graph3dViewPannable:!0,graph3dViewRotatable:!0,graph3dViewWalkable:!0,graph3dViewResettable:!0,graph3dViewZoomable:!0,graph3dViewRectSelectable:!0,graph3dViewRectSelectBackground:dc,graph3dViewGridVisible:!1,graph3dViewGridSize:50,graph3dViewGridGap:50,graph3dViewGridColor:[.4,.75,.85,1],graph3dViewRotateMaxPhi:L,graph3dViewRotateMinPhi:0,graph3dViewShadowDisabled:!0,graph3dViewShadowQuality:"high",graph3dViewShadowIntensity:.3,graph3dViewShadowBias:-.005,graph3dViewShadowRadius:.1,graph3dViewShadowType:"hard",graph3dViewShadowDegreeX:30,graph3dViewShadowDegreeZ:-10,graph3dViewOriginAxisVisible:!1,graph3dViewCenterAxisVisible:!1,graph3dViewAxisXColor:[1,0,0,1],graph3dViewAxisYColor:[0,1,0,1],graph3dViewAxisZColor:[0,0,1,1],graph3dViewEditSizeColor:[1,1,0,1],graph3dViewOrtho:!1,graph3dViewOrthoWidth:2e3,graph3dViewSyncEyeWithOrthoWidth:!1,graph3dViewFovy:L/4,graph3dViewNear:10,graph3dViewFar:1e4,graph3dViewEye:[0,300,1e3],graph3dViewCenter:[0,0,0],graph3dViewUp:[0,1,-1e-7],graph3dViewDataNumWarningLine:1e4,graph3dViewHeadlightDirection:"camera",graph3dViewHeadlightRange:0,graph3dViewHeadlightGroup:0,graph3dViewHeadlightColor:[1,1,1,1],graph3dViewHeadlightIntensity:1,graph3dViewHeadlightDisabled:!1,graph3dViewHeadlightAmbientIntensity:.7,graph3dViewFogDisabled:!0,graph3dViewFogMode:"linear",graph3dViewFogDensity:5e-4,graph3dViewFogColor:"white",graph3dViewFogNear:1,graph3dViewFogFar:2e3,graph3dViewPickerResolution:.5,graph3dViewDashDisabled:!0,graph3dViewUvClipEnabled:!1,graph3dViewBatchBlendDisabled:!0,graph3dViewBatchBrightnessDisabled:!0,graph3dViewBatchColorDisabled:!1,graph3dViewBatchInstancedDisabled:!0,graph3dViewFlowBlendMode:"addRGB",graph3dViewEnvmapType:"legacy",graph3dMaxVectorCacheTime:50,graph3dEnvmapCapabilityRequire:8,setShape3dModel:Sl,getShape3dModel:jm,convertShape3dModelName:Dp,getShape3dModelMap:function(){return rp},getCachedShape3dModelMap:function(){return of},createMatrix:function(F,t){ar(F)||(F=[F]);for(var A=F.length-1;A>=0;A--){var Y=F[A];t=Jg(Y.mat,Y.s3,Y.r3,Y.rotationMode,Y.t3,t)}return t},transformVec:function(I,M){return Ee(I,M)},glBindFrame:Ol,glUnbindFrame:Mo,createBoxModel:function(){return{vs:Tm,ns:cc,uv:Zp,is:Mb}},createRoundRectModel:function(d,l){return Wo.roundRect(d,l)},createStarModel:function(l,P){return Wo.star(l,P)},createRectModel:function(N,z){return Wo.rect(N,z)},createTriangleModel:function(B,X){return Wo.triangle(B,X)},createRightTriangleModel:function(l,n){return Wo.rightTriangle(l,n)},createParallelogramModel:function(A,e){return Wo.parallelogram(A,e)},createTrapezoidModel:function(u,J){return Wo.trapezoid(u,J)},createSmoothSphereModel:function(W,w,E,b,q,f,K){return Xp(new An(W,w,E,b,q,f,K))},createSphereModel:function(E,$,K,s,G,X,p){return E?ts(E,$,K,s,G,X,p):R.createSmoothSphereModel()},createSmoothConeModel:function(f,H,N,W,Q){return Lm(f,H,N,W,Q)},createConeModel:function(J,V,N,m,s,a,_,d){return J?qh(J,V,N,m,s,a,_,d):Lm(a)},createSmoothCylinderModel:function(g,j,s,$,v,h,P,Q){return Xp(new zd(g,j,s,$,v,h,P,Q))},createCylinderModel:function(u,b,t,H,a,X,V,x){return u?ah(u,b,t,H,a,X,V,x):Wf(X,V)},createSmoothTorusModel:function(U,$,R,b,p,v){return Xp(new Ak(U,$,R,b,p,v))},createTorusModel:function(V,v,i,y,m,X,l,_){return V?Oq(V,v,i,y,m,X,l,_):mq(X,l)},createExtrusionModel:function(S,k,o,F,b,J,D,j){return lk(S,k,o,F,b,J,D,j)},createSmoothRingModel:function(f,m,r,F,p,x){for(var e=[],Q=0;Q<f.length-1;Q+=2)e.push({x:f[Q],y:f[Q+1]});for(f=mi(e,m,r)[0],e=[],Q=0;Q<f.length;Q++){var P=f[Q];e.push(new xe(P.x,0,P.y))}return Xp(new Qd(e,x,F,p))},createTextGeometry:function(r,G){var F=Xp(new ag(r,G));if(G.cube)for(var K=Yk(F),f=K.min,h=K.max,u=f.x,L=f.y,s=f.z,q=h.x-u||1,W=h.y-L||1,T=h.z-s||1,M=["vs","top_vs","bottom_vs"],n=0,z=M.length;z>n;n++){var R=F[M[n]];if(R)for(var Q=0,g=R.length;g>Q;Q+=3)R[Q]=(R[Q]-u)/q-.5,R[Q+1]=(R[Q+1]-L)/W-.5,R[Q+2]=(R[Q+2]-s)/T-.5}return F},loadFontFace:function(q,i){R.xhrLoad(q,function(e){if(!e)return i();var h;try{h=JSON.parse(e)}catch(W){h=JSON.parse(e.substring(65,e.length-2))}kf.loadFace(h),i&&i(h.familyName.toLowerCase())},i?null:{sync:!0})},getShaderErrorLog:function(){return Cj.join("\n")},createRingModel:function(_,S,Q,j,p,m,q,l,r,g){for(var O=[],U=0;U<_.length-1;U+=2)O.push({x:_[U],y:_[U+1]});m=m||R.shapeSide,q=q||0,l=l||m;var s,V,J,G,L,z,X,c,u,f,U,b,B,d,o,n,A,h,$=[],T=[],W=r?[]:I,M=r?[]:I,w=g?[]:I,P=g?[]:I,D=j?[]:I,t=j?[]:I,y=p?[]:I,e=p?[]:I,_=mi(O,S,Q),Y=lj(_),a=0,x=2*Math.PI/m;return _.forEach(function(I){if(J=I.length,J>1){if(G=I[0],j)for(z=G.x,c=G.y,U=q;l>U;U++)b=U+1,B=U*x,d=b*x,o=F(B),n=k(B),A=F(d),h=k(d),D.push(o*z,c,-n*z,A*z,c,-h*z,0,c,0),t.push(.5-.5*o,.5-.5*n,.5-.5*A,.5-.5*h,.5,.5);for(f=0;J>f;f++){for(L=I[f],z=G.x,X=L.x,c=G.y,u=L.y,s=a/Y,a+=Jc(G,L),V=a/Y,U=q;l>U;U++)b=U+1,B=U*x,d=b*x,o=F(B),n=k(B),A=F(d),h=k(d),$.push(o*X,u,-n*X,A*X,u,-h*X,o*z,c,-n*z,A*X,u,-h*X,A*z,c,-h*z,o*z,c,-n*z),T.push(U/m,V,b/m,V,U/m,s,b/m,V,b/m,s,U/m,s),r&&U===q&&(W.push(0,c,0,0,u,0,o*X,u,-n*X,o*X,u,-n*X,o*z,c,-n*z,0,c,0),M.push(0,.5-c,0,.5-u,2*X,.5-u,2*X,.5-u,2*z,.5-c,0,.5-c)),g&&b===l&&(w.push(0,c,0,A*X,u,-h*X,0,u,0,A*X,u,-h*X,0,c,0,A*z,c,-h*z),P.push(1,.5-c,1-2*X,.5-u,1,.5-u,1-2*X,.5-u,1,.5-c,1-2*z,.5-c));G=L}if(p)for(z=G.x,c=G.y,U=q;l>U;U++)b=U+1,B=U*x,d=b*x,o=F(B),n=k(B),A=F(d),h=k(d),y.push(A*z,c,-h*z,o*z,c,-n*z,0,c,0),e.push(.5-.5*A,.5+.5*h,.5-.5*o,.5+.5*n,.5,.5)}}),{vs:$,uv:T,bottom_vs:y,bottom_uv:e,top_vs:D,top_uv:t,from_vs:W,from_uv:M,to_vs:w,to_uv:P}}},!0),Wn(c,{"3d.move.mode":z,"3d.selectable":!0,"3d.visible":!0,"3d.movable":!0,"3d.editable":!0,"3d.clip.direction":null,"3d.clip.percentage":1,"3d.reflectable":!0,"shape.border.gradient.color":z,"edge.gradient.color":z,"edge.source.t3":z,"edge.target.t3":z,"light.type":Ag,"light.group":0,"light.center":[0,0,0],"light.color":[1,1,1,1],"light.disabled":!1,"light.angle":L/4,"light.range":0,"light.exponent":1,"light.intensity":1,"light.mask":fg,"headlight.ambientIntensity":z,"wf.visible":!1,"wf.width":1,"wf.fog":!0,"wf.color":Iq,"wf.short":!1,"wf.mat":z,"wf.boundingBox":!1,"wf.geometry":!1,"wf.loadQuadWireframe":!1,"wf.combineTriangle":!0,batch:z,"transparent.mask":!1,brightness:z,"select.brightness":.7,"repeat.uv.length":z,"shadow.cast":!0,"shadow.receive":!0,"3d.clipbox":z,"3d.clipbox.mask":fg,"3d.clipbox.group":0,"3d.clipbox.shape":"cube","effect.flow":!1,"effect.flow.gradient":"spread.horizontal","effect.flow.uvshape":"rect","effect.flow.size":512,"effect.flow.group":0,"effect.flow.intensity":1,"effect.flow.blend":z,"effect.flow.mask":fg,bloom:!1,envmap:0,"envmap.probe":0,roughness:0,renderTextureSamples:4,alphaTest:.4,autorotate:!1,fixSizeOnScreen:!1,"texture.cache":!1,"hide.overlapping.group":z,"vector.dynamic":!1,"vector.dynamic.maxsize":2048,"texture.scale":1,"geometry.cache":!1,"highlight.mode":!1,"highlight.type":"hard","highlight.visible":!0,"highlight.width":.8,"highlight.color":"rgba(190, 210, 250, 1)","highlight.glow":.8,"highlight.strength":2,"color.empty":[0,0,0,0],"label.face":Uj,"label.t3":z,"label.r3":z,"label.texture.scale":2,"label.rotationMode":Yc,"label.light":!1,"label.blend":z,"label.reverse.flip":!1,"label.reverse.color":_g,"label.reverse.cull":!1,"label.transparent":!1,"label.autorotate":!1,"label2.face":Uj,"label2.t3":z,"label2.r3":z,"label2.texture.scale":2,"label2.rotationMode":Yc,"label2.light":!1,"label2.blend":z,"label2.reverse.flip":!1,"label2.reverse.color":_g,"label2.reverse.cull":!1,"label2.transparent":!1,"label2.autorotate":!1,"note.face":Uj,"note.t3":z,"note.r3":z,"note.texture.scale":2,"note.rotationMode":Yc,"note.light":!1,"note.blend":z,"note.reverse.flip":!1,"note.reverse.color":_g,"note.reverse.cull":!1,"note.transparent":!1,"note.autorotate":!1,"note2.face":Uj,"note2.t3":z,"note2.r3":z,"note2.texture.scale":2,"note2.rotationMode":Yc,"note2.light":!1,"note2.blend":z,"note2.reverse.flip":!1,"note2.reverse.color":_g,"note2.reverse.cull":!1,"note2.transparent":!1,"note2.autorotate":!1,"part.boundingBox":!1,shape3d:z,"shape3d.color":Ch,"shape3d.top.color":z,"shape3d.bottom.color":z,"shape3d.from.color":z,"shape3d.to.color":z,"shape3d.image":z,"shape3d.image.projection":z,"shape3d.top.image":z,"shape3d.bottom.image":z,"shape3d.from.image":z,"shape3d.to.image":z,"shape3d.light":!0,"shape3d.side":0,"shape3d.side.from":z,"shape3d.side.to":z,"shape3d.smooth":z,"shape3d.visible":!0,"shape3d.from.visible":!0,"shape3d.to.visible":!0,"shape3d.top.visible":!0,"shape3d.bottom.visible":!0,"shape3d.torus.radius":.17,"shape3d.resolution":0,"shape3d.blend":z,"shape3d.opacity":z,"shape3d.reverse.flip":!1,"shape3d.reverse.color":_g,"shape3d.reverse.cull":!1,"shape3d.transparent":!1,"shape3d.uv.offset":z,"shape3d.uv.scale":z,"shape3d.uv.rotation":z,"shape3d.uv.anchor":z,"shape3d.uv.union":z,"shape3d.top.uv.offset":z,"shape3d.top.uv.scale":z,"shape3d.top.uv.rotation":z,"shape3d.top.uv.anchor":z,"shape3d.bottom.uv.offset":z,"shape3d.bottom.uv.scale":z,"shape3d.bottom.uv.rotation":z,"shape3d.bottom.uv.anchor":z,"shape3d.from.uv.offset":z,"shape3d.from.uv.scale":z,"shape3d.from.uv.rotation":z,"shape3d.from.uv.anchor":z,"shape3d.to.uv.offset":z,"shape3d.to.uv.scale":z,"shape3d.to.uv.rotation":z,"shape3d.to.uv.anchor":z,"shape3d.top.cap":z,"shape3d.bottom.cap":z,"shape3d.start.angle":0,"shape3d.sweep.angle":f,"shape3d.point.epsilon":1e-6,"shape3d.discard.selectable":!0,"shape3d.top.discard.selectable":!0,"shape3d.bottom.discard.selectable":!0,"shape3d.from.discard.selectable":!0,"shape3d.to.discard.selectable":!0,"shape3d.scaleable":!0,"shape3d.reflector":!1,"shape3d.reflector.color":"rgb(128,128,128)","shape3d.reflector.blur":0,"shape3d.reflector.blur.iterations":1,"shape3d.reflector.background":null,"shape3d.reflector.clip":.003,"shape3d.reflector.shadow":"scene","camera.type":"perspective","camera.aspect":1,"camera.fovy":z,"camera.ortho.width":z,"camera.near":z,"camera.far":z,"camera.background":0,"camera.renderSky":!0,"camera.renderAxis":!1,"camera.renderGrid":!1,"camera.renderEdit":!1,"camera.onlySky":!1,"texture.mipmap.max":z,"texture.filter":z,"texture.filter.min":z,"texture.filter.mag":z,"texture.wrap":z,"points.image":"rect","points.color":"white","points.transparent":!1,"points.size":20,"points.opacity":1,"points.uv.scale":[1,1],"points.uv.offset":[0,0],"points.discard.selectable":!1,"all.light":!0,"all.visible":!0,"all.color":Ch,"all.image":z,"all.blend":z,"all.opacity":z,"all.reverse.flip":!1,"all.reverse.color":_g,"all.reverse.cull":!1,"all.transparent":!1,"all.uv":z,"all.uv.offset":z,"all.uv.scale":z,"all.uv.rotation":z,"all.uv.anchor":z,"all.uv.union":z,"all.discard.selectable":!0,mat:z,"left.mat":z,"right.mat":z,"top.mat":z,"bottom.mat":z,"front.mat":z,"back.mat":z,"edge.source.anchor.elevation":z,"edge.target.anchor.elevation":z,"edge.source.offset.elevation":0,"edge.target.offset.elevation":0},!0);var $c,gr=!1,kl=[0,0,0,0],ze=function(L){return L instanceof Ds},Sq=function($){return[$.x,$.e||0,$.y]},pm=function(D,R,Z){for(var R=$m(R||0),C=R[0],g=R[1],K=R[2];Z--;)D.push(C,g,K)},re=function(E,X,t){for(var X=$m(X||0),P=X[0],L=X[1],D=X[2],m=X[3];t--;)E.push(P,L,D,m)},Ep=function(J,m,M){if(m)for(var f,D,Z,e=m[0],L=m[1],K=m[2],u=m[4],R=m[5],C=m[6],U=m[8],l=m[9],c=m[10],F=m[12],Y=m[13],s=m[14],G=M.length,t=0,t=0;G>t;t+=3)f=M[t],D=M[t+1],Z=M[t+2],J.push(e*f+u*D+U*Z+F,L*f+R*D+l*Z+Y,K*f+C*D+c*Z+s);else uh(J,M);return J},Km=function(m,L,Y){var l=L.s("light.intensity"),F=$m(L.s(tj)),V=F[0],R=F[1],P=F[2];1!==l&&(V*=l,R*=l,P*=l);var H=L.s("light.disabled");m.push(V,R,P,H?1:0),Y.c.push(V,R,P),Y.g.push(H?-1:L.s("light.group")),Y.e.push(H?1:0)},fp=function(j,c){var h,v=Jm.for(c),V=v.directUniforms(),T=j._lastLightUploadInfo={c:[],g:[],e:[]},p=j._headlightDirection;p&&3===p.length?h=p:"shadow"===p&&(h=j.shadowMap.getDirection()),h=h?Xn.normalizeArray(j._transformDirectionToViewSpace(null,h)):[0,0,0],V.uHeadlightDirection=h,V.uHeadlightRange=j._headlightRange;var L=V.uHeadlightAmbientIntensity=j._headlightAmbientIntensity,R=j._headlightIntensity,o=$m(j._headlightColor);1!==R&&(o=[o[0]*R,o[1]*R,o[2]*R]);var u;V.uHeadlightColor=[o[0],o[1],o[2],(u=j._headlightDisabled)?1:0],T.c.push(o[0],o[1],o[2]),T.g.push(u?-1:j._headlightGroup),T.e.push(u?1:0);var M=j._59O,t=j._spots,O=j._dirs;if(M.length){var w=[],C=[],W=[];M.forEach(function($){Km(w,$,T),uh(C,j._transformPointToViewSpace($.p3())),W.push($.s("light.range"))}),V.uPointColor=w,V.uPointRange=W,V.uPointPosition=C}if(t.length){var K=[],s=[],q=[],a=[],m=[],B=[];t.forEach(function(M){Km(K,M,T),uh(s,j._transformPointToViewSpace(M.p3())),uh(m,j._transformDirectionToViewSpace(M.p3(),M.s("light.center"))),q.push(M.s("light.range")),a.push(F(M.s("light.angle")/2)),B.push(M.s("light.exponent"))}),V.uSpotColor=K,V.uSpotRange=q,V.uSpotAngle=a,V.uSpotExponent=B,V.uSpotPosition=s,V.uSpotDirection=m}if(O.length){var k=[],X=[];O.forEach(function(z){Km(k,z,T),uh(X,j._transformDirectionToViewSpace(z.p3()))}),V.uDirColor=k,V.uDirDirection=X}j._lastLightMask=fg,j._lastHeadlightAmbientIntensity=L},od=function(P,f,a,_){if(_===z&&(_=P._headlightAmbientIntensity),_!==P._lastHeadlightAmbientIntensity&&(f.uHeadlightAmbientIntensity=P._lastHeadlightAmbientIntensity=_),a!==P._lastLightMask){P._lastLightMask=a;var X=P._lastLightUploadInfo;if(X){var q,u,e,T=X.g,O=X.e,o=T.length,k=new Array(o),M=!1;for(u=0;o>u;u++)q=T[u],e=0>q||q>=32?1:a&1<<q?0:1,k[u]=e,e!==O[u]&&(M=!0);if(M){X.e=O=k;var J=X.c;f.uHeadlightColor=[J[0],J[1],J[2],O[0]];var d,U=P._59O,r=P._spots,l=P._dirs,R=3,H=1;if(o=U.length){for(u=0,d=[];o>u;u++)d.push(J[R++],J[R++],J[R++],O[H++]);f.uPointColor=d}if(o=r.length){for(u=0,d=[];o>u;u++)d.push(J[R++],J[R++],J[R++],O[H++]);f.uSpotColor=d}if(o=l.length){for(u=0,d=[];o>u;u++)d.push(J[R++],J[R++],J[R++],O[H++]);f.uDirColor=d}}}}},oq=function(s,q){return Math.max(s.getRotateMinPhi()+xk,Math.min(s.getRotateMaxPhi()-xk,q))},Zg=function(){return.05+Mp()/2},As=function(I,q,K,w){var $,D=I.getEye();return I.isOrtho()?($=Er(I.getCenter(),D),$[0]+=w[0],$[1]+=w[1],$[2]+=w[2]):$=D,Lh(q,K,w,$)},Lh=function(p,E,S,W){var f=Li(p,E),P=Er(W,S,!0),n=Li(P,E);if(i(n)<xk)return I;var x=(f-Li(S,E))/n;return[S[0]+P[0]*x,S[1]+P[1]*x,S[2]+P[2]*x]},Br=function(n,L){return{x:2*n.x-L.x,y:2*n.y-L.y}},am=function(Q,h,u,z){var q,O;if(!Q)return q=Wd(h.y-u.y,u.x-h.x),{x:h.x+z*k(q),y:h.y+z*F(q)};if(!u)return q=Wd(Q.y-h.y,h.x-Q.x),{x:h.x+z*k(q),y:h.y+z*F(q)};var E=Er([Q.x,Q.y,0],[h.x,h.y,0],!0),i=Er([u.x,u.y,0],[h.x,h.y,0],!0),H=-(E[0]+i[0])/2,D=-(E[1]+i[1])/2,g=a(H*H+D*D);if(xk>g)return q=Wd(Q.y-h.y,h.x-Q.x),{x:h.x+z*k(q),y:h.y+z*F(q)};var A=Q.x-h.x,n=Q.y-h.y,K=u.x-h.x,Z=u.y-h.y,d=a(A*A+n*n),M=a(K*K+Z*Z);q=p(Li(E,i))/2,O=E[1]*i[0]-E[0]*i[1]>0?-1:1,H/=g,D/=g;var e=z/k(q),$=o(d,M)/F(q);g=Math.min(e,$);var f={x:h.x+O*g*H,y:h.y+O*g*D};return u.b&&e>M/F(q)&&(f.adjust=!0),f},er=function(P){var u=P[1],M=P[2],j=P[3],D=P[6],v=P[7],q=P[11];P[1]=P[4],P[2]=P[8],P[3]=P[12],P[4]=u,P[6]=P[9],P[7]=P[13],P[8]=M,P[9]=D,P[11]=P[14],P[12]=j,P[13]=v,P[14]=q},yo=function(A){var g=A[0],E=A[1],t=A[2],O=A[3],Y=A[4],f=A[5],x=A[6],s=A[7],C=A[8],Z=A[9],n=A[10],z=A[11],$=A[12],k=A[13],D=A[14],_=A[15],o=g*f-E*Y,L=g*x-t*Y,K=g*s-O*Y,G=E*x-t*f,m=E*s-O*f,W=t*s-O*x,q=C*k-Z*$,r=C*D-n*$,u=C*_-z*$,j=Z*D-n*k,S=Z*_-z*k,H=n*_-z*D,p=o*H-L*S+K*j+G*u-m*r+W*q;return p?(p=1/p,A[0]=(f*H-x*S+s*j)*p,A[1]=(t*S-E*H-O*j)*p,A[2]=(k*W-D*m+_*G)*p,A[3]=(n*m-Z*W-z*G)*p,A[4]=(x*u-Y*H-s*r)*p,A[5]=(g*H-t*u+O*r)*p,A[6]=(D*K-$*W-_*L)*p,A[7]=(C*W-n*K+z*L)*p,A[8]=(Y*S-f*u+s*q)*p,A[9]=(E*u-g*S-O*q)*p,A[10]=($*m-k*K+_*o)*p,A[11]=(Z*K-C*m-z*o)*p,A[12]=(f*r-Y*j-x*q)*p,A[13]=(g*j-E*r+t*q)*p,A[14]=(k*L-$*G-D*o)*p,A[15]=(C*G-Z*L+n*o)*p,void 0):I},uf=function(g,R){if(R){var _=R[0],Y=R[1],j=R[2];g[12]=g[0]*_+g[4]*Y+g[8]*j+g[12],g[13]=g[1]*_+g[5]*Y+g[9]*j+g[13],g[14]=g[2]*_+g[6]*Y+g[10]*j+g[14],g[15]=g[3]*_+g[7]*Y+g[11]*j+g[15]}},xm=function(d,Y){if(Y){var k=Y[0],s=Y[1],L=Y[2];d[0]=d[0]*k,d[1]=d[1]*k,d[2]=d[2]*k,d[3]=d[3]*k,d[4]=d[4]*s,d[5]=d[5]*s,d[6]=d[6]*s,d[7]=d[7]*s,d[8]=d[8]*L,d[9]=d[9]*L,d[10]=d[10]*L,d[11]=d[11]*L}},Hh=function($,O,P){var w=O[0],N=O[1],S=O[2],l=O[3],H=O[4],c=O[5],q=O[6],G=O[7],p=O[8],j=O[9],L=O[10],f=O[11],y=O[12],s=O[13],z=O[14],h=O[15],g=P[0],m=P[1],F=P[2],v=P[3];return $[0]=g*w+m*H+F*p+v*y,$[1]=g*N+m*c+F*j+v*s,$[2]=g*S+m*q+F*L+v*z,$[3]=g*l+m*G+F*f+v*h,g=P[4],m=P[5],F=P[6],v=P[7],$[4]=g*w+m*H+F*p+v*y,$[5]=g*N+m*c+F*j+v*s,$[6]=g*S+m*q+F*L+v*z,$[7]=g*l+m*G+F*f+v*h,g=P[8],m=P[9],F=P[10],v=P[11],$[8]=g*w+m*H+F*p+v*y,$[9]=g*N+m*c+F*j+v*s,$[10]=g*S+m*q+F*L+v*z,$[11]=g*l+m*G+F*f+v*h,g=P[12],m=P[13],F=P[14],v=P[15],$[12]=g*w+m*H+F*p+v*y,$[13]=g*N+m*c+F*j+v*s,$[14]=g*S+m*q+F*L+v*z,$[15]=g*l+m*G+F*f+v*h,$},gg=function(g,b,R,L){var n,u,v,J,E,p,z,P,l,N,k=b[0],d=b[1],r=b[2],Q=L[0],A=L[1],x=L[2],c=R[0],G=R[1],M=R[2];return i(k-c)<xk&&i(d-G)<xk&&i(r-M)<xk?un(g):(z=k-c,P=d-G,l=r-M,N=1/a(z*z+P*P+l*l),z*=N,P*=N,l*=N,n=A*l-x*P,u=x*z-Q*l,v=Q*P-A*z,N=a(n*n+u*u+v*v),N?(N=1/N,n*=N,u*=N,v*=N):(n=0,u=0,v=0),J=P*v-l*u,E=l*n-z*v,p=z*u-P*n,N=a(J*J+E*E+p*p),N?(N=1/N,J*=N,E*=N,p*=N):(J=0,E=0,p=0),g[0]=n,g[1]=J,g[2]=z,g[3]=0,g[4]=u,g[5]=E,g[6]=P,g[7]=0,g[8]=v,g[9]=p,g[10]=l,g[11]=0,g[12]=-(n*k+u*d+v*r),g[13]=-(J*k+E*d+p*r),g[14]=-(z*k+P*d+l*r),g[15]=1,g)},Kr=function(f,h,T,k,H){var N=1/Le(h/2),m=1/(k-H);return f[0]=N/T,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=N,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=(H+k)*m,f[11]=-1,f[12]=0,f[13]=0,f[14]=2*H*k*m,f[15]=0,f},ap=function(z,A,M,e,L,O,y){var v=1/(A-M),t=1/(e-L),l=1/(O-y);return z[0]=-2*v,z[1]=0,z[2]=0,z[3]=0,z[4]=0,z[5]=-2*t,z[6]=0,z[7]=0,z[8]=0,z[9]=0,z[10]=2*l,z[11]=0,z[12]=(A+M)*v,z[13]=(L+e)*t,z[14]=(y+O)*l,z[15]=1,z},Do=function(T,q){var c=q[0],M=q[1],s=q[2],I=q[3],r=c*c+M*M+s*s+I*I,W=r?1/r:0;return T[0]=-c*W,T[1]=-M*W,T[2]=-s*W,T[3]=I*W,T},Hb=function(N,H){var k=H[0]+H[5]+H[10],e=0;return k>0?(e=2*Math.sqrt(k+1),N[3]=.25*e,N[0]=(H[6]-H[9])/e,N[1]=(H[8]-H[2])/e,N[2]=(H[1]-H[4])/e):H[0]>H[5]&H[0]>H[10]?(e=2*Math.sqrt(1+H[0]-H[5]-H[10]),N[3]=(H[6]-H[9])/e,N[0]=.25*e,N[1]=(H[1]+H[4])/e,N[2]=(H[8]+H[2])/e):H[5]>H[10]?(e=2*Math.sqrt(1+H[5]-H[0]-H[10]),N[3]=(H[8]-H[2])/e,N[0]=(H[1]+H[4])/e,N[1]=.25*e,N[2]=(H[6]+H[9])/e):(e=2*Math.sqrt(1+H[10]-H[0]-H[5]),N[3]=(H[1]-H[4])/e,N[0]=(H[8]+H[2])/e,N[1]=(H[6]+H[9])/e,N[2]=.25*e),N},hp=function(r,N,i){var T=N[0],$=N[1],y=N[2],c=N[3],U=T+T,E=$+$,g=y+y,p=T*U,F=T*E,L=T*g,J=$*E,X=$*g,u=y*g,n=c*U,Z=c*E,b=c*g;return r[0]=1-(J+u),r[1]=F+b,r[2]=L-Z,r[3]=0,r[4]=F-b,r[5]=1-(p+u),r[6]=X+n,r[7]=0,r[8]=L+Z,r[9]=X-n,r[10]=1-(p+J),r[11]=0,r[12]=i[0],r[13]=i[1],r[14]=i[2],r[15]=1,r},yk=function($,U){if($.isVREnabled()){var G=$.vr.getViewMatrix(U);if(G)return G}return $._camera?$._camera.getViewMatrix(U):gg(U?U:an(),$._eye,$._center,$._up)},Xf=function(r,d){if(r.isVREnabled()){var t=r.vr.getProjectMatrix();if(t)return t}if(r._camera)return r._camera.getProjectMatrix();if(!d&&r._computedProjectMatrix)return yq(r._computedProjectMatrix);var S=r.getAspect(),m=r._near,n=r._far,p=an();if(r._ortho){var U=r._orthoWidth/2,f=U/S;ap(p,-U,U,-f,f,m,n)}else Kr(p,r._fovy,S,m,n);return p},df=function($,P){if(!$)return I;var x=0,w=1,m=2,X=[],Z=0,i=$.length,C=i/3;if(P){for(;i>Z;Z++)X[Z]=0;for(Z=0;Z<P.length;Z+=3){var t=[],n=[],b=[];t[x]=$[3*P[Z+1]+x]-$[3*P[Z]+x],t[w]=$[3*P[Z+1]+w]-$[3*P[Z]+w],t[m]=$[3*P[Z+1]+m]-$[3*P[Z]+m],n[x]=$[3*P[Z+2]+x]-$[3*P[Z+1]+x],n[w]=$[3*P[Z+2]+w]-$[3*P[Z+1]+w],n[m]=$[3*P[Z+2]+m]-$[3*P[Z+1]+m],b[x]=t[w]*n[m]-t[m]*n[w],b[w]=t[m]*n[x]-t[x]*n[m],b[m]=t[x]*n[w]-t[w]*n[x];for(var c=0;3>c;c++)X[3*P[Z+c]+x]+=b[x],X[3*P[Z+c]+w]+=b[w],X[3*P[Z+c]+m]+=b[m]}}else for(Z=0;C>Z;Z+=3){var t=[],n=[],b=[];t[x]=$[3*(Z+1)+x]-$[3*Z+x],t[w]=$[3*(Z+1)+w]-$[3*Z+w],t[m]=$[3*(Z+1)+m]-$[3*Z+m],n[x]=$[3*(Z+2)+x]-$[3*(Z+1)+x],n[w]=$[3*(Z+2)+w]-$[3*(Z+1)+w],n[m]=$[3*(Z+2)+m]-$[3*(Z+1)+m],b[x]=t[w]*n[m]-t[m]*n[w],b[w]=t[m]*n[x]-t[x]*n[m],b[m]=t[x]*n[w]-t[w]*n[x];for(var c=0;3>c;c++)X[3*(Z+c)+x]=b[x],X[3*(Z+c)+w]=b[w],X[3*(Z+c)+m]=b[m]}for(Z=0;i>Z;Z+=3){var U=[];U[x]=X[Z+x],U[w]=X[Z+w],U[m]=X[Z+m];var d=a(U[x]*U[x]+U[w]*U[w]+U[m]*U[m]);0===d&&(d=xk),U[x]=U[x]/d,U[w]=U[w]/d,U[m]=U[m]/d,X[Z+x]=U[x],X[Z+w]=U[w],X[Z+m]=U[m]}return new Tb(X)},Qc=function(e,h,F,Z){if(F||(F=e.createTexture()),h){var W=e.TEXTURE_2D,$=e.REPEAT,u=e.CLAMP_TO_EDGE,X=e.TEXTURE_MIN_FILTER;Z=Z||El;var V=Z.minFilter||Z.filter||e.LINEAR,j=Z.magFilter||Z.filter||e.LINEAR;e.activeTexture(e.TEXTURE0),Eb(e,F),e.texImage2D(W,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,h),Ln(e,e.TEXTURE_MAG_FILTER,j);var i=h.naturalWidth||h.width,g=h.naturalHeight||h.height;jl.isPOT(i)&&jl.isPOT(g)&&!Z.clampToEdge&&!h.clampToEdge?(Ln(e,e.TEXTURE_WRAP_S,$),Ln(e,e.TEXTURE_WRAP_T,$),Ln(e,X,V===e.NEAREST?e.NEAREST_MIPMAP_NEAREST:e.LINEAR_MIPMAP_LINEAR),Z.mipmapMaxLevel!==z&&Ln(e,e.TEXTURE_MAX_LEVEL,Z.mipmapMaxLevel),e.generateMipmap(W)):(Ln(e,e.TEXTURE_WRAP_S,u),Ln(e,e.TEXTURE_WRAP_T,u),Ln(e,X,V)),Eb(e,I)}return F},pn=function(j,E,F){var x=new Uint8Array(F||4);return E=E||j.createTexture(),j.activeTexture(j.TEXTURE0),Eb(j,E),Ln(j,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texImage2D(j.TEXTURE_2D,0,j.RGBA,1,1,0,j.RGBA,j.UNSIGNED_BYTE,x),E},$g=function(D,w,z){var _=new Uint8Array(z||4);return w=w||D.createTexture(),D.activeTexture(D.TEXTURE0),D.bindTexture(D.TEXTURE_CUBE_MAP,w),D.texParameteri(D.TEXTURE_CUBE_MAP,D.TEXTURE_MAG_FILTER,D.LINEAR),D.texParameteri(D.TEXTURE_CUBE_MAP,D.TEXTURE_MIN_FILTER,D.LINEAR),D.texImage2D(D.TEXTURE_CUBE_MAP_POSITIVE_X+0,0,D.RGBA,1,1,0,D.RGBA,D.UNSIGNED_BYTE,_),D.texImage2D(D.TEXTURE_CUBE_MAP_POSITIVE_X+1,0,D.RGBA,1,1,0,D.RGBA,D.UNSIGNED_BYTE,_),D.texImage2D(D.TEXTURE_CUBE_MAP_POSITIVE_X+2,0,D.RGBA,1,1,0,D.RGBA,D.UNSIGNED_BYTE,_),D.texImage2D(D.TEXTURE_CUBE_MAP_POSITIVE_X+3,0,D.RGBA,1,1,0,D.RGBA,D.UNSIGNED_BYTE,_),D.texImage2D(D.TEXTURE_CUBE_MAP_POSITIVE_X+4,0,D.RGBA,1,1,0,D.RGBA,D.UNSIGNED_BYTE,_),D.texImage2D(D.TEXTURE_CUBE_MAP_POSITIVE_X+5,0,D.RGBA,1,1,0,D.RGBA,D.UNSIGNED_BYTE,_),w},Bm=function(L){L._26I&&L._prg&&(L._26I.deleteProgram(L._prg),L._prg=I)},hk=function(){function p(v){if(v.match(Z))return ip(v);var f=B[v];if(f)return f;var N=new RegExp("#define\\s+"+v+"\\s+(\\d+)"),h=e.match(N);return B[v]=h?ip(h[1]):0}function F(g){B={},e=g;var l=g.replace(m,K).replace(y,S);return e=null,B=null,l}function K(G,X,h){h=p(h);for(var r="",y=0;h>y;y++)r+=X+y+";";return r}function S(Y,l,H,R){for(var U="",e=p(l);e<p(H);e++)U+=R.replace(/\[\s*i\s*\]/g,"["+e+"]").replace(/\[\s*I\s*\]/g,e);
return U}var B,e,m=/(uniform\s+sampler2D\s+\w+)\[([\S\d]+)\];/g,y=/#UNROLL_LOOP_START\s+for\s*\(\s*int\s+i\s*=\s*([\S\d]+)\s*;\s*i\s*<\s*([\S\d]+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#UNROLL_LOOP_END/g,Z=/^\d+$/;return function(j){return F(j)}}(),Kl=function(G,U,_,W){var h=G.createShader(_);return G.shaderSource(h,hk(W)),G.compileShader(h),G.attachShader(U,h),h},Ik=function(V){return V.createBuffer()},Eb=function(a,x){a.bindTexture(a.TEXTURE_2D,x||a._emptyTexture)},Ln=function(z,m,O){z.texParameteri(z.TEXTURE_2D,m,O)},rl=function(M,b){var k=Jm.for(M).directState();k.polygonOffset.enabled=!0,k.polygonOffset.value=b},_m=function(o){var R=Jm.for(o).directState();R.polygonOffset.enabled=!1},go=function(j,t){if(t){var p=Jm.for(j).directState();p.color.clear=$m(t)}},id=function(m,V,G){if(G!==V._lastClipboxEnabled){var k=m._boxClipperGroups,D=m._boxClipperShape,K=k?k.length:0,U=new Array(K);if(G)for(var i=0;K>i;i++)U[i]=G&1<<k[i]?D[i]:0;V._lastClipboxEnabled=G,V.uClipperShape=U}},qj=id,Jr=function(L){var P=Jm.for(L),C=P.directUniforms(),H=P.directAttribs();C.uFix=!0,H.aNormal=!1},yb=function(l){var h=Jm.for(l),G=h.directUniforms();G.uFix=!1},gb=function(J,l,D,S,j,R,a,k){var Z=Jm.for(J),G=Z.directState(),t=Z.directUniforms();J._picking||(D?(t.uBlend=!0,t.uBlendColor=D):t.uBlend=!1,t.uLight=t.uFog=S==I?!0:S,gs(j)&&1!==j&&(t.uPartOpacity=j),t.uReverseFlip=R==I?!1:R,t.uFixPickReverseColor=a||_g),G.cullFace.enabled=k?!0:!1},he=function(X){if(!X._picking){var z=Jm.for(X),I=z.directUniforms();I.uPartOpacity=1}},th=function(){var N=new B.Math.Matrix2d,T=[1,0,0,0,1,0,0,0,0];return function(p,t,R,U,V,h,O,E,g,n,w){var P=Jm.for(p),Z=P.directUniforms(),b=P.directAttribs();return R?(Z.uTexture=!0,Z.uDiscardSelectable=ki(U)?U:!0,b.aUv=Vi(p,V,h,I,2),w?(Z.uBlendTexture=!0,Z.uBlendSampler=w):(Z.uBlendTexture=!1,Z.uBlendSampler=p._emptyBlendTexture),Z.uSampler=R,Z.uUvMatrix=O||E||g||n?dl(g,O,E,n,N).toArray9():T,void 0):(Z.uSampler=p._emptyTexture,Z.uBlendSampler=p._emptyBlendTexture,void 0)}}(),Uk=function(Y,j,T){var H=Jm.for(Y),P=H.directUniforms(),p=H.directAttribs();Y.activeTexture(Y.TEXTURE0),Eb(Y,I),Y.activeTexture(Y.TEXTURE1),Eb(Y,I),T&&(p.aUv=!1,P.uTexture=!1,P.uSampler=Y._emptyTexture,P.uBlendTexture=!1,P.uBlendSampler=Y._emptyBlendTexture)},Bs=function(D,f,w,W,l,v){var b=Jm.for(D),o=b.directUniforms(),M=b.directAttribs();!w||dq||wm||D.lineWidth(w),W&&!D._picking&&(o.uFixPickReverseColor=W),l&&(M.aPosition=Vi(D,l,v,I))},qb=function(r,J,f,v,d){$c&&(v=r[$c]),d?r.drawArraysInstanced(v==I?r.TRIANGLES:v,J,f,d):r.drawArrays(v==I?r.TRIANGLES:v,J,f);var P=r._renderInfo;P&&(P.calls++,d&&(f*=d),P.vertices+=f,(v==I||v===r.TRIANGLES)&&(P.faces+=f/3),v===r.LINES&&(P.lines+=f/2),v===r.POINTS&&(P.points+=f))},kc=function(Z,f,W,r,H,$){$c&&(r=Z[$c]),$?Z.drawElementsInstanced(r==I?Z.TRIANGLES:r,W,H==I?Z.UNSIGNED_SHORT:H,f==I?0:2*f,$):Z.drawElements(r==I?Z.TRIANGLES:r,W,H==I?Z.UNSIGNED_SHORT:H,f==I?0:2*f);var d=Z._renderInfo;d&&(d.calls++,$&&(W*=$),d.vertices+=W,(r==I||r===Z.TRIANGLES)&&(d.faces+=W/3),r===Z.LINES&&(d.lines+=W/2),r===Z.POINTS&&(d.points+=W))},db=function(L,f,V){var S=L.ARRAY_BUFFER;return L.bindBuffer(S,f),V&&L.bufferData(S,V,L.STATIC_DRAW),f},_e=function(F,B,s,t,j){var B=Vi(F,B,s,t,j);return B.instanced=!0,B},Vi=function(n,c,Y,S,i){return Y?Zm(n,n.ARRAY_BUFFER,c,Y):db(n,c,Y,S,i)},Nd=function(v,R,V){var g=v.ELEMENT_ARRAY_BUFFER;v.bindBuffer(g,R),V&&v.bufferData(g,V,v.STATIC_DRAW)},Pn=function(_,U,I){Zm(_,_.ELEMENT_ARRAY_BUFFER,U,I)},Zm=function(h,V,e,Z){var x=Z._bufId;x||(x=Z._bufId=B.Math.generateIncreasingID());var e,G=h._bufPool;return(e=G[x])&&e._buf?h.bindBuffer(V,e._buf):(e=G[x]={_buf:Ik(h)},h.bindBuffer(V,e._buf),h.bufferData(V,Z,h.STATIC_DRAW)),e._fid=h._renderInfo.frame,e._buf},le=function(O,L){L!=I&&L>=0&&O.enableVertexAttribArray(L)},vn=function(v,m){m!=I&&m>=0&&v.disableVertexAttribArray(m)},ci=function(P,U){var V=P.getGL(),F=Jm.for(V),$=F.directUniforms();P._7O=P._8O.pop(),U&&($.uMVMatrix=P._7O,P._6O=U,$.uNMatrix=U)},gd=function(U,h){return h||(h=an()),rn(h,U),yo(h),er(h),h},Rg=function(P,A){var r=P.getGL(),W=P._7O,i=Jm.for(r),J=i.directUniforms();A?(P._8O.push(yq(W)),J.uMMatrix=A,Hh(W,W,A),P._7O=W):J.uMMatrix=Lr,J.uMVMatrix=W,J.uNMatrix=gd(W,P._6O)},dj={body:0,label:1,label2:2,note:3,note2:4,symbol:5},hm=10,zg=function(u,X,q,p,G,M){var o;if(q){var S=p._pickId;S||(S=p._pickId=X._pickIdUsed,X._pickIdUsed+=hm);var b,_=dj[G];if(null!=_)b=S+_;else{var B=p._pickExtraPartMap;B||(B=p._pickExtraPartMap={}),(b=B[G])||(b=B[G]=X._pickIdUsed++)}X[b]||(X[b]={data:p.data,part:G}),o=Vs(b)}else o=kl;if(!M){var U=Jm.for(u),n=U.directUniforms();n.uFixPickReverseColor=o}return o},ss=zg,ps=function(R,A,r){"target"!==r&&(r="source");var X="target"===r?A.getTargetAgent():A.getSourceAgent(),h="edge."+r+".";if(Dg(X)){var k=A.s(h+"anchor.x"),o=A.s(h+"anchor.elevation"),m=A.s(h+"anchor.y"),M=Zi(X,R.getMat(X)),O=X.getAnchor3d(),L=Ee([(k===z?.5:k)-O.x,(o===z?.5:o)-O.y,(m===z?.5:m)-O.z],M);return L[1]+=A.s(h+"offset.elevation"),L}var j=A.s(h+"index"),i=R.getData3dUI(X);if(!i.info||!i.info.list)return!1;if(j>=0){var N,I,w,u,B,P=i.info._lastPointsSegments,s=P.points,c=P.segments,C=-1,Q=-1;for(w=0,u=c?c.length:s.length;u>w;w++){if(I=c?c.get(w):1,3===I)B=2;else if(4===I)B=3;else{if(5===I)continue;B=1}if(C+=B,Q++,Q===j){N=s.get(C);break}}return N||(N=s.get(s.length-1)),[N.x,(N.e||0)+A.s(h+"offset.elevation"),N.y]}var q=A.s(h+"percent")||.5;if(q=Math.max(0,Math.min(q,1)),!i||!i.getCache)return!1;var F=i.getCache(),u=F[F.length-1].length,P=R.getLineOffset(X,q*u),L=P.point;return[L.x,L.y+A.s(h+"offset.elevation"),L.z]},br=function(){var X={center:function(m,i,j,q,S){var V=-i[1]/2,z={x:-i[0]/2,y:V,width:i[0],height:i[1]},r=Xc(m,z,j);return[r.x+q,-r.y-S,R.getPosition3dGap()]},front:function(U,z,K,O,w){var v=-z[1]/2,Z={x:-z[0]/2,y:v,width:z[0],height:z[1]},j=Xc(U,Z,K);return[j.x+O,-j.y-w,z[2]/2+R.getPosition3dGap()]},back:function(Z,b,W,A,E){var N=-b[0]/2,S=-b[1]/2,w={x:N,y:S,width:b[0],height:b[1]},l=Xc(Z,w,W);return[-l.x-A,-l.y-E,-b[2]/2-R.getPosition3dGap()]},left:function(c,L,T,M,g){var G=-L[1]/2,D={x:-L[2]/2,y:G,width:L[2],height:L[1]},w=Xc(c,D,T);return[-L[0]/2-R.getPosition3dGap(),-w.y-g,w.x+M]},right:function(s,c,q,U,I){var B=-c[2]/2,x=-c[1]/2,O={x:B,y:x,width:c[2],height:c[1]},e=Xc(s,O,q);return[c[0]/2+R.getPosition3dGap(),-e.y-I,-e.x-U]},top:function(I,e,m,f,S){var c={x:-e[0]/2,y:-e[2]/2,width:e[0],height:e[2]},T=Xc(I,c,m);return[T.x+f,e[1]/2+R.getPosition3dGap(),T.y+S]},bottom:function($,N,I,c,P){var A=-N[2]/2,k={x:-N[0]/2,y:A,width:N[0],height:N[2]},n=Xc($,k,I);return[n.x+c,-N[1]/2-R.getPosition3dGap(),-n.y-P]}};return function(J,T,d,g,N,f){return X[g](J,T,d,N||0,f||0)}}(),qf=function(i,w,E,p,P,M,H,c,G,J){if(P&&(w[0]+=P[0],w[1]+=P[1],w[2]+=P[2]),uf(i,E),c){var s=an();if(Ml(s,G,J),Ee(w,s),uf(i,w),i.auto=c,i.pos=Ee([0,0,0],i),M){var r=i.mat2=an();Ml(r,M,H)}}else Ml(i,G,J),uf(i,w),p===xi?eh(i,-pk):p===Dd?eh(i,pk):p===Vh?Kf(i,-pk):p===dd?Kf(i,pk):p===Xo&&eh(i,L),Ml(i,M,H);return i},wn=function(f,l){var Q=l.auto,L=l.mat2,m=f.gv;if(Q){var e,b=an(),t=[0,0,0,0];e="string"==typeof Q?[Q.indexOf("x")<0?m._eye[0]:m._center[0],Q.indexOf("y")<0?m._eye[1]:m._center[1],Q.indexOf("z")<0?m._eye[2]:m._center[2]]:m._eye,Hb(t,gg(an(),e,m._center,m._up)),hp(b,Do(t,t),l.pos),L&&Hh(b,b,L),Rg(m,b)}else Rg(m,l)},hq=function(h,L,d,u,b){var A=h.s,v=h.gv,H=v.getGL(),g=v._prg,V=v._buffer,M=v._1O,n=Jm.for(H),o=n.directAttribs();Qc(H,bp,M),wn(h,d),gb(H,g,A(L+".blend"),A(L+".light"),A(L+".opacity"),A(L+".reverse.flip"),A(L+".reverse.color"),A(L+".reverse.cull")),th(H,g,M,b,V.uv,fd),o.aPosition=Vi(H,V.vs,u,I),o.aNormal=Vi(H,V.ns,_f,I),Pn(H,V.is,Gi),kc(H,0,Gi.length),Uk(H,g,M),he(H,g),ci(v)},Vo=function(q,O,d){var h=q.gv,C=q.data,Y=q[O]={blend:h.getBodyColor(C)||h.getFaceBlend(C,O),light:h.getFaceLight(C,O),color:h.getFaceColor(C,O),opacity:h.getFaceOpacity(C,O),transparent:h.getFaceTransparent(C,O),reverseFlip:h.getFaceReverseFlip(C,O),reverseColor:h.getFaceReverseColor(C,O),reverseCull:h.getFaceReverseCull(C,O),texture:h.getFaceImage(C,O),blendTexture:h.getFaceBlendImage(C,O),discardSelectable:h.getFaceDiscardSelectable(C,O)};if("csg"!==O){Y.uv=h.getFaceUv(C,O)||d&&d[O+"Uv"],Y.uvScale=h.getFaceUvScale(C,O)||d&&d[O+"UvScale"],Y.uvOffset=h.getFaceUvOffset(C,O)||d&&d[O+"UvOffset"],Y.uvRotation=h.getFaceUvRotation(C,O)||d&&d[O+"uvRotation"],Y.uvAnchor=h.getFaceUvAnchor(C,O)||d&&d[O+"uvAnchor"];var Z=h.getFaceMat(C,O);if(Z){var J=Zi(C,Z);C.appendAnchorMatrix3d(J),Y.mat=J}}return Y},il=function(h,T,l,e,f){var A=h[e];if(A){if(!f(A.transparent))return;var j=h.data,o=h.gv,B=o._buffer,H=o.getTexture(A.texture,j,e),V=o.getTexture(A.blendTexture,j),K=Jm.for(T),n=K.directUniforms(),g=K.directAttribs();th(T,l,H,A.discardSelectable,B.uv,A.tuv,A.uvOffset,A.uvScale,A.uvRotation,A.uvAnchor,V),gb(T,l,A.blend,A.light,A.opacity,A.reverseFlip,A.reverseColor,A.reverseCull),A.cs&&!o._batchColorDisabled?(n.uBatchColor=!0,g.aBatchColor=Vi(T,B.batchColor,A.cs,l.aBatchColor,4)):n.uDiffuse=A.color||c["color.empty"],g.aPosition=Vi(T,B.vs,A.vs,I),g.aNormal=Vi(T,B.ns,A.ns,I),qb(T,0,A.vs.length/3),A.cs&&!o._batchColorDisabled&&(n.uBatchColor=!1,vn(T,l.aBatchColor)),he(T,l),Uk(T,l,H)}},km=function(S,g,m){ar(S)?S.forEach(function(L){km(L,g,m)}):Fc(S)?km(kg(g,S),g,m):Pd(S)?S.shape3d?km(S.shape3d,g,m):m.push(S):m.push(S)},fe=function(){for(var Q=50,p=arguments.length,h=[],s=0;p>s;s++)h[s]=arguments[s];Cj[Qn]="Time : "+(new Date).toLocaleString()+", Info :"+h.join(", "),Qn=(Qn+1)%Q,console.error("Failed to create shader.")},dl=function(){var I=new jl.Matrix2d;return function(l,V,x,g,h){return h||(h=I),h.identity(),g&&h.translate(-g[0],-g[1]),x&&h.scale(x[0],x[1]),l&&h.rotate(l),g&&h.translate(g[0],g[1]),V&&h.translate(V[0],V[1]),h}}(),Ei=function(l,G,f,o,L,B){var K,j,e,W,Y,h,U,V,F,H,D,n=[o-G,L-f],Z=l?l.length:0;for(e=0;Z>e;e++){for(W=2,K=l[e],Y=K[0],h=K[1];W+1<K.length;){if(U=K[W],V=K[W+1],j=ek(G,f,o,L,Y,h,U,V,!0)){F=[U-Y,V-h],H=Jc(F),F[0]/=H,F[1]/=H,H=Li(n,F),H=H>0?B:-B,D=[F[0]*H,F[1]*H];break}Y=U,h=V,W+=2}if(D)break}if(D)for(o=G+D[0],L=f+D[1],e=0;Z>e;e++)for(W=2,K=l[e],Y=K[0],h=K[1];W+1<K.length;){if(U=K[W],V=K[W+1],j=ek(G,f,o,L,Y,h,U,V,!0))return[0,0];Y=U,h=V,W+=2}return D?D:[o-G,L-f]},Tc=function(m){return"nearest"===m?Te.NEAREST:"linear"===m?Te.LINEAR:m},lp=B.graph3d={WebGLConstants:Te},Xe=function(m,q,I){Lp(G+".graph3d."+m,q,I)},Xj="!~!<yfusfw!+!yjsubNQv!>!opjujtpQ`mh!gjeof$!~!<6/1!,!*{/mbdpMwVxpmg!,!z/mbdpMwVxpmg!-y/mbdpMwVxpmg)3dfw!>!^j]wVxpmg!<{zy/*enspgtobsu!+!yjsubNNv!+!^j]yjsubNxpmg)!>!mbdpMwVxpmg!|!*,,j!<UDFKCP`XPMG`YBN!=!j!<1!>!j!uoj)!spg!<mbdpMwVxpmg!4dfw!1!?!UDFKCP`XPMG`YBN!gj$!gjeof$!<enspgtobsu!+!yjsubNNv!+!yjsubNxpebit!>!esppDxpebit!QBNXPEBIT`FTV!gfegj$!gjeof$!~!<fdobutjEfojMb!>!fdobutjEfojMw!|!*itbEv)!gj!ITBE!gfegj$!gjeof$!~!<ttfouihjsCidubCb!>!ttfouihjsCidubCw!|!*ttfouihjsCidubCv)!gj!TTFOUIHJSCIDUBC!gfegj$!gjeof$!~!<eofmCidubCb!>!eofmCidubCw!|!*eofmCidubCv)!gj!EOFMCIDUBC!gfegj$!gjeof$!~!<spmpDidubCb!>!spmpDidubCw!|!*spmpDidubCv)!gj!SPMPDIDUBC!gfegj$!gjeof$!~!<**1/2!-wVb)4dfw!+!yjsubNwVv)3dfw!>!wVw!|!*fsvuyfUv)!gj!ftmf$!<*y/wVb!-**1/2!-wVb)4dfw!+!yjsubNwVv)3dfw)4dfw!>!wVw!QJMD`WV!gfegj$!<*enspgtobsu)4dfw!>!opjujtpQw!gjeof$!~!1!>>!SFQQJMD`YPC`YBN!gj$!<*enspgtobsu!+!yjsubNNv)4dfw!>!emspXw!<*yfusfw)4dfw!>!yfusfWw!gjeof$!<**1/2!-mbnspOb)5dfw!+!yjsubNOv)4dfw!>!mbnspOw!ftmf$!<**1/2!-mbnspOb)5dfw!+!yjsubNOv)4dfw!>!mbnspOw!ftmf!~!<**1/2!-mbnspOw!+!n)5dfw!+!yjsubNOv)4dfw!>!mbnspOw!<**^3]n!-^3]n)upe!-*^2]n!-^2]n)upe!-*^1]n!-^1]n)upe)4dfw!0!mbnspOb!>!mbnspOw!<*!efdobutoJyjsubNb!)4ubn!>!n!4ubn!|!*fdobutoJftVv)!gj!FDOBUTOJIDUBC!gfegj$!gjeof$!|!*ldjQva)!gj!1!>>!SFQQJMD`YPC`YBN!gj$!<enspgtobsu!+!yjsubNWNv!>!yfusfw!5dfw!gjeof$!~!<enspgtobsu!+!efdobutoJyjsubNb!>!enspgtobsu!|!*fdobutoJftVv)!gj!FDOBUTOJIDUBC!gfegj$!<*1/2!-opjujtpQb)5dfw!>!enspgtobsu!5dfw!|!*ejpw)ojbn!ejpw!gjeof$!<^UDFKCP`XPMG`YBN]wVxpmg!3dfw!hojzsbw!<^UDFKCP`XPMG`YBN]yjsubNxpmg!5ubn!nspgjov!1!?!UDFKCP`XPMG`YBN!gj$!gjeof$!<esppDxpebit!5dfw!hojzsbw!<yjsubNxpebit!5ubn!nspgjov!QBNXPEBIT`FTV!gfegj$!gjeof$!<fdobutjEfojMw!ubpmg!hojzsbw!<fdobutjEfojMb!ubpmg!fuvcjsuub!<itbEv!mppc!nspgjov!ITBE!gfegj$!gjeof$!<^UPQT`YBN]opjudfsjEupqTv!4dfw!nspgjov!<^UPQT`YBN]opjujtpQupqTv!4dfw!nspgjov!<^UPQT`YBN]spmpDupqTv!5dfw!nspgjov!1!?!UPQT`YBN!gj$!gjeof$!<^UOJPQ`YBN]opjujtpQuojpQv!4dfw!nspgjov!<^UOJPQ`YBN]spmpDuojpQv!5dfw!nspgjov!1!?!UOJPQ`YBN!gj$!gjeof$!<^SJE`YBN]opjudfsjEsjEv!4dfw!nspgjov!<^SJE`YBN]spmpDsjEv!5dfw!nspgjov!1!?!SJE`YBN!gj$!gjeof$!<eofmCidubCw!4dfw!hojzsbw!<eofmCidubCb!4dfw!fuvcjsuub!<eofmCidubCv!mppc!nspgjov!EOFMCIDUBC!gfegj$!gjeof$!<ttfouihjsCidubCw!ubpmg!hojzsbw!<ttfouihjsCidubCb!ubpmg!fuvcjsuub!<ttfouihjsCidubCv!mppc!nspgjov!TTFOUIHJSCIDUBC!gfegj$!gjeof$!<spmpDidubCw!5dfw!hojzsbw!<spmpDidubCb!5dfw!fuvcjsuub!<spmpDidubCv!mppc!nspgjov!SPMPDIDUBC!gfegj$!<opjujtpQw!4dfw!hojzsbw!<emspXw!4dfw!hojzsbw!<yfusfWw!4dfw!hojzsbw!<mbnspOw!4dfw!hojzsbw!<yjGv!mppc!nspgjov!<ldjQv!mppc!nspgjov!<yjsubNxfjWv!5ubn!nspgjov!<yjsubNOv!5ubn!nspgjov!<yjsubNQv!5ubn!nspgjov!<yjsubNNv!5ubn!nspgjov!<yjsubNWNv!5ubn!nspgjov!<opjujtpQb!4dfw!fuvcjsuub!gjeof$!~!<*{zy/**1/1!-sje)5dfw!+!yjsubn))f{jmbnspo!osvufs!|!*yjsubn!5ubn!oj!-sje!4dfw!oj!)opjudfsjEnspgtobsu!4dfw!<efdobutoJyjsubNb!5ubn!fuvcjsuub!<fdobutoJftVv!mppc!nspgjov!FDOBUTOJIDUBC!gfegj$!<mbnspOb!4dfw!fuvcjsuub!gjeof$!<wVw!3dfw!hojzsbw!ftmf$!<wVw!4dfw!hojzsbw!QJMD`WV!gfegj$!<wVb!3dfw!fuvcjsuub!<yjsubNwVv!4ubn!nspgjov!<fsvuyfUeofmCv!mppc!nspgjov!<fsvuyfUv!mppc!nspgjov!YJGFSQ$!^#CBRBEJxTT87hJFI,,bX1XrIwcn3UM{ZeZ,M6HEN6nLxe2Z72s2:3johr6foKrpqwxNKYkdbJ2CN[mBbf[wXU,T0oGuSEd190ohLZkEn8IuCe[OHoWeKz:Sf,VS7xdSLw23W1YJLU:jdv2{hiDbhDzNNEh9tp3xsuEp94Sl4c3wRzqwShMDRhCLRjCDEBOH5BBVRBCFRE4cJTHrTDH1BNgHJN",Rb="!~!~!<eJ!>!spmpDhbsG`mh!~!<spmpDsfmqnbTwv!>+!eJ!<*zy/wVw!-sfmqnbTeofmCv)E3fsvuyfu!>!spmpDsfmqnbTwv!5dfw!|!*fsvuyfUeofmCv)!gj!gjeof$!~!<ttfouihjsCidubCw!>+!chs/eJ!|*ttfouihjsCidubCv)gj!TTFOUIHJSCIDUBC!gfegj$!~!<ttfouihjsCv!>+!chs/eJ!|*1/2!>a!ttfouihjsCv)gj!gjeof$!~!<*spudbGhpg!-*x/eJ!-chs/spmpDhpGv)5dfw!-eJ)yjn!>!eJ!gjeof$!<*iuqfe!-sbGhpGv!-sbfOhpGv)qfutiuppnt!>!spudbGhpg!ubpmg!ftmf$!<*iuqfe!+!iuqfe!+!zujtofEhpGv!+!zujtofEhpGv!.)qyf!.!1/2!>!spudbGhpg!ubpmg!3QYF`HPG!gfegj$!<{/yfusfWw.!>!iuqfe!ubpmg!|!*hpGv)!gj!HPG!gfegj$!~!~!<zujdbqPusbQv!>+!b/eJ!|*1/2!>a!zujdbqPusbQv)gj!~!gjeof$!~!<zujwjudfmgfSv!+!{zy/spmpDwof!>,!chs/eJ!gjeof$!<*spmpDwof)sbfojMpUmfyfUqbNwof!>!spmpDwof!<**{z/dfWudfmgfs!-y/dfWudfmgfs)4dfw!-qbNwoFv)fcvDfsvuyfu!>!spmpDwof!5dfw!ftmf$!<**ttfoihvps!-*{z/dfWudfmgfs!-y/dfWudfmgfs.)4dfw!-qbNwoFv)WVfcvDfsvuyfu)CHStpUsbfojM!>!spmpDwof!5dfw!WV`FCVD`FQZU`QBNWOF!gfegj$!gjeof$!<*mbnspOemspx!-yfusfWpUbsfnbd)udfmgfs!>!dfWudfmgfs!4dfw!ftmf$!<***mbnspOemspx!-yfusfWpUbsfnbd)udfmgfs!-ubvRqbnwoFv)spudfWfubups)f{jmbnspo!>!dfWudfmgfs!4dfw!FUBUPS`QBNWOF!gfegj$!<*yjsubNxfjWv!-O)opjudfsjEnspgtobsUftsfwoj!>!mbnspOemspx!4dfw!<*opjujtpQbsfnbDv!.!emspXw)f{jmbnspo!>!yfusfWpUbsfnbd!4dfw!|*qbNwoFftVv)!gj!QBNWOF`FTV!gfegj$!gjeof$!~!~!~!~!<chs/^j]spmpDupqTv!+!udfggFupqt!+!fhobSm!+!*1/1!-*mbnspOm.!-O)upe)ybn!>,!chs/eJ!<*1/1!-*^j]uofopqyFupqTv!-udfggFupqt)xpq)ybn!>!udfggFupqt!|*^j]fmhoBupqTv!?!udfggFupqt)gj!<*mbnspOm!-^j]opjudfsjEupqTv)upe!>!udfggFupqt!ubpmg!<*spudfWm)f{jmbnspo!>!mbnspOm!4dfw!|*1/1!?!fhobSm)!gj!~!<*1/2!-*^j]fhobSupqTv!0!*spudfWm)iuhofm))ojn!.!1/2!>!fhobSm!|*1/1!?!^j]fhobSupqTv)!gj!<1/2!>!fhobSm!ubpmg!<^j]opjujtpQupqTv!.!yfusfWw!>!spudfWm!4dfw!|*1/1!>>!x/^j]spmpDupqTv)gj!|!*,,j!<UPQT`YBN!=!j!<1>j!uoj)spg!1!?!UPQT`YBN!gj$!gjeof$!~!~!~!<chs/^j]spmpDuojpQv!+!fhobSm!+!*1/1!-**spudfWm)f{jmbnspo.!-O)upe)ybn!>,!chs/eJ!|*1/1!?!fhobSm)!gj!~!<*1/2!-*^j]fhobSuojpQv!0!*spudfWm)iuhofm))ojn!.!1/2!>!fhobSm!|*1/1!?!^j]fhobSuojpQv)!gj!<1/2!>!fhobSm!ubpmg!<^j]opjujtpQuojpQv!.!yfusfWw!>!spudfWm!4dfw!|*1/1!>>!x/^j]spmpDuojpQv)gj!|!*,,j!<UOJPQ`YBN!=!j!<1>j!uoj)spg!1!?!UOJPQ`YBN!gj$!gjeof$!~!~!<chs/^j]spmpDsjEv!+!*1/1!-**^j]opjudfsjEsjEv)f{jmbnspo.!-O)upe)ybn!>,!chs/eJ!|*1/1!>>!x/^j]spmpDsjEv)gj!|!*,,j!<SJE`YBN!=!j!<1>j!uoj)spg!1!?!SJE`YBN!gj$!~!<chs/spmpDuihjmebfIv!+!nsfUusfcnbm!>+!chs/eJ!gjeof$!~!<fvmbWxpebit!+!zujtofuoJxpebit!.!1/2!>+!nsfUusfcnbm!~!<osvufs!<esbdtje!|!*1/1!>>!fvmbWxpebit!%%!mmvDxpebit)!gj!<*esppDxpebit!-tvjebSxpebit!-tbjCxpebit!-f{jTxpebit!-qbNxpebit)xpebiTufh!.!1/2!>!fvmbWxpebit!ubpmg!|!*fwjfdfSxpebit)!gj!QBNXPEBIT`FTV!gfegj$!~!<*1/2!-fhobSuihjmebfIv0*yfusfWw)iuhofm)ojn!.!1/2!>+!nsfUusfcnbm!|*1/1!?!fhobSuihjmebfIv)gj!<*1/1!-zujtofuoJuofjcnBuihjmebfIv!,!*zujtofuoJuofjcnBuihjmebfIv!.!1/2)!+!nsfUusfcnbm)ybn!>!nsfUusfcnbm!<*opjudfsjEuihjmebfIv.!-O)upe!>!nsfUusfcnbm!ftmf!<*M.!-O)upe!>!nsfUusfcnbm!*1/1!>>!{/opjudfsjEuihjmebfIv!%%!1/1!>>!z/opjudfsjEuihjmebfIv!%%!1/1!>>!y/opjudfsjEuihjmebfIv)!gj!<nsfUusfcnbm!ubpmg!|*1/1!>>!x/spmpDuihjmebfIv)gj!gjeof$!EOF`QPPM`MMPSOV$!~!gjeof$!<chs/mfyfUxpmg!>,!chs/eJ!ftmf$!<bchs/mfyfUxpmg!>,!bchs/eJ!*!BCHS`EEB`FEPN`EOFMC`XPMG!)efojgfe!gjmf$!<bchs/mfyfUxpmg!>!bchs/eJ!*!BCHS`FEJSSFWP`FEPN`EOFMC`XPMG!)efojgfe!gjmf$!<b/mfyfUxpmg!>!b/eJ!*!B`FEJSSFWP`FEPN`EOFMC`XPMG!)efojgfe!gjmf$!<chs/mfyfUxpmg!>!chs/eJ!*!CHS`FEJSSFWP`FEPN`EOFMC`XPMG!)efojgfe!gjmf$!<bchs/mfyfUxpmg!>+!bchs/eJ!*!BCHS`ZMQJUMVN`FEPN`EOFMC`XPMG!)efojgfe!gjmf$!<chs/mfyfUxpmg!>+!chs/eJ!*!CHS`ZMQJUMVN`FEPN`EOFMC`XPMG!)efojgfe!gj$!****1/1)3dfw!-^j]wVxpmg)obiUsfubfsh)mmb!%%!***1/2)3dfw!-^j]wVxpmg)obiUttfm)mmb!%%!^j]efmcboFxpmg)!gj!<*^j]wVxpmg!-^J]fsvuyfUxpmg)E3fsvuyfu!>!mfyfUxpmg!|!*,,j!<UDFKCP`XPMG`YBN!=!j!<1>j!uoj)!spg!USBUT`QPPM`MMPSOV$!<mfyfUxpmg!5dfw!1!?!UDFKCP`XPMG`YBN!gj$!|!*uihjMv)!gj!~!gjeof$!~!<spmpDeofmCv!>+!eJ!|*eofmCv)gj!ftmf$!~!<spmpDeofmCv!>+!eJ!|*eofmCv)gj!ftmf!~!<eofmCidubCw!>+!chs/eJ!|*eofmCidubCv)gj!EOFMCIDUBC!gfegj$!~!~!<esbdtje!|*1/1!>>!x/eJ)gj!gjeof$!<ftvggjEv!>!eJ!ftmf$!~!<ftvggjEv!>!eJ!|ftmf~!<spmpDidubCw!>!eJ!|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!|!ftmf!~!<spmpDwv!>!eJ!|*fsvuyfUv)gj!|!ftmf!~!<spmpDftsfwfSldjQyjGv!>!eJ!|*qjmGftsfwfSva!%%!ldbCtj)gj!~!<fvsu!>!ldbCtj!<O.!>!O!|*1/1!=!*O!-F)upe)gj!<ftmbg!>!ldbCtj!mppc!<F.!>!M!4dfw!gjeof$!<*yfusfWw.)f{jmbnspo!>!F!4dfw!ftmf$!<*2!-1!-1)4dfw!>!F!4dfw!DJIQBSHPIUSP!gfegj$!<*mbnspOw)f{jmbnspo!>!O!4dfw!|!ftmf!~!gjeof$!~!~!<ftvggjEv!>!eJ!|ftmf!~!<esbdtje!|*1/1!>>!x/ftvggjEv)gj!|!*fdobutjEitbEv!?!*fdobutjEqbHitbEv!-fdobutjEfojMw)epn!%%!itbEv)!gj!ITBE!gfegj$!gjeof$!<spmpDftsfwfSldjQyjGv!>!eJ!ftmf$!~!<spmpDftsfwfSldjQyjGv!>!eJ!|!ftmf!~!<spmpDidubCw!>!eJ!|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!|!*yjGv)!gj!<eJ!5dfw!|!ftmf!~!~!<esbdtje!|!*1/1!>>!b/spmpDhbsG`mh)!gj!gjeof$!<spmpDftsfwfSldjQyjGv!>!spmpDhbsG`mh!ftmf$!~!<spmpDftsfwfSldjQyjGv!>!spmpDhbsG`mh!|!ftmf!~!<spmpDidubCw!>!spmpDhbsG`mh!|!*spmpDidubCv)!gj!SPMPDIDUBC!gfegj$!|!*ldjQv)!gj!~!<osvufs!<*1/2!-1/1!-1/1!-1/1)5dfw!>!spmpDhbsG`mh!|!*uvpldbmc)!gj!gjeof$!~!~!<osvufs!<esbdtje!|!**6/1!=!*mbdpMw)iuhofm)!>a!^j]sfooJqjmDsfqqjmDv!%%!3!>>!^j]fqbiTsfqqjmDv!}}!***ojNqjmd!-mbdpMw)obiUsfubfsh)mmb!%%!**ybNqjmd!-mbdpMw)obiUttfm)mmb)!>a!^j]sfooJqjmDsfqqjmDv!%%!2!>>!^j]fqbiTsfqqjmDv)!gj!<**1/2!-emspXw)5dfw!+!^j]yjsubNsfqqjmDv)4dfw!>!mbdpMw!|!*,,j!<SFQQJMD`YPC`YBN!=!j!<1!>!j!uoj)!spg!<mbdpMw!4dfw!1!?!SFQQJMD`YPC`YBN!gj$!~!gjeof$!~!<esbdtje!|!**sje!-*uofdsfQqjmDv)4dfw)upe!?!*opjujtpQw!-sje)upe)!gj!ftmf$!~!<esbdtje!|!**sje!-*uofdsfQqjmDv)4dfw)upe!?!*opjujtpQqjmd!-sje)upe)!gj!~!<*1/1!-1/1!-{/wVw)4dfw!>!opjujtpQqjmd!<1/2.!>!y/sje!|!*:!=!opjudfsjEqjmDv)!gj!ftmf!~!<*1/1!-1/1!-{/wVw)4dfw!>!opjujtpQqjmd!<1/2!>!y/sje!|!*9!=!opjudfsjEqjmDv)!gj!ftmf!QJMD`WV!gfegj$!~!<1/2.!>!{/sje!|!*8!=!opjudfsjEqjmDv)!gj!ftmf!~!<1/2!>!{/sje!|!*7!=!opjudfsjEqjmDv)!gj!ftmf!~!<1/2.!>!z/sje!|!*6!=!opjudfsjEqjmDv)!gj!ftmf!~!<1/2!>!z/sje!|!*5!=!opjudfsjEqjmDv)!gj!ftmf!~!<1/2.!>!y/sje!|!*4!=!opjudfsjEqjmDv)!gj!ftmf!~!<1/2!>!y/sje!|!*3!=!opjudfsjEqjmDv)!gj!gjeof$!<opjujtpQw!>!opjujtpQqjmd!4dfw!QJMD`WV!gfegj$!<*1/1!-1/1!-1/1)4dfw!>!sje!4dfw!|!*1!?!opjudfsjEqjmDv)!gj!~!~!~!<esbdtje!|!*utfUbiqmBv!>=!b/spmpDwv)!gj!|!ftmf!~!~!<esbdtje!|!*1/1!>>!b/spmpDwv)!gj!|!*uofsbqtobsUv)!gj!gjeof$!<*wVw!-sfmqnbTv)E3fsvuyfu!>!spmpDwv!ftmf$!<*zy/wVw!-sfmqnbTv)E3fsvuyfu!>!spmpDwv!QJMD`WV!gfegj$!|!**fmcbudfmfTesbdtjEv!%%!ldjQv)a!%%!fsvuyfUv)!gj!<spmpDwv!5dfw!|!*ejpw)ojbn!ejpw!<uvpldbmc!mppc!nspgjov!gjeof$!<^UDFKCP`XPMG`YBN]wVxpmg!3dfw!hojzsbw!<^UDFKCP`XPMG`YBN]efmcboFxpmg!mppc!nspgjov!<^UDFKCP`XPMG`YBN]fsvuyfUxpmg!E3sfmqnbt!nspgjov!1!?!UDFKCP`XPMG`YBN!gj$!gjeof$!gjeof$!~!~!<*1/2!-*Gqjn!-2spmpd!-1spmpd)yjn)5dfw!osvufs!<*1/2!,!uoJqjn!-sjEfmqnbt!-qbNwof)WVfcvDsbfojmjc!>!2spmpd!4dfw!|!ftmf!~!<*1/2!-1spmpd)5dfw!osvufs!|!*1/1!>>!Gqjn)!gj!<*uoJqjn!-sjEfmqnbt!-qbNwof)WVfcvDsbfojmjc!>!1spmpd!4dfw!<*qjn)sppmg!>!uoJqjn!ubpmg!<*qjn)udbsg!>!Gqjn!ubpmg!<*mfwfMqjNybn`WVfcvd!-1n!-*ttfoihvps)qjNpUttfoihvps)qnbmd!>!qjn!ubpmg!|!*ttfoihvps!ubpmg!-sjEfmqnbt!4dfw!-qbNwof!E3sfmqnbt)WVfcvDfsvuyfu!5dfw!~!<qjn!osvufs!~!<*ttfoihvps!+!72/2)3hpm!+!1/3!.!>!qjn!|!ftmf!~!<6n!,!*7s!.!6s)!0!*6n!.!7n)!+!*ttfoihvps!.!6s)!>!qjn!|!*7s!>?!ttfoihvps)!gj!ftmf!~!<5n!,!*6s!.!5s)!0!*5n!.!6n)!+!*ttfoihvps!.!5s)!>!qjn!|!*6s!>?!ttfoihvps)!gj!ftmf!~!<2n!,!*5s!.!2s)!0!*2n!.!5n)!+!*ttfoihvps!.!2s)!>!qjn!|!*5s!>?!ttfoihvps)!gj!ftmf!~!<1n!,!*2s!.!1s)!0!*1n!.!2n)!+!*ttfoihvps!.!1s)!>!qjn!|!*2s!>?!ttfoihvps)!gj!<1/1!>!qjn!ubpmg!|!*ttfoihvps!ubpmg)qjNpUttfoihvps!ubpmg!1/5!7n!fojgfe$!9411/1!7w!fojgfe$!23/1!7s!fojgfe$!1/4!6n!fojgfe$!721/1!6w!fojgfe$!614/1!6s!fojgfe$!1/3!5n!fojgfe$!751/1!5w!fojgfe$!5/1!5s!fojgfe$!1/2!.!2n!fojgfe$!783/1!2w!fojgfe$!9/1!2s!fojgfe$!1/3!.!1n!fojgfe$!:44/1!1w!fojgfe$!1/2!1s!fojgfe$!~!<*z/g!-nc!-nu)yjn!osvufs!<*y/g!-sc!-mc)yjn!>!nc!4dfw!<*y/g!-su!-mu)yjn!>!nu!4dfw!<chs/**wv!-qbNwof)E3fsvuyfu)sbfojMpUmfyfUqbNwof!>!mc!4dfw!<f{jTmfyfu!>.!y/wv!<chs/**wv!-qbNwof)E3fsvuyfu)sbfojMpUmfyfUqbNwof!>!sc!4dfw!<f{jTmfyfu!>,!z/wv!<chs/**wv!-qbNwof)E3fsvuyfu)sbfojMpUmfyfUqbNwof!>!su!4dfw!<f{jTmfyfu!>,!y/wv!<chs/**wv!-qbNwof)E3fsvuyfu)sbfojMpUmfyfUqbNwof!>!mu!4dfw!<f{jTmfyfu!>+!wv!<*f{jTfdbg!+!1/3!.!f{jTfmjUybn`WVfcvd!-1/1)ybn!+!1/4!>,!y/wv!<f{jTfmjUojn`WVfcvd!+!1/3!+!uoJsfumjg!>,!z/wv!~!<f{jTfmjUybn`WVfcvd!+!1/3!>,!z/wv!|!*mfwfMqjNybn`WVfcvd!=!uoJqjn)!gj!<f{jTfdbg!+!fdbg!>,!y/wv!~!<1/4!>.!fdbg!<f{jTfdbg!>,!z/wv!|!*1/3!?!fdbg)!gj!<g!.!6/1!>,!wv!<*wv)udbsg!>!g!3dfw!<*1/2!.!f{jTfdbg)!+!*fdbg!-opjudfsje)WVufh!>!wv!3dfw!<*f{jTfmjUybn`WVfcvd!+!1/4)!0!1/2!>!f{jTmfyfu!ubpmg!<*uoJqjn)3qyf!>!f{jTfdbg!ubpmg!<*mfwfMqjNojn`WVfcvd!-uoJqjn)ybn!>!uoJqjn!<*1/1!-uoJqjn!.!mfwfMqjNojn`WVfcvd)ybn!>!uoJsfumjg!ubpmg!<*opjudfsje)fdbGufh!>!fdbg!ubpmg!|!*uoJqjn!ubpmg!-opjudfsje!4dfw!-qbNwof!E3sfmqnbt)WVfcvDsbfojmjc!4dfw!~!<*1/2!,!wv)!+!6/1!osvufs!~!<*{/opjudfsje)tcb!0!*z/opjudfsje!-y/opjudfsje)3dfw!>!wv!|!ftmf!~!<*z/opjudfsje)tcb!0!*{/opjudfsje!-y/opjudfsje!.)3dfw!>!wv!|!*1/5!>>!fdbg)!gj!ftmf!~!<*y/opjudfsje)tcb!0!*z/opjudfsje!-{/opjudfsje!.)3dfw!>!wv!|!*1/4!>>!fdbg)!gj!ftmf!~!<*{/opjudfsje)tcb!0!*z/opjudfsje!-y/opjudfsje!.)3dfw!>!wv!|!*1/3!>>!fdbg)!gj!ftmf!~!<*z/opjudfsje)tcb!0!*{/opjudfsje!.!-y/opjudfsje!.)3dfw!>!wv!|!*1/2!>>!fdbg)!gj!ftmf!~!<*y/opjudfsje)tcb!0!*z/opjudfsje!-{/opjudfsje)3dfw!>!wv!|!*1/1!>>!fdbg)!gj!<wv!3dfw!|!*fdbg!ubpmg!-opjudfsje!4dfw)WVufh!3dfw!~!<fdbg!osvufs!~!<1/5!;!1/2!@!1/1!?!z/opjudfsje!>!fdbg!ftmf!<1/6!;!1/3!@!1/1!?!{/opjudfsje!>!fdbg!*z/opjudfsjEtcb!?!{/opjudfsjEtcb)!gj!|!ftmf!~!<1/5!;!1/2!@!1/1!?!z/opjudfsje!>!fdbg!ftmf!<1/4!;!1/1!@!1/1!?!y/opjudfsje!>!fdbg!*z/opjudfsjEtcb!?!y/opjudfsjEtcb)!gj!|!*{/opjudfsjEtcb!?!y/opjudfsjEtcb)!gj!<1/2!.!>!fdbg!ubpmg!<*opjudfsje)tcb!>!opjudfsjEtcb!4dfw!|!*opjudfsje!4dfw)fdbGufh!ubpmg!1/72!f{jTfmjUojn`WVfcvd!fojgfe$!1/763!f{jTfmjUybn`WVfcvd!fojgfe$!1/5!mfwfMqjNojn`WVfcvd!fojgfe$!1/9!mfwfMqjNybn`WVfcvd!fojgfe$!WV`FCVD`FQZU`QBNWOF!gfegj$!~!<*{zy/*yjsubn!+!*1/1!-sje)5dfw))f{jmbnspo!osvufs!|!*yjsubn!5ubn!oj!-sje!4dfw!oj)opjudfsjEnspgtobsUftsfwoj!4dfw!gjeof$!~!<*x/fvmbw!-**SPUDBG`BNNBH)4dfw!-{zy/fvmbw)xpq)5dfw!osvufs!|!*fvmbw!5dfw)sbfojMpUmfyfUqbNwof!5dfw!ftmf$!~<*!b/fvmbw!-*!*!*!*!9142411/1!)4dfw!-chs/fvmbw!)mbvrFobiUttfm!)4dfw!-3:/32!+!chs/fvmbw!-*!661/1!)4dfw!.!661/2!+!*!*!77725/1!)4dfw!-chs/fvmbw!)xpq!)yjn!)5dfw!osvufs!|!*!fvmbw!5dfw!oj!)CHStpUsbfojM!5dfw!~!<*b/fvmbw!-****65151/1)4dfw!-chs/fvmbw)mbvrFobiUttfm)4dfw!-9194::4881/1!+!chs/fvmbw!-**5/3)4dfw!-*5218342361/1)4dfw!,!79:387985:/1!+!chs/fvmbw)xpq)yjn)5dfw!osvufs!|!*fvmbw!5dfw)sbfojMpUmfyfUqbNwof!5dfw!WV`FCVD`FQZU`QBNWOF!gfegj$!gjeof$!~!<{zy/*!*x/ubvr!-{/ubvr.!-z/ubvr.!-y/ubvr.)5dfw!-wr!)ubvRumvn!osvufs!<*!*1/1!-dfw)5dfw!-ubvr!)ubvRumvn!>!wr!5dfw!|!*!dfw!4dfw!-ubvr!5dfw!)spudfWfubups!4dfw!~!<*!{/3r!+!{/2r!.!z/3r!+!z/2r!.!y/3r!+!y/2r!.!x/3r!+!x/2r!-z/3r!+!y/2r!.!y/3r!+!z/2r!,!x/3r!+!{/2r!,!{/3r!+!x/2r!-y/3r!+!{/2r!.!{/3r!+!y/2r!,!x/3r!+!z/2r!,!z/3r!+!x/2r!-{/3r!+!z/2r!.!z/3r!+!{/2r!,!x/3r!+!y/2r!,!y/3r!+!x/2r)5dfw!osvufs!|!*3r!5dfw!-2r!5dfw)ubvRumvn!5dfw!<ubvRqbnwoFv!5dfw!nspgjov!FUBUPS`QBNWOF!gfegj$!<1/3!>!SPUDBG`BNNBH!ubpmg!utopd!QBNWOF`FTV!gfegj$!gjeof$!~!gjeof$!<*qe!-*z/f{jTmfyfu!-E4ec)WVpUfcvd!-qbNxpebit)fsbqnpDE3fsvuyfu!osvufs!ftmf$!<*1/:!0!1/2)!+!*!*qe!-*z/f{jTmfyfu!-yyz/uftggp!,!E4ec)WVpUfcvd!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*qe!-*z/f{jTmfyfu!-yyy/uftggp!,!E4ec)WVpUfcvd!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*qe!-*z/f{jTmfyfu!-zyz/uftggp!,!E4ec)WVpUfcvd!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*qe!-*z/f{jTmfyfu!-zyy/uftggp!,!E4ec)WVpUfcvd!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*qe!-*z/f{jTmfyfu!-E4ec)WVpUfcvd!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*qe!-*z/f{jTmfyfu!-yzz/uftggp!,!E4ec)WVpUfcvd!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*qe!-*z/f{jTmfyfu!-yzy/uftggp!,!E4ec)WVpUfcvd!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*qe!-*z/f{jTmfyfu!-zzz/uftggp!,!E4ec)WVpUfcvd!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*qe!-*z/f{jTmfyfu!-zzy/uftggp!,!E4ec)WVpUfcvd!-qbNxpebit)fsbqnpDE3fsvuyfu!)!osvufs!<z/f{jTmfyfu!+!tvjebSxpebit!+!*2!-2!.)3dfw!>!uftggp!3dfw!*UGPT`GDQ`FQZU`QBNXPEBIT)efojgfe!}}!*GDQ`FQZU`QBNXPEBIT)efojgfe!gj$!<*opjujtpQpUuihjm)f{jmbnspo!>!E4ec!4dfw!<tbjCxpebit!>,!qe!<*sbfObsfnbDxpebit!.!sbGbsfnbDxpebit)!0!*sbfObsfnbDxpebit!.!*opjujtpQpUuihjm)iuhofm)!>!qe!ubpmg!<{zy/esppDxpebit!>!opjujtpQpUuihjm!4dfw!<**1/3!-1/5)3dfw!+!f{jTqbNxpebit)!0!*1/2)3dfw!>!f{jTmfyfu!3dfw!|!*sbGbsfnbDxpebit!ubpmg!-sbfObsfnbDxpebit!ubpmg!-esppDxpebit!5dfw!-tvjebSxpebit!ubpmg!-tbjCxpebit!ubpmg!-f{jTqbNxpebit!3dfw!-qbNxpebit!E3sfmqnbt)xpebiTuojpQufh!ubpmg!~!<*68/1!-684/1)3dfw!,!sbobmq!+!*63/1!-632/1)3dfw!osvufs!~!<1/3!.!Zohjt!+!{/w!>!z/sbobmq!<1/3!,!Zohjt!+!1/3!,!y/w!>!y/sbobmq!<*z/w)ohjt!>!Zohjt!ubpmg!|!*foPutpnmb!>?!z/Wtcb)!gj!ftmf!~!<Yohjt!+!1/3!,!Yohjt!+!{/w!>!y/sbobmq!<*y/w)ohjt!>!Yohjt!ubpmg!|!*foPutpnmb!>?!y/Wtcb)!gj!ftmf!~!<y/w!.!1/5!>!y/sbobmq!*1/1!?!{/w)!gj!|!*foPutpnmb!>?!{/Wtcb)!gj!<mfyfUButpnmb!.!1/2!>!foPutpnmb!ubpmg!<Zf{jTmfyfu!+!6/2!>!mfyfUButpnmb!ubpmg!<zy/w!>!sbobmq!3dfw!<*Zf{jTmfyfu!+!1/3!.!1/2)!+!fcvDpUfmbdt!>+!w!<fcvDpUfmbdt!>+!Wtcb!<**{/Wtcb!-z/Wtcb)ybn!-y/Wtcb)ybn!0!1/2!>!fcvDpUfmbdt!ubpmg!<*w)tcb!>!Wtcb!4dfw!|!*Zf{jTmfyfu!ubpmg!-w!4dfw)WVpUfcvd!3dfw!~!<xpebit!osvufs!~!gjeof$!<*{/esppDxpebit!-zy/esppDxpebit!-qbNxpebit)fsbqnpDE3fsvuyfu!>!xpebit!ftmf$!<*1/:!0!1/2)!+!*!*{/esppDxpebit!-*2ze!-2ye)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit)qsfMxpebiTE3fsvuyfu!,!*{/esppDxpebit!-*2ze!-1/1)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit)qsfMxpebiTE3fsvuyfu!,!*{/esppDxpebit!-*2ze!-1ye)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit)qsfMxpebiTE3fsvuyfu!,!*{/esppDxpebit!-*1/1!-2ye)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit)qsfMxpebiTE3fsvuyfu!,!*{/esppDxpebit!-zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit)qsfMxpebiTE3fsvuyfu!,!*{/esppDxpebit!-*1/1!-1ye)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit)qsfMxpebiTE3fsvuyfu!,!*{/esppDxpebit!-*1ze!-2ye)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit)qsfMxpebiTE3fsvuyfu!,!*{/esppDxpebit!-*1ze!-1/1)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit)qsfMxpebiTE3fsvuyfu!,!*{/esppDxpebit!-*1ze!-1ye)3dfw!,!zy/esppDxpebit!-f{jTqbNxpebit!-qbNxpebit)qsfMxpebiTE3fsvuyfu!)!>!xpebit!<tvjebSxpebit!+!z/f{jTmfyfu!,!>!2ze!ubpmg!<tvjebSxpebit!+!y/f{jTmfyfu!,!>!2ye!ubpmg!<tvjebSxpebit!+!z/f{jTmfyfu!.!>!1ze!ubpmg!<tvjebSxpebit!+!y/f{jTmfyfu!.!>!1ye!ubpmg!<f{jTqbNxpebit!0!*1/2)3dfw!>!f{jTmfyfu!3dfw!*UGPT`GDQ`FQZU`QBNXPEBIT)efojgfe!gjmf$!<*1/:!0!1/2)!+!*!*{/esppDxpebit!-*2ze!-2ye)3dfw!,!zy/esppDxpebit!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*{/esppDxpebit!-*2ze!-1/1)3dfw!,!zy/esppDxpebit!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*{/esppDxpebit!-*2ze!-1ye)3dfw!,!zy/esppDxpebit!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*{/esppDxpebit!-*1/1!-2ye)3dfw!,!zy/esppDxpebit!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*{/esppDxpebit!-zy/esppDxpebit!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*{/esppDxpebit!-*1/1!-1ye)3dfw!,!zy/esppDxpebit!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*{/esppDxpebit!-*1ze!-2ye)3dfw!,!zy/esppDxpebit!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*{/esppDxpebit!-*1ze!-1/1)3dfw!,!zy/esppDxpebit!-qbNxpebit)fsbqnpDE3fsvuyfu!,!*{/esppDxpebit!-*1ze!-1ye)3dfw!,!zy/esppDxpebit!-qbNxpebit)fsbqnpDE3fsvuyfu!)!>!xpebit!<tvjebSxpebit!+!z/f{jTmfyfu!,!>!2ze!ubpmg!<tvjebSxpebit!+!y/f{jTmfyfu!,!>!2ye!ubpmg!<tvjebSxpebit!+!z/f{jTmfyfu!.!>!1ze!ubpmg!<tvjebSxpebit!+!y/f{jTmfyfu!.!>!1ye!ubpmg!<f{jTqbNxpebit!0!*1/2)3dfw!>!f{jTmfyfu!3dfw!*GDQ`FQZU`QBNXPEBIT)efojgfe!gj$!|!*utfUnvutvsg)!gj!<*dfWutfUnvutvsg)mmb!>!utfUnvutvsg!mppc!<*1/2!>=!{/esppDxpebit!-nvutvsGoj)3dfwc!>!dfWutfUnvutvsg!3dfwc!<*dfWnvutvsGoj)mmb!>!nvutvsGoj!mppc!<*1/2!>=!z/esppDxpebit!-1/1!>?!z/esppDxpebit!-1/2!>=!y/esppDxpebit!-1/1!>?!y/esppDxpebit)!5dfwc!>!dfWnvutvsGoj!5dfwc!<*::::::/1!-{/esppDxpebit)ojn!>!{/esppDxpebit!<tbjCxpebit!>,!{/esppDxpebit!<x/esppDxpebit!>0!{zy/esppDxpebit!<1/2!>!xpebit!ubpmg!|!*esppDxpebit!5dfw!-tvjebSxpebit!ubpmg!-tbjCxpebit!ubpmg!-f{jTqbNxpebit!3dfw!-qbNxpebit!E3sfmqnbt)xpebiTufh!ubpmg!~!<d!osvufs!<*y/g!-c!-b)yjn!>!d!ubpmg!<*z/g!-us!-cs)yjn!>!c!ubpmg!<*z/g!-um!-cm)yjn!>!b!ubpmg!<*6/1!,!f{jt!+!wv)udbsg!>!g!3dfw!<*fsbqnpd!-zz/uftggp!+!f{jTmfyfu!,!WVejpsuofd!-tiuqfe)fsbqnpDE3fsvuyfu!>!us!ubpmg!<*fsbqnpd!-yz/uftggp!+!f{jTmfyfu!,!WVejpsuofd!-tiuqfe)fsbqnpDE3fsvuyfu!>!cs!ubpmg!<*fsbqnpd!-zy/uftggp!+!f{jTmfyfu!,!WVejpsuofd!-tiuqfe)fsbqnpDE3fsvuyfu!>!um!ubpmg!<*fsbqnpd!-yy/uftggp!+!f{jTmfyfu!,!WVejpsuofd!-tiuqfe)fsbqnpDE3fsvuyfu!>!cm!ubpmg!<f{jt!0!*6/1!,!f{jt!+!wv)sppmg!>!WVejpsuofd!3dfw!<f{jt!0!*1/2)3dfw!>!f{jTmfyfu!3dfw!<*1/2!-1/1)3dfw!>!uftggp!3dfw!utopd!|!*fsbqnpd!ubpmg!-wv!3dfw!-f{jt!3dfw!-tiuqfe!E3sfmqnbt)qsfMxpebiTE3fsvuyfu!ubpmg!~!<***wv!-tiuqfe)E3fsvuyfu)iuqfEpUBCHSldbqov!-fsbqnpd)qfut!osvufs!|!*fsbqnpd!ubpmg!-wv!3dfw!-tiuqfe!E3sfmqnbt)fsbqnpDE3fsvuyfu!ubpmg!~!<*tspudbGldbqoV!-w)upe!osvufs!|!*w!5dfw!oj!utopd)iuqfEpUBCHSldbqov!ubpmg!<*/2!-tspudbGldbQ)5dfw!0!fmbdtoxpEldbqoV!>!tspudbGldbqoV!5dfw!utopd!<*/763!-/763!+!/763!-/763!+!/763!+!/763)4dfw!>!tspudbGldbQ!4dfw!utopd!</763!0!/663!>!fmbdtoxpEldbqoV!ubpmg!utopd!</663!0!/763!>!fmbdtqVldbQ!ubpmg!utopd!<esppDxpebit!5dfw!hojzsbw!<fwjfdfSxpebit!mppc!nspgjov!<tvjebSxpebit!ubpmg!nspgjov!<tbjCxpebit!ubpmg!nspgjov!<zujtofuoJxpebit!ubpmg!nspgjov!<f{jTxpebit!3dfw!nspgjov!<qbNxpebit!E3sfmqnbt!nspgjov!<mmvDxpebit!mppc!nspgjov!QBNXPEBIT`FTV!gfegj$!gjeof$!<fdobutjEfojMw!ubpmg!hojzsbw!<fdobutjEqbHitbEv!ubpmg!nspgjov!<fdobutjEitbEv!ubpmg!nspgjov!<itbEv!mppc!nspgjov!ITBE!gfegj$!gjeof$!gjeof$!<sbGhpGv!ubpmg!nspgjov!<sbfOhpGv!ubpmg!nspgjov!ftmf$!<zujtofEhpGv!ubpmg!nspgjov!3QYF`HPG!gfegj$!<hpGv!mppc!nspgjov!<spmpDhpGv!5dfw!nspgjov!HPG!gfegj$!gjeof$!<*6/1!-6/1!-6/1)4dfw!>!ybNqjmd!4dfw!utopd!<*6/1.!-6/1.!-6/1.)4dfw!>!ojNqjmd!4dfw!utopd!<^SFQQJMD`YPC`YBN]yjsubNsfqqjmDv!5ubn!nspgjov!<^SFQQJMD`YPC`YBN]sfooJqjmDsfqqjmDv!mppc!nspgjov!<^SFQQJMD`YPC`YBN]fqbiTsfqqjmDv!uoj!nspgjov!1!?!SFQQJMD`YPC`YBN!gj$!gjeof$!<^UPQT`YBN]opjudfsjEupqTv!4dfw!nspgjov!<^UPQT`YBN]opjujtpQupqTv!4dfw!nspgjov!<^UPQT`YBN]fhobSupqTv!ubpmg!nspgjov!<^UPQT`YBN]fmhoBupqTv!ubpmg!nspgjov!<^UPQT`YBN]uofopqyFupqTv!ubpmg!nspgjov!<^UPQT`YBN]spmpDupqTv!5dfw!nspgjov!1!?!UPQT`YBN!gj$!gjeof$!<^UOJPQ`YBN]opjujtpQuojpQv!4dfw!nspgjov!<^UOJPQ`YBN]fhobSuojpQv!ubpmg!nspgjov!<^UOJPQ`YBN]spmpDuojpQv!5dfw!nspgjov!1!?!UOJPQ`YBN!gj$!gjeof$!<^SJE`YBN]opjudfsjEsjEv!4dfw!nspgjov!<^SJE`YBN]spmpDsjEv!5dfw!nspgjov!1!?!SJE`YBN!gj$!gjeof$!<eofmCidubCw!4dfw!hojzsbw!<eofmCidubCv!mppc!nspgjov!EOFMCIDUBC!gfegj$!gjeof$!<ttfouihjsCidubCw!ubpmg!hojzsbw!<ttfouihjsCidubCv!mppc!nspgjov!TTFOUIHJSCIDUBC!gfegj$!gjeof$!<spmpDidubCw!5dfw!hojzsbw!<spmpDidubCv!mppc!nspgjov!SPMPDIDUBC!gfegj$!<opjudfsjEuihjmebfIv!4dfw!nspgjov!<spmpDuihjmebfIv!5dfw!nspgjov!<zujtofuoJuofjcnBuihjmebfIv!ubpmg!nspgjov!<fhobSuihjmebfIv!ubpmg!nspgjov!<emspXw!4dfw!hojzsbw!<opjujtpQbsfnbDv!4dfw!nspgjov!<yjsubNxfjWv!5ubn!nspgjov!gjeof$!gjeof$!<qbNwoFv!fcvDsfmqnbt!nspgjov!ftmf$!<ttfoihvps!ubpmg!nspgjov!<qbNwoFv!E3sfmqnbt!nspgjov!WV`FCVD`FQZU`QBNWOF!gfegj$!<zujwjudfmgfSv!ubpmg!nspgjov!<qbNwoFftVv!mppc!nspgjov!QBNWOF`FTV!gfegj$!<opjujtpQw!4dfw!hojzsbw!<yfusfWw!4dfw!hojzsbw!<mbnspOw!4dfw!hojzsbw!<ftvggjEv!5dfw!nspgjov!<zujdbqPusbQv!ubpmg!nspgjov!<ttfouihjsCv!ubpmg!nspgjov!<uihjMv!mppc!nspgjov!<spmpDeofmCv!5dfw!nspgjov!<eofmCv!mppc!nspgjov!<uofdsfQqjmDv!ubpmg!nspgjov!<opjudfsjEqjmDv!uoj!nspgjov!<sfmqnbTeofmCv!E3sfmqnbt!nspgjov!<sfmqnbTv!E3sfmqnbt!nspgjov!gjeof$!<wVw!3dfw!hojzsbw!ftmf$!<wVw!4dfw!hojzsbw!QJMD`WV!gfegj$!<fsvuyfUeofmCv!mppc!nspgjov!<fsvuyfUv!mppc!nspgjov!<uofsbqtobsUv!mppc!nspgjov!<utfUbiqmBv!ubpmg!nspgjov!<spmpDftsfwfSldjQyjGv!5dfw!nspgjov!<qjmGftsfwfSv!mppc!nspgjov!<ldjQv!mppc!nspgjov!<yjGv!mppc!nspgjov!<fmcbudfmfTesbdtjEv!mppc!nspgjov!YJGFSQ$!gjeof$!gjeof$!<ubpmg!qnvjefn!opjtjdfsq!ftmf$!<ubpmg!qihji!opjtjdfsq!IHJI`OPJTJDFSQ`UOFNHBSG`MH!gfegj$!TF`MH!gfegj$!";
Wn(R,{setBatchInfo:function(L,y){nn[L]=y},getBatchInfo:function(U){return nn[U]},getBatchInfoMap:function(){return nn},setBatchInfoMap:function(m){nn=m}},!0);var Hr=[1,1,1],ac=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],bj=[1,0,0,0,0,1,0,1,1,1,1,0],lg=[-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5],jd=[.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5],Jl=[.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5],fo=[.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5],vf=[.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5],Ro=[-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5],zb=function(M,X){var Y=M._40Q;Y.each(function(z){z.ivBatch(X)})},ug=function(G,J,Y){var C=Y._id,$=J[C];if($){var o=$.batch,R=G[o],D=R.ds,T=$.index;if(R.invalidate=!0,delete J[C],D.splice(T,1),Bd(D))return delete G[o],void 0;for(var i=T,M=$.begin,I=$.size;T<D.length;T++)$=J[D[T]._id],$.index--,$.begin-=I;if(R.ms&&R.ms.length)return R.ms.splice(16*i,16),R.ics&&R.ics.splice(4*i,4),R.ps&&R.ps.splice(4*i,4),void 0;var U=3*M,V=3*I,O=4*M,u=4*I,j=R.vs,e=R.ps,l=R.uv,d=R.cs,w=R.bs,E=R.rs,H=R.ns,c=R.ls;j.splice(U,V),e.splice(O,u),l&&l.splice(2*M,2*I),d&&d.splice(O,u),w&&w.splice(U,V),E&&E.splice(M,I),H&&H.splice(U,V),c&&c.splice(M,I)}},vi=function(n,K,L,b,g){if(!b)return I;var x=K[b];if(!x){var j=g.getBatchInfo(b)||El,Y=j.image?[]:I;x=K[b]={vs:[],ns:[],uv:Y,cs:Y?I:j.color?I:[],bs:j.blend?[]:I,ps:[],rs:j.brightness?[]:I,ds:[],ms:j.instanced?[]:I,ics:Y?I:j.color||!j.instanced?I:[]}}return x.invalidate=!0,n[L._id]={index:x.ds.length,begin:x.vs.length/3,batch:b},x.ds.push(L),x},Mj=function(x,v){return v!=I&&1!==v?[x[0]*v,x[1]*v,x[2]*v,x[3]]:x},lb=function(y){var p=y.shapeModel;p||(p=kg(y)),p&&(p._ctlineModel=[],p._lineModel=z)},Uh=function(){var v;return function(w,a,y){var c=w.getData3dUI(a),W=c.shapeModel;if(W||(W=kg(c)),W||!c.shapeName){var r,_=a.s("wf.combineTriangle");if(y.geometry){if(!W&&(a instanceof B.Node&&!(a instanceof B.Shape)?(v||(v={vs:Tm,is:Mb,uv:Zp}),W=v):W=[c.left,c.front,c.right,c.back,c.top,c.bottom],!W))return z;if(_){var M=a.s("wf.normEpsilon");isNaN(M)&&(M=2),_=0|Math.min(3,Math.max(1,isNaN(_)?1:_)),r=wg[_-1](W,c,180/(Math.PI*M))}else r=sc(W,c);if(!r||0===r.length)return}else if(r=y.short?nd:Yp,a.s("wf.boundingBox")){var H=c.getBoundingBox(!0);if(H){var Q=(new qc).scale(H.max.clone().sub(H.min)).setPosition(H.max.clone().add(H.min).divideScalar(2)).toArray();r=Ep([],Q,r)}}var p,O,Z,q=w.getBrightness(a),F=a.s("bloom"),L=a.s("3d.reflectable"),x=$m(y.color||"white"),D=x[3]<1,e=Math.ceil(y.width)||1,V=a.s("3d.clipbox")?Wg:a.s("3d.clipbox.mask"),K=a.s("wf.fog"),J=a.getRenderLayer(),m=w._40Q.get(J),l=m.wireframeIndexMap,j=m.wireframeModelMap,d=a.s("batch"),t=a.s("3d.clip.direction");if(t){if(O=a.s("3d.clip.percentage"),0===O)return;p="_"+a._id,Z=c._formatClipUniforms(t,O,a)}else p=d?(D?"T":"O")+d:(D?"T":"O")+(F?"_1":"_0")+(L?"1_":"0_")+V+"_"+e+(K?"1_":"0_");var u=j[p];u||(u=j[p]={vs:[],cs:[],ps:[],ds:[],T:D,B:F,clipboxMask:V,reflectable:!!L,W:e,batch:d,fog:K}),u.invalidate=!0;var n=u.vs,s=u.cs,E=u.ds,P=l[a._id]={index:E.length,begin:n.length/3,batch:p};E.push(a);var G,I=c.mat;y.geometry&&a instanceof B.Shape&&(R.extractShapeTranslation||R.extractPolylineTranslation||R.extractVerticesTranslation)&&(G=c._vsTranslation)&&I&&(I=(new jl.Matrix4).fromArray(I).multiply(G).toArray()),a instanceof B.Edge||!(!I||!y.geometry&&a instanceof B.Shape)||(I=Zi(a,y.mat),a.appendAnchorMatrix3d(I)),Z?(u.mat=yq(I),u.clipDirection=Z[0],u.clipPercent=Z[1],Ep(n,null,r)):Ep(n,I,r);var g=P.size=n.length/3-P.begin;re(s,Mj(x,q),g)}}}(),Rj=function(Z,H,g,f,X,d,z,$,h){var E=Z.getBrightness(H);E==I&&(E=1);var p=Mj($m(f),E),K=p[3]<1;d=Math.ceil(d)||1;var G=H.s("3d.clipbox")?Wg:H.s("3d.clipbox.mask"),V=(K?"T":"O")+d+"_"+G;if(z){var s=z[0],N=(z[1]||s)+s;V+="-"+s+"-"+N,h&&(V+="-"+Qm(h)+"-"+E,h=Mj($m(h),E))}var T=H.getRenderLayer(),m=Z._40Q.get(T),w=m.polylineIndexMap,k=m.polylineModelMap,n=k[V];n||(n=k[V]={vs:[],cs:[],ps:[],ds:[],ls:z?[]:I,T:K,clipboxMask:G,W:d},z&&(n.D=s,n.G=N,n.A=h)),n.invalidate=!0;var Y,_=n.vs,A=n.cs,F=n.ds,W=n.ls,J=w[H._id]={index:F.length,begin:_.length/3,batch:V};F.push(H);var j;!(j=Z.getData3dUI(H).mat)&&H instanceof B.Polyline&&(j=Zi(H),H.appendAnchorMatrix3d(j)),Ep(_,j,g);var u,D=J.size=_.length/3-J.begin,P=g.length,M=0,r=[];if(z||X)for(Y=0;P>Y;Y+=6)u=Jc([g[Y],g[Y+1],g[Y+2]],[g[Y+3],g[Y+4],g[Y+5]]),r.push(u),M+=u;if(M&&X){var a,Q=Mj($m(X),E),t=[Q[0]-p[0],Q[1]-p[1],Q[2]-p[2],Q[3]-p[3]],b=0;for(Y=0;P>Y;Y+=6)a=b/M,re(A,[p[0]+t[0]*a,p[1]+t[1]*a,p[2]+t[2]*a,p[3]+t[3]*a],1),b+=r[Y/6],a=b/M,re(A,[p[0]+t[0]*a,p[1]+t[1]*a,p[2]+t[2]*a,p[3]+t[3]*a],1)}else re(A,p,D);if(z)for(b=$||0,Y=0;P>Y;Y+=6)W.push(b),b+=r[Y/6],W.push(b)},Ql=function(t,W,$){if(W){var K=$[W.batch],B=K.ps,e=K.ms&&K.ms.length,I=e?4*W.index:4*W.begin,s=e?1:W.size;if(B[I]!==t[0]||B[I+1]!==t[1]||B[I+2]!==t[2]||B[I+3]!==t[3]){for(var N=0;s>N;N++)B[I++]=t[0],B[I++]=t[1],B[I++]=t[2],B[I++]=t[3];B._invalidateThisFrame=!0}}},rs=function(){var q=new B.Math.Vector3,o=new B.Math.Vector3;return function(i,Z){var r=Z+["32"],P=i[Z],u=i[r];if(P){if((R.extractBatchTranslation||R.extractVerticesTranslation)&&"vs"===Z){o.set(0,0,0);for(var N=P.length,e=0;N>e;e+=3)o.add(q.fromArray(P,e));o.divideScalar(N/3);for(var O=o.x,M=o.y,k=o.z,s=new Array(N),e=0;N>e;e+=3)s[e]=P[e]-O,s[e+1]=P[e+1]-M,s[e+2]=P[e+2]-k;P=s,i.translate=[O,M,k]}u&&u.length===P.length?(u.set(P),u._bufId=null):i[r]=new Tb(P)}else delete i[r]}}(),Um=function(S,d,y,I,x,O,L,t){var g=d instanceof B.Shape,p=O[0],F=O.length;if(F>1){p=yq(p);for(var N=1;F>N;N++)Hh(p,p,O[N])}if(g){var v=d.p3();uf(p,v)}uh(L.ms,p);var U;if(L.ics&&(U=d.s("shape3d.color"))&&re(L.ics,U,1),!L.vs.length){var c=yq(ac);g&&uf(c,Em(v)),Gb(S,d,y,I,x,[c],L,t)}},Gb=function(y,p,g,Z,z,w,s,d){if(ar(g))g.forEach(function(P){Gb(y,p,P,Z,z,w,s,d)});else if(Fc(g))Gb(y,p,kg(Z,g),Z,z,w,s,d);else if(Pd(g)){var N,j=tp(g.mat,p,y),i=tp(g.s3,p,y),D=tp(g.t3,p,y),C=tp(g.r3,p,y);if((i||C||D||j)&&(N=Jg(j,i,C,tp(g.rotationMode,p,y),D),w.push(N)),g.shape3d)Gb(y,p,g.shape3d,Z,z,w,s,g);else{var V=Z.s;d=d||El;var X=w[0],F=w.length,A=V("shape3d.color",g.color,d.color);if(z||(z=V("shape3d.blend",g.blend,d.blend)),F>1){X=yq(X);for(var U=1;F>U;U++)Hh(X,X,w[U])}var u=X?gd(X):I;g.vs&&V(io,g.visible,d.visible)&&Jd(X,s,g.vs,g.uv,g.is,g.ns,u,z,A),g.top_vs&&V(eq,g.topVisible,d.topVisible)&&Jd(X,s,g.top_vs,g.top_uv,g.top_is,g.top_ns,u,z,V("shape3d.top.color",g.topColor,d.topColor)||A),g.bottom_vs&&V(qp,g.bottomVisible,d.bottomVisible)&&Jd(X,s,g.bottom_vs,g.bottom_uv,g.bottom_is,g.bottom_ns,u,z,V("shape3d.bottom.color",g.bottomColor,d.bottomColor)||A),g.from_vs&&V(cg,g.fromVisible,d.fromVisible)&&Jd(X,s,g.from_vs,g.from_uv,g.from_is,g.from_ns,u,z,V("shape3d.from.color",g.fromColor,d.fromColor)||A),g.to_vs&&V(Rd,g.toVisible,d.toVisible)&&Jd(X,s,g.to_vs,g.to_uv,g.to_is,g.to_ns,u,z,V("shape3d.to.color",g.toColor,d.toColor)||A)}N&&w.pop()}},Jd=function(M,Q,N,X,n,x,e,k,U){var r,i=Q.cs,l=Q.uv,g=Q.bs,A=Q.ns,u=Q.vs;if(x&&0!==x.length||(x=df(N,n)),n){r=n.length;for(var S=0;r>S;S++){var v=n[S],V=3*v;Ep(u,M,[N[V],N[V+1],N[V+2]]),Ep(A,e,[x[V],x[V+1],x[V+2]]),l&&uh(l,[X[2*v],X[2*v+1]])}}else r=N.length/3,Ep(u,M,N),Ep(A,e,x),l&&uh(l,X);i&&re(i,U,r),g&&(k?pm(g,k,r):uh(g,Hr,r))},Oi=function(G,R,x){var Z=G.data.p3();if(R=yq(R),uf(R,Z),uh(x.ms,R),!x.vs.length){var v=yq(ac);uf(v,Em(Z)),Tj(G,v,x)}},Tj=function(b,X,h){Ob(b,xi,X,h),Ob(b,Dd,X,h),Ob(b,Uj,X,h),Ob(b,Xo,X,h),Ob(b,Vh,X,h),Ob(b,dd,X,h),Ob(b,"csg",X,h)},Dq=function(u,k,L,H,w,I){uh(L.ms,w);var B;L.ics&&(B=k.s("all.color"))&&re(L.ics,B,1),L.vs.length||Zk(u,k,L,H,yq(ac),I)},Zk=function(R,d,C,f,J,N){Fo(R,d,C,f,J,N,xi,lg),Fo(R,d,C,f,J,N,Dd,jd),Fo(R,d,C,f,J,N,Vh,Jl),Fo(R,d,C,f,J,N,dd,fo),Fo(R,d,C,f,J,N,Uj,vf),Fo(R,d,C,f,J,N,Xo,Ro)},ob=function(p,J,y,t,K){t?K.instanced?p.gv.batchInstancedModel(p.data,t,p,p.getBodyColor(),[J],y):Gb(p.gv,p.data,t,p,p.getBodyColor(),[J],y):K.instanced?p.gv.batchInstancedShapeFace(p,J,y):Tj(p,J,y)},Ob=function(A,s,D,o){var u=A[s];if(u){var P=u.tuv;if(P){var a=u.uvScale,Q=u.uvOffset,R=u.uvRotation,x=u.uvAnchor;if(a||Q||R){var Y,C,i,n=dl(R,Q,a,x),E=n.a,l=n.b,H=n.c,j=n.d,K=n.tx,B=n.ty,b=P.length;for(i=0;b>i;i+=2)Y=P[i],C=P[i+1],P[i]=E*Y+H*C+K,P[i+1]=l*Y+j*C+B}}Jd(D,o,u.vs,P,I,I,D?gd(D):I,u.blend,u.color)}},Fo=function(S,K,f,b,Z,l,$,i){var U,C=f.cs,n=f.uv,u=f.bs,J=f.vs,m=f.ns,L=df(i);if(S.getFaceVisible(K,$)){var X=S.getFaceMat(K,$);if(X&&(Z=Zi(K,X),l=gd(Z)),Ep(J,Z,i),Ep(m,l,L),C&&re(C,S.getFaceColor(K,$),6),n){var q=S.getFaceUv(K,$)||b[$+"Uv"],E=S.getFaceUvScale(K,$)||b[$+"UvScale"],z=S.getFaceUvOffset(K,$)||b[$+"UvOffset"],H=S.getFaceUvRotation(K,$)||b[$+"UvRotation"],G=S.getFaceUvAnchor(K,$)||b[$+"UvAnchor"];q=q?[q[6],q[7],q[0],q[1],q[2],q[3],q[2],q[3],q[4],q[5],q[6],q[7]]:bj;var h=q[0],_=q[1],v=q[2],B=q[3],N=q[4],F=q[5],e=q[6],M=q[7],g=q[8],O=q[9],D=q[10],P=q[11];if(E||z||H||G){var W=dl(H,z,E,G),Y=W.a,T=W.b,t=W.c,I=W.d,Q=W.tx,a=W.ty;h=Y*h+t*_+Q,_=T*h+I*_+a,v=Y*v+t*B+Q,B=T*v+I*B+a,N=Y*N+t*F+Q,F=T*N+I*F+a,e=Y*e+t*M+Q,M=T*e+I*M+a,g=Y*g+t*O+Q,O=T*g+I*O+a,D=Y*D+t*P+Q,P=T*D+I*P+a}n.push(h,_,v,B,N,F,e,M,g,O,D,P)}u&&(U=S.getBodyColor(K)||S.getFaceBlend(K,$),U?pm(u,U,6):uh(u,Hr,6))}},Wr=function(T,O,W,f){var W=T._picking?T.pickColorMap:null,X=T.getGL(),F=T._prg,R=T._buffer;if(!Jb(O)){Rg(T,ac),Jr(X);var U,t,y,S;for(var L in O){var J,m,j,E,n=O[L];if(n.batch){var $=T.getBatchInfo(n.batch)||El;J=$.wfBloom===z?$.bloom:$.wfBloom,m=$.wfReflectable===z?$.reflectable:$.wfReflectable,j=$.wfClipboxMask===z?$.clipboxMask:$.wfClipboxMask,E=$.width}else J=n.B,m=n.reflectable,j=n.clipboxMask,E=n.W;if(!(f&&!n.T||!f&&n.T||T.isReflecting(X)&&m===!1)){n.invalidate?(n.invalidate=!1,rs(n,"vs"),rs(n,"cs"),rs(n,"ls"),rs(n,"ps")):W&&n.ps&&n.ps._invalidateThisFrame&&(n.ps._invalidateThisFrame=!1,rs(n,"ps")),U=n.translate,t=n.clipDirection,U||t?(y=t?yq(n.mat):[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],U&&uf(y,U),S=yq(T._6O),Rg(T,y)):y=null;var s=n.vs32,q=W?n.ps32:n.cs32;Bs(X,F,E,I,R.vs,s);var p=Jm.for(X),Y=p.directUniforms(),l=p.directAttribs(),V=n.D,x=!T._dashDisabled&&V;Y.uAlphaTest=c.alphaTest,X._blooming&&!J&&(Y.blackout=!0),t&&(Y.uClipPercent=n.clipPercent,Y.uClipDirection=t),qj(T,Y,j===z?fg:j),x&&(Y.uDash=!0,Y.uDashDistance=V,Y.uDashGapDistance=n.G,Y.uDiffuse=n.A||c["color.empty"],l.aLineDistance=Vi(X,R.lineDistance,n.ls32,I,1));var h=!T._batchColorDisabled;h&&q.length?(Y.uBatchColor=!0,l.aBatchColor=Vi(X,R.batchColor,q,I,4)):(Y.uBatchColor=!1,l.aBatchColor=!1);var r=n.fog!==!1;r||(Y.uFog=!1),th(X),qb(X,0,s.length/3,X.LINES),Uk(X),r||(Y.uFog=!0),h&&(Y.uBatchColor=!1,l.aBatchColor=!1),x&&(Y.uDash=!1,l.aLineDistance=!1),X._blooming&&!J&&(Y.blackout=!1),y&&(t&&(Y.uClipDirection=0),ci(T,S),Y.uMMatrix=Lr)}}yb(X),ci(T)}},Mk=function(L){L.invalidate=!1,rs(L,"vs"),rs(L,"ns"),rs(L,"cs"),rs(L,"rs"),rs(L,"ps"),rs(L,"bs"),rs(L,"uv"),rs(L,"ms"),rs(L,"ics")},In=function(W,J,M,A,T){var w,E,V,g,d,j,D,$,Q,i,h,S,R,M=W._picking?W.pickColorMap:null,s=W.getGL(),x=W._prg,e=Jm.for(s),U=e.directUniforms(),L=e.directAttribs(),o=W._buffer;if(!Jb(J)){var a,y,p=W._flowObjects.length?W.flowMap:null,t=W.drawFilter;Rg(W,ac);for(E in J)if(V=W.getBatchInfo(E)||El,V.visible!==!1&&!(A&&!V.transparent||!A&&V.transparent||W.isReflecting(s)&&V.reflectable===!1)){var m=V.renderLayerMask;if(m==I&&(m=Dc),T==I&&(T=Dc),Qo(T,m)&&(g=J[E],M||!V.transparentMask)){if(t){if(V.highlight!==!0)continue;if(a=g.ds){y=!1;for(var n=0,F=a.length;F>n;n++)if(!t(a[n])){y=!0;break}if(!y)continue}}var H=A&&V.autoSort===!0&&(W._33Q||g.invalidate);g.invalidate?Mk(g):M&&g.ps&&g.ps._invalidateThisFrame&&(g.ps._invalidateThisFrame=!1,rs(g,"ps"));var u=g.ms32,X=u&&u.length;if(j=g.vs32,D=M?g.ps32:X?g.ics32:g.cs32,i=g.uv32,$=g.bs32,Q=g.rs32,S=j.length/3,H){var C=qi(j,W.getEye(),W);C?(g.is=C.is,g.elementTypeUint=C.useUint32):(g.is=null,g.elementTypeUint=null)}if(S){R=g.translate,R&&Rg(W,[1,0,0,0,0,1,0,0,0,0,1,0,R[0],R[1],R[2],1]),d=V.light,h=W.getTexture(V.image),gb(s,x,I,V.light,V.opacity,V.reverseFlip,V.reverseColor,V.reverseCull),w=V.polygonOffset,w&&rl(s,w),D?W._batchColorDisabled?(U.uBatchColor=!1,L.aBatchColor=!1):(U.uBatchColor=!0,L.aBatchColor=X?_e(s,o.instancedBatchColor,D,I,4):Vi(s,o.batchColor,D,I,4)):(U.uBatchColor=!1,U.uDiffuse=V.color||c["color.empty"]);var B=V.alphaTest;U.uAlphaTest=B===z?c.alphaTest:B,U.shadowReceive=!M&&V.shadowReceive!==!1,qj(W,U,V.clipboxMask===z?fg:V.clipboxMask),od(W,U,V.lightMask===z?fg:V.lightMask,V.headlightAmbientIntensity),p&&p.resetFlowUniform(V.effectFlowMask===z?fg:V.effectFlowMask,U),s._blooming&&!V.bloom&&(U.blackout=!0),V.envmap!==z?(U.uUseEnvMap=!0,U.uReflectivity=V.envmap,U.roughness=V.roughness||0,W._setEnvmapByProbeId(U,V.envmapProbe||0)):(U.uUseEnvMap=!1,U.uReflectivity=0);var G=$&&!W._batchBlendDisabled;G&&(U.uBatchBlend=!0,L.aBatchBlend=Vi(s,o.batchBlend,$,I));var f=Q&&!W._batchBrightnessDisabled;f&&(U.uBatchBrightness=!0,L.aBatchBrightness=Vi(s,o.batchBrightness,Q,I,1)),i?th(s,x,h,V.discardSelectable,o.uv,i,V.uvOffset,V.uvScale,V.uvRotation,V.uvAnchor):th(s),L.aPosition=Vi(s,o.vs,j,I),L.aNormal=Vi(s,o.ns,g.ns32,I),X&&(U.uUseInstance=!0,L.aMatrixInstanced=_e(s,o.ms,u,I)),g.is?(Nd(s,o.is,g.is),kc(s,0,S,null,g.elementTypeUint?s.UNSIGNED_INT:null,null,X?g.ms32.length/16:0)):qb(s,0,S,null,X?g.ms32.length/16:0),i?Uk(s,x,h):Uk(s),D&&!W._batchColorDisabled&&(U.uBatchColor=!1,L.aBatchColor=!1),G&&(U.uBatchBlend=!1,L.aBatchBlend=!1),f&&(U.uBatchBrightness=!1,L.aBatchBrightness=!1),s._blooming&&!V.bloom&&(U.blackout=!1),X&&(U.uUseInstance=!1,L.aMatrixInstanced=z),w&&_m(s),he(s,x),R&&(ci(W),U.uMMatrix=Lr)}}}ci(W)}},qi=function(Q,h,J){var B=Q.length/3,D=B>65535,$=J._glCapabilities.elementTypeUint&&D;if(!$&&D)return null;for(var A=new Array(B),f=B/3,q=new Array(f),r=0;f>r;r++)q[r]=r;q.sort(function(W,l){var Y=9*W,Z=[(Q[Y]+Q[Y+3]+2*Q[Y+6])/4,(Q[Y+1]+Q[Y+4]+2*Q[Y+7])/4,(Q[Y+2]+Q[Y+5]+2*Q[Y+8])/4];Y=9*l;var $=[(Q[Y]+Q[Y+3]+2*Q[Y+6])/4,(Q[Y+1]+Q[Y+4]+2*Q[Y+7])/4,(Q[Y+2]+Q[Y+5]+2*Q[Y+8])/4],p=Jc(h,Z)-Jc(h,$);return p>0?-1:0>p?1:0});for(var r=0;f>r;r++){var g=3*r,O=3*q[r];A[g]=O,A[g+1]=O+1,A[g+2]=O+2}return{useUint32:$,is:$?new Uint32Array(A):new Ge(A)}},np={obj:function(W,b){var A={mat:W.mat,s3:W.s3,r3:W.r3,rotationMode:W.rotationMode,t3:W.t3,cube:W.cube==I?!0:W.cube,center:W.center==I?!0:W.center,ignoreMtls:W.ignoreMtls,ignoreTransparent:W.ignoreTransparent,ignoreColor:W.ignoreColor,ignoreImage:W.ignoreImage,ignoreNormal:W.ignoreNormal,prefix:W.prefix,flipY:W.flipY,flipFace:W.flipFace,reverseFlipMtls:W.reverseFlipMtls,finishFunc:function(S,d){if(S){var d=[];for(var w in S){var k=S[w];d.rawS3=k.rawS3,k.center&&(d.center=k.center),d.push(k),W.eachModel&&W.eachModel(w,k)}d.json=W,b(d)}else b()}};R.loadObj(W.obj,W.mtl,A)},bin:function(g,d){var z={finishFunc:function(l){l?d(l):d()}};R.loadBin(g.url,z)}};R.getModelTypeHandlers=function(){return np},R.setModelTypeHandler=function(G,S){np[G]=S},R.getModelTypeHandler=function(z){return np[z]},R.handleModelLoaded=function(){},R.handleUnfoundModel=function(){};var En=I,ud=I,Yg=function(A){En&&!A._loadingModelView_&&(ud||(ud={}),ud[A._loadingModelView_=Bi()]=A)},Up=function(V,x){En||(En={});var q=En[V];if(q){if(q.url===x)return;q.request.onload=No,q.request.onerror=No}if(x.indexOf(".bin")===x.length-4)return Yq(V,{modelType:"bin",url:x},x);if(x=R.beforeLoadURL(x),x.data){var $=R.parse(x.data);Yq(V,$,x)}else{var i=new nc;En[V]={request:i,url:x},i.onload=function(){if(200===this.status||0===this.status){delete En[V];var r=R.parse(i.getResponseText());Yq(V,r,x)}else ql(V,R.handleUnfoundModel(V,x)||I)},i.onerror=function(){ql(V,R.handleUnfoundModel(V,x)||I)};var U={};U.url=encodeURI(x),U.sync=!1,i.send(U)}},Yq=function(j,f,Q){var m=f.modelType;if(!m)return ql(j,f),R.handleModelLoaded(j,f),void 0;var t=R.getModelTypeHandler(m);if(t){if(En||(En={}),En[j])return;En[j]=!0;var g=function(t){t?(ql(j,t),R.handleModelLoaded(j,t)):ql(j,R.handleUnfoundModel(j,Q,f)||I)};t(f,g)}else ql(j,R.handleUnfoundModel(j,Q,f)||I)},ql=function(v,K){if(delete En[v],Fc(K)&&Wl.test(K))return Up(v,K),void 0;if(rp[v]=K,Jb(En)&&(En=I,ud)){for(var e in ud){var U=ud[e];U.invalidateAll&&U.invalidateAll(z,"modelLoaded",v),U.redraw&&U.redraw(),U.iv(),delete U._loadingModelView_}ud=I}if(K&&ud)for(var e in ud){var U=ud[e];U.invalidateAll&&U.invalidateAll(z,"modelLoading",v),U.redraw&&U.redraw(),U.iv()}},fd=new Tb([0,0,0,1,1,1,1,0]),_f=new Tb([0,0,1,0,0,1,0,0,1,0,0,1]),Gi=new Ge([0,1,2,2,3,0]),Tm=new Tb([-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5]),Mb=new Ge([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),Zp=new Tb([0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0]),cc=df(Tm,Mb),Qe=(new Tb([-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5]),new Ge([0,1,2,3,0,7,5,4,6,7,5,3,2,4,6,1]),[xi,Uj,Dd,Xo,Vh,dd]),Yp=[-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5],nd=[-.5,.5,.5,-.4,.5,.5,-.5,.5,.5,-.5,.4,.5,-.5,.5,.5,-.5,.5,.4,.5,.5,.5,.4,.5,.5,.5,.5,.5,.5,.4,.5,.5,.5,.5,.5,.5,.4,-.5,-.5,.5,-.4,-.5,.5,-.5,-.5,.5,-.5,-.4,.5,-.5,-.5,.5,-.5,-.5,.4,.5,-.5,.5,.4,-.5,.5,.5,-.5,.5,.5,-.4,.5,.5,-.5,.5,.5,-.5,.4,-.5,.5,-.5,-.4,.5,-.5,-.5,.5,-.5,-.5,.4,-.5,-.5,.5,-.5,-.5,.5,-.4,.5,.5,-.5,.4,.5,-.5,.5,.5,-.5,.5,.4,-.5,.5,.5,-.5,.5,.5,-.4,-.5,-.5,-.5,-.4,-.5,-.5,-.5,-.5,-.5,-.5,-.4,-.5,-.5,-.5,-.5,-.5,-.5,-.4,.5,-.5,-.5,.4,-.5,-.5,.5,-.5,-.5,.5,-.4,-.5,.5,-.5,-.5,.5,-.5,-.4],ts=function(i,D,I,w,b,p,M){p=p||16,i=i||16,D=D||0,I=I||i;var s,g,U,S,e,W,O,H,$,t=.5,d=[],z=[],o=f/i,Q=L/p;for(s=0;p>s;s++)for(W=s+1,S=s*Q,$=W*Q,g=D;I>g;g++)O=g+1,U=g*o,H=O*o,d.push(t*k(S)*F(U),t*F(S),-t*k(S)*k(U),t*k($)*F(H),t*F($),-t*k($)*k(H),t*k(S)*F(H),t*F(S),-t*k(S)*k(H),t*k(S)*F(U),t*F(S),-t*k(S)*k(U),t*k($)*F(U),t*F($),-t*k($)*k(U),t*k($)*F(H),t*F($),-t*k($)*k(H)),z.push(g/i,s/p,O/i,W/p,O/i,s/p,g/i,s/p,g/i,W/p,O/i,W/p);if(M){var _=[];for(s=0,e=d.length;e>s;s+=3)_.push(2*d[s],2*d[s+1],2*d[s+2])}if(w){var m=[],P=[];for(U=D*o,s=0;p>s;s++)W=s+1,S=s*Q,$=W*Q,m.push(0,0,0,t*k($)*F(U),t*F($),-t*k($)*k(U),t*k(S)*F(U),t*F(S),-t*k(S)*k(U)),P.push(0,.5,D/i,W/p,D/i,s/p)}if(b){var h=[],y=[];for(U=I*o,s=0;p>s;s++)W=s+1,S=s*Q,$=W*Q,h.push(0,0,0,t*k(S)*F(U),t*F(S),-t*k(S)*k(U),t*k($)*F(U),t*F($),-t*k($)*k(U)),y.push(1,.5,I/i,s/p,I/i,W/p)}var q={vs:d,uv:z,from_vs:m,from_uv:P,to_vs:h,to_uv:y};return M&&(q.ns=_),q},mq=function(e,x,b){e=e||.17,x=x||12,b=b||18,0>e?e=0:e>.25&&(e=.25);var R,O,U,X,I,H,D,y=.5,B=[],V=[],u=[],c=f/b,g=f/x,W=y-e;for(O=0;x>=O;O++)for(X=-L+O*g,H=F(X),I=k(X),R=0;b>=R;R++)U=R*c,D=W+e*H,B.push(F(U)*D,I*e,-k(U)*D),V.push(R/b,1-O/x);for(O=0;x>O;O++){var n=O*(b+1),K=(O+1)*(b+1);for(R=0;b>R;R++)u.push(n+R,K+R+1,K+R,n+R,n+R+1,K+R+1)}return{vs:B,uv:V,is:u}},Oq=function(u,x,M,r,Z,n,R,b){R=R||12,u=u||18,x=x||0,M=M||u,n=n||.17,0>n?n=0:n>.25&&(n=.25);var E,h,J,Y,S,$,V,N,q,D,g=.5,m=[],p=[],T=f/u,c=f/R,H=g-n,I=b?[]:z;for(J=0;R>J;J++)for(Y=J+1,V=-L+J*c,N=-L+Y*c,E=x;M>E;E++)h=E+1,S=E*T,$=h*T,q=H+n*F(V),D=H+n*F(N),m.push(F(S)*q,k(V)*n,-k(S)*q,F($)*q,k(V)*n,-k($)*q,F($)*D,k(N)*n,-k($)*D,F(S)*q,k(V)*n,-k(S)*q,F($)*D,k(N)*n,-k($)*D,F(S)*D,k(N)*n,-k(S)*D),p.push(E/u,1-J/R,h/u,1-J/R,h/u,1-Y/R,E/u,1-J/R,h/u,1-Y/R,E/u,1-Y/R),b&&I.push(F(S)*F(V),k(V),-k(S)*F(V),F($)*F(V),k(V),-k($)*F(V),F($)*F(N),k(N),-k($)*F(N),F(S)*F(V),k(V),-k(S)*F(V),F($)*F(N),k(N),-k($)*F(N),F(S)*F(N),k(N),-k(S)*F(N));if(r){var U=[],s=[];for(J=0;R>J;J++)Y=J+1,V=-L+J*c,N=-L+Y*c,S=x*T,q=H+n*F(V),D=H+n*F(N),U.push(F(S)*q,k(V)*n,-k(S)*q,F(S)*D,k(N)*n,-k(S)*D,F(S)*H,0,-k(S)*H),s.push(.5+.5*F(V),.5-.5*k(V),.5+.5*F(N),.5-.5*k(N),.5,.5)}if(Z){var v=[],P=[];for(J=0;R>J;J++)Y=J+1,V=-L+J*c,N=-L+Y*c,S=M*T,q=H+n*F(V),D=H+n*F(N),v.push(F(S)*q,k(V)*n,-k(S)*q,F(S)*H,0,-k(S)*H,F(S)*D,k(N)*n,-k(S)*D),P.push(.5-.5*F(V),.5-.5*k(V),.5,.5,.5-.5*F(N),.5-.5*k(N))}var G={vs:m,uv:p,from_vs:U,from_uv:s,to_vs:v,to_uv:P};return b&&(G.ns=I),G},Wf=function(V,S){for(var b,Y,v,i,G,I=.5,t=16,U=[],O=[],A=[],c=[],$=f/t,E=0;t>=E;E++)b=E*$,Y=F(b),i=Y*I,v=k(b),G=v*I,U.push(i,-I,G,i,I,G),A.push(Y,0,v,Y,0,v),O.push(1-E/t,1,1-E/t,0);for(E=0;t>E;E++)c.push(2*E,2*E+1,2*E+3,2*E,2*E+3,2*E+2);if(S){var Z=[],J=[],N=[];for(Z.push(0,-I,0),J.push(.5,.5),E=0;t>=E;E++)b=E*$,Y=F(b),v=k(b),Z.push(Y*I,-I,-v*I),J.push(.5+.5*Y,.5+.5*v);for(E=0;t>E;E++)N.push(0,E+2,E+1)}if(V){var w=[],m=[],P=[];for(w.push(0,I,0),m.push(.5,.5),E=0;t>=E;E++)b=E*$,Y=F(b),v=k(b),w.push(Y*I,I,-v*I),m.push(.5+.5*Y,.5-.5*v);for(E=0;t>E;E++)P.push(0,E+1,E+2)}return{vs:U,uv:O,is:c,ns:A,bottom_vs:Z,bottom_uv:J,bottom_is:N,top_vs:w,top_uv:m,top_is:P}},ah=function(O,H,T,R,r,a,y,B){O=O||12,H=H||0,T=T||O;for(var C,V,E,q,X,N,_,G,M,e=.5,D=[],i=[],S=f/O,n=H;T>n;n++)C=n+1,V=n*S,E=C*S,q=F(V)*e,X=k(V)*e,N=F(E)*e,_=k(E)*e,D.push(q,-e,-X,N,-e,-_,q,e,-X,N,-e,-_,N,e,-_,q,e,-X),i.push(n/O,1,C/O,1,n/O,0,C/O,1,C/O,0,n/O,0);if(B){var U=[];for(n=0,M=D.length;M>n;n+=3)U.push(2*D[n],0,2*D[n+2])}if(y){var $=[],l=[];for(n=H;T>n;n++)V=S*n,E=S*(n+1),q=F(V),X=k(V),N=F(E),_=k(E),$.push(q*e,-e,-X*e,0,-e,0,N*e,-e,-_*e),l.push(.5+.5*q,.5+.5*X,.5,.5,.5+.5*N,.5+.5*_)}if(a){var c=[],m=[];for(n=H;T>n;n++)V=S*n,E=S*(n+1),q=F(V),X=k(V),N=F(E),_=k(E),c.push(q*e,e,-X*e,N*e,e,-_*e,0,e,0),m.push(.5+.5*q,.5-.5*X,.5+.5*N,.5-.5*_,.5,.5)}if(R){var J=[],I=[];V=S*H,q=F(V)*e,X=k(V)*e,G=H/O,J.push(0,e,0,0,-e,0,q,-e,-X,q,-e,-X,q,e,-X,0,e,0),I.push(0,0,0,1,G,1,G,1,G,0,0,0)}if(r){var t=[],Q=[];V=S*T,q=F(V)*e,X=k(V)*e,G=T/O,t.push(0,-e,0,0,e,0,q,e,-X,q,e,-X,q,-e,-X,0,-e,0),Q.push(1,1,1,0,G,0,G,0,G,1,1,1)}var P={vs:D,uv:i,bottom_vs:$,bottom_uv:l,top_vs:c,top_uv:m,from_vs:J,from_uv:I,to_vs:t,to_uv:Q};return B&&(P.ns=U),P},Lm=function(u,c,E,j,r){c=c||18,E=E||0,j=j==I?f:j,r=r==I?.5:r;for(var n,K,L,b,Z,s,q=[0,.5,.75,.875,.9375],S=[],x=[],J=[],N=j/c,U=0;U<q.length;U++){var M=0===U%2?0:.5;for(n=0;c>=n;n++)K=(n+M)*N+E,L=1-q[U],S.push(F(K)*r*L,-r+2*q[U]*r,-k(K)*r*L),x.push((n+M)/c,L)}for(U=0;U<q.length-1;U++){var T=U*(c+1),y=(U+1)*(c+1);for(n=0;c>n;n++)J.push(T+n,y+n+1,y+n,T+n,T+n+1,y+n+1)}for(s=S.length/3-(c+1),n=0;c>n;n++)S.push(0,r,0),x.push((n+.5)/c,0);for(n=0;c>n;n++)J.push(s+n,s+n+1,s+(c+1)+n);if(u){var H=[],z=[],v=[];for(H.push(0,-r,0),z.push(.5,.5),n=0;c>=n;n++)K=n*N+E,b=F(K),Z=k(K),H.push(b*r,-r,-Z*r),z.push(.5+.5*b,.5+.5*Z);for(n=0;c>n;n++)v.push(0,n+2,n+1)}return{vs:S,uv:x,is:J,bottom_vs:H,bottom_uv:z,bottom_is:v}},qh=function(O,G,e,D,Y,R,j,h){O=O||16,G=G||0,e=e||O,j=j||1;var l,a,n,N,M,A,E,o=.5,C=[],g=[],Z=f/O,p=G,u=1/j,a=new Xn,n=new Xn,L=new Xn,V=new Xn,S=new Xn,I=new Xn,H=new Xn;for(h&&(l=[],M=new Xn,A=new Xn,E=new Xn);e>p;p++){var x=p+1,B=Z*p,r=Z*x;for(a.set(F(B)*o,-o,-k(B)*o),n.set(F(r)*o,-o,-k(r)*o),L.set(0,o,0),h&&(M.set(F(B),.5,-k(B)).normalize(),A.set(F(r),.5,-k(r)).normalize(),E.copy(M).add(A).normalize()),V.lerpVectors(L,a,u),S.lerpVectors(L,n,u),C.push(V.x,V.y,V.z,S.x,S.y,S.z,L.x,L.y,L.z),g.push(p/O,u,x/O,u,(p+x)/2/O,0),h&&l.push(M.x,M.y,M.z,A.x,A.y,A.z,E.x,E.y,E.z),N=1;j>N;N++)V.lerpVectors(L,a,u*(N+1)),S.lerpVectors(L,n,u*(N+1)),I.lerpVectors(L,a,u*N),H.lerpVectors(L,n,u*N),C.push(V.x,V.y,V.z,S.x,S.y,S.z,I.x,I.y,I.z,I.x,I.y,I.z,S.x,S.y,S.z,H.x,H.y,H.z),g.push(p/O,u*(N+1),x/O,u*(N+1),p/O,u*N,p/O,u*N,x/O,u*(N+1),x/O,u*N),h&&l.push(M.x,M.y,M.z,A.x,A.y,A.z,M.x,M.y,M.z,M.x,M.y,M.z,A.x,A.y,A.z,A.x,A.y,A.z)}if(R){var q=[],P=[];for(p=G;e>p;p++){B=Z*p,r=Z*(p+1);var v=F(B),T=k(B),z=F(r),$=k(r);q.push(v*o,-o,-T*o,0,-o,0,z*o,-o,-$*o),P.push(.5+.5*v,.5+.5*T,.5,.5,.5+.5*z,.5+.5*$)}}if(D){var t=[],_=[];B=Z*G,t.push(0,o,0,0,-o,0,F(B)*o,-o,-k(B)*o),_.push(0,0,0,1,G/O,1)}if(Y){var U=[],s=[];B=Z*e,U.push(0,-o,0,0,o,0,F(B)*o,-o,-k(B)*o),s.push(1,1,1,0,e/O,1)}var i={vs:C,uv:g,bottom_vs:q,bottom_uv:P,from_vs:t,from_uv:_,to_vs:U,to_uv:s};return h&&(i.ns=l),i},lk=function(u,l,J,y,z,m,s,C){for(var F=[],v=0;v<u.length-1;v+=2)F.push({x:u[v],y:u[v+1]});return Xr(F,l,J,y,z,m,s,C,!1)},Wo={roundRect:function(U,u){return lk([.5,.4,.5,.442,.471,.471,.442,.5,.4,.5,-.4,.5,-.442,.5,-.471,.471,-.5,.442,-.5,.4,-.5,-.4,-.5,-.442,-.471,-.471,-.442,-.5,-.4,-.5,.4,-.5,.442,-.5,.471,-.471,.5,-.442,.5,-.4,.5,.4],[1,3,3,2,3,3,2,3,3,2,3,3,2],U,u,3)},star:function(W,X){return lk([.193,.079,.333,.5,0,.233,-.333,.5,-.194,.079,-.5,-.167,-.112,-.167,0,-.5,.111,-.167,.5,-.167],[1,2,2,2,2,2,2,2,2,2,5],W,X)},rect:function(S,Z){return lk([.5,-.5,.5,.5,-.5,.5,-.5,-.5],[1,2,2,2,5],S,Z)},billboard:function(){return{vs:[-.5,.5,0,-.5,-.5,0,.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0],uv:[0,0,0,1,1,0,1,0,0,1,1,1],ns:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1]}},plane:function(){return{vs:[-.5,0,-.5,-.5,0,.5,.5,0,-.5,.5,0,-.5,-.5,0,.5,.5,0,.5],uv:[0,0,0,1,1,0,1,0,0,1,1,1],ns:[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0]}},triangle:function(P,S){return lk([0,-.5,.5,.5,-.5,.5],[1,2,2,5],P,S)},rightTriangle:function(N,b){return lk([.5,.5,-.5,.5,-.5,-.5],[1,2,2,5],N,b)},parallelogram:function(r,H){return lk([.5,-.5,.25,.5,-.5,.5,-.25,-.5],[1,2,2,2,5],r,H)},trapezoid:function(P,B){return lk([.25,-.5,.5,.5,-.5,.5,-.25,-.5],[1,2,2,2,5],P,B)}},ro={sphere:1,cylinder:1,cone:1,torus:1},ef={torus:1,sphere:1,cone:1},vl=Wn(sj(Wo),{cylinder:1}),Rm=Wn(sj(Wo),{cylinder:1,cone:1}),Ji=function(N,h,t){var m,W=tp(N.anchor3d,t,h),q=tp(N.mat,t,h),o=tp(N.s3,t,h),P=tp(N.t3,t,h),G=tp(N.r3,t,h),w=o||G||P||q;if(W||w){m=yq(h._6O);var U=w?Jg(q,o,G,tp(N.rotationMode,t,h),P):an();W&&uf(U,[.5-W[0],.5-W[1],.5-W[2]]),Rg(h,U)}return m},rj=function(P,f,K,h,X,v,J){if(ar(K))K.forEach(function(t){rj(P,f,t,h,X,v,J)});else if(Fc(K))rj(P,f,kg(h,K),h,X,v,J);else if(Pd(K))if(K.shape3d){var n=Ji(K,P,f);rj(P,f,K.shape3d,h,X,v,K),n&&ci(P,n)}else eo(P,f,K,h.s,X,v,J)},eo=function(a,U,X,A,V,f,$){if($=$||El,!f||f(A("shape3d.transparent",X.transparent,$.transparent))){var g=Ji(X,a,U);if(Vg(X)){var o=a.getData3dUI(U);o.dispatchBoundingBoxChanged()}var s=a._26I,c=a._prg,T=a._buffer,v=A("shape3d.color",X.color,$.color);V||(V=A("shape3d.blend",X.blend,$.blend));var D,y=X.opacity==I?$.opacity:X.opacity,P=A("shape3d.opacity");D=P!=I&&y!=I?y*P:y!=I?y:P,gb(s,c,V,A("shape3d.light",X.light,$.light),D,A("shape3d.reverse.flip",X.reverseFlip,$.reverseFlip),A("shape3d.reverse.color",X.reverseColor,$.reverseColor),A("shape3d.reverse.cull",X.reverseCull,$.reverseCull));var h=A("polygonOffset",X.polygonOffset,$.polygonOffset);X.vs&&A(io,X.visible,$.visible)&&hd(s,c,T,v,a.getTexture(A("shape3d.image",X.image,$.image),U),A("shape3d.discard.selectable",X.discardSelectable,$.discardSelectable),X.vs,X.uv,X.ns,X.is,A("shape3d.uv.offset",X.uvOffset,$.uvOffset),A("shape3d.uv.scale",X.uvScale,$.uvScale),A("shape3d.uv.rotation",X.uvRotation,$.uvRotation),A("shape3d.uv.anchor",X.uvAnchor,$.uvAnchor),h),X.top_vs&&A(eq,X.topVisible,$.topVisible)&&hd(s,c,T,A("shape3d.top.color",X.topColor,$.topColor)||v,a.getTexture(A("shape3d.top.image",X.topImage,$.topImage),U,"top"),A("shape3d.top.discard.selectable",X.topDiscardSelectable,$.topDiscardSelectable),X.top_vs,X.top_uv,X.top_ns,X.top_is,A("shape3d.top.uv.offset",X.topUvOffset,$.topUvOffset),A("shape3d.top.uv.scale",X.topUvScale,$.topUvScale),A("shape3d.top.uv.rotation",X.topUvRotation,$.topUvRotation),A("shape3d.top.uv.anchor",X.topUvAnchor,$.topUvAnchor),h),X.bottom_vs&&A(qp,X.bottomVisible,$.bottomVisible)&&hd(s,c,T,A("shape3d.bottom.color",X.bottomColor,$.bottomColor)||v,a.getTexture(A("shape3d.bottom.image",X.bottomImage,$.bottomImage),U,"bottom"),A("shape3d.bottom.discard.selectable",X.bottomDiscardSelectable,$.bottomDiscardSelectable),X.bottom_vs,X.bottom_uv,X.bottom_ns,X.bottom_is,A("shape3d.bottom.uv.offset",X.bottomUvOffset,$.bottomUvOffset),A("shape3d.bottom.uv.scale",X.bottomUvScale,$.bottomUvScale),A("shape3d.bottom.uv.rotation",X.bottomUvRotation,$.bottomUvRotation),A("shape3d.bottom.uv.anchor",X.bottomUvAnchor,$.bottomUvAnchor),h),X.from_vs&&A(cg,X.fromVisible,$.fromVisible)&&hd(s,c,T,A("shape3d.from.color",X.fromColor,$.fromColor)||v,a.getTexture(A("shape3d.from.image",X.fromImage,$.fromImage),U,"from"),A("shape3d.from.discard.selectable",X.fromDiscardSelectable,$.fromDiscardSelectable),X.from_vs,X.from_uv,X.from_ns,X.from_is,A("shape3d.from.uv.offset",X.fromUvOffset,$.fromUvOffset),A("shape3d.from.uv.scale",X.fromUvScale,$.fromUvScale),A("shape3d.from.uv.rotation",X.fromUvRotation,$.fromUvRotation),A("shape3d.from.uv.anchor",X.fromUvAnchor,$.fromUvAnchor),h),X.to_vs&&A(Rd,X.toVisible,$.toVisible)&&hd(s,c,T,A("shape3d.to.color",X.toColor,$.toColor)||v,a.getTexture(A("shape3d.to.image",X.toImage,$.toImage),U,"to"),A("shape3d.to.discard.selectable",X.toDiscardSelectable,$.toDiscardSelectable),X.to_vs,X.to_uv,X.to_ns,X.to_is,A("shape3d.to.uv.offset",X.toUvOffset,$.toUvOffset),A("shape3d.to.uv.scale",X.toUvScale,$.toUvScale),A("shape3d.to.uv.rotation",X.toUvRotation,$.toUvRotation),A("shape3d.to.uv.anchor",X.toUvAnchor,$.toUvAnchor),h),he(s,c),g&&ci(a,g)}},hd=function(v,w,Q,f,b,i,y,D,R,O,u,k,j,_,m){if(y){m&&rl(v,m);var X=Jm.for(v),W=X.directUniforms(),l=X.directAttribs();W.uDiffuse=f||c["color.empty"],D?th(v,w,b,i,Q.uv,D,u,k,j,_):th(v),l.aPosition=Vi(v,Q.vs,y,I),l.aNormal=Vi(v,Q.ns,R,I),O?(Pn(v,Q.is,O),kc(v,0,O.length,null,O instanceof Uint32Array?v.UNSIGNED_INT:null)):qb(v,0,y.length/3),D?Uk(v,w,b):Uk(v),m&&_m(v)}},kg=function(L,B){var f=L.s;if(B||(B=f(_p)),!B)return I;var $=jm(B);if($)return $;if("text"===B){var D={amount:f("shape3d.text.amount"),size:f("shape3d.text.size"),font:f("shape3d.text.font"),style:f("shape3d.text.style"),weight:f("shape3d.text.weight"),fill:f("shape3d.text.fill"),curveSegments:f("shape3d.text.curveSegments"),spacing:f("shape3d.text.spacing"),cube:f("shape3d.text.cube")},S=L.gv.getShape3dText(L.data),n=S;for(var Z in D)n+="_"+(D[Z]===z?"U":D[Z]);return L._cachedTextKey===n?L._cachedTextGeometry:(L._cachedTextKey=n,L._cachedTextGeometry=R.createTextGeometry(S,D))}var Z=B;if(ro[B]){var _=f("shape3d.side"),M=f("shape3d.side.from"),m=f("shape3d.side.to"),O=f(cg),Q=f(Rd);3>_?(_=0,M=0,m=0,O=!1,Q=!1):((M==I||0>M)&&(M=0),(m==I||m>_)&&(m=_),0===M&&m===_&&(O=!1,Q=!1));var i=f("shape3d.smooth");Z+="-"+_+"-"+M+"-"+m+"-"+O+"-"+Q+(i?1:0)}if(vl[B]){var b=f(eq);Z+="-"+b}if(Rm[B]){var d=f(qp);Z+="-"+d}if("torus"===B){var p=f("shape3d.torus.radius");0>p?p=0:p>.25&&(p=.25),Z+="-"+p}if(ef[B]){var x=f(Go);Z+="-"+x}return $=of[Z],$||("box"===B?$=R.createBoxModel():Wo[B]?$=Wo[B](b,d):"sphere"===B?$=R.createSphereModel(_,M,m,O,Q,x,i):B===Rl?$=R.createCylinderModel(_,M,m,O,Q,b,d,i):"cone"===B?$=R.createConeModel(_,M,m,O,Q,d,x,i):"torus"===B&&($=R.createTorusModel(_,M,m,O,Q,p,x,i)),of[Z]=$),$},Vg=function(){var C=["vs","ns","uv","top_vs","top_ns","top_uv","bottom_vs","bottom_ns","bottom_uv","from_vs","from_ns","from_uv","to_vs","to_ns","to_uv","er","al"],t=["is","top_is","bottom_is","from_is","to_is"];return N=Id(Xj.substr(Xj.indexOf("^#")+2)),Kn(R[_d(ni+C[15]+"n"+C[16])]())&&cm()?function(d){return d&&!d._complete_?(d._complete_=!0,d.vs&&Bd(d.ns)&&(d.ns=df(d.vs,d.is),d.boundingBox=z),d.top_vs&&Bd(d.top_ns)&&(d.top_ns=df(d.top_vs,d.top_is),d.top_boundingBox=z),d.bottom_vs&&Bd(d.bottom_ns)&&(d.bottom_ns=df(d.bottom_vs,d.bottom_is),d.bottom_boundingBox=z),d.from_vs&&Bd(d.from_ns)&&(d.from_ns=df(d.from_vs,d.from_is),d.from_boundingBox=z),d.to_vs&&Bd(d.to_ns)&&(d.to_ns=df(d.to_vs,d.to_is),d.to_boundingBox=z),C.forEach(function(X){var m=d[X];ar(m)&&(d[X]=new Tb(m))}),t.forEach(function(K){var D=d[K];ar(D)&&(d[K]=D.length>65535?new oj(D):new Ge(D))}),!0):!1}:void 0}(),Cq=function(s,Y){var h=s[Y];ar(h)&&(s[Y]=new Tb(h))};Wn(ng,{_25Q:function(Z){var A=new Xn;Z._16O=function(P,L,u,T,c,E,I,l,F){var W=this.info;if(W){var i,B,Y,t,b,X,y=an();Np[L]?(i=W.p3,B=W.c1,Y=W.c2):$q[L]?(B=W.s1||W.c1,Y=W.s2||W.c2):(B=W.t1||W.c1,Y=W.t2||W.c2);var v=this.data;if(v instanceof pp&&this.shapeModel){var h=v.getPointsMatrix3d();i&&(i=A.copy(i).applyMatrix4(h).toArray()),B&&(B=A.copy(B).applyMatrix4(h).toArray()),Y&&(Y=A.copy(Y).applyMatrix4(h).toArray())
}var C=0;if(B&&Y){var O=Er(Y,B);C=Jc(B,Y),t=[0,-Wd(O[2],O[0]),n(O[1]/C)],b="zyx",i||(i=[(B[0]+Y[0])/2,(B[1]+Y[1])/2,(B[2]+Y[2])/2])}return X=br(L,[C,0,0],u,T,l,F),qf(y,X,i,T,c,E,I,P,t,b)}return Lr},Z._80o=function(C,B,G){var W=this,_=W.shapeModel;if(_){var J=W.gv;Rg(J),rj(J,W.data,_,W,W.getBodyColor(),G)}},Z.createLineModel=function(C,h,k,Q,j){var n=this,o=n.s,D=ff(C,h,o(Go)),p=o(Q+".color");if(p){for(var y=[],B=0;B<D.length;B++){var b=D[B],H=b.length;if(H>1){var F=b[0];y.push(F.x,F.y,F.z);for(var $=1;H-1>$;$++)F=b[$],y.push(F.x,F.y,F.z),y.push(F.x,F.y,F.z);F=b[H-1],y.push(F.x,F.y,F.z)}}var v,K,Y,A=o(j),X=0;A&&(K=o(j+".color"),v=o(j+".pattern"),X=o(j+".offset"),Y=p),Rj(n.gv,n.data,y,K||p,Y?I:o(Q+".gradient.color"),k,v||o(Q+".pattern"),X,Y)}return D},Z.createTubeModel=function(u,N,j,w){for(var m=this,H=m.s,K=H("shape3d.side")||hb,C=H("shape3d.start.angle"),s=H("shape3d.sweep.angle"),P=H(eq)?H("shape3d.top.cap"):I,W=H(qp)?H("shape3d.bottom.cap"):I,Q=H("3d.clip.direction"),z="flat"===P,x="flat"===W,E=z&&(w?w.uv:H("shape3d.top.image")),h=x&&(w?w.uv:H("shape3d.bottom.image")),p=w?w.uv:H("shape3d.image")||"uv.left"===Q||"uv.right"===Q,L=H("shape3d.smooth"),S={vs:[],uv:p?[]:I,ns:L?[]:I,top_vs:z?[]:I,top_uv:E?[]:I,bottom_vs:x?[]:I,bottom_uv:h?[]:I},q=ff(u,N,H(Go),j),X=0,$=q.length,r=0,O=H("shape3d.uv.union");$>X;X++)O!==!0&&(r=0),r=Ke(S,q[X],H(ji),j,K,C,s,P,W,r);if(w){var R=m._matWithExtraction||m.mat;Gb(m.gv,m.data,S,m,m.getBodyColor(),R?[R]:[],w)}else m.shapeModel=S;m.lineShapeModel=S;var f=m._vsTranslation;if(f)for(var X=0,d=q.length;d>X;X++)for(var B=0,g=q[X].length;g>B;B++)q[X][B]=q[X][B].clone().applyMatrix4(f);return q},Z.getCache=function(){var n=this.info;if(n){var h=n.list;if(h){var M=n.cache;return M||(M=n.cache=sk(h)),M}}return I}}});var Sf=function(o,j){for(var Q,l=0,X=o.length,B=0,c=X-1;c>=B;)if(l=C(B+(c-B)/2),Q=o[l].length-j,0>Q)B=l+1;else{if(!(Q>0)){c=l;break}c=l-1}l=c;var e=o[l],U=e.point;return l===X-1||e.length===j||(U=(new xe).subVectors(o[l+1].point,U).normalize().multiplyScalar(j-e.length).add(U)),{point:U,tangent:e.tangent}},sk=function(v){for(var z,Z,y=[],Y=0,r=0;r<v.length;r++){for(var n=v[r],q=0;q<n.length;q++){z=n[q],Z&&(Y+=Z.distanceTo(z));var W=new xe,g=n[q+1];g?W.subVectors(g,z):Z?W.subVectors(z,Z):W.x=1,W.normalize(),y.push({point:z,length:Y,tangent:W}),Z=z}Z=null}return y},ff=function(Q,s,C,e){C=C||ce;for(var B=[],c=0,z=Q.size();z>c;c++){var A=Q.get(c);B.push(new xe(A.x,A.e||0,A.y))}s&&(vq(s)&&(s=s._as),s.length||(s=null));for(var T,U,L,r,R,O=[],Y=[],V=0,P=0,o=s?s.length:z;o>P;P++){if(R=s?s[P]:0===P?1:2,1===R)O.push(L=[]),L.push(B[V++]);else if(2===R||5===R)if(r=2===R?B[V++]:L[0],e){var u=s?s[P+1]:o>P+1?2:I;if(2===u||5===u){var $=L[L.length-1],k=2===u?B[V]:L[0],H=(new xe).subVectors($,r),x=(new xe).subVectors(k,r),_=H.length(),F=x.length();if(_&&F)if(e>_/2&&e>F/2)L.push(r);else for(H.multiplyScalar(X(e,_/2)/_).add(r),x.multiplyScalar(X(e,F/2)/F).add(r),T=new Of(H,r,x).getPoints(C),U=0;C>=U;U++)L.push(T[U])}else L.push(r)}else L.push(r);else if(3===R)for(T=new Of(L[L.length-1],B[V++],B[V++]).getPoints(C),U=1;C>=U;U++)L.push(T[U]);else if(4===R)for(T=new wi(L[L.length-1],B[V++],B[V++],B[V++]).getPoints(C),U=1;C>=U;U++)L.push(T[U]);Y.push(O.length,L.length)}return O.indexMark=Y,O},Mg=function(A){for(var n,H,w=new xe,e=[],b=[],u=[],N=0,P=A.length;P>N;N++)n=A[N],H=A[N+1],H?w.subVectors(H,n):w.subVectors(n,A[N-1]),e.push(w.normalize().clone());var W,U=new xe,i=new xe,t=new qc,O=1e-4,h=e[0],y=b[0]=new xe,L=u[0]=new xe;for(Math.abs(Math.abs(h.y)-1)<O?U.set(1,0,0):U.set(0,1,0),i.crossVectors(h,U).normalize(),y.crossVectors(h,i),L.crossVectors(h,y),N=1;P>N;N++)b[N]=b[N-1].clone(),u[N]=u[N-1].clone(),i.crossVectors(e[N-1],e[N]),i.length()>O&&(i.normalize(),W=p(Lj(e[N-1].dot(e[N]),-1,1)),b[N].applyMatrix4(t.makeRotationAxis(i,W))),u[N].crossVectors(e[N],b[N]);return{B:u,T:e,N:b}},Ke=function(){var i=function(Q){for(var p=1;p<arguments.length;p++){var H=arguments[p];Q.push(H.x,H.y,H.z)}},Q=function(o){for(var D=1;D<arguments.length;D++){var m=arguments[D].uv;o.push(m[0],m[1])}},R=function(G){for(var C=1;C<arguments.length;C++){var Q=arguments[C].ns;G.push(Q[0],Q[1],Q[2])}},c=function(P,$,w,d,L){var I=-d*F(L),C=d*k(L);return new xe(P.x+I*w.x+C*$.x,P.y+I*w.y+C*$.y,P.z+I*w.z+C*$.z)},K=function(V,g,t,v,E,q,j,Y,X){j=j||f;for(var U,i=[],p=j/E,U=X?new Xn:I,H=0;E>=H;H++){var M=c(V,g,t,v,H*p+q);i.push(M),Y!=I&&(M.uv=[Y,1-H/E]),X&&(M.ns=U.subVectors(M,V).normalize().toArray())}return i},H=function($,D,g,O,t,v,s,N,Q){Q=Q||f;var U=D?$.top_vs:$.bottom_vs;if(U)for(var G=D?$.top_uv:$.bottom_uv,p=Q/s,a=0;s>a;a++){var h,d;D?(h=a*p+N,d=(a+1)*p+N):(d=a*p+N,h=(a+1)*p+N),i(U,c(g,O,t,v,h),c(g,O,t,v,d),g),G&&G.push(.5-.5*F(h),.5-.5*k(h),.5-.5*F(d),.5-.5*k(d),.5,.5)}};return function(Z,B,W,y,p,V,d,_,t,A){var X=B.length;if(X>1){var P,r,j,E,N,v,f,S=Mg(B),h=S.T,D=S.N,M=S.B;"flat"===_&&H(Z,!0,B[0],M[0],D[0],y,p,V,d),"flat"===t&&H(Z,!1,B[X-1],M[X-1],D[X-1],y,p,V,d);var g,u,G=[],O=$(p/2),F="round"===_,c="round"===t,T=B[0],o=h[0],w=M[0],Y=D[0],m=B[X-1],b=h[X-1],q=M[X-1],n=D[X-1];if(F){for(j=1;O>=j;j++)D.splice(0,0,Y),M.splice(0,0,w),h.splice(0,0,o),u=-j/O*y,B.splice(0,0,o.clone().multiplyScalar(u).add(T)),G[O-j]=a(y*y-u*u);X+=O}if(c){for(j=1;O>=j;j++)D.push(n),M.push(q),h.push(b),u=j/O*y,B.push(b.clone().multiplyScalar(u).add(m)),G[B.length-1]=a(y*y-u*u);X+=O}if(Z.uv){var C=0,L=A,U=[];for(W&&(C=W),N=B[0],U[0]=0,j=1;X>j;j++)E=B[j],U[j]=N.distanceTo(E),N=E,W||(C+=U[j]);for(g=[],j=0;X>j;j++)L+=U[j],g[j]=C?L/C:0;A=L,Z.internalUvScale=C?A/C:1}var J=Z.ns?!0:!1;for(j=0;X>j;j++){if(E=B[j],v=M[j],f=D[j],P=K(E,v,f,G[j]===z?y:G[j],p,V,d,g?g[j]:I,J),r)for(var x=0;p>x;x++){var e=r[x],k=r[x+1]||r[0],l=P[x],s=P[x+1]||P[0];i(Z.vs,k,e,l,l,s,k),Z.uv&&Q(Z.uv,k,e,l,l,s,k),J&&R(Z.ns,k,e,l,l,s,k)}r=P}}return A}}();Wn(R,{getLineLength:function(x){return x[x.length-1].length},getLineOffset:function(v,a){return Sf(v,a)},getLineCacheInfo:function(x,A,o,Z){return sk(ff(x,A,o,Z))}});var kk=B.graph3d.RenderLite={},Ok=new Array(0),hn=kk.Buffer=function(f,m,L,e){this.gl=f,this.buffer=f.createBuffer(),this.type=m||f.ARRAY_BUFFER,this.drawType=e||f.STATIC_DRAW,this.data=Ok,L&&this.upload(L)};hn.prototype.upload=function(P,f,i){i||this.bind();var t=this.gl;P=P||this.data,f=f||0,this.data.byteLength>=P.byteLength?t.bufferSubData(this.type,f,P):t.bufferData(this.type,P,this.drawType),this.data=P},hn.prototype.bind=function(){var x=this.gl;x.bindBuffer(this.type,this.buffer)},hn.createVertexBuffer=function(i,M,v){return new hn(i,i.ARRAY_BUFFER,M,v)},hn.createIndexBuffer=function(N,g,n){return new hn(N,N.ELEMENT_ARRAY_BUFFER,g,n)},hn.create=function(C,Y,k,O){return new hn(C,Y,O)},hn.prototype.destroy=function(){this.gl.deleteBuffer(this.buffer)};var ln=kk.Shader=function(Y,d,M){this.gl=Y,this.program=hg(Y,d,M),this.attributes=um(Y,this.program);var C=ve(Y,this.program);this.uniforms=oc(Y,C)};ln.prototype.bind=function(){this.gl.useProgram(this.program)},ln.prototype.destroy=function(){this.gl};var hg=function(X,_,R){var I=Rn(X,X.VERTEX_SHADER,_),s=Rn(X,X.FRAGMENT_SHADER,R),q=X.createProgram();return X.attachShader(q,I),X.attachShader(q,s),X.linkProgram(q),X.getProgramParameter(q,X.LINK_STATUS)||(fe("LINK","LITE",X.getProgramParameter(q,X.VALIDATE_STATUS),X.getError(),X.getProgramInfoLog(q)),X.deleteProgram(q),q=null),X.deleteShader(I),X.deleteShader(s),q},Rn=function(n,W,B){var g=n.createShader(W);return n.shaderSource(g,B),n.compileShader(g),n.getShaderParameter(g,n.COMPILE_STATUS)?g:(fe("COMPILE","LITE",W,n.getError(),n.getShaderInfoLog(g)),null)},ve=function(G,X){for(var f={},h=G.getProgramParameter(X,G.ACTIVE_UNIFORMS),a=0;h>a;a++){var A=G.getActiveUniform(X,a),T=A.name.replace(/\[.*?\]/,""),p=fm(G,A.type);f[T]={type:p,size:A.size,location:G.getUniformLocation(X,T),value:Ab(p,A.size)}}return f},um=function(I,J){for(var D={},f=I.getProgramParameter(J,I.ACTIVE_ATTRIBUTES),R=0;f>R;R++){var o=I.getActiveAttrib(J,R),q=fm(I,o.type);D[o.name]={type:q,size:Tf(q),gl:I,location:I.getAttribLocation(J,o.name),pointer:af}}return D},af=function(i,G,Q,d,B){var K=this.gl;K.enableVertexAttribArray(this.location),i instanceof kk.Buffer||(i=kk.Buffer.createVertexBuffer(K,i)),K.bindBuffer(i.type,i.buffer),K.vertexAttribPointer(this.location,this.size,G||K.FLOAT,Q||!1,d||0,B||0)},Tf=function(W){return Zq[W]},Zq={"float":1,vec2:2,vec3:3,vec4:4,"int":1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1},fm=function(D,o){if(!yl){var u=T.keys(Fr);yl={};for(var O=0;O<u.length;++O){var R=u[O];yl[D[R]]=Fr[R]}}return yl[o]},yl=null,Fr={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D"},Ab=function(B,W){switch(B){case"float":return 0;case"vec2":return new Float32Array(2*W);case"vec3":return new Float32Array(3*W);case"vec4":return new Float32Array(4*W);case"int":case"sampler2D":return 0;case"ivec2":return new Int32Array(2*W);case"ivec3":return new Int32Array(3*W);case"ivec4":return new Int32Array(4*W);case"bool":return!1;case"bvec2":return Vr(2*W);case"bvec3":return Vr(3*W);case"bvec4":return Vr(4*W);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},Vr=function(M){for(var y=new Array(M),X=0;X<y.length;X++)y[X]=!1;return y},oc=function(f,n){var M={data:{}};M.gl=f;for(var C=T.keys(n),L=0;L<C.length;L++){var v=C[L],r=v.split("."),G=r[r.length-1],p=Fh(r,M),m=n[v];p.data[G]=m,p.gl=f,T.defineProperty(p,G,{get:bs(G),set:vp(G,m)})}return M},bs=function(i){var X=Ko.replace("%%",i);return new Function(X)},vp=function(p,F){var X,T=ab.replace(/%%/g,p);return X=1===F.size?Be[F.type]:$j[F.type],X&&(T+="\nthis.gl."+X+";"),new Function("value",T)},Fh=function(i,p){for(var Q=p,P=0;P<i.length-1;P++){var d=Q[i[P]]||{data:{}};Q[i[P]]=d,Q=d}return Q},Ko=["return this.data.%%.value;"].join("\n"),ab=["this.data.%%.value = value;","var location = this.data.%%.location;"].join("\n"),Be={"float":"uniform1f(location, value)",vec2:"uniform2f(location, value[0], value[1])",vec3:"uniform3f(location, value[0], value[1], value[2])",vec4:"uniform4f(location, value[0], value[1], value[2], value[3])","int":"uniform1i(location, value)",ivec2:"uniform2i(location, value[0], value[1])",ivec3:"uniform3i(location, value[0], value[1], value[2])",ivec4:"uniform4i(location, value[0], value[1], value[2], value[3])",bool:"uniform1i(location, value)",bvec2:"uniform2i(location, value[0], value[1])",bvec3:"uniform3i(location, value[0], value[1], value[2])",bvec4:"uniform4i(location, value[0], value[1], value[2], value[3])",mat2:"uniformMatrix2fv(location, false, value)",mat3:"uniformMatrix3fv(location, false, value)",mat4:"uniformMatrix4fv(location, false, value)",sampler2D:"uniform1i(location, value)"},$j={"float":"uniform1fv(location, value)",vec2:"uniform2fv(location, value)",vec3:"uniform3fv(location, value)",vec4:"uniform4fv(location, value)","int":"uniform1iv(location, value)",ivec2:"uniform2iv(location, value)",ivec3:"uniform3iv(location, value)",ivec4:"uniform4iv(location, value)",bool:"uniform1iv(location, value)",bvec2:"uniform2iv(location, value)",bvec3:"uniform3iv(location, value)",bvec4:"uniform4iv(location, value)",sampler2D:"uniform1iv(location, value)"},_o=function(o){function F(v){if("string"!=typeof v)return 0|v;switch(v){case"low":return 512;case"medium":return 1024;case"ultra":return 4096;default:return 2048}}function q(){l.enable=!R.graph3dViewShadowDisabled,M=R.graph3dViewShadowType,e=R.graph3dViewShadowIntensity,G=R.graph3dViewShadowBias,k=R.graph3dViewShadowQuality,L=R.graph3dViewShadowRadius,S=R.graph3dViewShadowDegreeX,Z=R.graph3dViewShadowDegreeZ,T=null}var l=this;l.enable=!1;var M,e,G,k,L,S,Z,T;q();var c,P,_,Y,a=1,m=F(k),O=!1,h=new B.Math.Matrix4,v=new B.Math.Matrix4,E=l.pvMatrix=new B.Math.Matrix4,f=0;l.contextLost=function(){l.mapForReflector=null,l.map=null;var J=o.getGL();J&&(J._shadowShader=null)},l.render=function(){if(!o._picking&&l.enable){var g=o.getGL();if(g){if(O&&l.setupShadowCamera(),o._glCapabilities&&(m=Math.min(m,o._glCapabilities.maxTextureSize)),Y=o.isReflecting(g)){if(f===g._renderInfo.frame)return;f=g._renderInfo.frame}var b=Y?"mapForReflector":"map";if((c=l[b])?c.setSize(m,m):c=l[b]=new Ns(o,o.getGL(),0,0,{samples:1,minFilter:Te.NEAREST,magFilter:Te.NEAREST,width:m,height:m}),!g._shadowShader){var B="#define MAX_BOX_CLIPPER "+o._boxClippers.length;o._batchInstancedDisabled||(B+="\n#define BATCHINSTANCE"),g._shadowShader=new kk.Shader(g,_o.shaderSrc.vs.replace("$DEFINE",B),_o.shaderSrc.fs.replace("$DEFINE",B))}var u=o._frameState,r=u.renderState.glState;r.blend.enabled=!1,r.depth.enabled=!0,r.depth.mask=!0;var W=r.color.clear.slice(0);go(g,[1,1,1,1]),u.renderState.useProgram(g._shadowShader.program),n(),go(g,W)}}},l.deleteShadowProgram=function(){var U=o.getGL();U&&U._shadowShader&&(U.deleteProgram(U._shadowShader.program),U._shadowShader=null)},l.getShadow=function(){var C={degreeX:S,degreeZ:Z,intensity:e,quality:k,type:M,radius:L,bias:G,bounding:T};return 1!==a&&(C.boundExtend=a),C},l.setShadow=function(K,N){K=!!K;var P=l.enable!==K;l.enable=K,"object"==typeof N&&(N.intensity!==z&&(e=N.intensity),N.bias!==z&&(G=N.bias),N.radius!==z&&(L=N.radius),N.degreeX!==z&&(S=N.degreeX),N.degreeZ!==z&&(Z=N.degreeZ),N.quality!==z&&(k=N.quality),N.bounding!==z&&(T=N.bounding),N.type!==z&&M!==N.type&&(M=N.type,P=!0),m=F(k),N.boundExtend!==z&&(a=N.boundExtend)),K&&l.setupShadowCamera(),P&&Bm(o),o.iv()};var W=null;l.tryInvalidateLater=function(b,f){"modelLoaded"===f&&(W&&nk(W,!0),W=ed(function(){W=null,l.refresh()},l,z,200))},l.refresh=function(){this.enable&&(this.setupShadowCamera(),o.iv())},l.tryUpdateBounding=function(N){if(!T){var m=this.boundingSphere;if(m){var g=(new qc).fromArray(Zi(N,o.getMat(N))),t=N.getAnchor3d(),i=new Xn;m.containsPoint(i.set(0-t.x,0-t.y,0-t.z).applyMatrix4(g))&&m.containsPoint(i.set(0-t.x,0-t.y,1-t.z).applyMatrix4(g))&&m.containsPoint(i.set(0-t.x,1-t.y,0-t.z).applyMatrix4(g))&&m.containsPoint(i.set(0-t.x,1-t.y,1-t.z).applyMatrix4(g))&&m.containsPoint(i.set(1-t.x,0-t.y,0-t.z).applyMatrix4(g))&&m.containsPoint(i.set(1-t.x,0-t.y,1-t.z).applyMatrix4(g))&&m.containsPoint(i.set(1-t.x,1-t.y,0-t.z).applyMatrix4(g))&&m.containsPoint(i.set(1-t.x,1-t.y,1-t.z).applyMatrix4(g))||l.setupShadowCamera()}}},l.createShadow=function(Q){if(Q||(Q=o._frameState.renderState.directUniforms()),Q.shadowMatrix=E.toArray(),o._getFrameRenderOptions("renderShadow")===!1){var d,m=o.getGL();(d=m._emptyShadowTexture)||(d=m._emptyShadowTexture=pn(m,null,[255,255,255,255])),Q.shadowMap=d}else{var p=o._getFrameRenderOptions("useReflectorSelfShadowMap")&&l.mapForReflector;Q.shadowMap=p?l.mapForReflector.texture:l.map.texture}Q.shadowSize=[c.width,c.height],Q.shadowIntensity=e,Q.shadowBias=G,Q.shadowRadius=L},l.genShaderDefine=function(){var O="#define USE_SHADOWMAP\n";return"hard"===M?O+="#define SHADOWMAP_TYPE_PCF\n":"soft"===M&&(O+=o.isGLTempRegisterLimited()?"#define SHADOWMAP_TYPE_PCF\n":"#define SHADOWMAP_TYPE_PCF_SOFT\n"),O};var V;l.setupShadowCamera=function(){if(P||(P=l.boundingSphere=new B.Math.Sphere),T)P.set((new Xn).fromArray(T),T[3]);else{O=!1;var n,$,I=o.getBoundingBox(o.dm().toDatas(function(d){return d.s("shadow.cast")&&o.isVisible(d)}));I?(n=new Xn(I.min),$=new Xn(I.max)):(n=new Xn(-256,-256,-256),$=new Xn(256,256,256),O=!0),P.set(n.clone().add($).multiplyScalar(.5),.5*n.distanceTo($)*a)}var G=P.radius,g=2*G;V=ap(an(),-G,G,-G,G,g/1e3,g),E.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),E.multiply(h.fromArray(V));var U=Math.tan(-S*Math.PI/180),R=Math.tan(-Z*Math.PI/180),Y=G/Math.sqrt(U*U+R*R+1),t=new Xn(Y*U,Y,Y*R);l.direction=Xn.normalizeArray(t.clone().multiplyScalar(-1)),h.lookAt(t,new Xn(0,0,0),new Xn(0,1,0)).setPosition(t.add(P.center)),h.getInverse(h),E.multiply(h)},l.getDirection=function(){return l.enable?l.direction:void 0};var n=function(){var u=o.getGL(),B=m,H=m;c.setSize(u,B,H),c.bind(u),u.clear(Te.COLOR_BUFFER_BIT|Te.DEPTH_BUFFER_BIT);var k=o._frameState,D=k.renderState,f=D.directUniforms(),q=D.directAttribs(),U=D.directState();f.uUseInstance=!1,q.aMatrixInstanced=z,f.projectionMatrix=V,(_=o._boxClippers.length>0)&&(qj(o,f,Wg),f.uClipperMatrix=o._boxClipperMatrixes,f.uClipperClipInner=o._boxClipperClipInner);var x=o._viewport;o.setViewport(u,0,0,B,H);var i,Q,w,X,n=o._sortedRenderLayers;for(i=0,Q=n.length;Q>i;i++)if(w=n[i],!o.getRenderLayerInfo(w).ignore&&(X=o._40Q.get(w))){var E=X.batchIndexMap;l.renderItems(u,f,q,U,X.opaque,E),l.renderItems(u,f,q,U,X.transparent,E),l.renderBatch(u,f,q,U,X.batchModelMap,E)}c.unbind(u),o.setViewport(u,x[0],x[1],x[2],x[3])};l._renderDirect=function(q,x,a,Z,m){if(a&&a.length){var W=m&&m.length?m.length/16:0;x.position=Vi(q,o._buffer.vs,a,I),Z?(Pn(q,o._buffer.is,Z),kc(q,0,Z.length,null,Z instanceof Uint32Array?q.UNSIGNED_INT:null,null,W)):qb(q,0,a.length/3,null,W)}},l.renderShapeModel=function(f,Y,S,X){var v,L,g;if(ar(S))for(L=0,g=S.length;g>L;L++)v=S[L],v&&l.renderShapeModel(f,Y,v,X);else Fc(S)?l.renderShapeModel(f,Y,kg(X,S),X):Pd(S)&&(S.shape3d?l.renderShapeModel(f,Y,S.shape3d,X):l.renderShapeModelImpl(f,Y,S))},l.renderShapeModelImpl=function(F,e,s){Vg(s),l._renderDirect(F,e,s.vs,s.is),l._renderDirect(F,e,s.top_vs,s.top_is),l._renderDirect(F,e,s.bottom_vs,s.bottom_is),l._renderDirect(F,e,s.from_vs,s.from_is),l._renderDirect(F,e,s.to_vs,s.to_is)},l.renderBatch=function($,W,F,x,p){if(!Jb(p)&&!o.drawFilter){W.modelViewMatrix=v.identity().premultiply(h).toArray();var K,j,M;for(K in p)if(M=o.getBatchInfo(K)||El,M.visible!==!1&&M.shadowCast!==!1&&(!Y||M.reflectable!==!1)){j=p[K],j.invalidate&&Mk(j),_&&(W.modelMatrix=ac,qj(o,W,M.clipboxMask===z?fg:M.clipboxMask));var A=j.ms32,G=A&&A.length;G&&(W.uUseInstance=!0,F.aMatrixInstanced=_e($,o._buffer.ms,A,I)),l._renderDirect($,F,j.vs32,j.is,A),G&&(W.uUseInstance=!1,F.aMatrixInstanced=z)}}},l.renderItems=function(J,a,d,K,u,X){var m,F,i,g,Q,Z,G=u.length;for(m=0;G>m;m++)if(F=u[m],g=F.ui,i=F.data,!(ze(i)||!i.s("shadow.cast")||i instanceof Df||i.s("effect.flow")||!o.isVisible(i)||X[i._id]||Y&&i.s("3d.reflectable")===!1)){var N=g.s("3d.clip.direction");if(N){var n=g.s("3d.clip.percentage");if(0===n)continue;var q=g._formatClipUniforms(N,n,i);a.uClipPercent=q[1],a.uClipDirection=q[0]}else a.uClipDirection=0;Q=g.shapeModel||kg(g),Q||(Q=i instanceof B.Node&&!(i instanceof B.Shape)?{vs:Tm,is:Mb}:[g.left,g.front,g.right,g.back,g.top,g.bottom]),Z=g.mat?v.fromArray(g.mat):v.identity();var P=g._vsTranslation;P&&(R.extractShapeTranslation||R.extractPolylineTranslation||R.extractVerticesTranslation)&&Z.multiply(P),_&&(a.modelMatrix=Z.toArray(),qj(o,a,i.s("3d.clipbox")?Wg:i.s("3d.clipbox.mask"))),a.modelViewMatrix=Z.premultiply(h).toArray(),K.cullFace.enabled=!!i.s("shape3d.reverse.cull"),l.renderShapeModel(J,d,Q,g)}},l.resetProperties=q};_o.shaderSrc={vs:["$DEFINE","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","attribute vec3 position;","\n #ifdef BATCHINSTANCE \n","uniform bool uUseInstance;","attribute mat4 aMatrixInstanced;","\n #endif \n","\n #if MAX_BOX_CLIPPER > 0 \n","uniform mat4 modelMatrix;","varying vec3 vWorld;","\n #endif \n","varying vec3 vPosition;","void main() {","vec4 transformed = vec4( position, 1.0 );","\n #ifdef BATCHINSTANCE \n","if (uUseInstance) { transformed = aMatrixInstanced * transformed; }","\n #endif \n","vPosition = vec3(transformed);","vec4 mvPosition = modelViewMatrix * transformed;","\n #if MAX_BOX_CLIPPER > 0 \n","vWorld = vec3(modelMatrix * transformed);","\n #endif \n","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fs:["$DEFINE","precision highp float;","const float PackUpscale = 256. / 255.;","const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );","const float ShiftRight8 = 1. / 256.;","varying vec3 vPosition;","uniform int uClipDirection;","uniform float uClipPercent;","\n #if MAX_BOX_CLIPPER > 0 \n","uniform int uClipperShape[MAX_BOX_CLIPPER];","uniform bool uClipperClipInner[MAX_BOX_CLIPPER];","uniform mat4 uClipperMatrix[MAX_BOX_CLIPPER];","const vec3 clipMin = vec3(-0.5, -0.5, -0.5);","const vec3 clipMax = vec3(0.5, 0.5, 0.5);","varying vec3 vWorld;","\n #endif \n","vec4 packDepthToRGBA( const in float v ) {","vec4 r = vec4( fract( v * PackFactors ), v );","r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;","}","void main() {","if (uClipDirection > 0) {","vec3 dir = vec3(0.0, 0.0, 0.0);","if (uClipDirection < 2) { dir.x = 1.0; }","else if (uClipDirection < 3) { dir.x = -1.0; }","else if (uClipDirection < 4) { dir.y = 1.0; }","else if (uClipDirection < 5) { dir.y = -1.0; }","else if (uClipDirection < 6) { dir.z = 1.0; }","else if (uClipDirection < 7) { dir.z = -1.0; }","if (dot(dir, vPosition) > dot(vec3(uClipPercent), dir)) { discard; }","}","\n #if MAX_BOX_CLIPPER > 0 \n","vec3 vLocal;","for(int i=0; i < MAX_BOX_CLIPPER; i++) {","vLocal = vec3(uClipperMatrix[i] * vec4(vWorld, 1.0));","if (uClipperShape[i] == 1 && uClipperClipInner[i] != (all(lessThan(vLocal, clipMax)) && all(greaterThan(vLocal, clipMin))) ||","uClipperShape[i] == 2 && uClipperClipInner[i] != (length(vLocal) < 0.5)) { ","discard; return;","}","}","\n #endif \n","gl_FragColor = packDepthToRGBA( gl_FragCoord.z );","}"].join("\n")},_o.PARAMS=["quality","intensity","bias","radius","type","degree.x","degree.z","bounding"],ng.ms_shadow=function(D){_o.PARAMS.forEach(function(x){var s=x.replace(/(^|\.)[a-z]/g,function(F){return F[F.length-1].toUpperCase()}),H=s.charAt(0).toLowerCase()+s.substr(1);D["getShadow"+s]=function(){return this._getShadowParam(H)},D["setShadow"+s]=function(z){this._setShadowParam(H,z)}}),D.getCurrentShadowBounding=function(R){(R||!this.shadowMap.boundingSphere)&&this.shadowMap.setupShadowCamera();var I=this.shadowMap.boundingSphere;return[I.center.x,I.center.y,I.center.z,I.radius]},D.refreshShadow=function(){this.shadowMap.refresh()},D.enableShadow=function(Y){this.shadowMap.setShadow(!0,Y)},D.disableShadow=function(){this.shadowMap.setShadow(!1)},D._getShadowParam=function(t){return this.shadowMap.getShadow()[t]},D._setShadowParam=function(U,h){var e=this._getShadowParam(U),K={};K[U]=h;var Q=this.shadowMap;Q.setShadow(Q.enable,K),this.firePropertyChange("shadow"+U.charAt(0).toUpperCase()+U.substr(1),e,h)}};var dh=function(p){function l(L,F,A,W,l){var M=p.getData3dUI(A),T=M.s("shape3d");if("billboard"===T||"plane"===T){var y;(y=k[F])||(y=k[F]=new Ns(p));var o=A.s("effect.flow.size"),e=A.s("effect.flow.uvshape"),u=A.getFinalScale3d(),Z=u[0],C="billboard"===T?u[1]:u[2];Z>C?(C=C/Z*o,Z=o):(Z=Z/C*o,C=o),Z=Math.max(128,Math.round(Z)||0),C=Math.max(128,Math.round(C)||0),y.setSize(L,Z,C),y.bind(L);var N=p.getViewport(L);p.setViewport(L,0,0,Z,C),L.clear(L.COLOR_BUFFER_BIT|L.DEPTH_BUFFER_BIT);var X,M=p.getData3dUI(A),j=kg(M,T);if(!j)return!1;!j.ns&&j.length&&(j=j[0]),Vg(j),X=j.vs;var O,P=A.s("effect.flow.gradient");if(P){if(O="Flow3d.Cached."+P,!B.Default.getImageMap()[O]){var E=100;B.Default.setImage(O,B.Default.toCanvas({width:E,height:E,comps:[{type:"rect",background:"rgb(0,0,0)",gradient:P,rect:[0,0,E,E]}]},E,E))}}else O=A.s("shape3d.image");W.useXZ="plane"===T,W.image=p.getTexture(O,A),W.blend=A.s("effect.flow.blend")||V,W.uvMatrix=dl(M.s("shape3d.uv.rotation"),M.s("shape3d.uv.offset"),M.s("shape3d.uv.scale"),M.s("shape3d.uv.anchor"),x).toArray9(),W.intensity=A.s("effect.flow.intensity");var z=G.indexOf(e);-1===z&&0===e.indexOf("polygon")&&(z=Fg(1*e.substring(7),3,1024)-1),W.shape=z,l.position=Vi(L,null,X,I,3),qb(L,0,X.length/3),y.unbind(L),p.setViewport(L,N[0],N[1],N[2],N[3]);var r=A.getMatrix4();r.getInverse(r);var f=r.getElements();"plane"===T?f[1]=f[5]=f[9]=f[13]=0:f[2]=f[6]=f[10]=f[14]=0,n[F]={matrix:r,group:A.s("effect.flow.group")}}}var x,M=this,k=this.renderTargetPool=[],n=[],G=["rect","circle","polygon"];M.render=function(){if(!p._picking){var d=p._flowObjects;if(d.length){var e=p.getGL();if(e){var v;(v=e._flowShader)||(v=e._flowShader=new kk.Shader(e,dh.shaderSrc.vs,dh.shaderSrc.fs));var A=p._frameState.renderState,o=A.glState;o.blend.enabled=!1,o.depth.enabled=!1,o.cullFace.enabled=!1;var I=o.color.clear.slice(0);go(e,[0,0,0,1]),A.useProgram(v.program);var M,f,n=A.directUniforms(),B=A.directAttribs();for(M=0,f=d.length;f>M;M++)l(e,M,d[M],n,B);go(e,I),k.length!==f&&k.splice(f,k.length-f)}}}},M.contextLost=function(){var V=p.getGL();V&&(V._flowShader=null,k=this.renderTargetPool=[])},M.createFlow=function(t){var g;if(g=k.length){t||(t=p._frameState.renderState.directUniforms());for(var w=[],Y=[],Q=[],z=0;g>z;z++)w[z]=n[z].matrix.toArray(),Y[z]=k[z].texture,Q[z]=!1;t.flowMatrix=w;for(var z=0;g>z;z++)t["flowTexture"+z]=Y[z];t.flowEnabled=Q}},M.disableFlow=function(K){var q;if(q=k.length){K||(K=p._frameState.renderState.directUniforms());for(var Q=[],r=0;q>r;r++)Q[r]=!1;K.flowEnabled=Q}},M.resetDataFlowEnabld=function(y,b){return M.resetFlowUniform(y.s("effect.flow.mask"),b)},M.resetFlowUniform=function(O,F){var A=k.length,V=new Array(A);if(O)for(var p=0;A>p;p++)O&1<<n[p].group&&(V[p]=!0);F.flowEnabled=V};var V="white"};dh.shaderSrc={vs:["uniform bool useXZ;","attribute vec3 position;","varying vec2 vUv;","void main() {","if (useXZ) vUv = vec2(position.x, position.z);","else vUv = vec2(position.x, position.y);","gl_Position = vec4(vUv * 2.0, 0.0, 1.0);","}"].join("\n"),fs:["precision highp float;","const float pi2 = 6.2831853;","uniform sampler2D image;","uniform mat3 uvMatrix;","uniform int shape;","uniform vec4 blend;","uniform float intensity;","varying vec2 vUv;","void main() {","vec2 uv;","float angle = atan(vUv.y, vUv.x) / pi2 + 0.5;","if (shape == 0) {","uv = vUv + 0.5;","}","else if (shape == 1) {","uv = vec2(length(vUv) * 2.0, angle);","}","else {","float step = 1.0 / float(shape + 1);","float modAngle = mod(angle, step) - step * 0.5;","uv = vec2(length(vUv) * 2.0 * cos(modAngle * pi2) , angle);","}","vec4 color = texture2D(image, vec2((uvMatrix * vec3(uv, 1.0)).xy)) * blend;","gl_FragColor = color * color.a * intensity;","}"].join("\n")};var co=function(C){this.gv=C,this.onMouseOver=this.onMouseOver.bind(this),this.resetProperties()};co.Mode={Disable:0,Selection:1,MouseOver:2,Style:3},ng.ms_highlight=function(q){q.setHighlightMode=function(b){var a;a="selection"===b||"selected"===b?co.Mode.Selection:"mouseover"===b||"hover"===b?co.Mode.MouseOver:"style"===b?co.Mode.Style:co.Mode.Disable;var A=this.getHighlightMode();this._highlightHelper.mode=a,this.firePropertyChange("highlightMode",A,b)},q.getHighlightMode=function(){var $=this._highlightHelper.mode;return $===co.Mode.Selection?"selected":$===co.Mode.MouseOver?"hover":$===co.Mode.Style?"style":"disabled"},["type","color","width","glow","strength"].forEach(function(s){var b=s.replace(/(^|\.)[a-z]/g,function(B){return B[B.length-1].toUpperCase()});q["getHighlight"+b]=function(){return this._highlightHelper[s]},q["setHighlight"+b]=function(t){var y=this._highlightHelper,c=y[s];t!==c&&(y[s]=t,this.firePropertyChange("highlight"+b,c,t))}})},Lp(co,T,{onMouseOver:function(s){R.preventDefault(s);var u=this.gv;if(!u._48Q){var w=u.getDataAt(s);w!==this.mouseOverData&&(this.mouseOverData=w,u.iv())}},setFetchTargetFunc:function(d){this.fetchTargetFunc=d},_42:function(k,X){var z,r,s=this,g=s._mode,j=s.gv;if(!k._renderInfo.reflectDepth&&g!==co.Mode.Disable){if(g===co.Mode.Selection?z=j.sm().getSelection().toArray(function(V){return V.s("highlight.visible")}):g===co.Mode.MouseOver&&s.mouseOverData&&s.mouseOverData.s("highlight.visible")&&(z=[s.mouseOverData]),s.fetchTargetFunc&&(z=s.fetchTargetFunc(z)),g===co.Mode.Style)z=z||[],r=function(p){if(z.indexOf(p)>=0)return!1;var g=j.getDataHighlightMode(p);return g===!1?!0:g===!0?!1:"selected"===g?j.isSelected(p)?!1:!0:"hover"===g?p===s.mouseOverData?!1:!0:!0};else{if(!z||!z.length)return;r=function(C){return z.indexOf(C)<0?!0:void 0}}var K=j.isVRPresenting(),x=j.getWidth();if(K){var U=j.getWidth;x/=2,j.getWidth=function(){return x};var t=j.getViewport()}var p,A=j.getDevicePixelRatio(),m=Math.floor(x*A),c=Math.floor(j.getHeight()*A);(p=s._renderTarget)?p.setSize(k,m,c):s._renderTarget=p=new lp.RenderTarget(j,k,m,c);var E="soft"===s.type;if(p.bind(k),E){var V=k.getParameter(k.COLOR_CLEAR_VALUE);go(k,[1,1,1,1]),k.clear(k.COLOR_BUFFER_BIT),go(k,V)}else k.clear(k.COLOR_BUFFER_BIT);j.setViewport(k,0,0,m,c),j.drawFilter=function(y){var p=r(y);if(p){var e=j.getData3dUI(y);e&&y.s("batch")&&e._46Q(k,[0,0,0,0])}return p},zg=function(e,g,S,V,H,v){var a;return a=V&&V.data&&r(V.data)?[0,0,0,0]:[S?0:1,1,1,1],v||(Jm.for(e).directUniforms().uFixPickReverseColor=a),a};var v=k._blooming;v&&(k._blooming=!1),j.renderPickScene(),v&&(k._blooming=!0),zg=ss,j.drawFilter=null,p.unbind(k),dq&&vn(k,X.aPosition),vn(k,X.aNormal),K&&(j.getWidth=U,j.setViewport(k,t[0],t[1],t[2],t[3]));var D=j.getHighlightColor();if(s._lastHighlightColor!==D){var $=Qm(s._lastHighlightColor=D);s._highlightColorData=[$[0]/255,$[1]/255,$[2]/255,$[3]/255]}return E?s.renderSoftOutline(k,m,c):s.renderHardOutline(k,m,c),k.useProgram(X=j._prg),dq&&le(k,X.aPosition),!0}},_assureShader:function(S,J){var F=S._compiledShader[J];return F||(F=S._compiledShader[J]=new kk.Shader(S,co.CommonShaderVs,co[J].fs)),F},renderHardOutline:function(Q,D,z){var b=this,i=b.gv,W=i._postProcessing,N=Jm.for(Q),S=N.directState();S.blend.enabled=!0,S.depth.enabled=!1,W.blitScreen(null,b._renderTarget.texture,b._assureShader(Q,"HighlightHard"),{textureSize:[D,z],edgeWidth:i.getHighlightWidth(),edgeColor:b._highlightColorData},{clear:!1}),S.blend.enabled=!1,S.depth.enabled=!0},renderSoftOutline:function(j,k,X){var g,H,h,x,M,K=this,d=K.gv,u=d._postProcessing,w=Math.floor(k/2),f=Math.floor(X/2),Z=Math.floor(k/4),L=Math.floor(X/4),q=K._downSampleRenderTarget;q?(g=K._edgeDetectionRenderTarget,H=K._blurV2,h=K._blurH2,x=K._blurV4,M=K._blurH4,(q.width!==w||q.height!==f)&&(q.setSize(w,f),g.setSize(w,f),H.setSize(w,f),h.setSize(w,f),x.setSize(Z,L),M.setSize(Z,L))):(q=K._downSampleRenderTarget=new lp.RenderTarget(d,j,w,f),g=K._edgeDetectionRenderTarget=new lp.RenderTarget(d,j,w,f),H=K._blurV2=new lp.RenderTarget(d,j,w,f),h=K._blurH2=new lp.RenderTarget(d,j,w,f),x=K._blurV4=new lp.RenderTarget(d,j,Z,L),M=K._blurH4=new lp.RenderTarget(d,j,Z,L));var b=j.getParameter(j.COLOR_CLEAR_VALUE),Q=d.getViewport(),R=K.width,D=K.strength,l=K.glow,e=Jm.for(j).glState,A=e.depth,i=e.blend,Y=A.enabled;go(j,[1,1,1,1]),A.enabled=!1,i.apply({func:[j.SRC_ALPHA,j.ONE]}),u.blitScreen(q,K._renderTarget.texture),u.blitScreen(g,q.texture,K._assureShader(j,"EdgeDetection"),{texSize:[w,f],color:K._highlightColorData}),u.blitScreen(h,g.texture,K._assureShader(j,"Blur"),{direction:[1,0],texSize:[w,f],radius:R}),u.blitScreen(H,h.texture,K._assureShader(j,"Blur"),{direction:[0,1],texSize:[w,f],radius:R}),u.blitScreen(M,H.texture,K._assureShader(j,"Blur"),{direction:[1,0],texSize:[Z,L],radius:R}),u.blitScreen(x,M.texture,K._assureShader(j,"Blur"),{direction:[0,1],texSize:[Z,L],radius:R}),i.apply({enabled:!0}),d.setViewport(j,Q[0],Q[1],Q[2],Q[3]),u.blitScreen(null,K._renderTarget.texture,K._assureShader(j,"BlendTogether"),{edgeTexture1:H.texture,edgeTexture2:x.texture,edgeStrength:D*R,edgeGlow:l},{clear:!1}),i.apply({func:[j.SRC_ALPHA,j.ONE_MINUS_SRC_ALPHA,j.ONE,j.ONE_MINUS_SRC_ALPHA]}),A.enabled=Y,go(j,b)},resetProperties:function(){this.mode=co.Mode.Style,this.type=c["highlight.type"],this.color=c["highlight.color"],this.width=c["highlight.width"],this.glow=c["highlight.glow"],this.strength=c["highlight.strength"]},contextLost:function(){this._renderTarget=null}}),T.defineProperties(co.prototype,{mode:{get:function(){return this._mode},set:function(b){var y=this._mode;if(b!==y){this._mode=b;var G=y===co.Mode.MouseOver||y===co.Mode.Style,U=b===co.Mode.MouseOver||b===co.Mode.Style;U&&G||(G&&W(this.gv.getView(),"mousemove",this.onMouseOver),U&&j(this.gv.getView(),"mousemove",this.onMouseOver))}}}}),co.CommonShaderVs=["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),co.HighlightHard={fs:["precision highp float;","uniform sampler2D image;","uniform vec2 textureSize;","uniform float edgeWidth;","uniform vec4 edgeColor;","varying vec2 vUv;","float getCol(vec2 coord) {","return texture2D(image, coord).a;","}","void main() {","vec2 cc = vUv;","float center = getCol(cc);","float dx = edgeWidth / textureSize.x;","float dy = edgeWidth / textureSize.y;","vec2 coord;","float topLeft = getCol(cc+vec2(-dx, -dy));","float top = getCol(cc+vec2(0.0, -dy));","float topRight = getCol(cc+vec2(dx, -dy));","float left = getCol(cc+vec2(-dx, 0.0));","float right = getCol(cc+vec2(dx, 0.0));","float bottomLeft = getCol(cc+vec2(-dx, dy));","float bottom = getCol(cc+vec2(0.0, dy));","float bottomRight = getCol(cc+vec2(dx, dy));","float v = -topLeft-2.0*top-topRight+bottomLeft+2.0*bottom+bottomRight;","float h = -bottomLeft-2.0*left-topLeft+bottomRight+2.0*right+topRight;","float edge = sqrt(h * h + v * v);","edge = smoothstep(0.9, 1.0, edge);","if (edge < 0.5) {","discard;","}","gl_FragColor = edgeColor;","}"].join("\n")},co.EdgeDetection={fs:["precision highp float;","uniform sampler2D image;","varying vec2 vUv;","uniform vec2 texSize;","uniform vec4 color;","void main() {","vec2 invSize = 1.0 / texSize;","vec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);","vec4 c1 = texture2D( image, vUv + uvOffset.xy);","vec4 c2 = texture2D( image, vUv - uvOffset.xy);","vec4 c3 = texture2D( image, vUv + uvOffset.yw);","vec4 c4 = texture2D( image, vUv - uvOffset.yw);","float diff1 = (c1.r - c2.r)*0.5;","float diff2 = (c3.r - c4.r)*0.5;","float d = length( vec2(diff1, diff2) );","gl_FragColor = color * vec4(d);","}"].join("\n")},co.Blur={fs:["#define MAX_RADIUS 4","precision highp float;","varying vec2 vUv;","uniform sampler2D image;","uniform vec2 texSize;","uniform vec2 direction;","uniform float radius;","float gaussianPdf(in float x, in float sigma) {","return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;","}","void main() {","vec2 invSize = 1.0 / texSize;","float weightSum = gaussianPdf(0.0, radius);","vec4 diffuseSum = texture2D( image, vUv) * weightSum;","vec2 delta = direction * invSize * radius/float(MAX_RADIUS);","vec2 uvOffset = delta;","for( int i = 1; i <= MAX_RADIUS; i ++ ) {","float w = gaussianPdf(uvOffset.x, radius);","vec4 sample1 = texture2D( image, vUv + uvOffset);","vec4 sample2 = texture2D( image, vUv - uvOffset);","diffuseSum += ((sample1 + sample2) * w);","weightSum += (2.0 * w);","uvOffset += delta;","}","gl_FragColor = diffuseSum/weightSum;","}"].join("\n")},co.BlendTogether={fs:["precision highp float;","varying vec2 vUv;","uniform sampler2D image;","uniform sampler2D edgeTexture1;","uniform sampler2D edgeTexture2;","uniform float edgeStrength;","uniform float edgeGlow;","void main() {","vec4 edgeValue1 = texture2D(edgeTexture1, vUv);","vec4 edgeValue2 = texture2D(edgeTexture2, vUv);","vec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;","float vv = texture2D(image, vUv).r;","vec4 finalColor = edgeStrength * vv * edgeValue;","gl_FragColor = finalColor;","}"].join("\n")};
var Ds=B.Light=function(){yd(Ds,this),this.s(tj,c[tj]),this.s(_p,"sphere"),this.s("shape3d.reverse.cull",!0),this.s3(20,20,20)};$e("Light",nl,{_image:"light_icon",_icon:"light_icon",onStyleChanged:function(r,I,K){Ds.superClass.onStyleChanged.apply(this,arguments),r===tj&&this.s("shape3d.color",K)}});var Es=lp.FrameState=function(y,A){this.renderState=Jm.for(A),this.picking=!1,this.envmapReflectivity=.5,this.cameraPosition=z,this.projectMatrix=z,this.viewMatrix=z,this.view=y,this.defaultProgram=z,this.pickColorMap=z,this._pvStack=[],this._renderStateStack=[]};Es.prototype.savePV=function(){var V=this.view;this._pvStack.push([yq(this.projectMatrix),yq(this.viewMatrix),V._18Q,yq(V._7O)])},Es.prototype.restorePV=function(){var T=this._pvStack.pop();if(T){var Y=this.view;this.projectMatrix=Y._projectMatrix=T[0],this.viewMatrix=Y._viewMatrix=T[1],Y._18Q=T[2],Y._7O=T[3]}},Es.prototype.setPV=function(K,W){var z=this.view,q=!1;if(K&&(this.projectMatrix=z._projectMatrix=K,q=!0),W&&(this.viewMatrix=z._viewMatrix=W,z._7O=yq(W),q=!0),q){var r=z.getWidth(),O=z.getHeight(),o=yq(this.projectMatrix);z._18Q=Hh(o,o,W),z._18Q._wh=r/O}},Es.prototype.syncEnv=function(H){var l=this,T=l.view;l.envmapReflectivity=T._envmapReflectivity||.5,l.cameraPosition=T.getEye(),l.projectMatrix=T._projectMatrix,l.viewMatrix=T._viewMatrix,l.pickColorMap=H,l.picking=T.getGL()._picking},Es.prototype.setGLState=function(){var j=[0,0,0,0],K=[!0,!0,!0,!0],J=[-1,1],$=[Te.FUNC_ADD,Te.FUNC_ADD],v=[Te.SRC_ALPHA,Te.ONE_MINUS_SRC_ALPHA,Te.ONE,Te.ONE_MINUS_SRC_ALPHA];return function(y,i){var o=this,b=o.renderState.gl,k=o.renderState.glState;k.dither=!1,i?k.color.mask=K:k.color.reset(),k.pixelStore.reset(),k.blend.color=j,k.blend.equation=$,k.blend.func=v,k.cullFace.enabled=!1,k.scissor.enabled=!1,k.depth.enabled=!0,k.depth.clear=1,k.depth.func=b.LEQUAL,k.depth.range=J,k.stencil.enabled=!1,k.polygonOffset.enabled=!1,y?(k.depth.mask=!1,k.blend.enabled=!0):(k.depth.mask=!0,k.blend.enabled=!1)}}(),Es.prototype.setUniforms=function(T){var d=this,P=d.view,I=d.renderState,M=I.gl,y=I.uniforms;y.uBrightness=1,y.uOpacity=1,y.uPartOpacity=1,y.uPick=d.picking,y.uUseInstance=!1,y.uTexture=!1,y.uBlendTexture=!1,y.uAlphaTest=c.alphaTest,y.uTransparent=!!T,y.uFix=!1,y.uBatchColor=!1,y.uBatchBlend=!1,y.uBatchBrightness=!1,y.uReflectivity=d.envmapReflectivity||.5,y.uCameraPosition=d.cameraPosition,y.uPMatrix=d.projectMatrix,y.uViewMatrix=d.viewMatrix,y.uEnvMap=null,qj(P,y,Wg),y.uClipperMatrix=P._boxClipperMatrixes,y.uClipperClipInner=P._boxClipperClipInner,y.uEnvmapQuat=P._envmapExtraQuaternion,P._envmapRenderer.resetUniformCache(),d.picking||(fp(P,M,z),P._fogDisabled||(y.uFogColor=P._fogColor,y.uFogDensity=P._fogDensity,y.uFogNear=P._fogNear,y.uFogFar=P._fogFar))},Es.prototype.drawLayer=function(y){return this.view.renderLayers(y,!0)},Es.prototype.drawData=function(C,f,o){var X=this.view;if(X.isVisible(C)){var $=this.renderState,L=$.uniforms,l=X.getData3dUI(C);if(l){var z=$.gl,M=z._picking,b=X._picking,A=l._pickId;o&&(l._pickId=o),L.uPick=z._picking=X._picking=!!o,L.uTransparent=!!f,l._42($.gl,$.program,f?d:P),L.uPick=z._picking=M,X._picking=b,l._pickId=A}}};var Fs=lp.Graph3dView=function(u,v){var p=this;p.resetHeadlightProperties(),p.resetFogProperties(),p._webGLVersion=1,p._attributes=v||R.graph3dViewAttributes,p._25I={},p._view=Fd(1,p);var L;p._attributes&&(L=p._attributes.canvas)||(L=On(p._view)),p._canvas=L,j(L,"webglcontextlost",function(f){f.preventDefault(),Bm(p),p._26I&&(p._doBufferGC(p._26I,!0),Jk(p._canvas,0,0),["_highlightHelper","shadowMap","flowMap","_envmapRenderer","_postProcessing"].forEach(function($){p[$].contextLost()}),p.dm().each(function(d){var s=p.getData3dUI(d);s.contextLost()})),p._26I=I,p._1o.onContextLost(),p._35O=!0}),j(L,"webglcontextrestored",function(){p._35O=!1,p.iv()}),p._40Q=new Ms(p),p._43Q={},p._44Q=-1,p._batchIndexMap={},p._batchModelMap={},p._wireframeIndexMap={},p._wireframeModelMap={},p._wireframeIndexMapSwap={},p._wireframeModelMapSwap={},p._polylineIndexMap={},p._polylineIndexMap={},p._polylineIndexMapSwap={},p._polylineIndexMapSwap={},p._8O=[],p._7O=an(),p._6O=an(),p._1o=new Ws(p),p._30O=new Zs(p),p._31O=new Xs(p),p._32O=new Ys(p),p._raycaster=new it(p),p._highlightHelper=new co(p),p._postProcessing=new st(p),p._41Q=[],p._42Q=0,p._frameRenderOptionStack=[],lp.VR?(p.vr=new lp.VR(p),p.isVREnabled=function(){return this.vr.enable},p.isVRPresenting=function(){return this.vr.isPresenting()}):(p.vr={enable:!1,isPresenting:Z},p.isVREnabled=Z,p.isVRPresenting=Z),p.shadowMap=new _o(p),p.flowMap=new dh(p),p._33Q=!0,p._eye=sj(R.graph3dViewEye),p._center=sj(R.graph3dViewCenter),p._up=sj(R.graph3dViewUp),p._lightChanged=!1,p._59O=[],p._spots=[],p._dirs=[],p._boxClippers=[],p._flowObjects=[],p._frameId=0,p._picking=!1,p._batchInfoMap={},p._renderLayerInfoMap={},p._sortedRenderLayers=T.keys(yh),p.overlappingBox=new Dn(p),p.dm(u?u:new Og),p._coreInteractor=new ds(this),p._envmapRenderer=new lp.EnvmapRenderer(this),p.setInteractors([new Ps(p)]),p._initView(),p._genBatchInstancedArrayFunc()},Gs={fogDisabled:1,fogMode:1,dashDisabled:1,batchColorDisabled:1,batchInstancedDisabled:1,batchBlendDisabled:1,batchBrightnessDisabled:1,flowBlendMode:1,uvClipEnabled:1,ortho:1},Hs={box:1,sphere:2},Is={addRGB:"FLOW_BLEND_MODE_ADD_RGB",addRGBA:"FLOW_BLEND_MODE_ADD_RGBA",overrideRGBA:"FLOW_BLEND_MODE_OVERRIDE_RGBA",overrideRGB:"FLOW_BLEND_MODE_OVERRIDE_RGB",overrideA:"FLOW_BLEND_MODE_OVERRIDE_A",multiplyRGB:"FLOW_BLEND_MODE_MULTIPLY_RGB",multiplyRGBA:"FLOW_BLEND_MODE_MULTIPLY_RGBA"},Js=0;Xe("Graph3dView",T,{ms_v:1,ms_tip:1,ms_gv:1,ms_dm:1,ms_lp:1,ms_fire:1,ms_sm:1,_51o:1,ms_shadow:1,ms_highlight:1,ms_quickVisible:1,ms_ac:["devicePixelRatio","boundaries","moveStep","rotateStep","editHelperDisabled","blockSelectable","sizeEditableFunc","rotationEditableFunc","editableFunc","rotatable","zoomable","pannable","walkable","resettable","mouseRoamable","zoomToCenter",Oe,Il,"firstPersonMode",mm,"movableFunc","gridVisible","gridSize","gridGap","gridColor","originAxisVisible","centerAxisVisible","axisXColor","axisYColor","axisZColor","editSizeColor","rectSelectable","rectSelectBackground","headlightRange","headlightDirection","headlightColor","headlightIntensity","headlightAmbientIntensity","headlightDisabled","headlightGroup","ortho","orthoWidth","syncEyeWithOrthoWidth","fovy","near","far",Cc,Nq,"up","aspect","fogDisabled","fogMode","fogDensity","fogColor","fogNear","fogFar","pickerResolution","dashDisabled","uvClipEnabled","batchColorDisabled","batchInstancedDisabled","batchBlendDisabled","batchBrightnessDisabled","flowBlendMode","hoverDelay","batchInfoMap","renderLayerInfoMap","rotateMinPhi","rotateMaxPhi","sortable","sortFunc"],_editable:!1,_sortable:R.graph3dViewSortable,_editHelperDisabled:R.graph3dViewEditHelperDisabled,_blockSelectable:R.graph3dViewBlockSelectable,_devicePixelRatio:z,_boundaries:z,_moveStep:R.graph3dViewMoveStep,_rotateStep:R.graph3dViewRotateStep,_rotateMinPhi:R.graph3dViewMinPhi===z?R.graph3dViewRotateMinPhi:R.graph3dViewMinPhi,_rotateMaxPhi:R.graph3dViewMaxPhi===z?R.graph3dViewRotateMaxPhi:R.graph3dViewMaxPhi,_pannable:R.graph3dViewPannable,_rotatable:R.graph3dViewRotatable,_walkable:R.graph3dViewWalkable,_resettable:R.graph3dViewResettable,_zoomable:R.graph3dViewZoomable,_zoomToCenter:!0,_firstPersonMode:R.graph3dViewFirstPersonMode,_mouseRoamable:R.graph3dViewMouseRoamable,_gridVisible:R.graph3dViewGridVisible,_gridSize:R.graph3dViewGridSize,_gridGap:R.graph3dViewGridGap,_gridColor:R.graph3dViewGridColor,_originAxisVisible:R.graph3dViewOriginAxisVisible,_centerAxisVisible:R.graph3dViewCenterAxisVisible,_axisXColor:R.graph3dViewAxisXColor,_axisYColor:R.graph3dViewAxisYColor,_axisZColor:R.graph3dViewAxisZColor,_ortho:R.graph3dViewOrtho,_orthoWidth:R.graph3dViewOrthoWidth,_syncEyeWithOrthoWidth:R.graph3dViewSyncEyeWithOrthoWidth,_fovy:R.graph3dViewFovy,_near:R.graph3dViewNear,_far:R.graph3dViewFar,_rectSelectable:R.graph3dViewRectSelectable,_rectSelectBackground:R.graph3dViewRectSelectBackground,_editSizeColor:R.graph3dViewEditSizeColor,_autoMakeVisible:Fp,_pickerResolution:R.graph3dViewPickerResolution,_dashDisabled:R.graph3dViewDashDisabled,_uvClipEnabled:R.graph3dViewUvClipEnabled,_batchColorDisabled:R.graph3dViewBatchColorDisabled,_batchInstancedDisabled:R.graph3dViewBatchInstancedDisabled,_batchBlendDisabled:R.graph3dViewBatchBlendDisabled,_batchBrightnessDisabled:R.graph3dViewBatchBrightnessDisabled,_flowBlendMode:R.graph3dViewFlowBlendMode,addCamera:function(q){var N=this,A=T.freeze({id:N._42Q++,priority:q.priority||0,ignoreInPick:!!q.ignoreInPick,render:q.render});q.switch3DStatus&&(N._43Q[A.id]=!0),N._41Q.push(A),N._41Q.sort(function(K,h){return K.priority!==h.priority?K.priority-h.priority:K.id-h.id})},setEye:function(P,Y,B){1===arguments.length&&(Y=P[1],B=P[2],P=P[0]);var H=this._eye;H[0]=P,H[1]=Y,H[2]=B,this.fp(Cc,I,H)},setCenter:function(B,R,E){1===arguments.length&&(R=B[1],E=B[2],B=B[0]);var F=this._center;F[0]=B,F[1]=R,F[2]=E,this.fp(Nq,I,F)},setUp:function(R,a,X){1===arguments.length&&(a=R[1],X=R[2],R=R[0]);var c=this._up;c[0]=R,c[1]=a,c[2]=X,this.fp("up",I,c)},getDevicePixelRatio:function(){return this._picking?this._1o._resolution:this._devicePixelRatio||Gn},isTransparentMask:function(z){return z.s("transparent.mask")},getCoreInteractor:function(){return this._coreInteractor},getHighlightHelper:function(){return this._highlightHelper},getRaycaster:function(){return this._raycaster},getAspect:function(){var I=this,m=I._aspect;return m?m:(m=I.getWidth()/I.getHeight(),m||1.2)},getCanvas:function(){return this._canvas},setDataModel:function(S){var h=this,q=h._dataModel,E=h._selectionModel;q!==S&&(q&&(q.ump(h.handleDataModelPropertyChange,h),q.umm(h.handleDataModelChange,h),q.umd(h.handleDataPropertyChange,h),E||q.sm().ums(h.handleSelectionChange,h)),h._dataModel=S,S.mp(h.handleDataModelPropertyChange,h),S.mm(h.handleDataModelChange,h),S.md(h.handleDataPropertyChange,h),E?E._21I(S):S.sm().ms(h.handleSelectionChange,h),h._postProcessing.handleDataModleChange(q,S),h._tryInvalidateEnvmap(),h.invalidateAll(!0),h.invalidateLight(),h.invalidateboxClipper(),h.invalidateFlowObjects(),h._49Q(),h.fp(Bb,q,S),h._canvas.style.background=S.getBackground()||"")},handleDataModelPropertyChange:function(d){var x=d.property;if("background"===x){var X=this._canvas.style.background,l=d.newValue||"";this._canvas.style.background=l,this.fp("canvasBackground",X,l)}else if("envmapType"===x)this._tryInvalidateEnvmap();else if("envmap"===x){var X=this._shaderUseEnvmapFlag,l=!(!d.newValue||!d.newValue.length);X!==l&&Bm(this),this.iv()}},handleDataPropertyChange:function(k){var C=k.data;this.invalidateData(C);var e=k.property;ze(C)&&"s:light.type"===e?this.invalidateLight():"s:3d.clipbox"===e?this.invalidateboxClipper(C,!0):"s:effect.flow"===e?this.invalidateFlowObjects(C,!0):"s:shadow.cast"===e?this.shadowMap.tryUpdateBounding(C):"s:3d.visible"===e&&this.invalidateQuickVisible(C)},invalidateboxClipper:function(a,o){var u=this._boxClippers,k=u.length;if(a){var d=!!a.s("3d.clipbox");if(o=!!o,d===o)u.indexOf(a)<0&&u.push(a);else{var h=u.indexOf(a);h>=0&&u.splice(h,1)}}else u=this._boxClippers=[],this.dm().each(function(U){U.s("3d.clipbox")&&u.push(U)});var P=u.length;k!==P&&(Bm(this),this.shadowMap.deleteShadowProgram(),this._updateBoxClipperMatrix(),qj=P?id:No),this.iv()},_updateBoxClipperMatrix:function(){for(var A,k,C=this._boxClippers,V=this._boxClipperMatrixes=[],L=this._boxClipperClipInner=[],P=this._boxClipperGroups=[],p=this._boxClipperShape=[],D=new qc,I=0,E=C.length;E>I;I++)A=C[I],A.appendAnchorMatrix3d(k=Zi(A,this.getMat(A))),V.push(D.getInverse(D.fromArray(k)).toArray()),L.push("inner"===A.s("3d.clipbox")),P.push(A.s("3d.clipbox.group")),p.push(Hs[A.s("3d.clipbox.shape")]||1)},_49Q:function(){this._4AQ||this._48Q||this.dm().size()<R.graph3dViewDataNumWarningLine||(this._48Q=!0,console.log("Too many datas so than disable some feature to speed up.\nYou can set global Default.graph3dViewDataNumWarningLine to largeEnoughNum to avoid this, or call graph3dView.quitDataNumWarning() to quit.\n"),this.enableQuickVisibleMode(),this.getHighlightHelper().mouseOverData=null)},quitDataNumWarning:function(){this.disableQuickVisibleMode(),this._48Q=!1,this._4AQ=!0},invalidateFlowObjects:function(w,O){var q=this._flowObjects,$=q.length;if(w){var h=!!w.s("effect.flow");if(O=!!O,h===O)q.indexOf(w)<0&&q.push(w);else{var R=q.indexOf(w);R>=0&&q.splice(R,1)}}else q=this._flowObjects=[],this.dm().each(function(d){d.s("effect.flow")&&q.push(d)});$!==q.length&&Bm(this),this.iv()},invalidateLight:function(){this._lightChanged||(this._lightChanged=!0,this.iv())},onPropertyChanged:function(f){var c=this,b=f.property;if(c.iv(),c._18Q=I,"eye"===b)c._33Q=!0;else if("devicePixelRatio"===b)c._42(c.getDevicePixelRatio());else if(Gs[b]&&(Bm(c),"batchInstancedDisabled"===b)){c._genBatchInstancedArrayFunc(),this.shadowMap.deleteShadowProgram();var O,G=R.getBatchInfoMap();for(O in G)G[O]&&G[O].instanced&&c.invalidateBatch(O);G=c._batchInfoMap;for(O in G)G[O]&&G[O].instanced&&c.invalidateBatch(O)}},_5O:function(M){var P=M._22Q();return P?new P(this,M):I},getData3dUI:function(W){var s=this._25I[W._id];return s===z&&(s=this._5O(W),this._25I[W._id]=s),s},invalidateAll:function(p,s){var X=this;if(p){for(var W in X._25I){var V=X._25I[W];V&&V.dispose()}X._25I={},X.iv(),zb(X)}else zb(X),X.dm().each(function(U){X.invalidateData(U)});X.shadowMap.tryInvalidateLater(p,s)},invalidateSelection:function(){var H=this;H.sm().each(function(n){H.invalidateData(n)})},invalidateData:function(a){var v=this,_=v.getData3dUI(a);_&&(_.iv(),v.iv()),zb(v,a)},getShape3dText:function(y){return y.getStyle("shape3d.text")||this.getLabel(y)},invalidateBatch:function($){var P=this,L=P._40Q;L.each(function(k){P._invalidateBatch($,k.batchModelMap,k.batchIndexMap),P._invalidateBatch("T"+$,k.wireframeModelMap,k.wireframeIndexMap),P._invalidateBatch("O"+$,k.wireframeModelMap,k.wireframeIndexMap),k.markBatchInvalid()}),P.iv()},_invalidateBatch:function(A,O,g){var h=this,o=O[A];o&&(o.ds.forEach(function(F){var u=h.getData3dUI(F);u&&u.iv(),delete g[F._id]}),delete O[A])},handleDataModelChange:function(p){var a=this,z=p.kind,T=p.data;if("add"===z)a.invalidateData(T),kh(T)&&T.getEdgeGroup()&&T.getEdgeGroup().eachSiblingEdge(a.invalidateData,a),ze(T)&&a.invalidateLight(),T.s("3d.clipbox")&&a.invalidateboxClipper(T,!0),T.s("effect.flow")&&a.invalidateFlowObjects(T,!0),a._49Q();else if(z===Ib){var C=T._id,R=a._25I[C];R&&(R.dispose(),delete a._25I[C],a.iv()),T===a._currentSubGraph&&a.setCurrentSubGraph(I),zb(a,T),ze(T)&&a.invalidateLight(),T.s("3d.clipbox")&&a.invalidateboxClipper(T,!1),T.s("effect.flow")&&a.invalidateFlowObjects(T,!1)}else z===jr&&(a.invalidateAll(!0),a.setCurrentSubGraph(I),zb(a),a.invalidateLight(),a.invalidateboxClipper(),a.invalidateFlowObjects())},toCanvas:function(H,F,U){var Q=this,u=Q.getGL();if(Q.validate(),H){var $=u.getParameter(u.COLOR_CLEAR_VALUE);go(u,H)}Q._42(1,{renderAxis:!1,renderEdit:!1,renderGrid:!1});var i=Q.getWidth()||1,n=Q.getHeight()||1,Z=new Uint8Array(4*i*n),N=On(),w=N.getContext("2d");u.readPixels(0,0,i,n,u.RGBA,u.UNSIGNED_BYTE,Z),Jk(N,i,n,1);for(var p=w.getImageData(0,0,i,n),D=p.data,B=0;B<D.length;B+=4){var d=B/4,V=C(d/i),t=d-V*i;d=4*((n-1-V)*i+t),D[d]=Z[B],D[d+1]=Z[B+1],D[d+2]=Z[B+2],D[d+3]=Z[B+3]}if(w.putImageData(p,0,0),H&&go(u,$),Q._42(Q.getDevicePixelRatio()),F&&U){var a=On(),S=a.getContext("2d");return Jk(a,F,U,1),R.drawImage(S,N,0,0,F,U),a}return N},toDataURL:function(L,T){var I=this,Q=I.getGL();if(I.validate(),L){var g=Q.getParameter(Q.COLOR_CLEAR_VALUE);go(Q,L)}I._42(1,{renderAxis:!1,renderEdit:!1,renderGrid:!1});var c=I._canvas.toDataURL(T||"image/png",1);return L&&go(Q,g),I._42(I.getDevicePixelRatio()),c},isWebGL2:function(){return 2===this._webGLVersion},getGL:function(){var m=this._26I;if(m)return this.acquireProgram(),m;if(!this._35O){var R=this,Y=R._canvas,H=R._attributes;if(!H||H.requestWebGL2!==!1)try{m=Y.getContext("webgl2",H)||Y.getContext("experimental-webgl2",H),m&&(R._webGLVersion=2,R._26I=m)}catch(o){}if(!m)try{m=Y.getContext("webgl",H)||Y.getContext("experimental-webgl",H)}catch(o){throw new Error("WebGL not supported")}if(!m)throw new Error("WebGL not supported");R._26I=m;var U=R._frameState=new Es(this,m);R._glExtensions=new x(m),R._glCapabilities=new s(m,R._glExtensions),R._2O={},m._emptyCubeTexture=$g(m),m._compiledShader={},m._emptyTexture=pn(m),m._emptyBlendTexture=pn(m),m._bufPool={},m._id=++Js,m._divisorState=[],U.setGLState(),R._buffer={vs:Ik(m),ns:Ik(m),is:Ik(m),uv:Ik(m),batchColor:Ik(m),batchBlend:Ik(m),batchBrightness:Ik(m),lineDistance:Ik(m)},R._1O=Qc(m);var G=R._cube={vs:Ik(m),ns:Ik(m),is:Ik(m),uv:Ik(m)};return db(m,G.vs,Tm),db(m,G.ns,cc),db(m,G.uv,Zp),Nd(m,G.is,Mb),R.acquireProgram(),R._genBatchInstancedArrayFunc(),m._renderInfo={calls:0,vertices:0,faces:0,lines:0,points:0,textureCache:{time:0,count:0,pixels:0},frame:0,cacheTimeCost:0,reflectDepth:0},m}},getGLCapabilities:function(){var y=this.getGL();return y?this._glCapabilities:void 0},getGLExtensions:function(){var X=this.getGL();return X?this._glExtensions:void 0},getEnvmap:function(){return this._glCapabilities&&this._glCapabilities.maxVertexTextures<R.graph3dEnvmapCapabilityRequire?null:this.dm().getEnvmap()},getEnvmapType:function(){var Q,K=this.dm();return K&&(Q=K.getEnvmapType()),Q||"legacy"},setEnvmapExtraQuaternion:function(M){var e=this._envmapExtraQuaternion;this._envmapExtraQuaternion=M instanceof jl.Quaternion?M.clone().inverse().toArray():null,null==e!=(null==M)&&Bm(this)},invalidateEnvmap:function(V){return this._envmapRenderer.invalidateEnvmap(V)},_setEnvmapByProbeId:function(Q,k){return this._envmapRenderer.setEnvmapByProbeId(Q,k)},_tryInvalidateEnvmap:function(){var n=this.getEnvmapType();n!==this._lastProgramEnvmapType&&(Bm(this),this.iv())},acquireProgram:function(){var p=this,Z=p._26I;if(Z&&!p._prg){var D=p._prg=Z.createProgram();if(!D)return I;var m=p._dirs.length,i=p._spots.length,C=p._59O.length,A=p._boxClippers.length,N=p._flowObjects.length,G=["uPMatrix","uMVMatrix","uMMatrix","uReflectivity","uViewMatrix","uUseEnvMap","uEnvMap","uCameraPosition","uNMatrix","uViewMatrix","aNormal","aUv","uUvMatrix","uDiffuse","uBlend","uBlendColor","uBrightness","uPartOpacity","uAlphaTest","uTransparent","uClipDirection","uClipPercent","uTexture","uBlendTexture","uSampler","uBlendSampler","uDiscardSelectable","uFix","uPick","uReverseFlip","uFixPickReverseColor","uBatchBrightness","aBatchBrightness","uBatchColor","aBatchColor","uBatchBlend","aBatchBlend","uDash","aLineDistance","uDashDistance","uDashGapDistance","uLight","uHeadlightRange","uHeadlightAmbientIntensity","uHeadlightColor","uFogColor","uFogDensity","uFogNear","uFogFar"];m&&G.push("uDirColor","uDirDirection"),i&&G.push("uSpotColor","uSpotRange","uSpotAngle","uSpotExponent","uSpotPosition","uSpotDirection"),C&&G.push("uPointColor","uPointRange","uPointPosition"),gr||(Xj=Id(Xj.substring(0,Xj.indexOf("^#"))),Rb=Id(Rb),gr=!0);var c=p.getEnvmap(),V=c&&c.length,y=p.getEnvmapType(),a=["#define MAX_DIR "+m,"#define MAX_SPOT "+i,"#define MAX_POINT "+C,"#define MAX_BOX_CLIPPER "+A,"#define MAX_FLOW_OBJECT "+N,p._fogDisabled?"":"#define FOG","exp2"===p.getFogMode()?"#define FOG_EXP2":"",p._dashDisabled?"":"#define DASH",p._uvClipEnabled?"#define UV_CLIP":"",null==p._envmapExtraQuaternion?"":"#define ENVMAP_ROTATE",V?"#define USE_ENVMAP":"","legacy"!==y?"#define ENVMAP_TYPE_CUBE_UV":"",p.isOrtho()?"#define ORTHOGRAPHIC":"",p._batchColorDisabled?"":"#define BATCHCOLOR",p._batchInstancedDisabled?"":"#define BATCHINSTANCE",p._batchBlendDisabled?"":"#define BATCHBLEND",p._batchBrightnessDisabled?"":"#define BATCHBRIGHTNESS","#define "+(Is[p.getFlowBlendMode()]||Is[R.graph3dViewFlowBlendMode]),p.shadowMap.enable?p.shadowMap.genShaderDefine():"",""].join("\n"),k=Kl(Z,D,Z.VERTEX_SHADER,Xj.replace("#PREFIX",a));Z.getShaderParameter(k,Z.COMPILE_STATUS)||fe("COMPILE",Z.VERTEX_SHADER,Z.getError(),Z.getShaderInfoLog(k));var d=Kl(Z,D,Z.FRAGMENT_SHADER,Rb.replace("#PREFIX",a));if(Z.getShaderParameter(d,Z.COMPILE_STATUS)||fe("COMPILE",Z.FRAGMENT_SHADER,Z.getError(),Z.getShaderInfoLog(d)),dq?G.push("aPosition"):(D.aPosition=0,Z.bindAttribLocation(D,0,"aPosition")),Z.linkProgram(D),!Z.getProgramParameter(D,Z.LINK_STATUS)){var S=Z.getProgramInfoLog(D);return p._prg=I,S.indexOf("maximum temp register")>=0&&!p._glTempRegisterLimited?(p._glTempRegisterLimited=!0,Z.deleteProgram(D),p.acquireProgram()):(fe("LINK",Z.getProgramParameter(D,Z.VALIDATE_STATUS),Z.getError(),S),Z.deleteProgram(D),I)}G.forEach(function(S){D[S]=/^u/.test(S)?Z.getUniformLocation(D,S):Z.getAttribLocation(D,S)});var F=p._frameState;F.renderState.program=F.defaultProgram=D,p._envmapRenderer.changeEnvmapType(p._lastProgramEnvmapType=y),p._shaderUseEnvmapFlag=V,Z.deleteShader(k),Z.deleteShader(d)}},isGLTempRegisterLimited:function(){return this._glTempRegisterLimited},getBrightness:function(i){var b=i.s("brightness"),O=this.isSelected(i)?i.s("select.brightness"):I;return b==I?O:O==I?b:b*O},getDataHighlightMode:function(z){return z.s("highlight.mode")},getWireframe:function(b){var u=b.s("wf.visible"),c=b.s("wf.width");return u===!0||c>0&&"selected"===u&&this.isSelected(b)?{color:b.s("wf.color"),width:c,"short":b.s("wf.short"),mat:b.s("wf.mat")}:void 0},getPartPosition:function(w,j,F,J){J=J||El;var v=this.getData3dUI(w),p=v._16O(J.autoRotate,j,I,F||Uj,J.t3,J.r3,J.rotationMode);return[p[12],p[13],p[14]]},_transformPointToViewSpace:function(f){var I=[f[0],f[1],f[2]];return Ee(I,this._viewMatrix),I},_transformDirectionToViewSpace:function(J,q){var Z=J?[J[0],J[1],J[2]]:[0,0,0];Ee(Z,this._viewMatrix);var n=q?[q[0],q[1],q[2]]:[0,0,0];Ee(n,this._viewMatrix);var p=n[0]-Z[0],u=n[1]-Z[1],H=n[2]-Z[2],B=Math.sqrt(p*p+u*u+H*H);return B?[p/B,u/B,H/B]:[p,u,H]},getWireframeGeometry:function(p){return p.s("wf.geometry")?{color:p.s("wf.color"),width:p.s("wf.width"),mat:p.s("wf.mat"),geometry:!0}:void 0},getBodyColor:function(k){return k.s("body.color")},getMat:function(V){return V.getMat?V.getMat():V.s("mat")},getFaceMat:function(N,K){return N.getFaceMat?N.getFaceMat(K):N.s(K+".mat")},getFaceBlend:function(G,q){return G.s(q+".blend")||G.s("all.blend")},getFaceColor:function(v,f){return v.s(f+".color")||v.s("all.color")},getFaceImage:function(r,U){return r.s(U+".image")||r.s("all.image")},getFaceBlendImage:function(j,B){return j.s(B+".blend.image")||j.s("all.blend.image")},getFaceDiscardSelectable:function(V,N){var e=V.s(N+".discard.selectable");return e==I?V.s("all.discard.selectable"):e},getFaceUv:function(U,l){return U.s(l+".uv")||U.s("all.uv")},getFaceUvOffset:function(Y,u){return Y.s(u+".uv.offset")||Y.s("all.uv.offset")},getFaceUvScale:function(A,Q){return A.s(Q+".uv.scale")||A.s("all.uv.scale")},getFaceUvRotation:function(a,Z){return a.s(Z+".uv.rotation")||a.s("all.uv.rotation")},getFaceUvAnchor:function(H,J){return H.s(J+".uv.anchor")||H.s("all.uv.anchor")},getFaceLight:function(o,T){var Z=o.s(T+".light");return Z==I?o.s("all.light"):Z},getFaceVisible:function(J,j){var W=J.s(j+".visible");return W==I?J.s("all.visible"):W},getFaceOpacity:function(i,e){var h=i.s(e+".opacity");return h==I?i.s("all.opacity"):h},getFaceTransparent:function(m,i){var O=m.s(i+".transparent");return O==I?m.s("all.transparent"):O},getFaceReverseColor:function(x,f){return x.s(f+".reverse.color")||x.s("all.reverse.color")},getFaceReverseFlip:function(v,C){var s=v.s(C+".reverse.flip");return s==I?v.s("all.reverse.flip"):s},getFaceReverseCull:function(k,o){var V=k.s(o+".reverse.cull");return V==I?k.s("all.reverse.cull"):V},getTextureMap:function(){return this._2O},_2Oi:function(A,S,C){C=C||"";var X;(X=this._2O[A])||(X=this._2O[A]={}),X[C]=S},deleteTexture:function(y){var V=this;if(V._2O){var q=V._2O[y];if(q){delete V._2O[y];var i=V.getGL();for(var K in q)i.deleteTexture(q[K])}}},renderPickScene:function(){var N=this.getGL();this.syncRenderState(),this._picking=N._picking=!0,this.renderScene(),this._picking=N._picking=!1},invalidateCachedTexture:function(r){var V=this.getData3dUI(r);V.invalidateCachedTexture(this.getGL()),this.invalidateData(r)},invalidateShape3dCachedImage:function(N){this.invalidateCachedTexture(N)},invalidateCachedGeometry:function($){var J=this.getData3dUI($);J.invalidateCachedGeometry(),this.invalidateData($)},isInteractive:function(C){return C.s("interactive")},getTexture:function(y,d,b,i){if(!y)return I;var $,w,W=this,Y=W.getGL(),L=W._2O[y];if(L&&(d&&(w=d.s("texture.mipmap.max")),$=L[w||""]||L.default),!$){var s=Td(y);if(i||(i={}),!s)return Y._emptyTexture;if(d){i.mipmapMaxLevel=w=d.s("texture.mipmap.max");var e=d.s("texture.wrap");i.clampToEdge="clampToEdge"===e?!0:"repeat"===e?!1:z}if(s.uuid||(s.uuid=B.Math.generateUUID()),s.tagName){if(s.dynamic)return Qc(Y,s,W._1O,i);$=Qc(Y,s,z,i),W._2Oi(y,$,w)}else{var T,u=d&&(d.s("texture.cache")||d.s("shape3d.image.cache")||s.textureCache),M=W.isVRPresenting();if(M&&(d._textureUpdateFrame===Y._renderInfo.frame?u=!0:d._textureUpdateFrame=Y._renderInfo.frame),u&&(T=W.getData3dUI(d),$=T.getCachedTexture(b),$&&T.interactiveInfo&&$.interactiveInfo&&(T.interactiveInfo[$.interactiveInfo.key]=$.interactiveInfo.info)),!$){var l=Y._renderInfo.textureCache;if(u){if(l.time>R.graph3dMaxVectorCacheTime)return W.redraw(),Y._emptyTexture;if(!sg(s,d))return Y._emptyTexture}var U;d&&(1!==d.s("texture.scale")?U=d.s("texture.scale"):1!==d.s("shape3d.texture.scale")&&(U=d.s("shape3d.texture.scale"))),U||(U=1);var K=d&&(d.s("fixSizeOnScreen")||d.s("shape3d.fixSizeOnScreen")),p=K?Y.NEAREST:Y.LINEAR;K?"number"==typeof K&&(U*=0>K?1:K):d&&(d.s("vector.dynamic")||d.s("shape3d.vector.dynamic"))&&(T||(T=W.getData3dUI(d)),K=T.getVectorDynamicSize());var Q,S,k,n=d&&d.s("shape3d");"billboard"===n?k=d.getTall()/d.getWidth():"plane"===n&&(k=d.getHeight()/d.getWidth());var v=nr(s,d);if(K){var E;E=u?W._devicePixelRatio||Gn:W.getDevicePixelRatio(),Q=K[0]>0?K[0]*E:U*v*E,S=K[1]>0?K[1]*E:U*(k?kd(s,d,W,Math.min(4096,v*k)):kd(s,d))*E}else Q=U*v,S=U*(k?kd(s,d,W,Math.min(4096,v*k)):kd(s,d));if(Q>=1&&S>=1){var Z=0;(u||M)&&(Z=Date.now());var F=W._glCapabilities.maxTextureSize;Q=Math.min(Q,F),S=Math.min(S,F);var D=sb(Q,S);if(!T&&d&&(T=W.getData3dUI(d)),T&&T.interactiveInfo){var C=y;"object"==typeof C&&(C=C.uuid||(C.uuid=B.Math.generateUUID()));var o=T.interactiveInfo[C]={};D.interactiveInfo=o.bodyInfo={compInfos:[],matrix:new sn,rect:{x:0,y:0,width:Q,height:S}}}cq(D,s,0,0,Q,S,d,W),D.interactiveInfo&&(D.interactiveInfo=null),D.restore(),l.count++,l.pixels+=Q*S,d?(i.minFilter=Tc(d.s("texture.filter.min")||d.s("texture.filter"))||p,i.magFilter=Tc(d.s("texture.filter.mag")||d.s("texture.filter"))||p):i.minFilter=i.magFilter=p,u||M?($=Qc(Y,bp,null,i),T.setCachedTexture($,b),l.time+=Date.now()-Z,o&&($.interactiveInfo={key:C,info:o}),bp=null):$=Qc(Y,bp,W._1O,i)}}}}return $},redraw:function(){this.iv()},validateImpl:function(){var n=this;if(n._lightChanged){n._lightChanged=!1;var O=[],e=[],D=[];n.dm().each(function(t){if(ze(t)){var U=t.s("light.type");U===Ag?O.push(t):U===Wh?e.push(t):U===Ur&&D.push(t)}}),(O.length!==n._59O.length||e.length!==n._spots.length||D.length!==n._dirs.length)&&Bm(n),n._59O=O,n._spots=e,n._dirs=D}var X=n.getAspect();X!==n.__cachedAspect__&&(n._updateSkybox({property:"asceptChanged"}),n.__cachedAspect__=X),n._42(),n._1o.iv()},getRenderInfo:function(){var R=this.getGL();return R?R._renderInfo:void 0},getDebugTip:function(){var v=this,u=v.getRenderInfo();if(u){var B=v.getGL()._validBufCount||0,_="Draw Calls: "+u.calls+"<br/>"+"Vertices: "+u.vertices+"<br/>"+"Faces: "+u.faces+"<br/>"+"Lines: "+u.lines+"<br/>"+(u.points?"Points: "+u.points+"<br/>":"")+"Buffers: "+B+"<br/>"+"Cache Models: "+T.keys(of).length+"<br/>"+"Shape3d Models: "+T.keys(rp).length;if(v.isVRPresenting()&&(_+="<br/>VR fps: "+v.vr.getFps()),u.textureCache){var y=u.textureCache.count;if(_+="<br/>2D Dynamic Textures: "+u.textureCache.count,y>0){var n,S=u.textureCache.pixels;n=S>1e6?Math.round(S/1e6)+"M":S>1e3?Math.round(S/1e3)+"K":Math.round(S),_+="<br/>2D Dynamic pixels: "+n}}return _}},getFrameState:function(){return this._frameState},isBoundingBoxInView:function(){var Z=new B.Math.Box3,v=new B.Math.Matrix4;return function(H){var U=H;if(U instanceof B.Data&&(U=this.getData3dUI(U)),!U.mat)return!0;var x=U.getBoundingBox(!0);Z.copy(x).applyMatrix4(v.fromArray(U.mat));var E=this.getFrustum();return E.intersectsBox(Z)}}(),updateScene:function(){var x=this;x._81O=I,x.overlappingBox.clear();var C=x._40Q;C.init();var r=x.getGL(),w=x.dm();if(w.isHierarchicalRendering())w.eachByHierarchical(function(M){var J=x.getData3dUI(M);J&&J.update(x,r,C)});else{var j,l,z,g=w.getDatas().getArray(),i=g.length;for(j=0;i>j;j++)l=g[j],z=x.getData3dUI(l),z&&z.update(x,r,C)}this._updateBoxClipperMatrix(),C.onUpdated()},_pushFrameRenderOptions:function(D){this._frameRenderOptionStack.push(this._currentFrameRenderOptions),this._currentFrameRenderOptions=D},_popFrameRenderOptions:function(){this._currentFrameRenderOptions=this._frameRenderOptionStack.pop()},_getFrameRenderOptions:function(q){var p=this._currentFrameRenderOptions;return p&&p[q]},getRenderLists:function(){return this._40Q},renderScene:function(n){function e(n,p){m.setGLState(n,p),m.setUniforms(n),m.renderState.attribs.disable(),o=g.directUniforms(),T=g.directAttribs(),T.disable()}function N(t){for(var C=!1;q>F;F++){var W=u[F];if(!l||!W.ignoreInPick){if(W.priority>=t)break;(!K._43Q[K._44Q=W.id]||rd[Vp.length])&&(W.render(Y,K,m),e(),C=!0)}}return C}var K=this;K._pushFrameRenderOptions(n),K._getFrameRenderOptions("createShadowMap")!==!1&&K.shadowMap.render(),K.flowMap.render();var Y=K.getGL();K._envmapRenderer.onBeforeRender(Y),K._44Q=-1;var o,T,m=K._frameState,g=m.renderState,p=g.glState,v=K._prg;K._projectMatrix=Xf(K),yk(K,K._7O),K._viewMatrix=yq(K._7O),K.isReflecting(Y)||Hh(K._projScreenMatrix=an(),K._projectMatrix,K._viewMatrix),m.syncEnv(this._picking?this.pickColorMap:z),g.useProgram(v),e(!1,!0),Y.clear(Y.DEPTH_BUFFER_BIT);var l=K._picking,u=this._41Q,F=0,q=u.length;if(N(R.cameraPriority.skybox),l){var O=p.color.clear.slice(0);go(Y,[0,0,0,0])}else go(Y,[0,0,0,0]),p.blend.enabled=!1,p.depth.enabled=!1,p.depth.mask=!1,K._camera&&K._camera.s("camera.renderSky")===!1||K.drawSky(Y,v),K._getFrameRenderOptions("renderReflector")!==!1&&K.drawReflectors(Y)&&(K._projectMatrix=Xf(K),yk(K,K._7O),K._viewMatrix=yq(K._7O),m.syncEnv(),e()),p.blend.enabled=!1,p.depth.enabled=!0,p.depth.mask=!0,o.uTransparent=!1,K._getFrameRenderOptions("renderGrid")!==!1&&K._31O._42(Y,v);if(!Y.textureBatch||rd[(ONE_FRAME_TIME-6)/2]){l||(K.shadowMap.enable&&K.shadowMap.createShadow(o),K.flowMap.createFlow(o));for(var C=K._sortedRenderLayers,d=0,V=C.length;V>d;d++){var x=C[d],E=K.getRenderLayerInfo(x);if(!(!K._camera&&E.ignore||K._camera&&!K._camera.isLayerVisible(E.mask))){var U=E.priority;N(U)&&(l||(K.shadowMap.enable&&K.shadowMap.createShadow(o),K.flowMap.createFlow(o))),this.renderLayer(x)}}N(R.cameraPriority.infinity),l||K.flowMap.disableFlow(o),od(K,o,0,R.graph3dViewHeadlightAmbientIntensity),o.uHeadlightColor=[1,1,1,0],o.uUseEnvMap=!1,o.uHeadlightDirection=[0,0,0],o.uHeadlightRange=0,p.depth.enabled=!1,o.uTransparent=!1,o.shadowReceive=!1,qj(K,o,Wg),l?K.drawFilter||K._30O._42(Y,v):(K._highlightHelper._42(Y,v),this._renderAxisAndEditHelper(K._getFrameRenderOptions("renderAxis")!==!1,K._getFrameRenderOptions("renderEdit")!==!1),p.blend.enabled=!1,p.depth.mask=!0),p.depth.enabled=!0,l&&go(Y,O),db(Y,I),Nd(Y,I),K._44Q=-1,K._popFrameRenderOptions(null)}},_renderAxisAndEditHelper:function(U,C){if(U||C){var b=this,u=b.getGL(),w=b._prg,d=b._frameState,Z=d.renderState,x=Z.glState,E=Z.directUniforms();d.renderState.attribs.disable(),x.depth.enabled=!1,E.uTransparent=!1,E.shadowReceive=!1,x.blend.enabled=!1,x.depth.mask=!0,E.uPick=b._picking;var S=!b._fogDisabled;S&&(E.uFog=!1),U&&b._32O._42(u,w),C&&b._30O._42(u,w),S&&(E.uFog=!0),db(u,I),Nd(u,I)}},renderLayers:function(H,Q){Q&&(H=ir(H));for(var T=0,K=H.length;K>T;T++)this.renderLayer(H[T])},renderSky:function(){var $=this,h=$._frameState,T=h.renderState,g=T.glState,o=$.getGL(),M=$._prg;
$._projectMatrix=Xf($),yk($,$._7O),$._viewMatrix=yq($._7O),Hh($._projScreenMatrix=an(),$._projectMatrix,$._viewMatrix),h.syncEnv(),T.useProgram(M),h.setGLState(!1,!0),h.setUniforms(!1),h.renderState.attribs.disable(),o.clear(o.DEPTH_BUFFER_BIT),go(o,[0,0,0,0]),g.blend.enabled=!1,g.depth.enabled=!1,g.depth.mask=!1,$.drawSky(o,M),g.depth.mask=!0,g.depth.enabled=!0,db(o,I),Nd(o,I)},addRenderLayerListener:function(r,Z,y){var D=this;D._renderLayerNotifier||(D._renderLayerNotifier=new Tn),D._renderLayerNotifier.add(r,Z,y)},removeRenderLayerListener:function(l,e){this._renderLayerNotifier&&this._renderLayerNotifier.remove(l,e)},fireRenderLayerEvent:function(q,B){var k=this._renderLayerNotifier;k&&k.fire({layer:q,phase:B})},renderLayer:function($){var q=this,K=q._picking,j=q._40Q.get($);if(j){q.fireRenderLayerEvent($,"prepare");var X=q.getGL(),o=q.getRenderLayerInfo($),t=q._frameState,Y=t.renderState,E=Y.glState,z=Y.directUniforms();!K&&q.isSortable()&&j.sort(q._sortFunc,q._projScreenMatrix);var y,p,w,v=j.opaque,h=j.transparent,x=j.batchModelMap,C=j.polylineModelMap,M=j.wireframeModelMap,X=q.getGL(),V=q._prg;K||(E.blend.enabled=!1,E.depth.enabled=!0,E.depth.mask=!0),z.uTransparent=!1,o.clearDepth!==!1&&X.clear(X.DEPTH_BUFFER_BIT);var O=this.drawFilter;if(O){for(w=v,y=0,p=w.length;p>y;y++)O(w[y].data)!==!0&&w[y].ui._42(X,V,P);if(K)for(w=h,y=0,p=w.length;p>y;y++)w[y].ui._46Q(X);In(q,x)}else{for(w=v,y=0,p=w.length;p>y;y++)w[y].ui._42(X,V,P);if(K)for(w=h,y=0,p=w.length;p>y;y++)w[y].ui._46Q(X);In(q,x),Wr(q,C),Wr(q,M)}if(K||(E.blend.enabled=!0,E.depth.mask=!1),q._45Q=z.uTransparent=!0,O){for(w=h,y=0,p=w.length;p>y;y++)O(w[y].data)!==!0&&w[y].ui._42(X,V,d);In(q,x,null,!0)}else{for(w=h,y=0,p=w.length;p>y;y++)w[y].ui._42(X,V,d);In(q,x,null,!0),Wr(q,C,null,!0),Wr(q,M,null,!0)}q._45Q=null,q.fireRenderLayerEvent($,"post")}},_42:function(m,q){var _=this;if(!_._35O&&(!Xb||rd(Xb))){var k=_.getWidth(),G=_.getHeight();if(k&&G){var g=_.getGL();if(g){var h,y=_._canvas;if(m?h=!0:m=_.getDevicePixelRatio(),!_._picking&&(h||k!==y.clientWidth||G!==y.clientHeight)){Jk(y,k,G,m);var O=m;k&&Math.abs(g.drawingBufferWidth-k*m)>1&&(O=Math.min(O,g.drawingBufferWidth/k)),G&&Math.abs(g.drawingBufferHeight-G*m)>1&&(O=Math.min(O,g.drawingBufferHeight/G)),O!==m&&(_.setDevicePixelRatio(m=O),Jk(y,k,G,m)),_._18Q=null}g.clear(g.COLOR_BUFFER_BIT);var V=g._renderInfo;V.calls=0,V.vertices=0,V.faces=0,V.lines=0,V.points=0,V.textureCache={time:0,count:0,pixels:0},V.frame=++_._frameId,V.cacheTimeCost=0,V.reflectDepth=0,k*=m,G*=m,this.syncRenderState();do{if(_.isVREnabled()&&_.vr.render(g,k,G,q))break;if(_.updateScene(),_._postProcessing.render(g,k,G,q))break;_.setViewport(g,0,0,k,G),_.renderScene(q)}while(!1);_._33Q=!1,_.countFrame(),_._doBufferGC(g)}}}},syncRenderState:function(){var M,f;(M=this._frameState)&&(f=M.renderState)&&f.syncLoss()},drawReflectors:function(Y){Y._renderInfo.reflectDepth++;var E,G,T,n=this,V=n._dataModel.getReflectors(),B=!1;for(E in V)G=V[E],n.isVisible(G)&&(T=n.getData3dUI(G),T&&T.drawReflector&&T.drawReflector(Y)&&(B=!0));return Y._renderInfo.reflectDepth--,B},isReflecting:function($){return $._renderInfo.reflectDepth},getPostProcessing:function(){return this._postProcessing},enablePostProcessing:function(y,j){return this._postProcessing.enableModule(y,j)},getPostProcessingModule:function(V){return this._postProcessing.getModule(V)},getPostProcessingValue:function(V,D){var u=this._postProcessing.getModule(V);return u?u[D]:z},setPostProcessingValue:function(X,s,z){var U=this.getPostProcessingValue(X,s),c=this._postProcessing.getModule(X);c&&U!==z&&("enable"===s?this.enablePostProcessing(X,z):c[s]=z,this.firePropertyChange("postProcessing."+X+"."+s,U,z))},setDofImageFromGraphView:function(m,x,k){return this._postProcessing.getModule("Dof").setImageFromGraphView(m,x,k)},setViewport:function(F,q,u,a,t){this._viewport=[q,u,a,t],Jm.for(F).directState().viewport=this._viewport},getRenderState:function(){return Jm.for(this._26I)},getViewport:function(){return this._viewport},setBufferGCInterval:function(A){this._bufferGCInterval=A},_doBufferGC:function(Z,l){var S,V,O=Z._bufPool,_=0,w=0,Y=Z._renderInfo.frame,p=this._bufferGCInterval||10;for(S in O)_++,V=O[S],V&&(l||Y-V._fid>p?(Z.deleteBuffer(V._buf),V._buf=null,O[S]=null):w++);if(_/2>w&&_>128){var J={};for(S in O)O[S]&&(J[S]=O[S]);Z._bufPool=J}Z._validBufCount=w},_swapLineMap:function(){var u=this;_r=u._polylineModelMap,u._polylineModelMap=u._polylineModelMapSwap,u._polylineModelMapSwap=_r,_r=u._wireframeModelMap,u._wireframeModelMap=u._wireframeModelMapSwap,u._wireframeModelMapSwap=_r,_r=u._polylineIndexMap,u._polylineIndexMap=u._polylineIndexMapSwap,u._polylineIndexMapSwap=_r,_r=u._wireframeIndexMap,u._wireframeIndexMap=u._wireframeIndexMapSwap,u._wireframeIndexMapSwap=_r},_updateSkybox:function(u){if(this._skybox&&u){var p=u.property,f=!1,V=this._skybox;if("eye"===p||"forceUpdate"===p){var O=this._eye;V.p3(O[0],O[1],O[2]),f=!0}if("near"===p||"far"===p||"forceUpdate"===p||"asceptChanged"===p){var I=V.__cachedS3__;I||(I=V.__cachedS3__=V.getFinalScale3d());var n=Math.sqrt(3),Q=1/0,y=-1/0;I.forEach(function(I){I/=2,Q=X(I,Q),y=o(I,y)}),y*=n;var q=this._near,C=this._far,w=Math.tan(this.getFovy()/2)*q,d=this.getAspect()*w,l=1.1*Math.sqrt(d*d+w*w+q*q),M=1;if(l>Q)M=l/Q;else if(y>=C){var P=C*C/(q+C);M=P/y}if(1!==M){V.__updatingSkybox__=!0;var J=I.map(function(Q){return M*Q});V.s3(J),V.setScale3d(1,1,1),f=!0,delete V.__updatingSkybox__}}f&&this.invalidateData(V)}},getSkyBox:function(){return this.getSkybox()},setSkyBox:function(h){return this.setSkybox(h)},getSkybox:function(){return this._skybox},setSkybox:function(P){var f=this._skybox;if(f===P)return P&&this._updateSkybox({property:"forceUpdate"}),void 0;if(f&&(this._skyboxStyleMap&&f.setStyleMap(this._skyboxStyleMap),this._skyboxStyleMap=null,this._skyboxAnchor3d&&f.setAnchor3d(this._skyboxAnchor3d),this._skyboxAnchor3d=null,this._skyboxP3&&f.p3(this._skyboxP3),this._skyboxP3=null,this.handleDataModelChange({kind:Ib,data:f})),this._skybox=P,this.ump(this._updateSkybox,this),P){P.removeFromDataModel(),this._skyboxStyleMap=B.Default.clone(P.getStyleMap()),this._skyboxAnchor3d=P.getAnchor3d(),P.setAnchor3d(.5,.5,.5),this._skyboxP3=P.p3().slice(0),P.s({"shape3d.reverse.flip":!0,"shape3d.reverse.cull":!1,"all.reverse.flip":!0,"all.reverse.cull":!1,"front.reverse.flip":!0,"front.reverse.cull":!1,"back.reverse.flip":!0,"back.reverse.cull":!1,"left.reverse.flip":!0,"left.reverse.cull":!1,"right.reverse.flip":!0,"right.reverse.cull":!1,"top.reverse.flip":!0,"top.reverse.cull":!1,"bottom.reverse.flip":!0,"bottom.reverse.cull":!1});var x=P.onPropertyChanged;P.onPropertyChanged=function(c){x.call(P,c),!P.__updatingSkybox__&&["width","height","tall","scale","scaleTall"].indexOf(c.property)>=0&&(P.__cachedS3__=z)},this.mp(this._updateSkybox,this),this._updateSkybox({property:"forceUpdate"})}this.fp("skybox",f,P)},drawSky:function(e,J){var U=this,t=U._skybox;if(t){var o=Jm.for(e).directUniforms(),C=U._headlightIntensity,x=$m(U._headlightColor),J=U._prg;1!==C&&(x=[x[0]*C,x[1]*C,x[2]*C]),o.uHeadlightColor=[x[0],x[1],x[2],1];var B=U.getData3dUI(t);if(B){var i=U.isOrtho(),b=i||this._computedProjectMatrix;if(b){var E=U._projectMatrix;i&&(U._ortho=!1),o.uPMatrix=U._projectMatrix=Xf(U,!0)}var R=t.p3(),G=this.getEye();(R[0]!==G[0]||R[1]!==G[1]||R[2]!==G[2])&&(t._position.x=G[0],t._54O=G[1],t._position.y=G[2]),B.validate(),B._42(e,J,w),b&&(i&&(U._ortho=!0),o.uPMatrix=U._projectMatrix=E)}e.clear(e.DEPTH_BUFFER_BIT),o.uHeadlightColor=[x[0],x[1],x[2],U._headlightDisabled?1:0]}},getLogicalPoint:function(Z){return Lf(Z,this._canvas)},isRectOverlapping:function(E){var q=this.getData3dUI(E);return q._rectOverlapping},getHitFaceInfo:function(M){M.target&&(M=this.lp(M));var U=this.getDataInfoAt(M);if(U){var A=this.intersectObject(M,U.data);if(A)return{data:U.data,face:A.part}}return I},unproject:function(N,g){var u=this,r=u.getWidth(),n=u.getHeight(),F=N.target?u.lp(N):N,d=F.x-r/2,M=F.y-n/2,A=2*(d/r),$=2*(-1*M/n);g=g||0;var L=an(),S=Xf(u),V=yk(u);Hh(L,S,V),yo(L);var e=Ng([A,$,g,1],L);return[e[0]/e[3],e[1]/e[3],e[2]/e[3]]},getDataAt:function(b){var X=this.getDataInfoAt(b);return X?X.data:I},getDataInfoAt:function(U,i,T){return U.target&&(U=this.lp(U)),this._1o.get(dp(U.x,U.y,i),!0,T)},getDatasInRect:function(m,p){return this._1o.get(m,!1,p)},setEditable:function(b){var Z=this,x=Z._editable;Z._editable=b,this.fp(sq,x,b)},isEditable:function(m){var v=this;return m?v._editable?Dg(m)?m.s("3d.editable")?v._editableFunc?v._editableFunc(m):!0:!1:!1:!1:v._editable},isSelectable:function(O){return O.s("3d.selectable")&&this.sm().isSelectable(O)},isMovable:function(Z){var m=this;return kh(Z)&&Z.getStyle(bq)!==vr?!1:Z.s("3d.movable")?m._movableFunc?m._movableFunc(Z):!0:!1},isSizeEditable:function(f){return Dg(f)?this._sizeEditableFunc?this._sizeEditableFunc(f):!0:!1},isRotationEditable:function(H){return Dg(H)&&H.IRotatable!==!1?this._rotationEditableFunc?this._rotationEditableFunc(H):!0:!1},handleDelete:function(){this._editable&&this.removeSelection()},zoomIn:function(s){this.setZoom(ms,s)},zoomOut:function(A){this.setZoom(1/ms,A)},setZoom:function(){var c=new Xn,I=new Xn,b=new Xn,t=new Xn;return function(r,a){if(1!==r){var o=this;o._14o&&o._14o.stop(!0);var y,P=1/r;c.copy(o.getCenter()),I.copy(o.getEye());var H=o._ortho;if(H){if(y=o._orthoWidth,y<o._moveStep&&r>1)return}else if(c.distanceTo(I)<o._moveStep&&1>P)return;var k=!1;return o._zoomToCenter===!1&&o._lastZoomLP&&(b.copy(I).sub(c).normalize(),o._81O=null,t.copy(o.getHitPosition(o._lastZoomLP,c.toArray(),b.toArray())),k=!0,o._lastZoomHit=t),(a=wj(a))?(a.action=function(j){o.fi({kind:o._zooming?"betweenZoom":"beginZoom"}),o._zooming=1;var E=(P-1)*j+1;H&&o.setOrthoWidth(y*E),k?(o.setEye(b.lerpVectors(t,I,E).toArray()),o.setCenter(b.lerpVectors(t,c,E).toArray())):H||o.setEye(b.lerpVectors(c,I,E).toArray())},a._37o=function(){delete o._14o,delete o._zooming,o.fi({kind:"endZoom"}),o.onZoomEnded()},o._14o=$h(a)):(H&&o.setOrthoWidth(y*P),k?(o.setEye(b.lerpVectors(t,I,P).toArray()),o.setCenter(b.lerpVectors(t,c,P).toArray())):H||o.setEye(b.lerpVectors(c,I,P).toArray()),void 0)}}}(),setOrthoZoom:function(V,Y){return this.setZoom(V,Y)},getPositionInfo:function(n){var e=this,P=e._eye,N=e._center,d=e.getAspect(),Y=n?Li(Er(N,P,!0),Er(n,P)):Jc(P,N);if(e._ortho){var p=e._orthoWidth;return{length:Y,height:p/d,width:p}}var E=2*Le(e._fovy/2)*Y;return{length:Y,height:E,width:E*d}},getCenterInfo:function(){var c=this;return c._81O||(c._81O=c.getPositionInfo()),sj(c._81O)},rotate:function(e,$,R,d){var t=this;if(e||$){d==I&&(d=t._firstPersonMode),t._88O&&t._88O.stop(!0);var D=t._center,G=t._eye,C=t.getCenterInfo().length,Q=d?D:G,p=d?G:D,m=Er(Q,p),S=Wd(m[0],m[2]),W=Wd(a(m[0]*m[0]+m[2]*m[2]),m[1]),f=d?Nq:Cc;return d&&($=-$),(R=wj(R))?(R.action=function(y){t.fi({kind:t._rotating?"betweenRotate":"beginRotate"}),t._rotating=1;var r=S+e*y,Z=W+$*y;Z=d?L-oq(t,L-Z):oq(t,Z),m[0]=C*k(Z)*k(r),m[1]=C*F(Z),m[2]=C*k(Z)*F(r),Q[0]=p[0]+m[0],Q[1]=p[1]+m[1],Q[2]=p[2]+m[2],t.fp(f,I,Q)},R._37o=function(){delete t._88O,delete t._rotating,t.fi({kind:"endRotate"}),t.onRotateEnded()},t._88O=$h(R)):(S+=e,W+=$,W=d?L-oq(t,L-W):oq(t,W),m[0]=C*k(W)*k(S),m[1]=C*F(W),m[2]=C*k(W)*F(S),Q[0]=p[0]+m[0],Q[1]=p[1]+m[1],Q[2]=p[2]+m[2],t.fp(f,I,Q),void 0)}},pan:function(L,q,E,S){if(L||q){var R=this;S==I&&(S=R._firstPersonMode),R._89O&&R._89O.stop(!0);var B=yk(R),w=[B[0]*L,B[4]*L,B[8]*L],P=[B[1]*q,B[5]*q,B[9]*q],F=w[0]+P[0],D=w[1]+P[1],c=w[2]+P[2],i=R._center,M=R._eye;if(S){var k=Ei(R.getBoundaries(),M[0],M[2],M[0]+F,M[2]+c,a(F*F+c*c));F=k[0],c=k[1]}if(E=wj(E)){var Y=sj(M),A=sj(i);return E.action=function(J){R.fi({kind:R._panning?"betweenPan":"beginPan"}),R._panning=1,i[0]=A[0]+F*J,i[1]=A[1]+D*J,i[2]=A[2]+c*J,M[0]=Y[0]+F*J,M[1]=Y[1]+D*J,M[2]=Y[2]+c*J,R.fp(Cc,I,M),R.fp(Nq,I,i)},E._37o=function(){delete R._89O,delete R._panning,R.fi({kind:"endPan"}),R.onPanEnded()},R._89O=$h(E)}i[0]+=F,i[1]+=D,i[2]+=c,M[0]+=F,M[1]+=D,M[2]+=c,R.fp(Cc,I,M),R.fp(Nq,I,i)}},walk:function(o,G,k){if(o){var u=this;k==I&&(k=u._firstPersonMode),u._90O&&u._90O.stop(!0);var h=u._center,C=u._eye,D=Er(h,C,!0);if(k){var d=Ei(u.getBoundaries(),C[0],C[2],C[0]+D[0]*o,C[2]+D[2]*o,i(o));if(o=Jc(d),!o)return;D=[d[0]/o,0,d[1]/o]}if(G=wj(G)){var z=sj(C),Z=sj(h);return G.action=function(g){u.fi({kind:u._walking?"betweenWalk":"beginWalk"}),u._walking=1;var U=o*g;C[0]=z[0]+D[0]*U,C[1]=z[1]+D[1]*U,C[2]=z[2]+D[2]*U,h[0]=Z[0]+D[0]*U,h[1]=Z[1]+D[1]*U,h[2]=Z[2]+D[2]*U,u.fp(Cc,I,C),u.fp(Nq,I,h)},G._37o=function(){delete u._90O,delete u._walking,u.fi({kind:"endWalk"}),u.onWalkEnded()},u._90O=$h(G)}C[0]+=D[0]*o,C[1]+=D[1]*o,C[2]+=D[2]*o,h[0]+=D[0]*o,h[1]+=D[1]*o,h[2]+=D[2]*o,u.fp(Cc,I,C),u.fp(Nq,I,h)}},handleScroll:function(a,R){cl(a);var T=this,G=T._moveStep,n=T.getDataInfoAt(a);if(n){var y=n.data;if(y&&T.isInteractive(y)){var x=T.intersectObject(a,y);if(x){var k=x.part,s=Td(y.s(k+".image")||y.s("shape3d."+k+".image")||y.s("all.image")||y.s("shape3d.image"));if(s&&tp(s.scrollable,y,T))return}}}return T.isFirstPersonMode()?(T.isPannable()&&T.pan(0,R>0?G:-G),void 0):(T.isZoomable()&&(T._lastZoomLP=T.lp(a),T.setZoom(0>R?1/Vb:Vb),T._lastZoomLP=T._lastZoomHit=null),void 0)},handlePinch:function(f,G){if(this.isZoomable()){if(Math.abs(f-G)<R.pinchZoomThreshold)return;this.setZoom(G>f?1/Wp:Wp)}},reset:function(f){this.setUp(R.graph3dViewUp),this.moveCamera(R.graph3dViewEye,R.graph3dViewCenter,f)},moveSelection:function(d,W,e){var u=this;u.dm().beginTransaction(),wf(this.sm().toSelection(this.isMovable,this),d,W,e),u.dm().endTransaction()},getMoveMode:function(P,S){var h=S.s("3d.move.mode");if(h)return h;var R="88",_="89",O="90";return Ac(P)||_i[R]&&_i[_]&&_i[O]?"xyz":_i[R]&&_i[_]?"xy":_i[R]&&_i[O]?"xz":_i[_]&&_i[O]?"yz":_i[R]?"x":_i[_]?"y":_i[O]?"z":"xz"},handleTick:function(){var v=this,E=!1,r=v._moveStep,d=r,G=!1,e=!0,W=v._rotateStep*(e?-1:1);if(v.isWalkable()||(d=0),v.isPannable()||(r=0),v.isRotatable()||(W=0),v._32Q){var y=(xn()-v._32Q)/50;d*=y,r*=y,W*=y}v._31Q&&(nk(v._31Q),delete v._31Q,delete v._32Q),Ce()&&(E=!0,v.pan(-r,0,G,e)),Mf()&&(E=!0,v.pan(r,0,G,e)),Fi()&&(E=!0,Ac()?v.pan(0,r,G,e):v.walk(d,G,e)),$b()&&(E=!0,Ac()?v.pan(0,-r,G,e):v.walk(-d,G,e)),so()&&(E=!0,v.rotate(-W,0,G,e)),lf()&&(E=!0,v.rotate(W,0,G,e)),Kc()&&(E=!0,v.rotate(0,-W/2,G,e)),Yb()&&(E=!0,v.rotate(0,W/2,G,e)),E&&(v._32Q=xn(),v._31Q=ed(v.handleTick,v))},handleKeyDown:function(j){var c=this;!Bl(j)&&vc[j.keyCode]?c.handleTick():bm(j)?c.selectAll():Zr(j)?c.handleDelete(j):tl(j)&&this.isResettable()&&c.reset()},checkDoubleClickOnNote:function(H,j,k){var I=this;if(k===Si){if(j.s("note.toggleable"))return j.s(yg,!j.s(yg)),I.fi({kind:"toggleNote",event:H,data:j,part:k}),!0}else if(k===bl&&j.s("note2.toggleable"))return j.s(wq,!j.s(wq)),I.fi({kind:"toggleNote2",event:H,data:j,part:k}),!0;return!1},checkDoubleClickOnRotation:function(M,n,X){return X===bt?(n.setRotationX(0),!0):X===ct?(n.setRotationY(0),!0):X===dt?(n.setRotationZ(0),!0):!1},onRotateEnded:function(){},onWalkEnded:function(){},getViewRatio:function(r){var u=this;if(u.isOrtho())return u.getWidth()/u.getOrthoWidth();var E=u.getCenter(),s=u.getHeight(),F=u.getEye(),J=[E[0]-F[0],E[1]-F[1],E[2]-F[2]],V=[r[0]-F[0],r[1]-F[1],r[2]-F[2]],w=Math.sqrt(J[0]*J[0]+J[1]*J[1]+J[2]*J[2]),y=1/Math.tan(u.getFovy()/2);return s*w*y/(V[0]*J[0]+V[1]*J[1]+V[2]*J[2])},inViewSpace:function(M){var E,r=this,T=r._transformPointToViewSpace(M),l=r.getAspect(),q=r.getNear(),P=r.getFar();return-T[2]<q||-T[2]>P?!1:r.isOrtho()?(E=r.getOrthoWidth()/2,Math.abs(T[0])<=E&&Math.abs(T[1]*l)<=E):(E=Math.sqrt(T[0]*T[0]+T[1]*T[1]+T[2]*T[2])*Math.tan(r.getFovy()/2),Math.abs(T[1]<=E)&&Math.abs(T[0])<=E*l)},getPVMatrix:function(){var Z,X=this;return(Z=X._18Q)||(Z=Xf(X),X._18Q=Hh(Z,Z,yk(X)),X._18Q._wh=X.getWidth()/2/X.getHeight()),Z},getFrustum:function(){var k=new qc,O=new xb,Z=new Array(16);return function(){for(var N=this.getPVMatrix(),w=!1,X=0;16>X;X++)N[X]!==Z[X]&&(w=!0,Z[X]=N[X]);return w&&O.setFromMatrix(k.fromArray(N)),O}}(),toViewPosition:function(K){var g=this,s=g.getWidth()/2,S=g.getHeight()/2,T=g.getPVMatrix();return K=Ng([K[0],K[1],K[2],1],T),{x:s+s*K[0]/K[3],y:S-S*K[1]/K[3],z:K[2]/K[3]}},getHitPosition:function(r,$,K){var d=this,H=d.getWidth(),L=d.getHeight(),X=r.target?d.lp(r):r,e=X.x-H/2,I=X.y-L/2,g=d.getCenterInfo(),h=yk(d);$=$?$:[0,0,0],K=K?K:[0,1,0],e=e/H*g.width,I=-1*I/L*g.height;var Y=[h[0]*e,h[4]*e,h[8]*e],s=[h[1]*I,h[5]*I,h[9]*I],l=[Y[0]+s[0],Y[1]+s[1],Y[2]+s[2]],o=d.getCenter(),m=As(d,$,K,[l[0]+o[0],l[1]+o[1],l[2]+o[2]]);return m?m:[0,0,0]},intersectObject:function(q,g){return this._raycaster.intersectObject(q,g)},intersectObjects:function(j,o,T){return this._raycaster.intersectObjects(j,o,T)},getLineLength:function(s){this.validate();var D=this.getData3dUI(s);if(D&&D.getCache){var d=D.getCache();if(d)return d[d.length-1].length}return 0},getLineOffset:function(n,r){var p=this.getData3dUI(n);if(p&&p.getCache){var b=p.getCache();if(b){var P=Sf(b,r);if(n.s("shape3d")!==Rl)return P;var u,y;if(n.getScale3d&&(u=n.getScale3d(),1===u[0]&&1===u[1]&&1===u[2]&&(u=null)),n.r3&&(y=n.r3(),0===y[0]&&0===y[1]&&0===y[2]&&(y=null)),!y&&!u)return P;var K=new Xn(n.p3()),i=new Xn(P.point).sub(K),R=new Xn(P.tangent).add(i);if(u&&(u=new Xn(u),i.multiply(u),R.multiply(u)),y){var m=(new Hm).setFromEuler(new vb(y,n.getRotationMode(),!0));i.applyQuaternion(m),R.applyQuaternion(m)}return{point:i.clone().add(K),tangent:R.sub(i).normalize()}}}return I},_genBatchInstancedArrayFunc:function(){var D=this._glCapabilities&&this._glCapabilities.instancedArray&&!this._batchInstancedDisabled,Z=D?Um:Gb;this.batchInstancedModel=function(k,P,b,t,M,Y,g){Z(this,k,P,b,t,M,Y,g)};var I=D?Oi:Tj;this.batchInstancedShapeFace=function(h,N,F){I(h,N,F)};var p=D?Dq:Zk;this.batchInstancedFace=function(c,f,r,H,A){p(this,c,f,r,H,A)}},isLabelVisible:function(){return!0},isNoteVisible:function(){return!0},moveCamera:function(i,Y,x){var I=this,F=I.getEye();F=[F[0],F[1],F[2]];var u=I.getCenter();if(u=[u[0],u[1],u[2]],i||(i=F),Y||(Y=u),I._flyAnim&&I._flyAnim.stop(!0),x=wj(x),!x)return I.setEye(i[0],i[1],i[2]),I.setCenter(Y[0],Y[1],Y[2]),delete I._flyAnim,!0;var B=[i[0]-F[0],i[1]-F[1],i[2]-F[2]],T=[Y[0]-u[0],Y[1]-u[1],Y[2]-u[2]];return x.action=function(G){I.setCenter(u[0]+T[0]*G,u[1]+T[1]*G,u[2]+T[2]*G),I.setEye(F[0]+B[0]*G,F[1]+B[1]*G,F[2]+B[2]*G)},x._37o=function(){delete I._flyAnim},I._flyAnim=$h(x)},flyTo:function(){function m(S,r,f){if(f instanceof B.Node){_.fromArray(Zi(f,r.getMat(f)));var D=f.getAnchor3d();S.push((new Xn).set(0-D.x,0-D.y,0-D.z).applyMatrix4(_)),S.push((new Xn).set(0-D.x,0-D.y,1-D.z).applyMatrix4(_)),S.push((new Xn).set(0-D.x,1-D.y,0-D.z).applyMatrix4(_)),S.push((new Xn).set(0-D.x,1-D.y,1-D.z).applyMatrix4(_)),S.push((new Xn).set(1-D.x,0-D.y,0-D.z).applyMatrix4(_)),S.push((new Xn).set(1-D.x,0-D.y,1-D.z).applyMatrix4(_)),S.push((new Xn).set(1-D.x,1-D.y,0-D.z).applyMatrix4(_)),S.push((new Xn).set(1-D.x,1-D.y,1-D.z).applyMatrix4(_))}}var M=new Xn,O=new Xn,C=new Xn,w=new Xn,k=new Xn,_=new qc,G=new B.Math.Quaternion,Y=new vb,u=new cr;return function(a,e,$){var W=this;"boolean"==typeof e&&(e={animation:e}),e=e||{};var v=e.center,x=e.distance,Q=e.direction,J=e.worldDirection,Z=$||e.ratio||.8,N=e.xRatio||Z,A=e.yRatio||Z;($!==z||e.duration||e.frames)&&(e={animation:e});var H,p,L=[],r=x===z;if(v&&C.fromArray(v),!v||r)if(a||(a=W.dm().getDatas()),1===a.length&&(a=vq(a)?a.get(0):a[0]),a instanceof B.Node)v||C.fromArray(a.p3()),r&&(m(L,W,a),H=L.length);else{if(!a.length)return;if((r||!v)&&(L=[],a.forEach(function(k){m(L,W,k)}),H=L.length,!H))return;v||(u.setFromPoints(L),C.copy(u.min).add(u.max).multiplyScalar(.5))}if(W._flyAnim&&W._flyAnim.stop(!0),M.fromArray(W.getEye()),O.fromArray(W.getCenter()),W.setCenter(C.x,C.y,C.z),w.subVectors(M,O),Q||J){!J&&a instanceof B.Node?G.setFromEuler(Y.set(a.r3(),a.getRotationMode(),!0)):G.set(0,0,0,1);var f=w.length();w.fromArray(J||Q).applyQuaternion(G).setLength(f)}var K=new Xn(W.getUp()),c=jl.fequal(K.x,0,1e-5)&&jl.fequal(K.z,0,1e-5);if(c&&0===w.x&&0===w.z){var g=.001,D=w.y;w.y=D*(1-g),w.z=Math.sign(D)*g}var j=0;if(r){var F,i,o,s=N,n=A;if(k.copy(w),W.isOrtho()){var y=-1/0;for(W._eye[0]=w.x+C.x,W._eye[1]=w.y+C.y,W._eye[2]=w.z+C.z,F=Xf(W),Hh(F,F,yk(W)),p=0;H>p;p++)o=L[p],i=Ng([o.x,o.y,o.z,1],F),y=Math.max(y,Math.max(Math.abs(i[0])/s,Math.abs(i[1])/n));j=W.getOrthoWidth()*y}else{for(var U,b,S=W.getNear(),I=10;I--;){for(W._eye[0]=w.x+C.x,W._eye[1]=w.y+C.y,W._eye[2]=w.z+C.z,F=Xf(W),Hh(F,F,yk(W)),U=!0,b=-1/0,p=0;H>p;p++){if(o=L[p],i=Ng([o.x,o.y,o.z,1],F),i[3]<S&&I){w.multiplyScalar(2),U=!1;break}b=Math.max(b,Math.max(Math.abs(i[0])/s,Math.abs(i[1])/n)-i[3])}if(U)break}w.setLength(b+w.length())}w.manhattanLength()<1e-6&&w.copy(k)}else w.setLength(x);var t=w.add(C),_=wj(e.animation);if(_){W.setEye(M.x,M.y,M.z),W.setCenter(O.x,O.y,O.z);var l=t.clone().sub(C),V=l.length();V&&l.multiplyScalar(1/V);var h=M.clone().sub(O),T=h.length();T&&h.multiplyScalar(1/T);var q=(new qc).lookAtDirection(h,K),E=(new qc).lookAtDirection(l,K),P=(new Hm).setFromRotationMatrix(q),X=(new Hm).setFromRotationMatrix(E),d=(new Xn).subVectors(C,O);if(j)var oj=W.getOrthoWidth();var Se=new Xn,Pd=new Xn,Zq=new Xn,sc=_.action,Ge=_._37o,Yc=O.clone();return _.action=function(p,R){Pd.copy(Yc).addScaledVector(d,p);var O=P.clone().slerp(X,p);Se.set(0,0,1).applyQuaternion(O).setLength(T+(V-T)*p).add(Pd),Zq.set(0,1,0).applyQuaternion(O),W.setCenter(Pd.x,Pd.y,Pd.z),W.setEye(Se.x,Se.y,Se.z),W.setUp(Zq.x,Zq.y,Zq.z),j&&W.setOrthoWidth((j-oj)*p+oj),sc&&sc(p,R)},_._37o=function(){delete W._flyAnim;var s=W.getUp(),w=c?R.graph3dViewUp:K.toArray();(s[0]!==w[0]||s[1]!==w[1]||s[2]!==w[2])&&W.setUp(w),Ge&&Ge()},{lastEye:M,lastCenter:O,eye:t,center:C,orthoWidth:j,animation:W._flyAnim=$h(_)}}return W.setEye(t.x,t.y,t.z),W.setCenter(C.x,C.y,C.z),j&&W.setOrthoWidth(j),delete W._flyAnim,{lastEye:M,lastCenter:O,eye:t,center:C,orthoWidth:j}}}(),getBoundingBox:function(){function L(g,i,n){$.fromArray(Zi(n,i.getMat(n)));var K=n.getAnchor3d();g.push((new Xn).set(0-K.x,0-K.y,0-K.z).applyMatrix4($)),g.push((new Xn).set(0-K.x,0-K.y,1-K.z).applyMatrix4($)),g.push((new Xn).set(0-K.x,1-K.y,0-K.z).applyMatrix4($)),g.push((new Xn).set(0-K.x,1-K.y,1-K.z).applyMatrix4($)),g.push((new Xn).set(1-K.x,0-K.y,0-K.z).applyMatrix4($)),g.push((new Xn).set(1-K.x,0-K.y,1-K.z).applyMatrix4($)),g.push((new Xn).set(1-K.x,1-K.y,0-K.z).applyMatrix4($)),g.push((new Xn).set(1-K.x,1-K.y,1-K.z).applyMatrix4($))}var $=new qc;return function(q){if(q=q||this.sm().getSelection(),q instanceof B.Node&&(q=[q]),0===q.length)return I;var o=[];q.forEach(function(y){Dg(y)&&L(o,this,y)},this);var Y=[1/0,1/0,1/0],V=[-1/0,-1/0,-1/0];return o.forEach(function(F){Y[0]=Math.min(F.x,Y[0]),Y[1]=Math.min(F.y,Y[1]),Y[2]=Math.min(F.z,Y[2]),V[0]=Math.max(F.x,V[0]),V[1]=Math.max(F.y,V[1]),V[2]=Math.max(F.z,V[2])}),{min:Y,max:V}}}(),setBatchInfo:function(V,N){var D=this._batchInfoMap[V];this._batchInfoMap[V]=N,this.fp("batchInfo",D,N)},getBatchInfo:function(Z){return this._batchInfoMap[Z]||nn[Z]},setOrthoWidth:function(j){var U=this._orthoWidth;if(this._orthoWidth=j,this._syncEyeWithOrthoWidth){var x=j/this.getAspect(),G=x/2/Le(this.getFovy()/2),c=(new Xn).fromArray(this.getEye()),J=(new Xn).fromArray(this.getCenter());c.sub(J).setLength(G).add(J),this.setEye(c.toArray())}this.fp("orthoWidth",U,j)},getCamera:function(d){var k=this;d||(d=k._mainCamera,d||(d=k._mainCamera=new B.Camera)),d.s({"camera.type":k.isOrtho()?"ortho":"perspective","camera.aspect":k.getAspect(),"camera.fovy":k.getFovy(),"camera.ortho.width":k.getOrthoWidth(),"camera.near":k.getNear(),"camera.far":k.getFar()});var $=k.getEye();return d.p3($.slice()),d.lookAt(k.getCenter(),k.getUp()),d},syncFromCamera:function(B){var $=this,s=new Xn($.getEye()),V=new Xn($.getCenter()),Z=new Xn,n=V.sub(s).length();$.setEye(B.p3());var h=B.getEuler();return Z.set(0,0,-1).applyEuler(h),s.copy(Z).setLength(n).add(V.copy(B.p3())),$.setCenter(s.toArray()),s.set(0,1,0).applyEuler(h),V.set(0,1,0),Math.abs(Z.cross(s).dot(V))<1e-5?$.setUp(V.toArray()):$.setUp(s.toArray()),$.setOrtho("ortho"===B.s("camera.type")),$.setAspect(B.s("camera.aspect")),$.setFovy(B.s("camera.fovy")),$.setOrthoWidth(B.s("camera.ortho.width")),$.setNear(B.s("camera.near")),$.setFar(B.s("camera.far")),!0},resetHeadlightProperties:function(){this._headlightColor=R.graph3dViewHeadlightColor,this._headlightIntensity=R.graph3dViewHeadlightIntensity,this._headlightRange=R.graph3dViewHeadlightRange,this._headlightDirection=R.graph3dViewHeadlightDirection,this._headlightGroup=R.graph3dViewHeadlightGroup,this._headlightAmbientIntensity=R.graph3dViewHeadlightAmbientIntensity,this._headlightDisabled=R.graph3dViewHeadlightDisabled},resetFogProperties:function(){this._fogDisabled=R.graph3dViewFogDisabled,this._fogMode=R.graph3dViewFogMode,this._fogDensity=R.graph3dViewFogDensity,this._fogColor=R.graph3dViewFogColor,this._fogNear=R.graph3dViewFogNear,this._fogFar=R.graph3dViewFogFar},_sortRenderLayers:function(){var w=this,s=w._sortedRenderLayers=T.keys(w._renderLayerInfoMap);for(var t in yh)s.indexOf(t)>=0||s.push(t);s.sort(function(y,z){return y=w.getRenderLayerInfo(y),z=w.getRenderLayerInfo(z),y.priority-z.priority})},_appendRenderLayer:function(p,U){p=p||0;var _,t=this.getRenderLayerInfo(U);if(t)_=t.mask,!this._renderLayerInfoMap[U]&&yh[U]&&(this._renderLayerInfoMap[U]=t);else{var s=this._sortedRenderLayers.length;if(!(32>s))throw new Error("Only 31 render layer can be defined.");_=1<<s,t=this.getRenderLayerInfo(Fl),this._renderLayerInfoMap[U]={mask:_,priority:t.priority}}return p|=_},setRenderLayerInfo:function(R,v){this._appendRenderLayer(0,R);var H=this.getRenderLayerInfo(R),e=sj(H);for(var b in v)"mask"!==b&&(H[b]=v[b]);this._sortRenderLayers(),this.fp("renderLayerInfo",e,H)},getRenderLayerInfo:function(T){return this._renderLayerInfoMap[T]||sj(yh[T])},setRenderLayerInfoMap:function(K){var _=this._renderLayerInfoMap;this._renderLayerInfoMap={};for(var U in K)this.setRenderLayerInfo(U,K[U]);this.fp("renderLayerInfoMap",_,this._renderLayerInfoMap)},getRenderLayerKeys:function(){return this._sortedRenderLayers}}),function(){function o(x,H,M){var E=x[H];E&&E.releaseTexture(),x[H]=M}function _(){return["\n #ifdef ENVMAP_TYPE_CUBE_UV \n","#define cubeUV_maxMipLevel 8.0 \n","#define cubeUV_minMipLevel 4.0 \n","#define cubeUV_maxTileSize 256.0 \n","#define cubeUV_minTileSize 16.0 \n","float getFace(vec3 direction) {","vec3 absDirection = abs(direction);","float face = - 1.0;","if (absDirection.x > absDirection.z) {","if (absDirection.x > absDirection.y)","face = direction.x > 0.0 ? 0.0 : 3.0;"," else ","face = direction.y > 0.0 ? 1.0 : 4.0;","} else {","if (absDirection.z > absDirection.y) ","face = direction.z > 0.0 ? 2.0 : 5.0;"," else ","face = direction.y > 0.0 ? 1.0 : 4.0;","}","return face;","} ","vec2 getUV(vec3 direction, float face) {","vec2 uv;","if (face == 0.0) {","uv = vec2(direction.z, direction.y) / abs(direction.x);","} else if (face == 1.0) {","uv = vec2(- direction.x, - direction.z) / abs(direction.y);","} else if (face == 2.0) {","uv = vec2(- direction.x, direction.y) / abs(direction.z);","} else if (face == 3.0) {","uv = vec2(- direction.z, direction.y) / abs(direction.x);","} else if (face == 4.0) {","uv = vec2(- direction.x, direction.z) / abs(direction.y);","} else {","uv = vec2(direction.x, direction.y) / abs(direction.z);","}","return 0.5 * (uv + 1.0);","} ","vec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {","float face = getFace(direction);","float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);","mipInt = max(mipInt, cubeUV_minMipLevel);","float faceSize = exp2(mipInt);","float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);","vec2 uv = getUV(direction, face) * (faceSize - 1.0);","vec2 f = fract(uv);","uv += 0.5 - f;","if (face > 2.0) {","uv.y += faceSize;","face -= 3.0;","}","uv.x += face * faceSize;","if (mipInt < cubeUV_maxMipLevel) {","uv.y += 2.0 * cubeUV_maxTileSize;","}","uv.y += filterInt * 2.0 * cubeUV_minTileSize;","uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);","uv *= texelSize;","vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;","uv.x += texelSize;","vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;","uv.y += texelSize;","vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;","uv.x -= texelSize;","vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;","vec3 tm = mix(tl, tr, f.x);","vec3 bm = mix(bl, br, f.x);","return mix(tm, bm, f.y);","}","\n #define r0 1.0 \n","#define v0 0.339 \n","#define m0 - 2.0 \n","#define r1 0.8 \n","#define v1 0.276 \n","#define m1 - 1.0 \n","#define r4 0.4 \n","#define v4 0.046 \n","#define m4 2.0 \n","#define r5 0.305 \n","#define v5 0.016 \n","#define m5 3.0 \n","#define r6 0.21 \n","#define v6 0.0038 \n","#define m6 4.0 \n","float roughnessToMip(float roughness) {","float mip = 0.0;","if (roughness >= r1) {","mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;","} else if (roughness >= r4) {","mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;","} else if (roughness >= r5) {","mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;","} else if (roughness >= r6) {","mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;","} else {","mip = - 2.0 * log2(1.16 * roughness);","}","return mip;","} ","vec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {","float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);","float mipF = fract(mip);","float mipInt = floor(mip);","vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);","if (mipF == 0.0) {","return vec4(color0, 1.0);","} else {","vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);","return vec4(mix(color0, color1, mipF), 1.0);","}","} ","\n #endif \n"].join("")}function t(){return["vec4 sRGBToLinear( in vec4 value ) {","return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );","}","vec4 LinearTosRGB( in vec4 value ) {","return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );","}","vec4 inputTexelToLinear( vec4 value ) { return sRGBToLinear( value ); }","vec4 linearToOutputTexel( vec4 value ) { return LinearTosRGB( value ); }","vec4 envMapTexelToLinear( vec4 color ) { return inputTexelToLinear( color ); }"].join("")}function n(){return["precision mediump float;\n","precision mediump int;\n","attribute vec3 position;","attribute vec2 uv;","attribute float faceIndex;","varying vec3 vOutputDirection;","vec3 getDirection( vec2 uv, float face ) {","uv = 2.0 * uv - 1.0;","vec3 direction = vec3( uv, 1.0 );","if ( face == 0.0 ) { direction = direction.zyx; } ","else if ( face == 1.0 ) { direction = direction.xzy; direction.xz *= -1.0; } ","else if ( face == 2.0 ) { direction.x *= -1.0; }","else if ( face == 3.0 ) { direction = direction.zyx; direction.xz *= -1.0; } ","else if ( face == 4.0 ) { direction = direction.xzy; direction.xy *= -1.0; } ","else if ( face == 5.0 ) { direction.z *= -1.0; }","return direction;","}","void main() {","vOutputDirection = getDirection( uv, faceIndex );","gl_Position = vec4( position, 1.0 );","}"].join("")}function h(){return{vs:n(),fs:["precision mediump float;\n","precision mediump int;\n","varying vec3 vOutputDirection;","uniform samplerCube envMap;\n",t(),"\n void main() {","gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );","gl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3(- vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;","gl_FragColor = linearToOutputTexel( gl_FragColor );","}"].join("")}}function u(){return{vs:n(),fs:["precision mediump float;\n","precision mediump int;\n","varying vec3 vOutputDirection;","uniform sampler2D envMap;","uniform vec2 texelSize;\n",t(),"\n #define RECIPROCAL_PI 0.3183098861837907 \n","\n #define RECIPROCAL_PI2 0.15915494309189535 \n","vec2 equirectUv( in vec3 dir ) {","float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;","float v = 0.5 - asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI;","return vec2( u, v );","}","void main() {","gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );","vec3 outputDirection = normalize( vOutputDirection );","vec2 uv = equirectUv( outputDirection );","vec2 f = fract( uv / texelSize - 0.5 );","uv -= f * texelSize;","vec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;","uv.x += texelSize.x;","vec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;","uv.y += texelSize.y;","vec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;","uv.x -= texelSize.x;","vec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;","vec3 tm = mix( tl, tr, f.x );","vec3 bm = mix( bl, br, f.x );","gl_FragColor.rgb = mix( tm, bm, f.y );","gl_FragColor = linearToOutputTexel( gl_FragColor );","}"].join("")}
}function v(J){return{vs:n(),fs:["precision mediump float;\n","precision mediump int;\n","#define n "+J+"\n","varying vec3 vOutputDirection;","uniform sampler2D envMap;","uniform int samples;","uniform float weights[ n ];","uniform bool latitudinal;","uniform float dTheta;","uniform float mipInt;","uniform vec3 poleAxis; \n",t(),"\n #define ENVMAP_TYPE_CUBE_UV \n",_(),"\n vec3 getSample( float theta, vec3 axis ) {","float cosTheta = cos( theta );","vec3 sampleDirection = vOutputDirection * cosTheta + cross(axis, vOutputDirection) * sin(theta) + axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);","return bilinearCubeUV( envMap, sampleDirection, mipInt );","}","void main() {","vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );","if ( all( equal( axis, vec3( 0.0 ) ) ) ) {","axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );","}","axis = normalize( axis );","gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );","gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );","for ( int i = 1; i < n; i++ ) {","if ( i >= samples ) { break; }","float theta = dTheta * float( i );","gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );","gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );","}","gl_FragColor = linearToOutputTexel( gl_FragColor );","}"].join("")}}var x=lp.EnvmapRenderer=function(S){this.gv=S,this._envmaps={},this._envmapHash={},this._probeCaptureTime={},this._pingPongRenderTarget=null,this._equirectShader=null,this._cubemapShader=null,this._blurMaterial=null,this._lastCaptureFrame=0};x.prototype={},x.prototype.constructor=x,x.prototype.changeEnvmapType=function(v){"legacy"===v?(this.setEnvmapByProbeId=this.setEnvmapLegacy,this.onBeforeRender=this.onBeforeRenderLegacy):(this.setEnvmapByProbeId=this.setEnvmap,this.onBeforeRender=this.onBeforeRenderNew)},x.prototype.invalidateEnvmap=function(J){var y=this.gv;if("legacy"!==y.getEnvmapType()){var i=y.getGL();i&&(J?(delete this._envmapHash[J],delete this._probeCaptureTime[J]):(this._envmapHash={},this._probeCaptureTime={}),y.iv())}},x.prototype.contextLost=function(){var e=this;e._envmaps={},e._envmapHash={},e._pingPongRenderTarget=null,e._equirectShader=e._cubemapShader=e._blurMaterial=null,e._envmapLegacy=null,e._lastLegacyImage=null},x.prototype.onBeforeRenderLegacy=function(i){this.assureTextureLegacy(i)},x.prototype.assureTextureLegacy=function(s){var O=this,l=O.gv,f=l.getEnvmap();if(f!==O._lastLegacyImage){if(O._envmapLegacy&&(s.deleteTexture(O._envmapLegacy),O._envmapLegacy=null),!f)return O._lastLegacyImage=f,void 0;var K=R.getImage(f);if(K&&K.tagName){K=R.resizeImagePOT(K,!0);var z=O._envmapLegacy=s.createTexture();s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_CUBE_MAP,z),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+0,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,K),s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+1,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,K),s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+2,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,K),s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+3,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,K),s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+4,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,K),s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+5,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,K),s.bindTexture(s.TEXTURE_CUBE_MAP,s._emptyCubeTexture),O._lastLegacyImage=f}}},x.prototype.setEnvmapLegacy=function(n){n.uEnvMap=this._envmapLegacy},x.prototype.onBeforeRenderNew=function(z){this.assureTextureNew(z),this.resetUniformCache()},x.prototype.assureTextureNew=function(j){var A=this,g=A.gv,w=g.getEnvmap(),h=A._envmapHash,c=A._envmaps,T=j._renderInfo.frame;if(!(this._lastCaptureFrame>=T||g._picking))for(var t in w){var n,S=w[t],G=S.type;switch(G){case"sphere":n=S.image,n!==h[t]&&(vg=R.getImage(n),vg&&(h[t]=n,o(c,t,A.fromEquirectangular(n))));break;case"cube":var l=S.images;if(l&&6===l.length&&(n=l.join(","),n!==h[t])){for(var _=!0,a=0;6>a;a++)if(!R.getImage(l[a])){_=!1;break}_&&(h[t]=n,o(c,t,A.fromCubemap(l)))}break;case"skybox":var E=g.getSkybox();if(E){var v=E.s("shape3d");if(n="sphere"===v?E._id+"_"+E.s("shape3d.image"):E._id+"_"+E.s("front.image"),n!==h[t]){var _;if("sphere"===v)_=R.getImage(E.s("shape3d.image"));else{_=!0;for(var P=["front","back","left","right","top","bottom"],a=0;6>a;a++)if(!R.getImage(E.s(P[a]+".image"))){_=!1;break}}_&&(h[t]=n,o(c,t,A.fromSkybox()))}}break;case"probe":var I=S.pos,X=S.size;if(n=I[0]+"_"+I[1]+"_"+I[2]+"_"+X,n!==h[t]){var d=this._probeCaptureTime[n],Y=Date.now();d||(this._probeCaptureTime[n]=d=Y),Y-d>R.envmapProbeMinWaitTime&&!oe&&!En||Y-d>R.envmapProbeMaxWaitTime?(delete this._probeCaptureTime[n],h[t]=n,o(c,t,A.fromSceneProbe(I,X,S.filter))):g.iv()}}}},x.prototype.resetUniformCache=function(){this._frameUniformCache={}},x.prototype.setEnvmap=function(b,q){var l=b.uuid,z=this._frameUniformCache,s=this._envmaps[q];s&&(s=s.texture),z[l]!==s&&(z[l]=s,b.uEnvMap=s)},x.prototype.fromEquirectangular=function(w){var k=B.Default.getImage(w);return this.rectSize=[1/k.width,1/k.height],w=this.gv.getTexture(w),this.fromTexture(w)},x.prototype.fromCubemap=function(G){var r=this.gv.getGL(),h=r.createTexture();r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_CUBE_MAP,h),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,r.LINEAR);for(var P=[],N=e/3,z=0;6>z;z++)P[z]=R.resizeImage(B.Default.getImage(G[z]),N);return r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+0,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,P[0]),r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+1,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,P[1]),r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+2,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,P[2]),r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+3,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,P[3]),r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+4,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,P[4]),r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+5,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,P[5]),r.bindTexture(r.TEXTURE_CUBE_MAP,r._emptyCubeTexture),this.fromTexture(h,!0)},x.prototype.fromTexture=function(Y,C){var z=this._allocateTargets();this._pingPongRenderTarget||(this._pingPongRenderTarget=this._allocateTargets());var f=this.gv,$=f.getGL(),x=Jm.for($).directState(),m=x.depth.enabled;x.scissor.enabled=!0,x.depth.enabled=!1;var G=f.getViewport($);return this._textureToCubeUV(Y,z,C),this._applyPMREM(z),z.unbind($),f.setViewport($,G[0],G[1],G[2],G[3]),x.depth.enabled=m,x.scissor.enabled=!1,z},x.prototype.fromSkybox=function(){return this._fromCamera(function(J){J.s({"camera.onlySky":!0})})},x.prototype.fromScene=function(X){return this._fromCamera(function(e){e.s({"camera.onlySky":!1}),X&&X(e)})},x.prototype.fromNode=function(K){var _=this.gv.getData3dUI(K),X=_._42;_._42=No;var z=this.gv.getSkybox(),o=K.p3();if(z){var W=z.p3();z.p3(o)}var p=this.fromScene(function(F){F.p3(o)});return _._42=X,z&&z.p3(W),p},x.prototype.fromSceneProbe=function(s,R,c){var X=this.gv,W=X.getSkybox();if(W){var o=W.p3();W.p3(s)}if(c){var Z=X.isVisible;X.isVisible=function(a){var W=c(a);return W!==z?W:Z.call(X,a)}}var Q=this.fromScene(function(E){E.p3(s),E.s("camera.near",R)});return c&&(X.isVisible=Z),W&&W.p3(o),Q},x.prototype._fromCamera=function(K){var b=this.gv,R=b.getCamera();K&&K(R);var r=new Ns(b,e,e,{cube:!0}),m=b.getGL(),f=b.getViewport(m),V=this.setEnvmapByProbeId,Y=this.onBeforeRender;this.setEnvmapByProbeId=function(I){I.envMap=m._emptyTexture},this.onBeforeRender=No,R.attachRenderTarget(r),R.render(b),R.detachRenderTarget(),this.setEnvmapByProbeId=V,this.onBeforeRender=Y,b.setViewport(m,f[0],f[1],f[2],f[3]);var T=this.fromTexture(r.texture,!0);return r.releaseTexture(),T},x.prototype._allocateTargets=function(){return new Ns(this.gv,3*M,3*M,{magFilter:Te.NEAREST,minFilter:Te.NEAREST})},x.prototype._textureToCubeUV=function(z,q,T){var K,U=this.gv;T?null==(K=this._cubemapShader)&&(this._cubemapShader=K=this.createShader(h())):null==(K=this._equirectShader)&&(this._equirectShader=K=this.createShader(u()));var Z=U.getGL();q.bind(Z),this._setViewport(q,0,0,3*M,2*M);var Q=U.getRenderState();Q.useProgram(K);var X=Q.directUniforms(),P=Q.directAttribs();X.envMap=z,T||(X.texelSize=this.rectSize);var L=J[0];P.position=Vi(Z,null,L.vs,I,3),P.uv=Vi(Z,null,L.uv,I,2),P.faceIndex=Vi(Z,null,L.faceIs,I,1),qb(Z,0,L.vs.length/3)},x.prototype._applyPMREM=function(K){for(var x,I,Q,x=1;r>x;x++)I=Math.sqrt(y[x]*y[x]-y[x-1]*y[x-1]),Q=U[(x-1)%U.length],this._blur(K,x-1,x,I,Q)},x.prototype._setViewport=function(E,W,$,m,P){var I=this.gv;I.setViewport(I.getGL(),W,$,m,P),I.getRenderState().directState().scissor.box=[W,$,m,P]},x.prototype._blur=function(x,h,q,$,y){var H=this._pingPongRenderTarget;this._halfBlur(x,H,h,q,$,"latitudinal",y),this._halfBlur(H,x,q,q,$,"longitudinal",y)},x.prototype.createShader=function(P){var u=this.gv;return u.getPostProcessing().createShader(u.getGL(),P).program},x.prototype._halfBlur=function(P,F,T,s,$,u,y){var _=this.gv,V=this._blurMaterial;if("latitudinal"===u||"longitudinal"===u){V||(this._blurMaterial=V=this.createShader(v(d)));var p=_.getGL();F.bind(p);var j=3,A=_.getRenderState();A.useProgram(V);var a,Y,k,R=A.directUniforms(),x=A.directAttribs(),G=L[T]-1,D=isFinite($)?Math.PI/(2*G):2*Math.PI/(2*d-1),o=$/D,S=isFinite($)?1+Math.floor(j*o):d,t=[],q=0;for(a=0;d>a;++a)Y=a/o,k=Math.exp(-Y*Y/2),t.push(k),0==a?q+=k:S>a&&(q+=2*k);for(a=0;a<t.length;a++)t[a]=t[a]/q;R.envMap=P.texture,R.samples=S,R.weights=t,R.latitudinal="latitudinal"===u,y&&(R.poleAxis=y),R.dTheta=D,R.mipInt=E-T;var e=L[s],Y=3*Math.max(0,M-2*e),h=(0===s?0:2*M)+2*e*(s>E-N?s-E+N:0);this._setViewport(F,Y,h,3*e,2*e);var c=J[s];x.position=Vi(p,null,c.vs,I,3),x.uv=Vi(p,null,c.uv,I,2),x.faceIndex=Vi(p,null,c.faceIs,I,1),qb(p,0,c.vs.length/3),F.unbind(p)}};var N=4,E=8,M=Math.pow(2,E),W=[.125,.215,.35,.446,.526,.582],r=E-N+1+W.length,d=20,A=(1+Math.sqrt(5))/2,V=1/A,U=[new Xn(1,1,1),new Xn(-1,1,1),new Xn(1,1,-1),new Xn(-1,1,-1),new Xn(0,A,V),new Xn(0,A,-V),new Xn(V,0,A),new Xn(-V,0,A),new Xn(A,V,0),new Xn(-A,V,0)],m=function(){for(var B=[],j=[],J=[],z=E,L=0;r>L;L++){var C=Math.pow(2,z);j.push(C);var D=1/C;L>E-N?D=W[L-E+N-1]:0==L&&(D=0),J.push(D);for(var x=1/(C-1),M=-x/2,o=1+x/2,q=6,F=[],V=[],Q=[],T=0;q>T;T++){var s=2*(T%3)/3-1,$=T>2?0:-1;F.push(s,$,0,s+2/3,$,0,s+2/3,$+1,0,s,$,0,s+2/3,$+1,0,s,$+1,0),V.push(M,M,o,M,o,o,M,M,o,o,M,o),Q.push(T,T,T,T,T,T)}B.push({vs:new Tb(F),uv:new Tb(V),faceIs:new Tb(Q)}),z>N&&z--}return{_lodPlanes:B,_sizeLods:j,_sigmas:J}}(),J=m._lodPlanes,L=m._sizeLods,y=m._sigmas,e=R.EnvmapTextureSize}();var Ks=["left","front","right","back","top","bottom"],Ls=lp._RenderList=function(q){function m(){s.length=0,b.length=0,U={}}function x(T){var j,s,g,Z,q=T.gv,v=T.data,o=T.shapeModel;if(o){var U,w,A,$=v.s("shape3d.transparent")||v.s("points.transparent");for(ar(o)||(U=tp(o.transparent,v,q),o=[o]),g=0,Z=o.length;Z>g;g++)A=o[g],w=tp(A.transparent,v,q),w===z&&(w=U),w===z&&(w=$),w?s=!0:j=!0}for(g=0,Z=Ks.length;Z>g;g++){var B=T[Ks[g]];B&&(B.transparent?s=!0:j=!0)}q.isLabelVisible(v)&&(T.labelInfo&&(v.s(sm+".transparent")?s=!0:j=!0),T.label2Info&&(v.s(zl+".transparent")?s=!0:j=!0)),q.isNoteVisible(v)&&(T.noteInfo&&(v.s(Si+".transparent")?s=!0:j=!0),T.note2Info&&(v.s(bl+".transparent")?s=!0:j=!0)),T._38o&&(s=j=!0),s||(j=!0),T._renderParams={opaque:j,transparent:s}}function I(z,G){G&&x(z);var E=z.data,i=E._id;if(!U[i]){U[i]=!0;var e=z._renderParams;e&&e.visible!==!1&&(z={ui:z,data:E,z:0,id:i},e.opaque&&s.push(z),e.transparent&&b.push(z))}}function A(B,s){if(b.length>1){for(var N,Y,W=[0,0,0,0],o=0,C=b.length;C>o;o++)N=b[o].data,(Y=N._position)?(W[0]=Y.x,W[1]=N._54O,W[2]=Y.y,W[3]=1,Ng(W,s),b[o].z=W[2]/W[3]):b[o].z=0;b.sort(B||K)}}function r(p){p?(ug(l,e,p,q),ug(W,M,p,q),ug(L,Y,p,q)):(l=this.batchModelMap={},e=this.batchIndexMap={},W=this.polylineModelMap={},M=this.polylineIndexMap={},L=this.wireframeModelMap={},Y=this.wireframeIndexMap={}),this.markBatchInvalid()}function X(k){k?ug(l,e,k,q):(l=this.batchModelMap={},e=this.batchIndexMap={}),this.markBatchInvalid()}function F(Q){Q?ug(W,M,Q,q):(W=this.polylineModelMap={},M=this.polylineIndexMap={}),this.markBatchInvalid()}function H(G){G?ug(L,Y,G,q):(L=this.wireframeModelMap={},Y=this.wireframeIndexMap={}),this.markBatchInvalid()}function v(){return this._batchInvalid}function d(){this._batchInvalid=!0}function i(){this._batchInvalid=null}var s=[],b=[],l={},e={},W={},M={},L={},Y={},U={};return{opaque:s,transparent:b,init:m,push:I,batchModelMap:l,batchIndexMap:e,polylineModelMap:W,polylineIndexMap:M,wireframeModelMap:L,wireframeIndexMap:Y,ivBatch:r,ivModelBatch:X,ivPolylineBatch:F,ivWireframeBatch:H,markBatchInvalid:d,isBatchInvalid:v,onUpdated:i,sort:A}},Ms=lp._RenderLists=function(A){function y(){for(var n in z)z[n].init()}function P(){for(var J in z)z[J].onUpdated()}function v(k,g){k=k||"main";var Z=z[k];return!Z&&g&&(Z=z[k]=new Ls(A)),Z}function f(r,s){var G=r.data.getRenderLayer(),m=v(G,!0);m.push(r,s)}function S(i){for(var j in z)i(z[j])}var z={};return{init:y,onUpdated:P,get:v,push:f,each:S,lists:z}},Ns=lp.RenderTarget=function(f,w,i,M){var n,x=this;null!=w&&w.canvas?(n=w,w=i,i=M,M=arguments[4]):n=f.getGL(),M=M||{},M.cube===!!M.cube,M.samples=M.cube?0:Math.min(f._glCapabilities.maxSamples,M.samples&&M.samples>1&&2===f._webGLVersion?M.samples:0),x.options=M,x.uuid=B.Math.generateUUID(),x.gv=f,x.init(f,n,M),x.format=M.format||Te.RGBA,x.generateMipmaps=!!M.generateMipmaps,x.depthInternalFormat=M.depthFormat||n.DEPTH_COMPONENT16,M.samples&&!f._glCapabilities._maxSamplesChecked?x.setSize(n,w||1,i||1):x.setSize(n,w,i)};T.assign(lp.RenderTarget.prototype,{bind:function(k,Z){var d=this.options;if(d.autoSize){var J=this.gv,s=J.getDevicePixelRatio(),j=J.getWidth()*s,n=J.getHeight()*s;this.setSize(k,j,n)}d.cube?Ol(k,this.frame[Z]):Ol(k,this.options.samples?this._MSAAFbo:this.frame)},unbind:function(x){Mo(x),this.options.samples&&(x.bindFramebuffer(x.READ_FRAMEBUFFER,this._MSAAFbo),x.bindFramebuffer(x.DRAW_FRAMEBUFFER,this.frame),x.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,x.COLOR_BUFFER_BIT,x.NEAREST),x.bindFramebuffer(x.READ_FRAMEBUFFER,null),x.bindFramebuffer(x.DRAW_FRAMEBUFFER,null))},isCube:function(){return this.options.cube},init:function(w,b,E){var B=this,U=E.samples,i=E.cube,k=B.texture=b.createTexture(),d=i?Te.TEXTURE_CUBE_MAP:Te.TEXTURE_2D;b.activeTexture(b.TEXTURE0),b.bindTexture(d,k),b.texParameteri(d,b.TEXTURE_WRAP_S,E.wrapS||b.CLAMP_TO_EDGE),b.texParameteri(d,b.TEXTURE_WRAP_T,E.wrapT||b.CLAMP_TO_EDGE);var h=U?b.NEAREST:b.LINEAR;if(b.texParameteri(d,b.TEXTURE_MIN_FILTER,E.minFilter||h),b.texParameteri(d,b.TEXTURE_MAG_FILTER,E.magFilter||h),b.bindTexture(d,null),i){B.depth=[],B.frame=[];for(var G=0;6>G;G++)B.depth[G]=b.createRenderbuffer(),B.frame[G]=b.createFramebuffer()}else B.depth=b.createRenderbuffer(),B.frame=b.createFramebuffer();B.assureTexture()},assureTexture:function(){var d=this;d.gv._2Oi(d.uuid,d.texture,"default"),B.Default.setImage(d.uuid,null)},releaseTexture:function(){this.gv.deleteTexture(this.uuid)},setSize:function(Y,x,D){var V=this;if(x=Math.round(x),D=Math.round(D),x&&D&&(V.width!==x||V.height!==D)){V.width=x,V.height=D;var y=Y.RENDERBUFFER,q=Y.FRAMEBUFFER,A=V.options.samples,J=V.options.cube,u=J?Te.TEXTURE_CUBE_MAP:Te.TEXTURE_2D;if(A){var P=V.gv._glCapabilities;if(!P._maxSamplesChecked){for(Y.bindRenderbuffer(y,V.depth),Y.getError();A>1&&(Y.renderbufferStorageMultisample(y,A,V.depthInternalFormat,x,D),Y.getError());)A=Math.floor(A>>1);1>=A&&(A=0,Y.texParameteri(u,Y.TEXTURE_MIN_FILTER,V.options.minFilter||Y.LINEAR),Y.texParameteri(u,Y.TEXTURE_MAG_FILTER,V.options.magFilter||Y.LINEAR),Y.renderbufferStorage(y,V.depthInternalFormat,x,D)),P._maxSamplesChecked=!0,P.maxSamples=V.options.samples=A,Y.bindRenderbuffer(y,I)}}if(A&&(V._MSAAFbo||(V._MSAAFbo=Y.createFramebuffer(),V._MSAARbO=Y.createRenderbuffer()),Y.bindRenderbuffer(y,V._MSAARbO),Y.renderbufferStorageMultisample(Y.RENDERBUFFER,A,Y.RGBA8,x,D),Y.bindFramebuffer(q,V._MSAAFbo),Y.framebufferRenderbuffer(q,Y.COLOR_ATTACHMENT0,y,V._MSAARbO),Y.framebufferRenderbuffer(q,Y.DEPTH_ATTACHMENT,y,V.depth),Y.bindFramebuffer(q,null),Y.bindRenderbuffer(y,null)),Y.activeTexture(Y.TEXTURE0),Y.bindTexture(u,V.texture),J)for(var R=Y.TEXTURE_CUBE_MAP_POSITIVE_X,h=0;6>h;h++)V.setupFrameBufferTextureAndDepth(Y,V.frame[h],V.depth[h],R+h);else V.setupFrameBufferTextureAndDepth(Y,V.frame,V.depth,Y.TEXTURE_2D);if(V.generateMipmaps&&(2===gv._webGLVersion||jl.isPOT(x)&&jl.isPOT(D))){Y.generateMipmap(u);var i=V.options.minFilter||(A?Y.NEAREST:Y.LINEAR);Y.texParameteri(u,Y.TEXTURE_MIN_FILTER,i===Y.NEAREST?Y.NEAREST_MIPMAP_NEAREST:Y.LINEAR_MIPMAP_LINEAR)}Y.bindTexture(u,null)}},setupFrameBufferTextureAndDepth:function(k,j,v,$){var S=this,F=S.format;k.texImage2D($,0,F,this.width,this.height,0,F,k.UNSIGNED_BYTE,null),k.bindFramebuffer(k.FRAMEBUFFER,j),k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,$,S.texture,0),this.setupRenderBufferStorage(k,v),k.bindFramebuffer(k.FRAMEBUFFER,null)},setupRenderBufferStorage:function(h,n){var y=this,N=h.RENDERBUFFER;h.bindRenderbuffer(N,n);var U=y.options.samples;U?h.renderbufferStorageMultisample(N,U,y.depthInternalFormat,y.width,y.height):(h.renderbufferStorage(N,y.depthInternalFormat,y.width,y.height),h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,N,n)),h.bindRenderbuffer(h.RENDERBUFFER,null)},toCanvas:function(){var Y=this,N=Y.gv.getGL();Ol(N,Y.frame);var F=Y.width,w=Y.height,O=new Uint8Array(4*F*w);N.readPixels(0,0,F,w,Y.format,N.UNSIGNED_BYTE,O),Mo(N);var M=e.createElement("canvas");M.width=F,M.height=w;var H=M.getContext("2d"),A=H.createImageData(F,w);return A.data.set(O),H.putImageData(A,0,0),M}});var Os=lp.Interactor=function(s){this.gv=this.g3d=s};Xe("Interactor",T,{ms_listener:1,getView:function(){return this.gv.getView()},setUp:function(){this.addListeners()},tearDown:function(){this.removeListeners()},fi:function(r){this.gv.fi(r)},startDragging:function(G){ii(this,G)}});var Ps=lp.DefaultInteractor=function(O){yd(Ps,this,[O])};Xe("DefaultInteractor",Os,{getState:function(){return this._62O},setState:function(f){this._62O=f},getDataInfoAt:function(D,p){var _=this.gv,V=_.getDataInfoAt(D);if(!_.isBlockSelectable()||!V||!V.data)return V;if(!p&&_.isSelected(V.data))return V;for(var x=V.data;(x=x.getParent())&&x instanceof B.Block&&_.isSelectable(x);){var U=_.isSelected(x);if(U&&p)break;if(V={data:x,part:V.part},U&&!p)break}return V},handle_contextmenu:function(n){cl(n)},handle_mousewheel:function(y){this.gv.handleScroll(y,y.wheelDelta/40)},handle_DOMMouseScroll:function(y){2===y.axis&&this.gv.handleScroll(y,-y.detail)},handle_keydown:function(r){this.gv.handleKeyDown(r)},handle_mousedown:function(t){this.handle_touchstart(t)},handle_touchstart:function(M){cl(M);var l=this,j=l.gv,$=fb(M),S=l.getDataInfoAt(M),C=S?S.data:I,y=S?S.part:I,F=j.sm(),t=Om(M),s=Gg(M);j.setFocus(M)&&(l._62O=I,l._57I=I,l.pendingClickThrough=I,l.__lastClientPoint__=Po(M),C?Bl(M)?F.co(C)?F.rs(C):F.as(C):F.co(C)?C instanceof Xl&&C.isClickThroughEnabled()&&fb(M)&&(l.pendingClickThrough=Po(M)):F.ss(C):$&&(Bl(M)?j.isRectSelectable()&&(l._62O=Eg):l._57I=Po(M)),l._31Q&&(nk(l._31Q),delete l._31Q,delete l._32Q),l._62O||(j.isFirstPersonMode()&&(Ac(M)||Ie(M)||s>2?l._62O="pan":j.isMouseRoamable()||gp(M)?(l._62O="roaming",l.foward=t&&fb(M),l._32Q=xn(),l._31Q=ed(l.tick,l)):$||(l._62O="roaming")),l._62O||($&&t&&ht[y]?(l._62O=y,l.p3=C.p3()):$&&t&&Dg(C)&&j.isSelected(C)?j.isMovable(C)?(l._62O="move",l.p3=C.p3(),l.movedata=C):j._39Q(C)&&(l._62O="none"):gp(M)&&(s>2?l._62O="pan":2===s&&(l.dist=ej(M),l._62O="pinch")))),l.point=j.lp(M),ii(l,M),Fe(M)?j.handleDoubleClick(M,C,y):j.handleClick(M,C,y))},tick:function(){var L=this,u=L.gv,I=u._moveStep;L.point&&u.isWalkable()&&(L._32Q&&(I*=(xn()-L._32Q)/50),u.walk(L.foward?I:-I),L._32Q=xn(),L._31Q=ed(L.tick,L))},handle_mouseup:function(D){this.handle_touchend(D)},handle_touchend:function(L){var u=this._57I;if(u&&(Jc(u,Po(L))<=1&&this.gv.sm().cs(),this._57I=I),u=this.pendingClickThrough){if(Jc(u,Po(L))<=1){var V=this.getDataInfoAt(L);V&&V.data instanceof Xl&&V.data.isClickThroughEnabled()&&(V=this.getDataInfoAt(L,!0),V&&(L.clickThrough=!0,this.gv.sm().ss(V.data)))}this.pendingClickThrough=null}},handleWindowMouseMove:function(N){this.handleWindowTouchMove(N)},handleWindowTouchMove:function(P){var m,F,T=this,y=T.gv,g=T._62O,K=T.point,A=y.dm(),M=y.lp(P),j=M.x-K.x,O=M.y-K.y,I=y.getWidth(),H=y.getHeight();if(I&&H){var W=Po(P),$=tn(y,W,T.__lastClientPoint__),B=Jc({x:0,y:0},$),w=-f*j/I,Z=-f*O/H;if("roaming"===g)T.rotate(P,w/2,Z/2);else if(g===bt||g===ct||g===dt)y._86O||A.beginTransaction(),y.fi({kind:y._86O?"betweenEditRotation":"beginEditRotation",event:P}),y._86O=1,y.sm().each(function(m){if(Dg(m)&&y.isRotationEditable(m)){var o=i(w)>i(Z)?w:Z;g===bt?m.setRotationX(m.getRotationX()+o):g===ct?m.setRotationY(m.getRotationY()+o):g===dt&&m.setRotationZ(m.getRotationZ()+o)}});else if("move"===g||ht[g]){if(g===et||g===ft||g===gt)y._87O||A.beginTransaction(),y.fi({kind:y._87O?"betweenEditScale":"beginEditScale",event:P}),y._87O=1;else{if(!y._moving){if(B<R.touchMoveThreshold)return;A.beginTransaction()}y.fi({kind:y._moving?"betweenMove":"beginMove",event:P}),y._moving=1}var N,e=T.p3,U=y.getPositionInfo(e),L=yk(y);N=g===$s?"x":g===_s?"y":g===at?"z":g===et?"sx":g===ft?"sy":g===gt?"sz":y.getMoveMode(P,T.movedata),j=j/I*U.width,O=-1*O/H*U.height;var X,k,h=[L[0]*j,L[4]*j,L[8]*j],r=[L[1]*O,L[5]*O,L[9]*O],q=h[0]+r[0],S=h[1]+r[1],z=h[2]+r[2],J=[e[0]+q,e[1]+S,e[2]+z],E=Er(y.getEye(),J,!0);if("xyz"===N?(X=J,y.moveSelection(q,S,z)):"xz"===N?(X=As(y,e,[0,1,0],J),X&&y.moveSelection(X[0]-e[0],0,X[2]-e[2])):"xy"===N?(X=As(y,e,[0,0,1],J),X&&y.moveSelection(X[0]-e[0],X[1]-e[1],0)):"yz"===N?(X=As(y,e,[1,0,0],J),X&&y.moveSelection(0,X[1]-e[1],X[2]-e[2])):"x"===N||"sx"===N?(E[0]=0,X=As(y,e,E,J),X&&(k=X[0]-e[0],"x"===N?y.moveSelection(k,0,0):y.sm().each(function(u){Dg(u)&&y.isSizeEditable(u)&&(m=u.getScaleX()+k/100,F=m/u.getScaleX(),u.setScaleX(m),Ac(P)&&(u.setScaleY(u.getScaleY()*F),u.setScaleTall(u.getScaleTall()*F)))}))):"y"===N||"sy"===N?(E[1]=0,X=As(y,e,E,J),X&&(k=X[1]-e[1],"y"===N?y.moveSelection(0,k,0):y.sm().each(function(_){Dg(_)&&y.isSizeEditable(_)&&(m=_.getScaleTall()+k/100,F=m/_.getScaleTall(),_.setScaleTall(m),Ac(P)&&(_.setScaleY(_.getScaleY()*F),_.setScaleX(_.getScaleX()*F)))}))):("z"===N||"sz"===N)&&(E[2]=0,X=As(y,e,E,J),X&&(k=X[2]-e[2],"z"===N?y.moveSelection(0,0,k):y.sm().each(function(X){Dg(X)&&y.isSizeEditable(X)&&(m=X.getScaleY()+k/100,F=m/X.getScaleY(),X.setScaleY(m),Ac(P)&&(X.setScaleX(X.getScaleX()*F),X.setScaleTall(X.getScaleTall()*F)))}))),!X)return;T.p3=X}else if(g===Eg){var G=T.div;G||(G=T.div=eg(),Ul(T.getView(),G),G.op=K,G.style.background=y.getRectSelectBackground()),y.fi({kind:y._rectSelecting?"betweenRectSelect":"beginRectSelect",event:P}),y._rectSelecting=1,G.rect=Gj(G.op,M),Ae(G,G.rect)}else if("pinch"===g&&2===Gg(P)){y.fi({kind:y._pinching?"betweenPinch":"beginPinch",event:P}),y._pinching=1;var k=ej(P);y._lastZoomLP||(y._lastZoomLP=mn(P)),y.handlePinch(k,T.dist),T.dist=k}else"pan"===g||Ac(P)||Ie(P)?T.pan(P,j,O):"none"===g||y.isFirstPersonMode()||T.rotate(P,w,Z);T.point=M}},pan:function(r,a,i){var u=this.gv;if(u.isPannable()){var S=u.getWidth(),k=u.getHeight();if(!S||!k)return;var V=u.getCenterInfo(),T=a/S*V.width,A=-1*i/k*V.height;u.fi({kind:u._panning?"betweenPan":"beginPan",event:r}),u._panning=1,u.pan(-T,-A)}},rotate:function(P,g,U){var T=this.gv;T.isRotatable()&&(T.fi({kind:T._rotating?"betweenRotate":"beginRotate",event:P}),T._rotating=1,T.rotate(g,U))},handleWindowMouseUp:function(L){this.handleWindowTouchEnd(L)},handleWindowTouchEnd:function(V){var z=this,k=z.gv,U=k.dm(),c=z.div;if(c){var N=k.getDatasInRect(c.rect);if(!N.isEmpty()){var C=k.sm(),G=C.toSelection(),i=Ac(V),t=V.altKey;N.each(function(P){C.co(P)?(!i||i&&t)&&G.remove(P):(!t||i&&t)&&G.add(P)}),C.ss(G)}Pp(c)}k._moving&&(delete k._moving,k.fi({kind:"endMove",event:V}),k.onMoveEnded(),U.endTransaction()),k._panning&&(delete k._panning,k.fi({kind:"endPan",event:V}),k.onPanEnded()),k._rotating&&(delete k._rotating,k.fi({kind:"endRotate",event:V}),k.onRotateEnded()),k._86O&&(delete k._86O,k.fi({kind:"endEditRotation",event:V}),U.endTransaction()),k._87O&&(delete k._87O,k.fi({kind:"endEditScale",event:V}),U.endTransaction()),k._pinching&&(delete k._pinching,k.fi({kind:"endPinch",event:V}),k.onPinchEnded()),k._rectSelecting&&(delete k._rectSelecting,k.fi({kind:"endRectSelect",event:V}),k.onRectSelectEnded()),k._walking&&(delete k._walking,k.fi({kind:"endWalk",event:V}),k.onWalkEnded()),k._lastZoomLP=k._lastZoomHit=null,z.dist=z.point=z._62O=z.p3=z.movedata=z.div=z._57I=z.pendingClickThrough=z._32Q=z._31Q=z.foward=I,z.__lastClientPoint__=I}});var Qs=lp.MapInteractor=function(n){yd(Qs,this,[n]),this._keepHorizon=!0,this._threshold=2,this._touchScaleThreshold=.05,this._touchRotateThreshold=.03,this._touchScaleCheckAccuracy=.01,this._panButton="right",this._minPhi=0,this._maxPhi=5*Math.PI/12};Xe("MapInteractor",Os,{setUp:function(){Qs.superClass.setUp.call(this);var F=this.gv;this.__oldMinPhi__=F.getRotateMinPhi(),this.__oldMaxPhi__=F.getRotateMaxPhi(),F.setRotateMinPhi(this._minPhi),F.setRotateMaxPhi(this._maxPhi)},tearDown:function(){Qs.superClass.tearDown.call(this);var _=this.gv;_.setRotateMinPhi(this.__oldMinPhi__),_.setRotateMaxPhi(this.__oldMaxPhi__),delete this.__oldMinPhi__,delete this.__oldMaxPhi__},handle_contextmenu:function(A){cl(A)},handle_mousewheel:function(u){this.gv.handleScroll(u,u.wheelDelta/40)},handle_DOMMouseScroll:function(s){2===s.axis&&this.gv.handleScroll(s,-s.detail)},handle_keydown:function(k){this.gv.handleKeyDown(k)},handle_mousedown:function(q){this.handle_touchstart(q)},handle_touchstart:function(h){cl(h);var u=this,c=u.gv;if(c.setFocus(h)){var i=c.getDataInfoAt(h),M=i?i.data:I,q=i?i.part:I;u.__lastClientPoint__=Po(h);var t=u.editing={point:c.lp(h),data:M,part:q};gp(h)?t.touch=!0:(t.touch=!1,t.clickLeft=fb(h),t.pan=Ie(h)?!0:"left"===this.panButton===t.clickLeft),M&&c._39Q(M)&&(t.preventDefault=!0),ii(u,h),Fe(h)?c.handleDoubleClick(h,M,q):c.handleClick(h,M,q)}},handle_mouseup:function(n){this.handle_touchend(n)},handle_touchend:function(){},handleWindowMouseMove:function(v){this.handleWindowTouchMove(v)},handleWindowTouchMove:function(F){var _=this,S=_.gv,B=_.editing;if(B){var g=S.lp(F),y=B.point,X=g.x-y.x,O=g.y-y.y;if(!B.moved){if(Math.abs(X)<_.threshold&&Math.abs(O)<_.threshold&&!(F.touches&&F.touches.length>1))return;B.moved=!0}if(!B.preventDefault){B.point=g;var t=B.part;if(ht[t]){var K=B.data,q=S.dm(),p=S.getWidth(),Y=S.getHeight(),r=-f*X/p,z=-f*O/Y;if(t===bt||t===ct||t===dt){S._86O||q.beginTransaction(),S.fi({kind:S._86O?"betweenEditRotation":"beginEditRotation",event:F}),S._86O=1;var w=i(r)>i(z)?r:z;S.sm().each(function(M){Dg(M)&&S.isRotationEditable(M)&&(t===bt?M.setRotationX(M.getRotationX()+w):t===ct?M.setRotationY(M.getRotationY()+w):t===dt&&M.setRotationZ(M.getRotationZ()+w))})}else{var N=K.p3(),D=S.getPositionInfo(N);X=X/p*D.width,O=-1*O/Y*D.height;var E,A=yk(S),d=[A[0]*X,A[4]*X,A[8]*X],P=[A[1]*O,A[5]*O,A[9]*O],Z=d[0]+P[0],e=d[1]+P[1],s=d[2]+P[2],C=[N[0]+Z,N[1]+e,N[2]+s],o=Er(S.getEye(),C,!0);if(t===et||t===ft||t===gt){if(S._87O||q.beginTransaction(),S.fi({kind:S._87O?"betweenEditScale":"beginEditScale",event:F}),S._87O=1,E=As(S,N,o,C)){var T,v=0,M=["X","Y","Tall"];t===et?T="X":t===ft?(T="Tall",v=1):t===gt&&(T="Y",v=2),M.splice(M.indexOf(T),1);var Q=Ac(F),n=(E[v]-N[v])/100;S.sm().each(function(t){if(Dg(t)&&S.isSizeEditable(t)){var E=t["getScale"+T](),G=E+n;if(t["setScale"+T](G),Q){var e=G/E;M.forEach(function(k){t["setScale"+k](t["getScale"+k]()*e)})}}})}}else if(t===$s||t===_s||t===at){if(!S._moving){var u=Po(F),H=tn(S,u,_.__lastClientPoint__),G=Jc({x:0,y:0},H);if(G<R.touchMoveThreshold)return;q.beginTransaction()}S.fi({kind:S._moving?"betweenMove":"beginMove",event:F}),S._moving=1;var v=0;if(t===$s?v=0:t===_s?v=1:t===at&&(v=2),o[v]=0,E=As(S,N,o,C)){var n=E[v]-N[v],x=[0,0,0];x[v]=n,S.moveSelection.apply(S,x)}}}}else if(B.touch){var c=F.touches.length;if(2!==c)_.pan(F,X,O);else{if(1>=c)return;var W=F.touches,m={x:W[0].clientX,y:W[0].clientY},U={x:W[1].clientX,y:W[1].clientY},k={x:U.x-m.x,y:U.y-m.y},l=B.lastCenter,b=Math.atan2(k.y,k.x),h=B.theta,j=0;h==I?h=B.theta=b:(j=b-h,B.thetaStarted||Math.abs(j)>_.touchRotateThreshold?(B.thetaStarted=!0,B.theta=b):j=0);var a=L*(m.y+U.y)/2/S.getHeight(),$=B.phi,V=0;$==I?$=B.phi=a:(V=a-$,B.phiStarted||Math.abs(V)>_.touchRotateThreshold?(B.phiStarted=!0,B.phi=a):V=0);var J,el=Math.sqrt(k.x*k.x+k.y*k.y),ac=B.vlen;if(ac){var Ik=m.x-l.x,bj=m.y-l.y,gs=U.x-l.x,er=U.y-l.y,Fj=Math.sqrt(Ik*Ik+bj*bj),Rd=Math.sqrt(gs*gs+er*er),_g=ac/2,tm=_._sign2(Fj-_g),ef=_._sign2(Rd-_g);0>tm*ef||0===tm&&0===ef?(J=1,B.vlen=el):(J||(J=el/ac),B.scaleStarted||Math.abs(J-1)>_.touchScaleThreshold?(B.vlen=el,B.scaleStarted=!0):J=1)}else ac=B.vlen=el,J=1;1!==J&&S.setZoom(J),(V||j)&&_.rotate(F,j,-V),B.lastCenter={x:(U.x+m.x)/2,y:(U.y+m.y)/2}}}else if(B.pan)_.pan(F,X,O);else{var p=S.getWidth(),Y=S.getHeight();if(!p||!Y)return;var r=-f*X/p,z=-f*O/Y;_.rotate(F,r,z)}}}},_sign2:function(l){return Math.abs(l)<this._touchScaleCheckAccuracy?0:l>0?1:-1},handleWindowMouseUp:function(j){this.handleWindowTouchEnd(j)},getDataInfoAt:function(D,p){var q=this.gv,C=q.getDataInfoAt(D);if(!q.isBlockSelectable()||!C||!C.data)return C;if(!p&&q.isSelected(C.data))return C;for(var m=C.data,I=C.part;(m=m.getParent())&&m instanceof B.Block&&q.isSelectable(m);){var K=q.isSelected(m);if(K&&p)break;if(C={data:m,part:I},K&&!p)break}return C},handleWindowTouchEnd:function(j){var O=this,m=O.editing;if(O.editing=null,m){var J=O.gv;if(m.moved||!m.clickLeft&&!m.touch)J._panning=null,J._rotating=null,J.fi({kind:m.pan?"endPan":"endRotate",event:j});else{var h=O.getDataInfoAt(j),A=h&&h.data;A instanceof Xl&&A.isClickThroughEnabled()&&(h=O.getDataInfoAt(j,!0),h&&(A=h.data)),A?J.sm().setSelection([A]):J.sm().clearSelection()}var v=J.dm();J._moving&&(delete J._moving,J.fi({kind:"endMove",event:j}),J.onMoveEnded(),v.endTransaction()),J._86O&&(delete J._86O,J.fi({kind:"endEditRotation",event:j}),v.endTransaction()),J._87O&&(delete J._87O,J.fi({kind:"endEditScale",event:j}),v.endTransaction())}},pan:function(u,r,k){var M=this,T=M.gv;if(T.isPannable()){var X=T.getWidth(),s=T.getHeight();if(X&&s){var p=T.getCenterInfo(),Q=-r/X*p.width,y=1*k/s*p.height;T.fi({kind:T._panning?"betweenPan":"beginPan",event:u}),T._panning=1;var x=M.keepHorizon,w=M.editing.touch;if((w&&u.touches&&u.touches.length>1||!w&&Ac(u))&&(x=!x),!x)return T.pan(Q,y);if(Q||y){var n=yk(T),$=[n[0]*Q,n[4]*Q,n[8]*Q],j=[n[1],0,n[9]],G=Math.sqrt(j[0]*j[0]+j[2]*j[2]);G&&(j=[j[0]/G*y,0,j[2]/G*y]);var Y=$[0]+j[0],S=$[1]+j[1],L=$[2]+j[2],F=T._center,C=T._eye;F[0]+=Y,F[1]+=S,F[2]+=L,C[0]+=Y,C[1]+=S,C[2]+=L,T.fp(Cc,I,C),T.fp(Nq,I,F)}}}},rotate:function(M,i,p){var Z=this,y=Z.gv;if(y.isRotatable()){var E=y._center,T=y._eye,K=Er(T,E),d=Wd(a(K[0]*K[0]+K[2]*K[2]),K[1]),A=oq(y,d+p);p=A-d,y.fi({kind:y._rotating?"betweenRotate":"beginRotate",event:M}),y._rotating=1,y.rotate(i,p)}}}),T.defineProperties(Qs.prototype,{panButton:{get:function(){return this._panButton},set:function(m){this._panButton=m}},minPhi:{get:function(){return this._minPhi},set:function(p){this.gv.setRotateMinPhi(this._minPhi=p)}},maxPhi:{get:function(){return this._maxPhi},set:function(d){this.gv.setRotateMaxPhi(this._maxPhi=d)}},keepHorizon:{get:function(){return this._keepHorizon},set:function(s){this._keepHorizon=s}},threshold:{get:function(){return this._threshold},set:function(m){this._threshold=m}},touchScaleThreshold:{get:function(){return this._touchScaleThreshold},set:function(x){this._touchScaleThreshold=x}},touchRotateThreshold:{get:function(){return this._touchRotateThreshold},set:function(z){this._touchRotateThreshold=z}}});var Rs,Ss="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAEyUlEQVRYR62XW0xcVRSG/58cmIG2HmstE9N4SX2xtVqBCISoFS/RmDSpKQSvTWNixUStQSqVyBQYJUGttrQVtYkPatuQPmhivMUHqbUBZ2itl1qjTzZpImNUZhDLsUeWWXgOOd2cgcGyk3mYs/de69trr70uxP8YIlJKMi0i9wIgyf0iEiM5PFdxzGeDiBQAuB7AjQBuALCN5NcGQDmANgBfeL8UyYnZ5M8KICJ3AXgAwAlfOMl/VHAQwPtveYAKuQLA2yQ/ngliRgAR2QogA2AvSdcUZAIE50VEYR4BsIDkC7kgQgFE5GIAuwDsJnkk1+aZAPw9IqLX1gjgcZK/m7KmAXjK4wBaSf4ZplxEIgCuA3Cz3gSAfgDHSf6dY/0FAJ4D0G5ChAEcAPBwmHIRqXNd90nLsiocx/k+k8n8oK/Atu2rIpHIStd1v7QsawfJd0Ouywawh6T609Q4B8C788NhZnddt29sbGxBd3f39q6urtNhJ43H48uam5u3lJSUjFiWdV8IxE0Aqki+6M9NAXjefjnJXsOZogBGBgYGttbU1Hw427PS+cHBwbVVVVUJAItJOoa8xwD8RPIT/T4J4L3zfQAeNL1dRMZra2ur+/v7/8pHub+mvr7+wr6+vs8KCgoWGABFAN4EsEHjhA9QBeA2ks8HF6vZk8nkQL4nNwGTyeTa8vLycsuy7jcg1Mk/IpnyAZoBaOQ6FHg+ddlsdqNt201zObm5NpvN7ly0aNHrJN8LyL4FwGqSr/gAOrnej3C60HXdw/F4PJ7L4fKFSiQSl7W0tLQVFRWtCQDoNRwguZ6aWABcorE9sEDf+QjJ1fkqmmmdiHwHoCToXyKiceR0rkhY5TjOq9FoVLPdeY/x8fG+SCSySe/cFKYWCFOyPJ1Or4zFYh3nrR3A8PBwe2lp6TcAfg4DmBYwAFyRTqdXxWKx9nkE+DYUIEyBiFQ6jvNaNBq9Zz4AZruCGIBlJI8ZXpolee18AORwwgoAp/xnqMmjPuilZ8+ePZRIJNo7OztD436+YB0dHZe2trY+W1hYWGsccD/JOh/gKQBHSWpanRwicnc2m91k2/bmfJWFrRsdHd29cOHCXSTfD8i+FcA1JHcEQ/HtJDVnTw3XdfcPDQ0dra6unto8F5hUKrWurKxslWVZG4L7RGQbgA9IDgWT0VsANprJaGJi4kxDQ8OagwcPjsxFeWNj49Le3l6N91qMTA2vmNnr6fovGXkmvxPAlST3hGz4LZVKbausrMzLEnryioqKNpJLzCpJRJ4AcJLkp6rHLEieBjBA8rB5Wtd1942NjS3p6el5qa2t7VSYNdThmpqaWoqLi38xze4dUku4CpLb/f1hJZnWBY+SzJpKRGSdV5LVOI5zIpPJnNQ1tm2viEQiV7uue8SyrJeDDhew8GIAO0me4w9hABdp8ahNBkktyacNr+Qu84pSndfX81VY6e6dXJV3AoiT/CMoMFcyUogeAG+Q/DyX8+VZlqvZHwKw2VQ+zQdCTL4FwBkPZFrJPUtjoildG5PC4J2bOvJpze7QWhHAj4HWbBImpDXTQsPvH5cDeMf39lxWnBXAU6TNqcZu7fn0lyB53GhOdf6ZQHN6bF6a0xxOuJTkrwbA5LdcJ831/V8SOUYQxYGhRwAAAABJRU5ErkJggg==",Ts=32,Us=lp.GlobeInteractor=function(C,Z){yd(Us,this,[C]);
var O,E=Z.radius||6378137,v=this,h=null;Rs||(Rs=eg(),Rs.style.border="",Rs.style.backgroundImage="url("+Ss+")");var M=new Hm,k=new Xn,D=new Xn,V=new Xn,z=new Sp,t="number"==typeof E?{x:E,y:E,z:E}:E,L={center:new Xn(0,0,0),radius:t},n=function($){C._81O=null;var X=C.getHitPosition($,C.getCenter(),k.copy(C.getEye()).sub(D.copy(C.getCenter())).toArray());return z.origin.copy(C.getEye()),z.direction.copy(X).sub(z.origin).normalize(),z.intersectEllipsoid(L)},A=function(H,V){C._81O=null,z.origin.copy(C.getEye());for(var Q,n,X=C.getCenter(),m=k.copy(C.getEye()).sub(D.copy(C.getCenter())).toArray(),W=1,G=16,A=0,O=1,J={x:0,y:0};G--;){if(J.x=V.x+(H.x-V.x)*W,J.y=V.y+(H.y-V.y)*W,Q=C.getHitPosition(J,X,m),z.direction.copy(Q).sub(z.origin).normalize(),n=z.intersectEllipsoid(L),n&&1===W)return{hit:n};n?A=W:O=W,W=(A+O)/2}return{hit:n,out:1>W}},X=function(u,I){if(h){var o=Date.now();h.deltaTime=h.lastTime?o-h.lastTime:1e3,h.lastTime=o,h.lastAxis=u,h.lastAngle=I}I&&(M.setFromAxisAngle(u,I),C.setEye(k.copy(C.getEye()).applyQuaternion(M).toArray()),C.setCenter(k.copy(C.getCenter()).applyQuaternion(M).toArray()),C.setUp(k.copy(C.getUp()).applyQuaternion(M).toArray()))};v._showCrossIcon=function(W){Ul(v.getView(),Rs),Ae(Rs,{x:W.clientX-Ts/2,y:W.clientY-Ts/2,width:Ts,height:Ts})},v._hideCrossIcon=function(){Pp(Rs)},v._scrollImpl=function(q,k){h={point:C.lp(q),screen:Po(q),hit:n(q),type:"right"},h.hitNormalize=h.hit?h.hit.clone().normalize():new Xn;var D={clientX:h.screen.x,clientY:h.screen.y+10*k};v._handleMoveImpl(D),v._endMoveImpl(D)},v._startMoveImpl=function(r){O&&(O.stop(!0),O=null),h={point:C.lp(r),screen:Po(r),hit:n(r)},h.hitNormalize=h.hit?h.hit.clone().normalize():new Xn,gp(r)?1===r.touches.length?h.hit&&(h.type="left"):2===r.touches.length&&(h.type="touch2"):(fb(r)?h.hit&&(h.type="left"):Ne(r)?h.type="right":Ie(r)&&h.hit&&(h.type="middle"),!h.hit||"right"!==h.type&&"middle"!==h.type||v._showCrossIcon(r)),h.type&&ii(v,r)},v._handleMoveImpl=function(L){if(h)switch(h.type){case"left":return v._handleLeft(L);case"right":return v._handleRight(L);case"middle":return v._handleMiddle(L);case"touch2":return v._handleTouch2(L)}},v._endMoveImpl=function(){if(h){if(this._hideCrossIcon(),"left"===h.type||"middle"===h.type){var B=1e3*(h.lastAngle/(h.deltaTime||30)),i=h.lastAxis,k=h.lastTime,T=function(){var c=Date.now(),n=(c-k)/1e3;return k=c,B*=Math.pow(Math.abs(v.decelerationRate),3*n),Math.abs(B)<.01?(B=0,O&&O.stop(),void 0):(X(i,B*n),void 0)};O=$h({action:function(){T(arguments)},duration:5e3})}h=null}},v._handleLeft=function(w){if(!h.finished){var P=Po(w),c=A(P,h.lastScreen||h.screen);if(h.lastScreen=P,!c.hit)return h.finished=!0,v._endMoveImpl(w),void 0;var D=c.hit;D.normalize();var J=h.hitNormalize,W=Math.acos(D.dot(J)),L=D.cross(J).normalize();X(L,W),c.out&&(h.finished=!0,v._endMoveImpl(w))}},v._handleRight=function(q){var s=h.lastScreen||h.screen,K=s.y;s=h.lastScreen=Po(q);var g=s.y,b=g-K;if(b){var x=Math.min(.5,b*v.scaleSpeed);k.copy(C.getEye());var S=h.hit;S||(S=k.clone().divide(t).normalize().multiply(t)),D.copy(k).lerp(S,x),C.setEye(D.toArray()),k.copy(C.getUp()),D.normalize();var M=k.clone().cross(D).normalize();if(V.copy(C.getCenter()),V.sub(M.multiplyScalar(V.dot(M))),C.setCenter(V.toArray()),h.hit){var R=n(h.screen),f=h.hitNormalize;if(R){R.normalize();var B=Math.acos(R.dot(f)),W=R.cross(f).normalize();B&&X(W,B)}}}};var B=function(q){return Math.abs(q)<.01?0:q>0?1:-1};v._handleTouch2=function(G){var L=G.touches.length;if(2===L){var a=G.touches,Q={x:a[0].clientX,y:a[0].clientY},P={x:a[1].clientX,y:a[1].clientY},F={x:P.x-Q.x,y:P.y-Q.y},n=h.lastCenter,p=Math.atan2(F.y,F.x),q=h.theta,K=0;q==I?q=h.theta=p:(K=p-q,h.thetaStarted||Math.abs(K)>.03?(h.thetaStarted=!0,h.theta=p):K=0);var o,y=Math.sqrt(F.x*F.x+F.y*F.y),Y=h.vlen;if(Y){var u=Q.x-n.x,k=Q.y-n.y,s=P.x-n.x,l=P.y-n.y,c=Math.sqrt(u*u+k*k),O=Math.sqrt(s*s+l*l),t=Y/2,T=B(c-t),r=B(O-t);0>T*r||0===T&&0===r?(o=1,h.vlen=y):(o||(o=y/Y),h.scaleStarted||Math.abs(o-1)>.05?(h.vlen=y,h.scaleStarted=!0):o=1)}else Y=h.vlen=y,o=1;var F=D.copy(C.getEye()).clone();1!==o&&C.setEye(F.setLength((F.length()-E)/o+E).toArray()),K&&X(F.normalize(),K),h.lastCenter={x:(P.x+Q.x)/2,y:(P.y+Q.y)/2}}},v._handleMiddle=function(N){var U=Po(N),y=h.screen;h.screen=U;var T=(U.y-y.y)/180*Math.PI*v.rollSpeed;D.copy(C.getCenter()).sub(k.copy(C.getEye())).normalize(),k.copy(C.getUp()).cross(D).normalize(),D.copy(C.getEye()).sub(h.hit).applyAxisAngle(k,T).add(h.hit);var E=D.clone();D.copy(C.getCenter()).sub(h.hit).applyAxisAngle(k,T).add(h.hit);var L=D.clone(),t=D.copy(C.getUp()).applyAxisAngle(k,T).clone(),o=!1;T>0&&(V.copy(t),D.copy(L).sub(E).normalize(),k.copy(E).multiplyScalar(-1).normalize(),k.dot(V)-D.dot(V)>0&&(o=!0)),o||V.copy(h.hit).sub(E).dot(h.hitNormalize)>=0&&(o=!0),o||(C.setEye(E.toArray()),C.setCenter(L.toArray()),C.setUp(t.toArray()));var $=-(U.x-y.x)/180*Math.PI*v.rotateSpeed;X(h.hitNormalize,$)}};Xe("GlobeInteractor",Os,{handle_contextmenu:function(X){cl(X)},handle_mousewheel:function(U){this._scrollImpl(U,U.wheelDelta/40)},handle_DOMMouseScroll:function(X){2===X.axis&&this._scrollImpl(X,-X.detail)},handle_keydown:function(A){this.gv.handleKeyDown(A)},handle_mousedown:function(r){this.handle_touchstart(r)},handle_touchstart:function(o){cl(o);var X=this.gv;if(X.setFocus(o)){var i=X.getDataInfoAt(o),E=i?i.data:I;E&&X.isInteractive(E)||this._startMoveImpl(o);var Z=i?i.part:I;Fe(o)?X.handleDoubleClick(o,E,Z):X.handleClick(o,E,Z)}},handle_mouseup:function(X){this.handle_touchend(X)},handle_touchend:function(){},handleWindowMouseMove:function(Q){this.handleWindowTouchMove(Q)},handleWindowTouchMove:function(L){this._handleMoveImpl(L)},handleWindowMouseUp:function(h){this.handleWindowTouchEnd(h)},handleWindowTouchEnd:function(V){this._endMoveImpl(V)}}),T.defineProperties(Us.prototype,{rotateSpeed:{get:function(){return this._rotateSpeed||.3},set:function(x){this._rotateSpeed=x}},rollSpeed:{get:function(){return this._rollSpeed||.1},set:function(f){this._rollSpeed=f}},scaleSpeed:{get:function(){return this._scaleSpeed||.002},set:function(b){this._scaleSpeed=b}},decelerationRate:{get:function(){return this._decelerationRate||.04},set:function(M){this._decelerationRate=M}}});var Vs=function(Y){var y=2147483648|Y;return[(255&y>>16)/255,(255&y>>8)/255,(255&y)/255,(255&y>>24)/255]},Ws=function($){this.gv=$,this.gv.pickColorMap={_pickIdUsed:2e3}};Lp(Ws,T,{_iv:!0,iv:function(){this._iv=!0},get:function(t,N,K){this.validate();var S=this,X=S.gv.getGL();if(!X)return I;var o,F,j=S._resolution,n=Math.round(t.x*j),v=Math.ceil(t.width*j),A=Math.ceil(t.height*j),y=S.height-Math.round(t.y*j)-A,i=C(v/2),e=new Uint8Array(4*v*A),l=0,D=e.length,Y=N?I:new Gk,R=N?I:{};if(Ol(X,S.frame),X.readPixels(n,y,v,A,X.RGBA,X.UNSIGNED_BYTE,e),Mo(X),N){for(;i>=l;l++)for(var L=i-l,z=i+l,d=L;z>=d;d++)for(var E=L;z>=E;E++)if((d===L||d===z||E===L||E===z)&&(o=S.info(e,4*(d*v+E)))){if(K&&K(o)===!1)continue;return o}}else for(;D>l;l+=4)if(o=S.info(e,l)){if(K&&K(o)===!1)continue;F=o.data,R[F._id]||(Y.add(F),R[F._id]=F)}return Y},info:function(i,r){return this.gv.pickColorMap[(i[r]<<16)+(i[r+1]<<8)+i[r+2]+((127&i[r+3])<<24)]},getResolution:function(){return this._resolution},onContextLost:function(){this.texture=null,this.width=this.height=-1},validate:function(){var m=this,U=m.gv,k=U.getGL();if(k){var R=m._resolution=U._pickerResolution*U.getDevicePixelRatio(),$=Math.round(R*U.getWidth()),M=Math.round(R*U.getHeight()),O=k.RGBA,T=k.TEXTURE_2D,K=k.RENDERBUFFER,l=k.FRAMEBUFFER;if(m.texture||(m.texture=Qc(k),m.render=k.createRenderbuffer(),m.frame=k.createFramebuffer()),(m.width!==$||m.height!==M)&&(k.activeTexture(k.TEXTURE0),Eb(k,m.texture),k.texImage2D(T,0,O,$,M,0,O,k.UNSIGNED_BYTE,I),Ln(k,k.TEXTURE_MIN_FILTER,k.LINEAR),k.bindRenderbuffer(K,m.render),k.renderbufferStorage(K,k.DEPTH_COMPONENT16,$,M),Ol(k,m.frame),k.framebufferTexture2D(l,k.COLOR_ATTACHMENT0,T,m.texture,0),k.framebufferRenderbuffer(l,k.DEPTH_ATTACHMENT,K,m.render),Eb(k,I),k.bindRenderbuffer(K,I),Mo(k),m.width=$,m.height=M),m._iv){m._iv=!1;var v=!1;U._40Q.each(function(t){!v&&t.isBatchInvalid()&&(v=!0)}),v&&U.updateScene(),Ol(k,m.frame),k.clear(k.COLOR_BUFFER_BIT),U.overlappingBox.clear(),U.setViewport(k,0,0,$,M),U.renderPickScene(),Mo(k)}}}});var Xs=function(T){this.gv=T};Lp(Xs,T,{gap:0,size:0,_42:function(f,C){var j=this,$=j.gv,B=$._gridGap,b=$._gridSize;if($._gridVisible){if(j.gap!==B||j.size!==b){for(var _=[],c=$._gridSize/2,N=B*c,J=0;2*c+1>J;J++){var T=6*J,n=6*(2*c+1)+T;_[T]=-N,_[T+1]=0,_[T+2]=-N+J*B,_[T+3]=N,_[T+4]=0,_[T+5]=-N+J*B,_[n]=-N+J*B,_[n+1]=0,_[n+2]=-N,_[n+3]=-N+J*B,_[n+4]=0,_[n+5]=N}j.vs=new Tb(_),j.gap=B,j.size=b}Rg($),Jr(f),th(f);var w=!$._fogDisabled;if(w){var H=Jm.for(f).directUniforms();H.uFog=!1}Bs(f,C,1,$._gridColor,$._buffer.vs,j.vs),qb(f,0,j.vs.length/3,f.LINES),w&&(H.uFog=!0),Uk(f),yb(f)}else j.vs=j.gap=j.size=I}});var Ys=function(G){this.gv=G};Lp(Ys,T,{_42:function(z,y){var f=this.gv,e=f._buffer.vs,n=f._axisXColor,x=f._axisYColor,B=f._axisZColor,p=f._originAxisVisible,V=f._centerAxisVisible;if(p||V){var v=dq?z.TRIANGLES:z.TRIANGLE_FAN,C=z.LINES;if(Rg(f),Jr(z),th(z),p){var P=f.getCenterInfo(),w=X(P.width,P.height)/5,Z=.8*w,i=.05*w;Bs(z,y,1.5,n,e,new Tb([0,0,0,w,0,0,Z,i,0,Z,0,i,Z,-i,0,Z,0,-i,Z,i,0,0,0,0,0,w,0,i,Z,0,0,Z,i,-i,Z,0,0,Z,-i,i,Z,0,0,0,0,0,0,w,i,0,Z,0,i,Z,-i,0,Z,0,-i,Z,i,0,Z])),qb(z,0,2,C),qb(z,1,6,v),Bs(z,y,I,x),qb(z,7,2,C),qb(z,8,6,v),Bs(z,y,I,B),qb(z,14,2,C),qb(z,15,6,v)}if(V){var O=f._center,W=O[0],H=O[1],J=O[2],P=f.getPositionInfo(O);w=X(P.width,P.height)/20,Bs(z,y,1.5,n,e,new Tb([W,H,J,W+w,H,J,W,H,J,W,H+w,J,W,H,J,W,H,J+w])),qb(z,0,2,C),Bs(z,y,I,x),qb(z,2,2,C),Bs(z,y,I,B),qb(z,4,2,C)}Uk(z),yb(z)}}});var Zs=function($){this.gv=$},$s="edit_tx",_s="edit_ty",at="edit_tz",bt="edit_rx",ct="edit_ry",dt="edit_rz",et="edit_sx",ft="edit_sy",gt="edit_sz",ht={};ht[$s]=101,ht[_s]=102,ht[at]=103,ht[bt]=104,ht[ct]=105,ht[dt]=106,ht[et]=107,ht[ft]=108,ht[gt]=109,Lp(Zs,T,{_42:function(U,o,F){var N=this,i=N.gv,$=i.sm().ld();if($&&i.isEditable($)&&!i.isEditHelperDisabled()&&Dg($)&&(!i.isFirstPersonMode()||!i.isMouseRoamable()&&!gj)){Rg(i);var L,G=i.isMovable($),H=i.isRotationEditable($),K=i.isSizeEditable($),d=i._axisXColor,_=i._axisYColor,D=i._axisZColor,Y=i._editSizeColor,W=$.p3();if(i.isOrtho()){var s=i.getCenterInfo();L=X(s.width,s.height)/8}else L=Jc(i.getEye(),W)/10;var O,k,f=L/(F?5:10),a=.7*L,q=.4*a,x=W[0],M=W[1],y=W[2];O=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],G&&N._17O(U,o,$,F,$s,d,O,[x,M-f,y,x+a,M-f,y,x+a,M,y,x+a,M,y,x,M,y,x,M-f,y,x,M-f,y+f,x+a,M-f,y+f,x+a,M-f,y,x+a,M-f,y,x,M-f,y,x,M-f,y+f]),k=x+a,K&&N._17O(U,o,$,F,et,Y,O,[k,M-f,y,k+q,M-f,y,k+q,M,y,k+q,M,y,k,M,y,k,M-f,y,k,M-f,y+f,k+q,M-f,y+f,k+q,M-f,y,k+q,M-f,y,k,M-f,y,k,M-f,y+f]),k+=q,H&&N._17O(U,o,$,F,bt,d,O,[k,M-f,y,k+q,M-f,y,k+q,M,y,k+q,M,y,k,M,y,k,M-f,y,k,M-f,y+f,k+q,M-f,y+f,k+q,M-f,y,k+q,M-f,y,k,M-f,y,k,M-f,y+f]),O=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0],G&&N._17O(U,o,$,F,_s,_,O,[x,M,y,x,M+a,y,x-f,M+a,y,x-f,M+a,y,x-f,M,y,x,M,y,x,M,y,x,M,y-f,x,M+a,y-f,x,M+a,y-f,x,M+a,y,x,M,y]),k=M+a,K&&N._17O(U,o,$,F,ft,Y,O,[x,k,y,x,k+q,y,x-f,k+q,y,x-f,k+q,y,x-f,k,y,x,k,y,x,k,y,x,k,y-f,x,k+q,y-f,x,k+q,y-f,x,k+q,y,x,k,y]),k+=q,H&&N._17O(U,o,$,F,ct,_,O,[x,k,y,x,k+q,y,x-f,k+q,y,x-f,k+q,y,x-f,k,y,x,k,y,x,k,y,x,k,y-f,x,k+q,y-f,x,k+q,y-f,x,k+q,y,x,k,y]),O=[1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],G&&N._17O(U,o,$,F,at,D,O,[x,M,y,x,M,y+a,x,M-f,y+a,x,M-f,y+a,x,M-f,y,x,M,y,x,M-f,y,x-f,M-f,y,x-f,M-f,y+a,x-f,M-f,y+a,x,M-f,y+a,x,M-f,y]),k=y+a,K&&N._17O(U,o,$,F,gt,Y,O,[x,M,k,x,M,k+q,x,M-f,k+q,x,M-f,k+q,x,M-f,k,x,M,k,x,M-f,k,x-f,M-f,k,x-f,M-f,k+q,x-f,M-f,k+q,x,M-f,k+q,x,M-f,k]),k+=q,H&&N._17O(U,o,$,F,dt,D,O,[x,M,k,x,M,k+q,x,M-f,k+q,x,M-f,k+q,x,M-f,k,x,M,k,x,M-f,k,x-f,M-f,k,x-f,M-f,k+q,x-f,M-f,k+q,x,M-f,k+q,x,M-f,k])}},_17O:function(e,n,T,K,a,R,D,N){var b=this.gv,p=b._buffer,O=Jm.for(e),H=O.directUniforms(),P=O.directAttribs();if(b._picking){K=b.pickColorMap;var _=ht[a];K[_]={data:T,part:a},H.uFixPickReverseColor=Vs(_)}gb(e,n,I,!0,I,!0,I,!1),H.uDiffuse=R,P.aPosition=db(e,p.vs,new Tb(N),I),P.aNormal=db(e,p.ns,new Tb(D),I),th(e),qb(e,0,12),Uk(e),he(e,n)}});var it=B.Raycaster=function(E){this.gv=E,this.maxTriangleTest=1/0,this.backfaceCulling=!0};$e("Raycaster",T,{intersect:function(n){var k=this,y=k.gv,u=y.getDataAt(n);return u?k.intersectObject(n,u):null},intersectObjects:function(V,p,c){var G,B,r,$,N=this,R=1/0,Y=V.origin||(new Xn).fromArray(N.gv.getEye()),Z=N.maxTriangleTest,y=[];p.forEach(function(_){c&&c(_)===!1||_.s("intersect")!==!1&&y.push(_)});var O=Y.distanceToSquared2([0,0,0]);return y.sort(function(F,v){return(F.p3?Y.distanceToSquared2(F.p3()):O)-(v.p3?Y.distanceToSquared2(v.p3()):O)}),N.countTriangles=0,y.forEach(function(J){N.countTriangles>Z||(G=N.intersectObject(V,J),G&&(B=Y.distanceToSquared(G.world),R>B&&(r=J,$=G,R=B)))}),N.countTriangles=0,{data:r,intersect:$}},intersectObjectAndRecordTriangle:function(m,Y){this._4GQ=!0;var O=this.intersectObject(m,Y);return this._4GQ=!1,O},intersectLastTriangle:function(j,Y){var w=this.getRay(j);w.applyMatrix4(Y.inverseMatrix);var J=w.intersectPlane(Y.plane);if(!J)return null;var L=Sn.uvIntersection(J,Y.p1,Y.p2,Y.p3,Y.uv1.clone(),Y.uv2.clone(),Y.uv3.clone());return{world:J.clone().applyMatrix4(Y.matrixWorld),local:J.clone(),uv:L}},getRay:function(t){if(t instanceof Sp)return t;var w=this,e=w.gv,u=e.unproject(t),h=new Xn,K=e.getEye(),f=new Xn;if(e.isOrtho()){var Y=new Xn(K);f.copy(e.getCenter()).sub(Y).normalize();var i=h.copy(u).sub(Y).dot(f);h.copy(f).setLength(-i).add(Y.copy(u))}else h.copy(K),f.copy(u).sub(h).normalize();return new B.Math.Ray(h,f)},intersectObject:function(g,j){return this._intersectObjectImpl(this.getRay(g),j)},_intersectObjectImpl:function(){function $(){var G=new Xn;return G.subVectors(g,F),O.subVectors(E,F),G.cross(O).normalize(),G}var a=new qc,X=new qc,b=new Sp,v=new Xn,G=new Xn,j=new Xn,n=new Xn,R=new Xn,E=new Xn,F=new Xn,g=new Xn,C=new wc,K=new wc,A=new wc,O=new Xn,V={vs:Tm,is:Mb,uv:Zp},u=Qe.slice(0);return u.push("csg"),function(s,P){var r=this.gv.getData3dUI(P),x=P.mat||r.mat;x?a.fromArray(x):a.identity(),X.getInverse(a),b.copy(s).applyMatrix4(X);var f,O,p,N="body",h=r.shapeModel;if(!h&&(P instanceof B.Polyline||P instanceof B.Edge)&&r.lineShapeModel&&(h=r.lineShapeModel),h||(h=kg(r)),h||(B.CSGNode&&P instanceof B.CSGNode||B.CSGShape&&P instanceof B.CSGShape?(p=!0,h=[r.left,r.front,r.right,r.back,r.top,r.bottom,r.csg]):P instanceof B.Node&&!(P instanceof B.Shape)?(f=!0,h=V):(O=!0,h=[r.left,r.front,r.right,r.back,r.top,r.bottom])),!h)return console.log("Can not find shape model."),null;ar(h)||(h=[h]);var w,T,m,J,W,M,S,o,l,t,c,L,Y,Z,y,U,H=1/0,z=["","top_","bottom_"],d=!1,q=this.backfaceCulling,D=[];for(km(h,r,D),w=0,T=D.length;T>w;w++)if(Y=D[w])for(m=0,J=z.length;J>m;m++)if(Z=z[m],S=Y[Z+"vs"],o=Y[Z+"is"],l=Y[Z+"uv"]||Y[Z+"tuv"],S){if(y=Y[Z+"boundingBox"]){var c=b.intersectBox(y);if(!c)continue;if(b.origin.distanceTo(c)>H)continue;U=!1}else Y[Z+"boundingBox"]=y=new B.Math.Box3,U=!0;for(W=0,M=o?o.length:S.length/3;M>W;W+=3)this.countTriangles++,o?(G.fromArray(S,3*o[W]),j.fromArray(S,3*o[W+1]),n.fromArray(S,3*o[W+2])):(G.fromArray(S,3*W),j.fromArray(S,3*(W+1)),n.fromArray(S,3*(W+2))),U&&(y.expandByPoint(G),y.expandByPoint(j),y.expandByPoint(n)),t=b.intersectTriangle(G,j,n,q,v),t&&(L=b.origin.distanceTo(t),H>L&&(H=L,R.copy(t),E.copy(G),F.copy(j),g.copy(n),""!==Z?N=Z.slice(0,-1):f?N=Qe[Math.floor(W/6)]:O?N=Qe[w]:p&&(N=u[w]),l&&(d=!0,o?(C.fromArray(l,2*o[W]),K.fromArray(l,2*o[W+1]),A.fromArray(l,2*o[W+2])):(C.fromArray(l,2*W),K.fromArray(l,2*(W+1)),A.fromArray(l,2*(W+2))))))}if(!isFinite(H))return null;var k,i,I=R.clone().applyMatrix4(a),e=this._4GQ;d&&(e&&(i={inverseMatrix:X.clone(),matrixWorld:a.clone(),p1:E.clone(),p2:F.clone(),p3:g.clone(),uv1:C.clone(),uv2:K.clone(),uv3:A.clone(),plane:(new B.Math.Plane).setFromCoplanarPoints(E,F,g)}),k=Sn.uvIntersection(R,E,F,g,C,K,A));var _=$(E,F,g),Q=$(E.applyMatrix4(a),F.applyMatrix4(a),g.applyMatrix4(a)),Uh=b.direction.dot(_);Uh>0&&(_.multiplyScalar(-1),Q.multiplyScalar(-1));var Xn={world:I,local:R.clone(),worldNormal:Q,normal:_,uv:k,part:N};return i&&(Xn.triangleInfo=i),Xn}}()});var jt=function(e,o){this.gv=e,this.s=function(h,d,z){return d==I&&(d=z),d==I?o.getStyle(h):tp(d,o,e)},this.data=o};Lp(jt,T,{I3d:!0,ms_icons:1,_iv:!0,_cacheBoundingBox:z,iv:function(){this._iv=!0},update:function(A,k,X){var v=this,r=v.data;if(A||(A=v.gv,k=A.getGL(),X=A._40Q),!v.needValidate(k)||!A.isVisible(r))return X.push(this,!1),void 0;var z,s,o,h,C,O=r._id,V=r._47Q?null:v.s("batch"),N=r.getRenderLayer(),f=X.get(N,!0),Y=f.batchIndexMap,W=f.batchModelMap,p=A.getBrightness(r),L=p!=I&&1!==p;z=vi(Y,W,r,V,A);var t=V?A.getBatchInfo(V)||El:I,_=v.validate(z,t);if(z&&(!t.ms||!t.ms.length)&&(s=Y[O],o=s.size=z.vs.length/3-s.begin,C=z.rs))for(p=L?p:1,h=0;o>h;h++)C.push(p);var H=A.getWireframeGeometry(r);if(H)Uh(A,r,H);else if(Dg(r)){var E=A.getWireframe(r);E&&Uh(A,r,E)}v.labelInfo=v.label2Info=v.noteInfo=v.note2Info=v._38o=I,v._24O(sm,"getLabel"),v._24O(zl,"getLabel2"),v._26O(Si,"getNote"),v._26O(bl,"getNote2"),v._15O(),v.interactiveInfo=A.isInteractive(r)?{}:I,f.push(this,!0),_!==!1&&(v._iv=!1)},clearWireframeGeometryCache:function(){var k=this;lb(k),k.data.iv()},_46Q:function(Z,k){var S=this,R=S.data,t=S.gv;if(t.isVisible(R)){var $=R._id,b=t._40Q.get(R._renderLayer,!0),x=b.batchIndexMap[$],M=b.polylineIndexMap[$],V=b.wireframeIndexMap[$];(x||M||V)&&(k==I&&(k=zg(Z,t.pickColorMap,t.isSelectable(R),S,Qk,!0)),k&&(Ql(k,x,b.batchModelMap,t),Ql(k,M,b.polylineModelMap,t),Ql(k,V,b.wireframeModelMap,t)))}},_42:function(q,f,J){function H(x,N,q){var e=N.getBrightness(q),V=q.s("alphaTest"),C=q.s("envmap"),G=Jm.for(x),m=G.directUniforms();e!=I&&1!==e&&(m.uBrightness=e),m.uAlphaTest=V,m.uUseEnvMap=C?!0:!1,m.uReflectivity=C||.01,m.roughness=q.s("roughness"),N._setEnvmapByProbeId(m,q.s("envmap.probe")),m.shadowReceive=!W&&q.s("shadow.receive"),m.shadowCull=!W&&!!q.s("shadow.cull"),qj(N,m,q.s("3d.clipbox")?Wg:q.s("3d.clipbox.mask"));var d=Y.s("3d.clip.direction");if(d){var B=Y.s("3d.clip.percentage");0===B&&(O=!1);var S=Y._formatClipUniforms(d,B,q);m.uClipPercent=S[1],m.uClipDirection=S[0]}else m.uClipDirection=0;x._blooming&&!q.s("bloom")&&(m.blackout=!0),W||(N._flowObjects.length&&N.flowMap.resetDataFlowEnabld(q,m),od(N,m,q.s("light.mask"),q.s("headlight.ambientIntensity")))}var Y=this,n=Y.data,x=Y.gv;if(x.isVisible(n)){var E,W=x._picking;if(W)E=x.pickColorMap;else{if(x.isTransparentMask(n)||x.isReflecting(q)&&n.s("3d.reflectable")===!1)return;E=z}if(jt.getTitle===z){jt.getTitle=0;for(var t in R)if(t.length===zl.length+1&&t[zl.length]===yf[4].toUpperCase()&&t[zl.length-1]===yf[zl.length+1].toUpperCase()){jt.getTitle=ie;break}}if(!jt.getTitle||rd[zl.length+2]){if(jt.getHead===z){jt.getHead=0;for(var t in _){var V="box-sizing";6===t.length&&t[0]===yf[4]&&t[3]===V[0]&&t[4]===V[1]&&t[5]===V[2]&&(jt.getHead=Bc)}}if(!jt.getHead||rd[zl.length]){if(jt.getTitle2===z){jt.getTitle2=0;for(var t in _){var l="uv";6===t.length&&t[0]===cn[1].toUpperCase()&&t[1]===l[0]&&(jt.getTitle2=hs)}}if(!jt.getTitle2||rd[rr.length]){var F,Q,h=n._id,M=x._40Q.get(n._renderLayer,!0),b=M.batchIndexMap,c=M.batchModelMap,w=x.isSelectable(n),A=!1,O=!0,y=b[h];if(W&&(Q=zg(q,E,w,Y,Qk,y),Q&&!x._45Q&&(Ql(Q,y,c,x),Ql(Q,M.polylineIndexMap[h],M.polylineModelMap,x),Ql(Q,M.wireframeIndexMap[h],M.wireframeModelMap,x))),y||(A||(A=!0,H(q,x,n)),O&&Y._80o(q,f,J)),x.isLabelVisible(n)&&((F=Y.labelInfo)&&(W&&zg(q,E,w,Y,sm),A||(A=!0,H(q,x,n)),Y._28O(F,sm,J)),(F=Y.label2Info)&&(W&&zg(q,E,w,Y,zl),A||(A=!0,H(q,x,n)),Y._28O(F,zl,J))),x.isNoteVisible(n)&&((F=Y.noteInfo)&&(W&&zg(q,E,w,Y,Si),A||(A=!0,H(q,x,n)),Y._29O(F,Si,J)),(F=Y.note2Info)&&(W&&zg(q,E,w,Y,bl),A||(A=!0,H(q,x,n)),Y._29O(F,bl,J))),(F=Y._38o)&&(A||(A=!0,H(q,x,n)),Y._99O(q,f,F,E,w,J)),A){var L=Jm.for(q).directUniforms();L.uBrightness=1,L.uClipDirection=0,q._blooming&&(L.blackout=!1)}}}}}},_formatClipUniforms:function(W,u,Q){switch(W){case"uv.right":W=7;break;case"uv.left":W=8;break;case"left":W=2;break;case"top":W=3;break;case"bottom":W=4;break;case"front":W=5;break;case"back":W=6;break;case"right":default:W=1}if(0===W%2&&(u=1-u),7===W||8===W){var M=this.shapeModel;M&&M.internalUvScale&&(u*=M.internalUvScale)}else if(Q instanceof B.Shape){var e=Q.s3(),l=Q.p3(),D=Q.getAnchor3d();u=3>W?(u-D.x)*e[0]+l[0]:5>W?(u-D.y)*e[1]+l[1]:(u-D.z)*e[2]+l[2]}else u-=.5;return[W,u]},prepare:function(){var p=this,g=p.data;if(!(g instanceof Xl)){var H,m,F,N,W,n=p.gv,y=n.getGL(),t=g._id,B=p.s("batch"),e=n._batchIndexMap,o=n._batchModelMap,Z=n.getBrightness(g),r=Z!=I&&1!==Z;if(p.needValidate(y)){H=vi(e,o,g,B,n);var b=B?n.getBatchInfo(B)||El:I;if(p.validate(H,b),H&&(!b.ms||!b.ms.length)&&(m=e[t],F=m.size=H.vs.length/3-m.begin,W=H.rs))for(Z=r?Z:1,N=0;F>N;N++)W.push(Z);if(Dg(g)){var l=n.getWireframeGeometry(g);if(l)Uh(n,g,l);else{var E=n.getWireframe(g);E&&Uh(n,g,E)}}p.labelInfo=p.label2Info=p.noteInfo=p.note2Info=p._38o=I,p._24O(sm,"getLabel"),p._24O(zl,"getLabel2"),p._26O(Si,"getNote"),p._26O(bl,"getNote2"),p._15O(),p.interactiveInfo=n.isInteractive(g)?{}:I,p._iv=!1}}},dispatchBoundingBoxChanged:function(){this._cacheBoundingBox=z},getBoundingBox:function(){var d,J,G,w,l,A;return function(g){if(this._cacheBoundingBox)return this._cacheBoundingBox;d||(d={vs:Tm,is:Mb,uv:Zp},J=new Xn,G=new Xn,w=new Xn,l=new Xn,A=new Xn);var _=this,x=_.data,K=_.shapeModel;if(!K&&(x instanceof B.Polyline||x instanceof B.Edge)&&_.lineShapeModel&&(K=_.lineShapeModel),K||(K=kg(_)),K||(B.CSGNode&&x instanceof B.CSGNode||B.CSGShape&&x instanceof B.CSGShape?(isCSG=!0,K=[_.left,_.front,_.right,_.back,_.top,_.bottom,_.csg]):x instanceof B.Node&&!(x instanceof B.Shape)?K=d:(_.left||_.front||_.right||_.back||_.top||_.bottom)&&(K=[_.left,_.front,_.right,_.back,_.top,_.bottom])),!K)return z;ar(K)||(K=[K]);var u,t,q,R,H,r,F,N,n,v,E,k,S=["","top_","bottom_"],i=new B.Math.Box3,X=!1;if(_._needRecoverPosition){l.set.apply(l,x.p3());var a=x.s3();A.set(1/(a[0]||1),1/(a[1]||1),1/(a[2]||1))}else l.set(0,0,0),A.set(1,1,1);var L=[];for(km(K,_,L),u=0,t=L.length;t>u;u++)if(n=L[u])for(q=0,R=S.length;R>q;q++)if(v=S[q],F=n[v+"vs"],N=n[v+"is"],F){if(k=v+"boundingBox",E=n[k],!E)for(n[k]=E=new B.Math.Box3,H=0,r=N?N.length:F.length/3;r>H;H+=3)N?(J.fromArray(F,3*N[H]).sub(l).multiply(A),G.fromArray(F,3*N[H+1]).sub(l).multiply(A),w.fromArray(F,3*N[H+2]).sub(l).multiply(A)):(J.fromArray(F,3*H).sub(l).multiply(A),G.fromArray(F,3*(H+1)).sub(l).multiply(A),w.fromArray(F,3*(H+2)).sub(l).multiply(A)),!J.isNaN()&&E.expandByPoint(J),!G.isNaN()&&E.expandByPoint(G),!w.isNaN()&&E.expandByPoint(w);i.expandByBox(E),X=!0}return X?(this._cacheBoundingBox=i,T.freeze(i),T.freeze(i.min),T.freeze(i.max),g||zb(_.gv,x),i):z}}(),needValidate:function(){return this._iv},validate:function(){},_16O:function(){return Lr},_80o:function(){},dispose:function(){var j=this,y=j._pickId;if(y){var d=j.gv.pickColorMap;d[y]&&delete d[y]}},getBodyColor:function(p){var b=this.data,j=this.gv.getBodyColor(b);return j?j:p?b.getStyle(p):I},contextLost:function(){this._cachedTextures&&this.gv.invalidateCachedTexture(this.data)},getCachedTexture:function(L){var N=this._cachedTextures;return N?N[L||"main"]:null},setCachedTexture:function(I,l){var U=this._cachedTextures;return U||(U=this._cachedTextures={}),U[l||"main"]=I,I},invalidateCachedTexture:function(w){var N=this._cachedTextures;if(N){for(var B in N)w.deleteTexture(N[B]);this._cachedTextures={}}},invalidateCachedGeometry:function(){},_24O:function(i,D){var J=this,w=J.data,Y=J.gv,F=J.s,U=Y[D](w);if(U!=I){var k=F(i+".scale"),f=F(i+".max"),H=J[i+"Info"]={label:U,textureScale:F(i+".texture.scale"),color:Y[D+"Color"](w),font:F(i+".font"),align:F(i+".align"),background:Y[D+"Background"](w)},P=H.rect=Yj(H,U);f>0&&f<P.width&&(H.labelWidth=P.width,P.width=f),P.x=P.y=0,P.width*=k,P.height*=k,H.mat=J._16O(F(i+".autorotate"),F(i+".position"),P,F(i+".face"),F(i+".t3"),F(i+".r3"),F(i+".rotationMode"));var y=P.width/2,C=P.height/2;H.vs=new Tb([-y,C,0,-y,-C,0,y,-C,0,y,C,0]),P.width/=k,P.height/=k}},_26O:function(d,P){var Q=this,S=Q.data,Y=Q.gv,J=Q.s,V=Y[P](S);if(V!=I){var _=J(d+".scale"),x=this[d+"Info"]={note:V,textureScale:J(d+".texture.scale"),expanded:J(d+".expanded"),font:J(d+".font"),color:J(d+".color"),align:J(d+".align"),borderWidth:J(d+".border.width"),borderColor:J(d+".border.color"),background:Y[P+"Background"](S)};if(x.expanded){var U=J(d+".max"),a=Yj(x,V);a.width+=6,a.height+=2,U>0&&U<a.width&&(x.labelWidth=a.width,a.width=U);var W={x:-a.width/2,y:-8-a.height,width:a.width,height:a.height+8}}else W={x:-6,y:-18,width:12,height:18};x.mat=Q._16O(J(d+".autorotate"),J(d+".position"),I,J(d+".face"),J(d+".t3"),J(d+".r3"),J(d+".rotationMode")),x.rect=W,1!==_&&(W=sj(W),W.x*=_,W.height*=_,W.y=-W.height,W.width*=_);var N=W.x,E=W.y,r=W.width,k=W.height;x.vs=new Tb([N,-E,0,N,-E-k,0,N+r,-E-k,0,N+r,-E,0])}},eachShapeModel:function(J,T){function w(F){Vg(F),F.vs&&J(F.vs,F.is,F.ns,F.uv),F.top_vs&&J(F.top_vs,F.top_is,F.top_ns,F.top_uv),F.bottom_vs&&J(F.bottom_vs,F.bottom_is,F.bottom_ns,F.bottom_uv),F.from_vs&&J(F.from_vs,F.from_is,F.from_ns,F.from_uv),F.to_vs&&J(F.to_vs,F.to_is,F.to_ns,F.to_uv)}function O(q){var j,u,m;if(ar(q))for(u=0,m=q.length;m>u;u++)j=q[u],j&&O(j);else Fc(q)?O(kg(D,q),D):Pd(q)&&(q.shape3d?O(q.shape3d):w(q))}var D=this,R=D.data,T=T||D.shapeModel||kg(D);T||(T=R instanceof B.Node&&!(R instanceof B.Shape)?{vs:Tm,is:Mb}:[D.left,D.front,D.right,D.back,D.top,D.bottom]),O(T)},_28O:function(v,k,u){if(u(this.s(k+".transparent"))){var i=v.rect,A=v.textureScale,M=i.width*A,a=i.height*A;if(M>=1&&a>=1){var H=sb(M,a);1!==A&&(H.translate(i.x,i.y),H.scale(A,A),H.translate(-i.x,-i.y)),Gd(H,v),H.restore(),hq(this,k,v.mat,v.vs,!0)}}},_29O:function(M,p,L){if(L(this.s(p+".transparent"))){var e=M.rect,T=M.textureScale,x=e.x,c=e.y,V=e.width*T,t=e.height*T;if(V>=1&&t>=1){e.x=e.y=0;var k=sb(V,t);1!==T&&k.scale(T,T),tg(k,M),k.restore(),e.x=x,e.y=c,hq(this,p,M.mat,M.vs,!1)}}},_99O:function(J,j,E,T,f,b){if(E){var h=this,N=h.gv,B=h.data,Z=N._buffer,U=N._1O,Q=E.icons,W=Jm.for(J),y=W.directAttribs();for(var F in Q){var G=Q[F],x=E.rects[F];if(x&&b(tp(G.transparent,B,N))){N._picking&&zg(J,T,f,h,F);var D=tp(G.shape3d,B,N),A=D?[D]:tp(G.names,B,N),d=A?A.length:0,t=tp(G.textureScale,B,N)||1,S=tp(G.light,B,N);S==I&&(S=D?!0:!1),gb(J,j,tp(G.blend,B,N),S,tp(G.opacity,B,N),tp(G.reverseFlip,B,N),tp(G.reverseColor,B,N),tp(G.reverseCull,B,N));for(var l=0;d>l;l++){var R=A[l],C=x[l];if(wn(h,C.mat),D)rj(N,B,kg(h,D),h);else{var c=Td(R);if(c){var e=C.width*t,r=C.height*t;if(e>=1&&r>=1){var w=sb(e,r);_n(w,c,tp(G.stretch,B,N),0,0,e,r,B,N),w.restore(),Qc(J,bp,U),th(J,j,U,tp(G.discardSelectable,B,N),Z.uv,fd),y.aPosition=db(J,Z.vs,C.vs,I),y.aNormal=Vi(J,Z.ns,_f,I),Pn(J,Z.is,Gi),kc(J,0,Gi.length),Uk(J,j,U)}}}ci(N)}he(J,j)}}}}});var kt=function(P,q){yd(kt,this,[P,q])};Lp(kt,jt,{_16O:function(W,x,A,o,m,M,_,g,O){var F,c=this.data,i=c.getFinalScale3d();if(c.hasOwnProperty("_anchor")||c.hasOwnProperty("_anchorElevation")){var K=c.getAnchor3d();F=[-(K.x-.5)*i[0],-(K.y-.5)*i[1],-(K.z-.5)*i[2]]}if(c.s("part.boundingBox")){var s=this.getBoundingBox(!0);if(s){var Y=s.max.clone().sub(s.min),U=s.max.clone().add(s.min).divideScalar(2);F||(F=[0,0,0]),F[0]+=U.x*i[0],F[1]+=U.y*i[1],F[2]+=U.z*i[2],i[0]*=Y.x,i[1]*=Y.y,i[2]*=Y.z}}var w=br(x,i,A,o,g,O);return F&&(w[0]+=F[0],w[1]+=F[1],w[2]+=F[2]),qf(an(),w,c.p3(),o,m,M,_,W,c.getFinalRotation3d(),c.getRotationMode())},clear:function(){var Q=this;Q.faceMat=Q.mat=Q.shapeModel=Q.left=Q.right=Q.front=Q.back=Q.top=Q.bottom=Q.csg=I},needValidate:function(l){if(this._iv)return this._validateFrameId=l._renderInfo.frame,!0;if(this.data._47Q){var H=l._renderInfo.frame;if(this._validateFrameId!==H)return this._validateFrameId=H,!0}return!1},invalidateUnstableWireframe:function(){var j=this.data;if(j._47Q){var M=j.getRenderLayer(),Q=this.gv._40Q.get(M);Q&&Q.ivWireframeBatch(j)}},validate:function(l,K){var M=this,i=M.gv,z=M.data,O=M.shapeName=M.s(_p),g=kg(M,O);M._updateAutoRotation(),M._updateFixSize2d(),M._updateOverlapping(),M.dispatchBoundingBoxChanged(),M.invalidateUnstableWireframe();var G=Zi(z,i.getMat(z),g?M.s("shape3d.scaleable"):!0);if(z.appendAnchorMatrix3d(G),M.clear(),M.mat=z.mat=G,g||!O)if(M.shapeModel=g,l)if(g)K.instanced?i.batchInstancedModel(z,g,M,M.getBodyColor(),[G],l):Gb(i,z,g,M,M.getBodyColor(),[G],l);else{var B=gd(G);K.instanced?i.batchInstancedFace(z,l,K,G,B):Zk(i,z,l,K,G,B)}else g||(M._cubeUvs=null,M.vf(xi,0),M.vf(Dd,16),M.vf(Uj,8),M.vf(Xo,24),M.vf(Vh,32),M.vf(dd,40))},_updateAutoRotation:function(){var u=new vb,I=new qc,c=new Xn,A=new Xn,d=new Xn;return function(){var r=this,e=r.data,m=r.s("autorotate")||r.s("shape3d.autorotate");if(!m)return e._dynamicRotation&&delete e._dynamicRotation,void 0;var Q=r.gv;d.copy(r.s("shape3d.autorotate.up")||Q._up);var b;b="string"==typeof m?[m.indexOf("x")<0?Q._eye[0]:Q._center[0],m.indexOf("y")<0?Q._eye[1]:Q._center[1],m.indexOf("z")<0?Q._eye[2]:Q._center[2]]:Q._eye;var a=Q._center,H=e.p3();c.copy(H),A.set(b[0]-a[0],b[1]-a[1],b[2]-a[2]).add(c),I.lookAt(A,c,d),u.set(0,0,0,e.getRotationMode(),!0).setFromRotationMatrix(I);var k=e._dynamicRotation;k&&Math.abs(k[0]-u.x)<1e-5&&Math.abs(k[1]-u.y)<1e-5&&Math.abs(k[2]-u.z)<1e-5||(e._dynamicRotation=[u.x,u.y,u.z])}}(),_updateFixSize2d:function(){var s=this,n=s.data,O=s.s("fixSizeOnScreen")||s.s("shape3d.fixSizeOnScreen");if(!O)return n._dynamicScale3d&&delete n._dynamicScale3d,void 0;var b=s.gv,H=Zi(n,b.getMat(n)),W=Ee([0,0,0],H),d=b.toViewPosition(W);if(!isNaN(d.x)&&!isNaN(d.y)){var F=Ee([1,0,0],H),z=b.toViewPosition(F),g=Ee([0,1,0],H),u=b.toViewPosition(g),p=z.x-d.x,x=u.y-d.y;if(p&&x){var Q,V,v=n._dynamicScale3d||[1,1,1],R=Td(n.s("shape3d.image"));if(O[0]>0&&(Q=O[0]),O[1]>0&&(V=O[1]),!Q||!V){var G=O>0?O:1;Q||(Q=(nr(R,n)||n.getWidth())*G),V||(V=(kd(R,n)||n.getTall())*G)}var X=Math.abs(p/Q),T=Math.abs(x/V);Math.abs(X-1)<.001&&Math.abs(T-1)<.001||(n._dynamicScale3d=[v[0]/X,v[1]/T,v[2]])}}},_updateOverlapping:function(){var V=this,H=V.s("hide.overlapping.group");if(!H)return V._rectOverlapping&&(V._rectOverlapping=z),void 0;var Y,O,B,J=V.gv,F=V.data,t=Zi(F,J.getMat(F)),y=1/0,w=1/0,c=-1/0,P=-1/0,D=F.getAnchor3d(),N=D.x,C=D.y,d=D.z;for(Y=0;8>Y;Y++){if(O=Ee([(Y>>2)-N,(1&Y>>1)-C,(1&Y)-d],t),B=J.toViewPosition(O),isNaN(B.x)||isNaN(B.y))return;y=Math.min(y,B.x),c=Math.max(c,B.x),w=Math.min(w,B.y),P=Math.max(P,B.y)}var u={x:y,y:w,w:c-y,h:P-w};V._rectOverlapping=J.overlappingBox.isOverlapping(H,u)},getVectorDynamicSize:function(){var b,G=this,T=G.s("shape3d"),D=G.data;if("billboard"===T||"plane"===T||(b=D._currentCubeElementId)!=I){var v,K,X=G.gv,s=Zi(D,X.getMat(D)),g=D.getAnchor3d(),B=.5-g.x,j=.5-g.y,U=.5-g.z,F=Math.min(G.s("vector.dynamic.maxsize"),X._glCapabilities.maxTextureSize)/X.getDevicePixelRatio(),l=function(Z,u){Z[0]+=B,Z[1]+=j,Z[2]+=U,u[0]+=B,u[1]+=j,u[2]+=U;var z=X.toViewPosition(Ee(Z,s)),N=X.toViewPosition(Ee(u,s)),T=z.x-N.x,h=z.y-N.y;return Math.min(F,Math.sqrt(T*T+h*h))};if("billboard"===T)v=l([-.5,0,0],[.5,0,0]),K=l([0,-.5,0],[0,.5,0]);else if("plane"===T)v=l([-.5,0,0],[.5,0,0]),K=l([0,0,-.5],[0,0,.5]);else if(D._currentCubeElementId!=I){var f=3*Mb[b+1],Y=3*Mb[b],P=3*Mb[b+2];v=l([Tm[f],Tm[f+1],Tm[f+2]],[Tm[P],Tm[P+1],Tm[P+2]]),K=l([Tm[f],Tm[f+1],Tm[f+2]],[Tm[Y],Tm[Y+1],Tm[Y+2]])}return[v,K]}},vf:function(O,e){var B=this;if(B.gv.getFaceVisible(B.data,O)){var j=Vo(B,O);j.mat&&(B.faceMat=!0);var g=j.uv;if(g){var N=B._cubeUvs;N||(N=B._cubeUvs=new Tb([0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0]));for(var K=0;8>K;K++)N[e+K]=g[K]}return j}},_billboardInView:function(){var P=[-.5,-.5,0,-.5,.5,0,.5,-.5,0,.5,.5,0],h=[-.5,0,-.5,-.5,0,.5,.5,0,-.5,.5,0,.5],$=new cr,i=new Xn,B=new qc;return function(s){var c=this;if(!c.mat)return!0;var Y=c.gv.getFrustum(),x="billboard"===s?P:h;$.makeEmpty(),B.fromArray(c.mat);for(var o=0,n=x.length;n>o;o+=3)$.expandByPoint(i.fromArray(x,o).applyMatrix4(B));return Y.intersectsBox($)}}(),_80o:function(g,Y,Z){var G=this;if(G._rectOverlapping)return!0;var C=G.shapeModel;
if(C||!G.shapeName){var v=G.s("shape3d");if(("billboard"===v||"plane"===v)&&!G._billboardInView(v))return!0;var f=G.gv,J=G.data,U=f._cube,M=Jm.for(g),N=M.directAttribs();if(yi&&!Jf){var q=G.mat;if(q)for(var u=0;u<q.length;u++)G.mat[u]=q[q.length-u-1]}Rg(f,G.mat),!g._picking&&G.s("shape3d.reflector")||G.s("effect.flow")||(C?rj(f,J,C,G,G.getBodyColor(),Z):(N.aPosition=db(g,U.vs,I,I),N.aNormal=db(g,U.ns,I,I),Nd(g,U.is),G._18O(g,Y,"left",0,Z),G._18O(g,Y,"front",6,Z),G._18O(g,Y,"right",12,Z),G._18O(g,Y,"back",18,Z),G._18O(g,Y,"top",24,Z),G._18O(g,Y,"bottom",30,Z))),ci(f),G.faceMat&&(G._18O(g,Y,"left",0,Z,!0),G._18O(g,Y,"front",6,Z,!0),G._18O(g,Y,"right",12,Z,!0),G._18O(g,Y,"back",18,Z,!0),G._18O(g,Y,"top",24,Z,!0),G._18O(g,Y,"bottom",30,Z,!0))}},_18O:function(m,O,Z,J,s,W){var V=this[Z];if(V){if(!s(V.transparent))return;if(W&&!V.mat||!W&&V.mat)return;var y=this.data.s("polygonOffset");y&&rl(m,y),W&&Rg(this.gv,V.mat);var S=this,k=S.data,P=Jm.for(m),Y=P.directUniforms();k._currentCubeElementId=J;var B=S.gv,A=B.getTexture(V.texture,k,Z),w=V.uv,z=V.uvScale,e=V.uvOffset,x=V.uvRotation,l=V.uvAnchor,T=V.discardSelectable;A?w?th(m,O,A,T,B._buffer.uv,S._cubeUvs,e,z,x,l):th(m,O,A,T,B._cube.uv,I,e,z,x,l):th(m),gb(m,O,V.blend,V.light,V.opacity,V.reverseFlip,V.reverseColor,V.reverseCull),Y.uDiffuse=V.color||c["color.empty"],kc(m,J,6),he(m,O),Uk(m,O,A),W&&ci(B),y&&_m(m),k._currentCubeElementId=null}},contextLost:function(){kt.superClass.contextLost.apply(this,arguments),this.data.s("shape3d.reflector")&&(this._reflectorRenderTarget=null,this._reflectNormal=null)},drawReflector:function(){var m=new Xn,H=new Xn,Q=new vb,b=new qc,k=new Xn,O=new Xn,C=new Xn,u=new Xn,K=new qc,E=new qc,$=new Xk,q=new jq,f=new jq,g=function(F,Z,b){F[b]=Z[0],F[b+1]=Z[1],F[b+2]=Z[2]},h=function(d,e,y){y=y||0,d[0]=e[y],d[1]=e[y+1],d[2]=e[y+2]},S=function(M,E){g(M,E.getEye(),0),g(M,E.getCenter(),3),g(M,E.getUp(),6)},W=function(x,N){h(N._eye,x,0),h(N._center,x,3),h(N._up,x,6),N._18Q=I;var w=N._skybox;w&&(w.p3([x[0],x[1],x[2]]),N.getData3dUI(w).iv())};return function(P){var F=this;F._reflectorInfo=null;var s=F.data;if(s._reflecting)return!1;var V=F.gv;if(V._picking)return!1;var N=s instanceof gi,U=F._reflectorRenderTarget,o=V._canvas.width,A=V._canvas.height;if(U?U.setSize(P,o,A):U=F._reflectorRenderTarget=new lp.RenderTarget(V,P,o,A),N){var g=s.getPointsMatrix3d().getElements(),p=s.p3();p[1]+=(1-s.getAnchorElevation())*s.getTall(),m.copy(Ee(p,g))}else m.copy(s.p3());if(H.copy(V.getEye()),b.makeRotationFromEuler(Q.set(s.r3(),s.getRotationMode(),!0)),!F._reflectNormal){var X;if(N&&s.getThickness()<0){if(!F.shapeModel||!F.shapeModel.top_vs)return!1;X={vs:F.shapeModel.top_vs,ns:F.shapeModel.top_ns}}else{if(X=kg(F,F.s("shape3d")),!X)return!1;!X.ns&&X.length&&(X=X[0])}if(!X.ns||!X.vs)return!1;F._reflectNormal=[X.ns[0],X.ns[1],X.ns[2]],F._reflectorVbuffer=kk.Buffer.createVertexBuffer(P,new Float32Array(X.vs))}if(k.copy(F._reflectNormal),k.applyMatrix4(b),O.subVectors(m,H),O.dot(k)>0)return!1;O.reflect(k).negate(),O.add(m),C.copy(V.getCenter()).negate().add(m),C.reflect(k).negate(),C.add(m),u.copy(V.getUp()),u.reflect(k);var i=[0,0,0,0,0,0,0,0,0];S(i,V),h(V._eye,O.toArray()),h(V._center,C.toArray()),h(V._up,u.toArray()),V._18Q=I;var e=V._skybox;e&&(e.p3(V._eye),V.getData3dUI(e).iv()),Ol(P,U.frame),V.setViewport(P,0,0,U.width,U.height);var w=s.s("shape3d.reflector.background");if(w){var B=P.getParameter(P.COLOR_CLEAR_VALUE);go(P,w)}else go(P,[0,0,0,1]);Jm.for(P).glState.depth.mask=!0,P.clear(P.COLOR_BUFFER_BIT|P.DEPTH_BUFFER_BIT);var G=s.s("shape3d.reflector.clip"),y=G===z?.003:G,J=Xf(V),Y=yk(V);$.setFromNormalAndCoplanarPoint(k,m.add(k.clone().multiplyScalar(y))),$.applyMatrix4(E.fromArray(Y)),q.set($.normal.x,$.normal.y,$.normal.z,$.constant),E.fromArray(J).getInverse(E),f.set(Math.sign(q.x),Math.sign(q.y),1,1).applyMatrix4(E),q.multiplyScalar(2/q.dot(f)),J[2]=q.x-J[3],J[6]=q.y-J[7],J[10]=q.z-J[11],J[14]=q.w-J[15];var D=V._computedProjectMatrix;V._computedProjectMatrix=J,s._reflecting=!0;var c=s.s("shape3d.reflector.shadow"),T={renderAxis:!1,renderEdit:!1,renderGrid:!1};"disabled"===c?(T.createShadowMap=!1,T.renderShadow=!1):"scene"===c?T.createShadowMap=!1:T.useReflectorSelfShadowMap=!0,V.renderScene(T),V._computedProjectMatrix=D,K.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),K.multiply(E.fromArray(V._projectMatrix)),K.multiply(E.fromArray(V._viewMatrix)),w&&go(P,B),Mo(P),W(i,V);var a=s.s("shape3d.reflector.blur");if(a){var M=V.getPostProcessingModule("Blur");M&&M.drawImpl(P,U,a,a>=3,s.s("shape3d.reflector.blur.iterations"))}var v=V.getPostProcessingModule("Glitch");v&&v.enable&&v.onlyReflector&&(U=v._42(P,U));var j=P._compiledShader.reflector;j||(j=P._compiledShader.reflector=new kk.Shader(P,gl.Reflector.vs,gl.Reflector.fs)),j.bind(),P.activeTexture(P.TEXTURE0),Eb(P,U.texture),j.uniforms.tDiffuse=0,j.uniforms.color=$m(s.s("shape3d.reflector.color")||"rgb(128,128,128)"),j.uniforms.textureMatrix=K.toArray(),j.uniforms.modelMatrix=N?g:Zi(s),j.uniforms.viewMatrix=yk(V),j.uniforms.projectionMatrix=Xf(V);var l=F._reflectorVbuffer;l.upload(),j.attributes.pos.pointer(l);var x=this.s("shape3d.transparent");if(x){var L=Jm.for(P).glState,t=L.depth.mask;L.depth.mask=!1}return P.drawArrays(P.TRIANGLES,0,l.data.length/3),x&&(L.depth.mask=t),s._reflecting=!1,P.useProgram(V._prg),Eb(P,I),!0}}()}),gl.Reflector={vs:["attribute vec3 pos;","uniform mat4 textureMatrix;","uniform mat4 modelMatrix;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","varying vec4 vUv;","void main() {","	vUv = textureMatrix * modelMatrix * vec4( pos, 1.0 );","	gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4( pos, 1.0 );","}"].join("\n"),fs:["precision highp float;","uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","	return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","	return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","	vec4 base = texture2DProj( tDiffuse, vUv );","   vec2 tUv = vUv.xy / vUv.w;","   if (tUv.x < .0 || tUv.y < .0 || tUv.x > 1. || tUv.y > 1.) discard;","	gl_FragColor = vec4( blendOverlay( base.rgb, color ), base.a );","}"].join("\n")};var lt=function(s,P){yd(lt,this,[s,P])};Lp(lt,kt,{_80o:function(){}});var mt=function(H,u){yd(mt,this,[H,u])};Lp(mt,jt,{_25Q:1,validate:function(Z){var F=this,P=F.s;if(P(_p)!==Rl||P("batch")!=I||!F.info||F.data._needChangeGeometry){var x=F.gv,r=F.data,C=P("edge.width"),E=r._40I,W=r._41I;if(r._needChangeGeometry=F.shapeModel=F.info=F.lineShapeModel=I,E&&W){var y,H,s,Q,U,f,e,t,a,o,N=r.isLooped(),j=P(bq),i=R.getEdgeType(j);if(i){var A=i(r,Kq(F,x,r,N,j),x,F._19Q);if(!A.points||A.points.isEmpty())return;f=F.info={},e=A.segments,U=A.points,t=U.size();for(var L=E.getElevation(),G=W.getElevation(),J=0;t>J;J++){var M=U.get(J);M.e==I&&(M.e=L+(G-L)*J/(t-1))}a=Sq(U.get(0)),o=Sq(U.get(t-1));var V=t%2,B=(t-V)/2;f.c1=Sq(U.get(B-1)),f.c2=Sq(U.get(B)),0!==V&&(f.p3=f.c2),f.s1=a,f.s2=Sq(U.get(1)),f.t1=Sq(U.get(t-2)),f.t2=o}else{U=new Gk,f=F.info={};var h=P("edge.offset"),D=P("edge.center"),c=P("edge.source.t3"),p=P("edge.target.t3"),S=ps(x,r,"source"),v=ps(x,r,"target");if(!S||!v)return x.invalidateData(r),delete F.info,!1;if(c&&(S[0]+=c[0],S[1]+=c[1],S[2]+=c[2]),p&&(v[0]+=p[0],v[1]+=p[1],v[2]+=p[2]),j===vr){e=P("edge.segments");var g=f.points=P(Sd)||De;if(t=g.size()){if(a=Sq(g.get(0)),o=Sq(g.get(t-1)),!D&&h){var n=h;s=Er(a,S,!0),h=X(n,Jc(S,a)),S=[S[0]+s[0]*h,S[1]+s[1]*h,S[2]+s[2]*h],s=Er(v,o,!0),h=X(n,Jc(o,v)),v=[v[0]-s[0]*h,v[1]-s[1]*h,v[2]-s[2]*h]}if(1===t)f.p3=a;else{var V=t%2,B=(t-V)/2;y=Sq(g.get(B-1)),H=Sq(g.get(B)),0!==V&&(f.p3=H),f.s1=S,f.s2=a,f.t1=o,f.t2=v}}else!D&&h&&(s=Er(v,S,!0),Q=Jc(S,v),h=om(h,Q),S=[S[0]+s[0]*h,S[1]+s[1]*h,S[2]+s[2]*h],v=[v[0]-s[0]*h,v[1]-s[1]*h,v[2]-s[2]*h]),y=S,H=v;U.add({x:S[0],y:S[2],e:S[1]}),U.addAll(g),U.add({x:v[0],y:v[2],e:v[1]})}else{var k=Kq(F,x,r,N,j);if(F._19Q||(k=-k),N){var u=S[0],l=S[1],T=S[2],m=E.getTall()/2+k;y=[u-k,l+m,T],H=[u+k,l+m,T],U.add({x:u-k,y:T,e:l}),U.add({x:u-k,y:T,e:l+m}),U.add({x:u+k,y:T,e:l+m}),U.add({x:u+k,y:T,e:l})}else{s=Er(v,S,!0),Q=Jc(S,v);var d={x:S[0],y:S[2]},w={x:v[0],y:v[2]},$=am(I,d,w,k),_=$.x-d.x,O=$.y-d.y;h=om(h,Q),s[0]*=h,s[1]*=h,s[2]*=h,y=[S[0]+s[0]+_,S[1]+s[1],S[2]+s[2]+O],H=[v[0]-s[0]+_,v[1]-s[1],v[2]-s[2]+O],D?(U.add({x:S[0],y:S[2],e:S[1]}),U.add({x:y[0],y:y[2],e:y[1]}),U.add({x:H[0],y:H[2],e:H[1]}),U.add({x:v[0],y:v[2],e:v[1]})):(U.add({x:y[0],y:y[2],e:y[1]}),U.add({x:H[0],y:H[2],e:H[1]}))}}f.c1=y,f.c2=H}f._lastPointsSegments={points:U,segments:e},f.list=P(_p)===Rl?F.createTubeModel(U,e,C/2,Z):F.createLineModel(U,e,C,"edge","edge.dash")}}},invalidateCachedGeometry:function(){this.info=I}});var nt=function(U,m){yd(nt,this,[U,m]),this._needRecoverPosition=!0};Lp(nt,kt,{_80o:function(w,W,b){var T=this,I=T._matWithExtraction||T.mat;if(I&&(!T.s("shape3d.reflector")||w._picking)){var A=T.gv,Y=T.shapeModel;Rg(A,I),Y?rj(A,T.data,Y,T,T.getBodyColor(),b):(il(T,w,W,"left",b),il(T,w,W,"front",b),il(T,w,W,"right",b),il(T,w,W,"back",b),il(T,w,W,"top",b),il(T,w,W,"bottom",b)),ci(A)}},validate:function(o,l){var T,Q,g=this,J=g.s,q=g.data,K=q._thickness/2,h=q.isClosePath(),r=q.getPoints(),n=q.getSegments(),G=J(Go),E=o&&o.uv;if(g.invalidateUnstableWireframe(),g.clear(),g.dispatchBoundingBoxChanged(),R.extractShapeTranslation||R.extractVerticesTranslation){var Y=new jl.Vector3(q.p3());r=sj(r),r.forEach(function(f){f.x-=Y.x,f.y-=Y.z}),g._vsTranslation=(new jl.Matrix4).setPosition(Y);var U=q.getShapeElevation;q.getShapeElevation=function(){return-(this.getTall()||0)*(this._anchorElevation-.5)}}else g._vsTranslation=null;if(0>K){g.s("shape3d.reflector")&&(g._reflectNormal=null);try{var e=J("shape3d.image.projection");if(e&&e[4]){var C=q.p3(),c=C[0],B=C[2];e=[c+e[0],e[1]+B,c+e[2],e[3]+B]}Q=g.shapeModel=Xr(r,n,J(eq),J(qp),G,J(ji),q.getTall(),q.getShapeElevation(),h,e)}catch(D){Q=g.shapeModel={}}J(io)?J("shape3d.image")||delete Q.uv:(delete Q.vs,delete Q.ns,delete Q.uv),J("shape3d.top.image")||delete Q.top_uv,J("shape3d.bottom.image")||delete Q.bottom_uv}else if(J(_p)===Rl)T=mi(r,n,G,h),Q=g.shapeModel={vs:[]},J("shape3d.image")&&(Q.uv=[],Q.sum=J(ji)||lj(T)||1,Q.len=0),J(eq)&&!h&&(Q.top_vs=[],J("shape3d.top.image")&&(Q.top_uv=[])),J(qp)&&!h&&(Q.bottom_vs=[],J("shape3d.bottom.image")&&(Q.bottom_uv=[])),g._12O(T,K);else{var Z,M,d,N,x,X,t,O,_,s;if(T=mi(r,n,G,h),x=g.vf(Uj,E,!1,l),K&&(X=g.vf(Xo,E,!1,l),t=h?I:g.vf(xi,E,!1,l),O=h?I:g.vf(Dd,E,!1,l),_=g.vf(Vh,E,!1,l),s=g.vf(dd,E,!1,l)),K){for(var f=0,W=T.length;W>f;f++)T[f]=g._tryRemoveBezierPoints(T[f],K);g._12O(T,K)}else x&&T.forEach(function(o){if(N=o.length,N>0)for(Z=o[0],d=1;N>d;d++)M=o[d],g.addV(x.vs,Z,M),Z=M});g._20Q(T),o||(x&&(x.ns=df(x.vs),Cq(x,"vs"),Cq(x,$d)),K&&(X&&(X.ns=df(X.vs),Cq(X,"vs"),Cq(X,$d)),t&&(t.ns=df(t.vs),Cq(t,"vs"),Cq(t,$d)),O&&(O.ns=df(O.vs),Cq(O,"vs"),Cq(O,$d)),_&&(_.ns=df(_.vs),Cq(_,"vs"),Cq(_,$d)),s&&(s.ns=df(s.vs),Cq(s,"vs"),Cq(s,$d))))}var i=g.mat=q.getPointsMatrix3d().getElements();g._vsTranslation?i=g._matWithExtraction=(new jl.Matrix4).fromArray(i).multiply(g._vsTranslation).toArray():g._matWithExtraction=null,o&&(ob(g,i,o,Q,l),g.clear()),U!=I&&(q.getShapeElevation=U)},_20Q:function(M){var E,B,c,H,x,L,e,X,f,A,p,l,P,v=this,o=v.front,u=v.back,U=v.top,r=v.bottom,m=o?o.tuv:I,k=u?u.tuv:I,S=U?U.tuv:I,h=r?r.tuv:I,V=0,R={front:0,back:0,top:0,bottom:0};(m||k||S||h)&&(P=v.s(ji),E=P||lj(M)||1,p=v.s("all.uv.union"),M.forEach(function(n){if(B=n.length,B>0){for(A in R)l=v.s(A+".uv.union"),(l===!1||l==I&&p===!1)&&(R[A]=0,P||(E=lj([n])));for(L=n[0],c=1;B>c;c++){e=n[c],X=Jc(L,e);for(A in R)V=R[A],H=V/E,R[A]=V+=X,x=V/E,"back"===A&&(f=H,H=1-x,x=1-f),v._14O(v[A],H,x);L=e}}}))},_14O:function(d,Q,s){if(d){var T=d.uv,F=d.tuv;if(F){if(T)var t=T[0]+(T[6]-T[0])*Q,q=T[1]+(T[7]-T[1])*Q,P=T[2]+(T[4]-T[2])*Q,B=T[3]+(T[5]-T[3])*Q,Y=T[2]+(T[4]-T[2])*s,a=T[3]+(T[5]-T[3])*s,U=T[0]+(T[6]-T[0])*s,g=T[1]+(T[7]-T[1])*s;else t=Q,q=0,P=Q,B=1,Y=s,a=1,U=s,g=0;F.push(P,B,Y,a,U,g,U,g,t,q,P,B)}}},_13O:function(L){var F=L.uv,Z=L.tuv;Z&&(F?Z.push(F[2],F[3],F[4],F[5],F[6],F[7],F[6],F[7],F[0],F[1],F[2],F[3]):Z.push(0,1,1,1,1,0,1,0,0,0,0,1))},_tryRemoveBezierPoints:function(t,Y){var C=t.length;if(4>C)return t;var K,S,p,x,q,d,j=!1,U=function(V){return t[V]},A=function(c){return t[C-1-c]};for(q=0;1>=q;q++)for(d=q?A:U,S=d(0),p=d(1),K=2;C-1>K;K++)if(x=d(K),!x.remove)if(x.b){var i=am(S,p,x,Y);i.adjust?(x.remove=!0,j=!0):(S=p,p=x)}else S=p,p=x;if(!j)return t;var V=[];for(K=0;C>K;K++)t[K].remove||V.push(t[K]);return V},_12O:function(p,x){var P,b,$,X,T,e=this.s("shape3d.point.epsilon"),u=this;p.forEach(function(l){if(T=l.length,T>0)for(P={p:l[0],n:!0},X=1;T>X;X++)b=l[X],$=T-1>X?l[X+1]:I,$&&Math.abs(b.x-$.x)<e&&Math.abs(b.y-$.y)<e||u.addPoint(P,b,$,x,l)})},addPoint:function(R,$,b,e,x){var E,m,H,P,f,g,r,k,j,s=this,A=R.p,Y=R.f,y=R.b,w=s.s("shape3d.side")||hb,l=s.s("shape3d.start.angle"),i=s.s("shape3d.sweep.angle"),T=s.shapeModel,d=s.data.isClosePath();if(R.n&&(R.n=!1,Y=d&&x.length>2?am(x[x.length-2],A,$,e):am(I,A,$,e),y=Br(A,Y),T?T.top_vs&&s._10O(y,Y,w,l,i,T.top_vs,T.top_uv):(E=s.left)&&(s.addV(E.vs,y,Y),s._13O(E))),m=b?am(A,$,b,e):d&&x.length>2?am(A,$,x[1],e):am(A,$,I,e),H=Br($,m),T){var q,J,G=T.vs,L=T.uv,V=T.sum;for(L&&(q=T.len/V,T.len+=Jc(A,$),J=T.len/V),g=s._9O(y,Y,w,l,i),r=s._9O(H,m,w,l,i),k=0;w>k;k++)j=k+1,uh(G,g[j]),uh(G,r[k]),uh(G,g[k]),uh(G,r[k]),uh(G,g[j]),uh(G,r[j]),L&&(P=k/w,f=j/w,L.push(q,f,J,P,q,P,J,P,q,f,J,f));!b&&T.bottom_vs&&s._10O(H,m,w,l,i,T.bottom_vs,T.bottom_uv,!0)}else!b&&(E=s.right)&&(s.addV(E.vs,m,H),s._13O(E)),(E=s.front)&&s.addV(E.vs,Y,m),(E=s.back)&&s.addV(E.vs,H,y),(E=s.top)&&s.addH(E.vs,Y,m,H,y,!0),(E=s.bottom)&&s.addH(E.vs,y,H,m,Y);R.p=$,R.f=m,R.b=H},_10O:function(_,R,w,H,s,B,y,J){var U,E,$=this,O=$.data,Q=$._9O(_,R,w,H,s),Y=(_.x+R.x)/2,q=(_.y+R.y)/2,S=O.getShapeElevation(),i=0;for(i=0;w>i;i++)J?(uh(B,Q[i]),uh(B,Q[i+1])):(uh(B,Q[i+1]),uh(B,Q[i])),uh(B,[Y,S,q]),y&&(J?(U=f*(i+1)/w+H,E=f*i/w+H):(U=f*i/w+H,E=f*(i+1)/w+H),y.push(.5-.5*F(E),.5-.5*k(E),.5-.5*F(U),.5-.5*k(U),.5,.5))},_9O:function(s,b,d,l,X){var g,x,J=this,c=J.data,M=[],n=(s.x+b.x)/2,E=(s.y+b.y)/2,N=c.getTall()/2,H=c.getShapeElevation(),W=0;for(X==I&&(X=f);d>=W;W++)g=X*W/d+l,x=F(g),M.push([n+(s.x-n)*x,H+N*k(g),E+(s.y-E)*x]);return M},addV:function(S,c,x){var C=c.x,U=c.y,Z=x.x,V=x.y,l=this.data,j=l.getShapeElevation(),F=l.getTall()/2;S.push(C,j-F,U,Z,j-F,V,Z,j+F,V,Z,j+F,V,C,j+F,U,C,j-F,U)},addH:function(g,f,P,k,n,J){var h=this.data,o=h.getTall()/2,S=h.getShapeElevation()+(J?o:-o);g.push(f.x,S,f.y,P.x,S,P.y,k.x,S,k.y,k.x,S,k.y,n.x,S,n.y,f.x,S,f.y)},vf:function(k,D,L,v){var J,Q=this,Z=Q.gv.getFaceVisible(Q.data,k);return(L||Z)&&(J=Vo(Q,k,v),J.vs=[],J.tuv=Z&&(J.texture||D)?[]:I,J.visible=Z),J}});var ot=function(n,Y){yd(ot,this,[n,Y])},pt={},qt=function(e){return/\.(png|jpg|gif|jpeg|bmp|svg)$/i.test(e)};Lp(ot,kt,{validate:function(){var b=this,T=b.gv,$=b.data,F=b.s,t=$m(F("points.color")),i=F("points.size"),W=F("points.uv.offset"),u=F("points.image");!u||qt(u)||Jq.test(u)||(pt[u]||(pt[u]=b._createCachedImage(u)),u=pt[u]);var L,r,G=$._modelDirty,c=F("points.model");if(c){if(b._lastShapeModel!==c||!b.shapeModel){var S=kg(b,c);if(!S)return;var o=[],j={};b.eachShapeModel(function(x){for(var r=0,Q=x.length;Q>r;r+=3){var T=x[r],C=x[r+1],L=x[r+2],D=""+T+"_"+C+"_"+L;j[D]||(j[D]=!0,o.push(T,C,L))}},S),b._setShapeModelPoints(new Tb(o)),b._lastShapeModel=c,G=!0}L=b.shapeModel.vs.length,r=L/3}else{var B=$.getPoints();if(r=L=B.length,G||$._pointsDirty||!b.shapeModel){for(var M=[],q=0;r>q;q++){var X=B[q];X&&M.push(X.x,X.e,X.y)}b._setShapeModelPoints(new Tb(M)),$._pointsDirty=!1,b._lastShapeModel=null,G=!0}}if(b.info={mat:Zi($),size:i,diffuse:t,opacity:F("points.opacity"),texture:u,alphaTest:F("points.transparent")?0:F("alphaTest"),uvScale:F("points.uv.scale"),uvOffset:W,discardSelectable:F("points.discard.selectable")},G||$._colorsDirty){var p=!1,R=$.getColors();if(R&&R.length>0)for(var D=[],q=0;r>q;q++)for(var w=R[q],C=w?(p=!0,$m(w)):t,g=4*q,m=0;4>m;m++)D[g+m]=C[m];b.shapeModel.cs=p?new Tb(D):null,$._colorsDirty=!1}if(G||$._sizesDirty){var Q=!1,Y=$.getSizes();if(Y&&Y.length>0)for(var P,k=[],q=0;r>q;q++)P=Y[q],P>=0?(k.push(P),Q=!0):k.push(i);b.shapeModel.ss=Q?new Tb(k):null,$._sizesDirty=!1}if(G||$._offsetsDirty){var n=!1,K=$.getUvoffsets();if(K&&K.length>0)for(var f,O,I,Z=[],q=0;r>q;q++)f=2*q,O=K[f],I=K[f+1],O!=z&&I!=z?(Z.push(O,I),n=!0):Z.push(W[0],W[1]);b.shapeModel.os=n?new Tb(Z):null,$._offsetsDirty=!1}if(G||b._lastPointNumber!==r){this.dispose();var V=T.pickColorMap,a=b._startPickId=V._pickIdUsed;V._pickIdUsed=a+r;for(var M=[],q=0;r>q;q++){var H=a+q,l=Vs(H);M.push(l[0],l[1],l[2],l[3]),V[H]||(V[H]={data:$,part:q})}b.shapeModel.ps=new Tb(M),b._lastPointNumber=r}$._modelDirty=!1,this.dispatchBoundingBoxChanged()},_setShapeModelPoints:function(T){var B=this,r=B.shapeModel,I=B.shapeModel={vs:T};if(!r)return I;var K=T.length,g=Math.round(K/3);return r.cs&&r.cs.length==4*g&&(I.cs=r.cs),r.ss&&r.ss.length==g&&(I.ss=r.ss),r.os&&r.os.length==2*g&&(I.os=r.os),r.ps&&r.ps.length==4*g&&(I.ps=r.ps),I},_createCachedImage:function(t){var R=128,D=On(),b=D.getContext("2d");Jk(D,R,R,1),cq(b,{width:R,height:R,comps:[{type:t,background:"white",borderWidth:0,rect:[0,0,R,R]}]},0,0,R,R);var u=B.Math.generateUUID();return rb[u]=D,u},_80o:function(_,X){var v=this,o=v.gv,p=o._picking;if(!p||o.isSelectable(v.data)){var i=v.shapeModel,f=v.info;if(i&&i.vs&&i.vs.length){var w=Jm.for(_);w.useProgram(v._asureProgram(_));var e=w.directUniforms(),k=w.directAttribs();e.modelMatrix=f.mat,e.modelViewMatrix=Hh([],o._viewMatrix,f.mat),e.projectionMatrix=o._projectMatrix,e.viewMatrix=o._viewMatrix,e.scale=o.getHeight()/2,e.size=f.size,e.diffuse=f.diffuse,e.opacity=f.opacity,e.map=o.getTexture(f.texture,v.data),e.alphaTest=f.alphaTest,e.resolution=o.getDevicePixelRatio(),e.discardSelectable=f.discardSelectable,e.uvScale=f.uvScale,k.uvOffset=!p&&i.os?Vi(_,o._buffer.os,i.os,I):f.uvOffset,e.blackout=_._blooming&&!v.data.s("bloom"),k.position=Vi(_,o._buffer.vs,i.vs,I),p?(e.picking=!0,k.pickColor=Vi(_,o._buffer.ps,i.ps,I),e.useColor=!1,k.color=null):(e.picking=!1,k.pickColor=null,i.cs?(e.useColor=!0,k.color=Vi(_,o._buffer.cs,i.cs,I)):(e.useColor=!1,k.color=null)),i.ss?(e.useSizeArray=!0,k.sizeArray=Vi(_,o._buffer.ss,i.ss,I)):(e.useSizeArray=!1,k.sizeArray=null),qb(_,0,i.vs.length/3,_.POINTS),w.useProgram(X),k.disable(),o.shadowMap.enable&&o.shadowMap.createShadow(),o.flowMap.createFlow(e)}}},_asureProgram:function(i){return i._pointsShader||(i._pointsShader=this.gv._postProcessing.createShader(i,ot.shaderSrc)),i._pointsShader.program},dispose:function(){ot.superClass.dispose.call(this);var n=this._startPickId,X=this._lastPointNumber;if(n&&X){for(var o=this.gv.pickColorMap,s=0;X>s;s++){var g=n+s;o[g]&&delete o[g]}delete this._startPickId,delete this._lastPointNumber}}}),ot.shaderSrc="!!~v!oj<g*p!s{n/!onpbjuu5j!tnppQewfnm!N.b!u0s!jfym<bd!tv!o)j!g>p+s!nf!{njbTuu5o!jnppQe`fmmhW!j*f!xfNwbjuusdjfyq<ts!fvQotjjg!p)s!ng!jn!bu<5*!!q1s/p2k!f.d!u>j>p!o^N!b4u!s]j^y!<3!!]vyojjsgupbsNno!pnjbuud5f!kwpjsfqx!N)b!u>s!jfyw<ju!dvfoqjtgspfsQnt!jg!mmppbpuc!!tdbm~f!<<o!pbjuuuvsmjpctvfusf!!+w!ffd{4j!tq!p>t!jfu{jjpTou<ojp!Qv`omjhg!ps|n!!fctpmpfm!!~v!tf<Doppmjpusv<mp!tbfusu!s+j!czvbusfs!Bwff{dj5t!!d>p!mfp{sj<Tu!owjbpsQz`jmohh!!w|f!d*5z!bwsDspBmfp{sj<Tft!vb)u!ugsjj!cv<uofp!jwufjdt3p!QvwwnP!g+g!tyfjus<ub!Nwobpsjzujdofhk!pwsfqd!3>!!woPpgjgutjftup<Q`m!hv!oj<goppsjnu!jctpppQmw!nq!j+d!lyjjoshu<bN!xbfujuWsmjfcevpunf!!>w!fodp5j!uqjjtdplQDwpnm!ps<<*!1!/v2o!j-gepfsnns!pggmtpobbus!ut!j){5fd<fw!!v>o!jogppjsunj!tgpmQpwbnu!!5sdfftwp!mv<u*j!poop<ju!jvtopjqg!p)s4nd!fcwp!p>m!!evftnfsTpjg{tfoBbsssub!z4<df!wb!uu<s*jucfvtugfg!Pgwmvp)b3ud!ftwj!{>f!Busfstbgzg<Pw!!c~p!pm<!sjptmQpfds!t>q!fsdpumjpwDfwN!bu|s!j*ys)p!mnpbDuf5t!vn)!!*g!j|!f!tsmffu!vs~o!!n<]s!p3m!p^D]l!d4j!q^!!>>!>s!p.m!p2D/w1!<|!!~*ho!jwlpdjjeq!)n!bgjjo!)*|!^#!!~qs~f!dj<tsjppmop!Difjthvigqg!jgem!p>b!us<pm!p$DehfbgsjGo`fm!hV!TF|`!NfBtQmf!!v~o!jg<psspnm!pwDfwd!5>!!esjpgmgpvDthfb<sG!`vmohj!gp<sens!bgdmtpjbeu!!*p1q/b1d!j>u>z!<b/!svpomjpgDpfstnv!gggmjpeb)u!!gbjm!qi|b!U*fhtouj<ldj!qv)o!jggjp!sn<!ecspbpdmt!jvet!f*DuptmfpUsb<iq!mwbb!s=z!jbo/hs!pwmfpdD5f!twvDgpgmjpes)<!gj!!vogjjgeposfn$!!cp~p!m!<q*jwdvl!j-oqhb<n!!)vEo3jfgspvsuny!fcup!p>m+!!esjptmdpbDsfetTvfgmgfjdeu!bc<muff<tgg!Pvwo!j>g,p!swnv!!cp<pfmm!bcdmTbwdvl!p+v!ue<spp!DvuoojjgppQs`nm!hw!f>d!3w!vv!w3Tddfbwm!f<|!!*wfbmsczbjuodhf!mwffTde3s!bwdPtgjgetaf!u}<}!h$ojjgl!dejfqgaj)o!fgej)!!V*T!FQ`BNNB`QF!T*V!!)veofjogjpgsfne!!tgbjn$q!mf~s!3E<!*n!bzqu<jd$bfqope!j+g!b/wfptjveg!gnjbej!o-){*z!y|/f!tjvgg!g)jcem!b)d5ldpfvwu!*>!!|s!phmmp`DGfstbvhgDgpjmep!s!|>!!fwtfmdf5!)~1!/1<-*!!1z/u1j-d!b1q/p1!-+!!2b//1s*p<m!psDfwu!v-s{oz<y!/~spm!pwDfwd!5)!5edjfgwg!v>t!fsDppmmppDsf<tv!gjggj!e)!aq|j!d*lsjpomhp!D%f%t!v";var rt=function(n,M){yd(rt,this,[n,M]),this._needRecoverPosition=!0};Lp(rt,jt,{_25Q:1,validate:function(K){var Q=this,$=Q.data,i=Q.s,q=$.getPoints(),k=q.size();Q.dispatchBoundingBoxChanged();var W=$.p3(),Z=Q.mat=an();uf(Z,W),Ml(Z,$.getFinalRotation3d(),$.getRotationMode());var n=$.getScale3d(),w=$._dynamicScale3d;if(w&&(n[0]*=w[0],n[1]*=w[1],n[2]*=w[2]),xm(Z,n),uf(Z,Em(W)),(i(_p)!==Rl||i("batch")!=I||!Q.shapeModel||$._needChangeGeometry)&&($._needChangeGeometry=Q.shapeModel=Q.info=Q.lineShapeModel=I,k>1)){var V=Q.info={},L=$.getSegments(),D=$.getThickness(),G=Sq(q.get(0)),_=Sq(q.get(k-1)),S=k%2,c=(k-S)/2;if(V.c1=Sq(q.get(c-1)),V.c2=Sq(q.get(c)),0!==S&&(V.p3=V.c2),V.s1=G,V.s2=Sq(q.get(1)),V.t1=Sq(q.get(k-2)),V.t2=_,i(_p)===Rl){if(R.extractPolylineTranslation||R.extractVerticesTranslation){var W=new jl.Vector3($.p3());q=sj(q),q.forEach(function(c){c.x-=W.x,c.e-=W.y,c.y-=W.z}),Q._vsTranslation=(new jl.Matrix4).setPosition(W),Q._matWithExtraction=(new jl.Matrix4).fromArray(Z).multiply(Q._vsTranslation).toArray()}else Q._vsTranslation=null,Q._matWithExtraction=null;V.list=Q.createTubeModel(q,L,D/2,K)}else V.list=Q.createLineModel(q,L,D,"shape.border","shape.dash")}},invalidateCachedGeometry:function(){this.shapeModel=this.info=this.lineShapeModel=I},_80o:function(e,S,X){var p=this,g=p.shapeModel;if(g){var A=p.mat;(R.extractPolylineTranslation||R.extractVerticesTranslation)&&p._matWithExtraction&&(A=p._matWithExtraction);var P=p.gv;Rg(P,A);var k,B=p.s("3d.clip.direction");if(P._uvClipEnabled&&("uv.left"===B||"uv.right"===B)&&(k=p.s("3d.clip.percentage"))<1){var x=!0,N=!0;Vg(g);var E=g.top_vs,l=g.bottom_vs,i=g.vs,w=Jm.for(e),r=w.directUniforms(),q=w.directAttribs();"uv.left"==B?(1>k&&(x=!1),0>=k&&(N=!1)):(1>k&&(N=!1),0>=k&&(x=!1)),g.top_vs=g.bottom_vs=z,q.aUv=Vi(e,P._buffer.uv,g.uv,I,2),rj(P,p.data,g,p,p.getBodyColor(),X),q.aUv=!1,r.uClipDirection=0,g.vs=z,x&&(g.top_vs=E),N&&(g.bottom_vs=l),rj(P,p.data,g,p,p.getBodyColor(),X),g.vs=i,g.top_vs=E,g.bottom_vs=l}else rj(P,p.data,g,p,p.getBodyColor(),X);ci(P)}}});var st=B.graph3d.PostProcessing=function(G){var S,U,N,V,R=this,p={},Q=!1,L=!1;!function(){T.keys(st).forEach(function(D){p[D]=new st[D](G)})}(),R.getModule=function(k){return k?p[k]:R},R.getModuleList=function(){return T.keys(p)},R.resetModules=function(){for(var j in p)p[j].resetProperties()},R._serializable=!0,R.handleDataModleChange=function(v,B){v&&(R._serializable&&v.setPostProcessingData(R.serialize()),v.removeSerializeListener(R.onDataModelSerialize,R)),B&&(B.addSerializeListener(R.onDataModelSerialize,R),R.deserialize(B))},R.onDataModelSerialize=function(r){"serialize"===r.type?R._serializable&&(G.dm()._postProcessingData=R.serialize()):"deserialize"===r.type&&R.deserialize(G.dm())},R.isDeserializeDisabled=function(H){return!R._serializable||H.a("sceneBloom")!==z},R.isSerializable=function(){return R._serializable},R.setSerializable=function(B){R._serializable=B,B||G.dm().setPostProcessingData(z)},R.serialize=function(){var M,g,S,A,K={};for(g in p)if(S=p[g],A=S.serializeProperties){M={},S.enable&&(M.enable=!0);for(var J in A){var o=S[J];o!=A[J]&&(M[J]=o)}T.keys(M).length&&(K[g.toLowerCase()]=M)}return K},R.deserialize=function(B){var o,Q,A,l,J,k={},j={};for(o in p){A=p[o],l=A.serializeProperties;var _={},m="scene"+o,T=B.a(m);T!==z&&(_.enable=T);for(var J in l)T=B.a(m+J[0].toUpperCase()+J.slice(1)),T!==z&&T!==l[J]&&(_[J]=T);Jb(_)||(j[o[0].toLowerCase()+o.slice(1)]=_)}if(Jb(j)&&(j=B.getPostProcessingData()),j)for(Q in j)if(Q&&(o=Q[0].toUpperCase()+Q.slice(1),A=p[o])){k[o]=!0,l=j[Q];var U=!!l.enable;R.enableModule(o,U),o="scene"+o,B.a(o,U),A.resetProperties&&A.resetProperties();for(J in l)if("enable"!==J){var T=l[J];A[J]=T,B.a(o+J[0].toUpperCase()+J.slice(1),T)}}for(o in p)k[o]||(A=p[o],A.enable=!1,A.resetProperties&&A.resetProperties())},R.getRenderTarget=function(){return S},R.blitScreen=function(z,e,k,M,i){var m=G.getGL();if(m&&(L||t())){z&&(z.bind(m),G.setViewport(m,0,0,z.width,z.height)),i&&i.clear===!1||m.clear(m.COLOR_BUFFER_BIT|m.DEPTH_BUFFER_BIT),k||(k=U),k.bind(),m.activeTexture(m.TEXTURE0+0),Eb(m,e||m._emptyTexture);var F=k.uniforms;F.image=0;var C=1;if(M)for(var D in M){var r=M[D];r instanceof WebGLTexture&&(m.activeTexture(m.TEXTURE0+C),Eb(m,r),r=C,C++),F[D]=r}if(N.upload(),V.upload(),k.attributes.pos.pointer(V),m.drawElements(m.TRIANGLES,6,m.UNSIGNED_SHORT,0),C>1)for(;--C>=0;)m.activeTexture(m.TEXTURE0+C),Eb(m,null);else Eb(m,null);z&&z.unbind(m)}},R.decodeShader=function(S){var I,r,V,x="",D="";for(V=0;V<S.length;V++)I=S[V],"%"===I?I="'":"a"===I?I='"':"]"===I&&(I="\\"),r=String.fromCharCode(I.charCodeAt(0)-1),V%2?D+=r:x=r+x;return D+x},R.createShader=function(A,k,p){var D,y;if("string"==typeof k){var z=k.indexOf("^#");D=R.decodeShader(k.substr(0,z)),y=R.decodeShader(k.substr(z+2))}else D=k.vs,y=k.fs;if(p){var O=p(D,y);O&&O.vs&&(D=O.vs),O&&O.fs&&(y=O.fs)}return new kk.Shader(A,D,y)},R.enableModule=function(l,E){var W,B,O,T=l.split(",");for(W=0,B=T.length;B>W;W++)O=T[W].trim(),p[O]&&(p[O].enable=E);Q=!1;for(O in p)if(p[O].enable){Q=!0;break}};var t=function(){if(L)return!1;var t=G.getGL();return t?(S=new lp.RenderTarget(G,t,null,null,{samples:c.renderTextureSamples||1,minFilter:t.LINEAR,magFilter:t.LINEAR,depthFormat:G.isWebGL2()?t.DEPTH_COMPONENT32F:null}),U=new kk.Shader(t,d.vs,d.fs),N=kk.Buffer.createIndexBuffer(t,new Uint16Array([0,2,1,1,2,3])),V=kk.Buffer.createVertexBuffer(t,new Float32Array([0,0,1,0,0,1,1,1])),L=!0):!1},d=R.blitScreenShaderSrc={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","uniform sampler2D image;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D(image, vUv);","}"].join("\n")};R.contextLost=function(){L=!1;for(var s in p)p[s].contextLost&&p[s].contextLost()},R.render=function(Z,M,e,W){if(Q&&(L||t())){S.setSize(Z,M,e),S.bind(Z);var A=Z.getParameter(Z.COLOR_CLEAR_VALUE);A&&0===A[0]&&0===A[1]&&0===A[2]&&0===A[3]?A=null:go(Z,[0,0,0,0]),Z.clear(Z.COLOR_BUFFER_BIT|Z.DEPTH_BUFFER_BIT),G.setViewport(Z,0,0,M,e),W=W||{};var F=W.renderAxis!==!1,K=W.renderEdit!==!1;W.renderAxis=W.renderEdit=!1,G.renderScene(W),S.unbind(Z);for(var D=0,q=G._glCapabilities.maxAttributes;q>D;D++)Z.disableVertexAttribArray(D);var H,g=S;for(H in p)g=p[H]._42(Z,g)||g;G.setViewport(Z,0,0,M,e),A&&go(Z,A);var x=R.getModule("Fxaa");return x&&x.enable?R.blitScreen(null,g.texture,x.getShader(Z),{resolution:[1/M,1/e]}):R.blitScreen(null,g.texture),Z.useProgram(G._prg),G._renderAxisAndEditHelper(F,K),!0}}},tt=B.graph3d.PostProcessing.HueSaturation=function(K){function l(){var d=K.getGL();return d?(W=new lp.RenderTarget(K,d),F=K._postProcessing.createShader(d,tt.hueSaturationShader),L=kk.Buffer.createIndexBuffer(d,new Uint16Array([0,2,1,1,2,3])),S=kk.Buffer.createVertexBuffer(d,new Float32Array([0,0,1,0,0,1,1,1])),M=!0):!1}var L,S,F,W,s=this,n=!1,M=!1,$=[],r=[],P=[];this.serializeProperties={hue:[0,0,0,0,0,0,0],saturation:[0,0,0,0,0,0,0],lightness:[0,0,0,0,0,0,0]},this.resetProperties=function(){var P=this.serializeProperties;for(var e in P)this[e]=P[e]},this.resetProperties(),T.defineProperties(s,{enable:{get:function(){return n},set:function(L){!!n!=!!L&&(n=L,K.iv())}},hue:{get:function(){return $.map(function(Y){return C(180*Y)})},set:function(b){if($!==b&&7===b.length){for(var F=0;7>F;F++)$[F]=b[F]/180;K.iv()}}},saturation:{get:function(){return r.map(function(r){return C(100*r)})},set:function(u){if(r!==u&&7===u.length){for(var $=0;7>$;$++)r[$]=u[$]/100;K.iv()}}},lightness:{get:function(){return P.map(function(W){return C(100*W)})},set:function(C){if(P!==C&&7===C.length){for(var w=0;7>w;w++)P[w]=C[w]/100;K.iv()}}}}),s.contextLost=function(){M=!1},s._42=function(T,G){if(n&&(M||l())){var U=G.width,R=G.height;if(U&&R){W.setSize(T,U,R),Ol(T,W.frame),K.setViewport(T,0,0,W.width,W.height),T.clear(T.COLOR_BUFFER_BIT|T.DEPTH_BUFFER_BIT),F.bind(),T.activeTexture(T.TEXTURE0+0),Eb(T,G.texture);var E=F.uniforms;return E.image=0,E.hue=$,E.saturation=r,E.lightness=P,L.upload(),S.upload(),F.attributes.pos.pointer(S),T.drawElements(T.TRIANGLES,6,T.UNSIGNED_SHORT,0),Eb(T,null),Mo(T),W}}}};tt.hueSaturationShader="!!b~u!us<j*czv/utfp!qw!f.d!31!/q2p!t-<y/!twpbqs)z3jdofhw!!w>f!dw3V!ww!Vw<<*1/!2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+!!hzm/`tQppqt.j!u-j1p/o2!!>.!!w1f/d35!)+q!pyt/^#!!q~s!fd<j*txj/psop!mipjdh!i-q*!mgtmip)bcuh<s3!mvtoij)g5pdsfnw!!t>b!nsqpmmfpsD3hEb!sjGn`bmhhf!<<!*w!bs*zfjhoohb!Swtftdf3o!uwiVhwj<m!-!^$1e]ftgtjfoofu!iNhBjYm`!S-B{O/HmFt!i8)t!t$feofugijhojfm!`SqBbOnH!F`-B*MfMh!o1bSo!pvjoujbgspvsunb!tg!m-p^b1u]!oipvjfu]bNsBvYu`bStB!O-HzF/^m<ti!)voopjjgupbssnv!ugbmtp`bqub!nt!bu-v*sfbhuojbpSof]vNiB!Y-`^S1B]OfHvFi^!<-y!/vmotjig)pfsvni!`gqmbpnb!u!)m4jdhfiwu!o>f!tmtt]iN!BY`~S!BO~H!F^<<lbf!sgcm!pb<u^!snfbuqo`vipvdf`)fgvmip]btut!fjoouWibhmjvmf!->!!gfmhpobbuS!titvffoBumimh-j!mg!mp<b^us!fiuvofvSpbdo`hffv*i!]|op!jgumbpsbvuu!bwtb!m>v!ff!h>o!bjSooWpbjmuvbfs!v,u!b)ti!vf<B^msmf!u,o!vipvdf`Sfbvoih]ff*v!i0!!>3!/f1h<obS!fjvgi!!)w|b!m*vffh!o=b!s1!/>1>*!!ssffuuovvspod!`wfbvmiv)f!!g,j!!2/|1!<*,!,fsmftufo!vjpgd!`)fwvbim!v<fF!H?O!B2S/`1Y*B!Ns!f=u!vssfou!owvbpmdv`ff!v.i!!2</11!<>!!sffmutofv!psdf`ufvvsio!!uwobjm)v!fs<pg!!~<!2g!m,p!bfuh!onbbsq!`>t!bfuhvosbbsu!jp<o1)!g>m!pfbhuo!bjso!W*b7m!v>f?-!!fghmopbbsu)!!tgbju!vs~b!uj~p!oB<mlmb-f!sgcm!pb<us!ftubouvvpsdb`ufjvpio!S>b!ofhhfo*b!s|!!|g!m*p6b/u1!!w,b!m*vsff!u>o!vjpodW`bfmvvif)!u+b!p)m2g/!1=!!,i!)t!bgujv!sb|u!j*p,o,Bsmfmu!o,v!ptdb`ufvvsib!u<jFpHoOSBbSo`hYfB*N<!=!!ssffuuvosvop!dd`mfbvniq!)<w1b!m>v!fs-f!u1o/v1p-d!`2f/v1i*!<uo!j~)!!sgpmgp!bu!<nfbhqo`bmSjthtifuooufithtj)mg!m-pfbhuo!bjSooWpbjmuvbfs-v!ugbmtp!b-uf!hmojbhSifuvoif!tutbBpmmmg-!!g<m1p!b>u!!fmhjohbisu!oufotjt!Sb<oehmfp*i!t|fs!igum`pfbvui!!wu!b>p!mmgj!hi<u1o/f7t!t+B!mym/!m,t!im!j>h!iiu!oufbtptmSgb!oh<f*<{z!yj/gs!p)mwp!d=)!m1t/i13*ch!ss!f>u!vmstoi!!j4odWfbwm!vf<!*+w!V)ww!!-,f!h2b/n1j*)<E3!ffsmvtufyf!us!f>u!vsspom!pjdo!W5bdmfvwf!!,|!!)*w)!o+j!b)n2!/e1j!p.w!!joW~b!mv<f**m*!<-t!!~-i!)g4mdpfbwu!!oisvvfu3fssh!c)~g!mp<b1u/!7g!20-!!ig!m>p!biu!!g~3!-!<g1m/p7b!u>!,i!vif!*!||!*!1j/g1!!)=i!vif)!!=g!j1!/1*~!!i<vbfu!m,f>E!d2!/01!<*h!!f.m!tsf)!!j,g!!1)/i5v!f>!!?i!!2/|1!*ft!mifv!f~!!.><!b2u/m1f<Ed!!g0m!p*bsu!!.s!fct)<!,!!j1g/!3)!)>7!/i1!!+|!!i*vyfb*N!d=!!>2>/!1h*)!!gsjf!tf!t>m!fg!2~!!,!<)bgu3m!f.E!dg!20*!!*+c!!7./!1h!)+!!>i!vif!<|!!f*mytbfN!dj!g>!>)!)s3)/!1g!j+!!iv<f***!o=j!N2d/!1,*!y!bsNfdt)!!>.!!g13/<3)!!f0m!tbfu!mjfgE!d)!);4!/*1o!j+N!di!v,f!*y!b=N!d3)/!10*!b!usmfftE!d>!!@g!26!/,1!!)=g!3m!!.>!!gt2!*!+<!o)j)N3d/!1.!!0y!b4N/d1!*>!!.b!uimvffE*d!!+u!b7p/m1g<!!|f!m*tofjN!ds!f?t!!y>b!Ngd2)<!g!js!fuv<s1o/!3s!f0t!<*o!j~Nd!!,w!fydb4N!di)t!m>3!smh!c)w<f*d*4c!!i-thm)*y!b|n!!-wsf)dy4b!ns!h>c!<ybN!dj!gu!b)pimtgm!/z<!*>*>c!!1-/h1)*o!j|n!!-ssh)co!j>n!!w>f!do4j)Nidt!mu/b{p*m<g!!~<!cf/mdt!f>!!|c!!ugbmppmbgu!!g<3h</d!!>j!gh!!)uibtpmm/g{!!=<!s1//d6!*>!!sg!3u!b>p!migt!m/<{1!/+1!!)>2!/m1!!u,b!pimtgm!/z<*1</1!!f>m!ttf!u!bgp3m!g>!!i<t1m//2{.!!,>!!iit!mu/bzp!m.g!!it|m!/*zd!!+4!diftwm)/m{t<i3c!hgsm!p4bduf!wg!2!>~!!3/<1c!h+s!!iotsmv/u{f!s.!!g~3!<<*!*s1h/c4/0s1!/>2!)i!v.f!3ys/hmct)ig!2--3!gg!3--2!gi)tcmh/sy3!f,v!i)!2>/!1c0/4c/h1s*!*<<*!ys/hmct/ih!!->3!gi!v-f23gs)hc";
var ut=B.graph3d.PostProcessing.Bloom=function(t){function y(){var n=t.getGL();if(n)for(var m=t._postProcessing,X=0;B>X;X++)C[X]=m.createShader(n,ut._35Q,function(b,i){return{fs:i.replace(/DEFINE_VALUE/g,Y[X]).replace("%OVERRIDE_ALPHA_DEFINE%",w?"#define OVERRIDE_ALPHA":"")}})}function g(){var u=t.getWidth(),k=t.getHeight();if(!u||!k)return!1;var R=t.getGL();if(!R)return!1;W=[u,k];var G,a=Math.round(W[0]/2),X=Math.round(W[1]/2);for(O=new lp.RenderTarget(t,R,a,X),P=[],f=[],G=0;B>G;G++)P.push(new lp.RenderTarget(t,R,a,X)),f.push(new lp.RenderTarget(t,R,a,X)),a=Math.round(a/2),X=Math.round(X/2);var H=t._postProcessing;return U=H.createShader(R,ut._34Q),y(),o=H.createShader(R,ut._36Q,function(O,l){return{fs:l.replace(/NUM_MIPS/g,B)}}),Q=H.createShader(R,ut.finalShader),s=kk.Buffer.createIndexBuffer(R,new Uint16Array([0,2,1,1,2,3])),V=kk.Buffer.createVertexBuffer(R,new Float32Array([0,0,1,0,0,1,1,1])),S=!0}var u,J,i,w,j,s,V,I,G=this,b=!1,S=!1;this.serializeProperties={strength:1.5,threshold:.55,radius:.4,overrideAlpha:!0,selective:!1},this.resetProperties=function(){var Q=this.serializeProperties;for(var M in Q)this[M]=Q[M]},T.defineProperties(G,{enable:{get:function(){return b},set:function(H){!!b!=!!H&&(b=H,t.iv())}},strength:{get:function(){return u},set:function(B){u!==B&&(u=B,t.iv())}},threshold:{get:function(){return J},set:function(N){J!==N&&(J=N,t.iv())}},radius:{get:function(){return i},set:function(N){i!==N&&(i=N,t.iv())}},overrideAlpha:{get:function(){return w},set:function(d){!!w!=!!d&&(w=d,S&&y(),t.iv())}},selective:{get:function(){return j},set:function(n){!!j!=!!n&&(j=!!n,t.iv())}}}),this.resetProperties();var O,U,o,Q,W=[256,256],P=[],f=[],B=5,Y=[3,5,7,9,11],C=[];G.contextLost=function(){S=!1,I=null},G._42=function(R,A){function Y(d,u,F,S){Ol(R,u.frame),t.setViewport(R,0,0,u.width,u.height),S?S(R):R.clear(R.COLOR_BUFFER_BIT|R.DEPTH_BUFFER_BIT),x!==d&&d.bind();var G=0;for(var T in F){var Z=F[T];Z instanceof WebGLTexture&&(R.activeTexture(R.TEXTURE0+G),Eb(R,Z),Z=G,G++),d.uniforms[T]=Z}for(x!==d&&(s.upload(),V.upload(),d.attributes.pos.pointer(V),x=d),R.drawElements(R.TRIANGLES,6,R.UNSIGNED_SHORT,0);G--;)R.activeTexture(R.TEXTURE0+G),Eb(R,null);Mo(R)}if(b&&(S||g())){var x;if(j){I||(I=new lp.RenderTarget(t,R)),I.setSize(R,A.width,A.height),I.bind(R);var p=R.getParameter(R.COLOR_CLEAR_VALUE);p&&0===p[0]&&0===p[1]&&0===p[2]&&1===p[3]?p=null:go(R,[0,0,0,1]),R.clear(R.COLOR_BUFFER_BIT|R.DEPTH_BUFFER_BIT),t.setViewport(R,0,0,A.width,A.height),R._blooming=!0,t.syncRenderState(),t.renderScene({renderAxis:!1,renderGrid:!1,renderEdit:!1}),R._blooming=!1,p&&go(R,p),I.unbind(R)}Y(U,O,{smoothWidth:.01,luminosityThreshold:J,tDiffuse:j?I.texture:A.texture});var d,a=O,z=Math.round(W[0]/2),M=Math.round(W[1]/2);for(d=0;B>d;d++)Y(C[d],P[d],{colorTexture:a.texture,direction:[1,0],texSize:[z,M]}),Y(C[d],f[d],{colorTexture:P[d].texture,direction:[0,1],texSize:[z,M]}),z=Math.round(z/2),M=Math.round(M/2),a=f[d];return Y(o,P[0],{blurTexture1:f[0].texture,blurTexture2:f[1].texture,blurTexture3:f[2].texture,blurTexture4:f[3].texture,blurTexture5:f[4].texture,bloomStrength:u,bloomRadius:i,bloomTintColor:[1,1,1]}),Y(Q,A,{image:P[0].texture},function(g){Jm.for(g).glState.blend.apply({enabled:!0,equation:g.FUNC_ADD,func:[g.SRC_ALPHA,g.ONE]})}),Jm.for(R).glState.blend.apply({equation:R.FUNC_ADD,func:[R.SRC_ALPHA,R.ONE_MINUS_SRC_ALPHA,R.ONE,R.ONE_MINUS_SRC_ALPHA]}),A}}};ut._34Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f*d!jbtijqpmob!!i-jmhfiyqf!ug!m-psbpum<pDvuovjqgupvspn!!)tybjnnq!m>f!ss3pEm!puDEhjbgsgGv`tmfh<<v*o!jwg!p-sinu!egjmXpibuup!pmnvtn!j,o!petmjpuiztUfissifUtziupjmtep<ojvnovjmg!p-senm!pgimtpfbsui!UtznupjptupioXjjnevumi!<)qwfbustzijuophp!nwtf!d>3!!bwiVqwm<b!wupbjpem!gnb<j*o1)/*1!!|-1w/f1d!5-!1u/f1y!f-m1!/>1!)u5fdyfuwv!s>f!3sEp)m!puDEujvgqguvvtpf!-5!dwfVww!<**<!bwnfvdm4!!-m{vznyb/!m>f!ywffud!4))u!p1e/!3>:!:w-!!u1b/p6m9g8-<!*1!/522",ut._35Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qsgfjdejotfj$po<!*ibj/hyijqQ!fgsmvpubyuf<u!w-bnsvzTjuoihh!jwffxd03n!vwTVfwt<vgvgojjeg)p5sdnf!wt!b>n!qsmpfmsp3DEh!bdspGm`pmshUffytumvfs$f<<*v1o/j2g!p-snnv!Twufidh3j!fuxf0ynTvjT{fft<vgvgojjeg)p5sdnf!ww!f>d!3s!pemjpsDfhdbusjGp`om<h$BeIfQgMjBo`fF!ELJFSSSOFFWMP`!SgBfEeJgVjT$!E~FG<JxO!F+`!W1B/M3V!F>,$!enfvgTjuoifh!jTfJxHN<Bx!!E+F!G*J3OfFm`qWnBbMtV!F,!&2PfWmFqSnSbJtE)F!`>B,M!QnIvBT`fEtFvGgJgOjFe&<gcmhpsb/u*!uhfbtvgtgtPjwbvo!Q.e!gw)Vjwo!!-gfmspvbuuy!fyU-s!pjmop!dg!m)pEb3uf!stvjuhynfbu*!!>|!3sffmuqvnsbot!!14/d4f:w9:<5c!h+s!/f*yuqf)t!g.g1P/w6v!!+,!!yw!V+w!!y-0f)s!vtujyhfnUbs!p+m!ptdj!h)nEb3*f*s0vtujyhfnub!<>!~2fwmpqjneb!tn!b4jdof)w*!<|y!w+f!df3{!jjTowwoTjj!{+f!!o>p!j2u/d1f!s0j!eu!f>y!Tujf{tfg<gPgwmvp!b3ud!fgwTj<h*nbbn!h>j!Tggm!p-byu))gTeJQHoNbBj*t<tvgbmhp!b>u!!xx!fujbhpimugTv<n*!j>)!uhbbpvmtgt!j>b!oyQ!eugb)p1m/g1-|!!g*T!j,h,n!bj*!<<TwVfJdE5B!Su`fMyFuOvSsFfLQ!j=y!!j>!!<u2f!y>u!vjs!fu3oEj)!!)dsppmgps<UnfvyTuuvishfj-f!xw!V+w!*c<hsw/fydj4Q!fesjvgugyvftuf!T>v!n",ut._36Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f*d!j*twjVpwo!!-i6jfhsivqu!ygfmUpsbvum<c)wEb3sfzsjvouhy!fwuf!d+3!!*w1V/w2<!-vsopjmgppDsuno!jtUbnnpqpmmfcs)35Ed!fcwm!v+s!U*f3y/u1v)ssfp2u<dbvGonjpgppmsCnq!stfbmnq!m,f!s*3wEV!wc!m-v5sfUsfvyuuyvfsUfs3v<mcv)oEj3gfpssvnu!ytfbun!q+m!f*s13/E2!!c-msvpsmUpfDyuuovjsUfn4p<pmvco)j5gdpfswn!!+t!b*n5q/m1f)ss3pEu!dcbmGvnspUpfmyCuqvssffm5<!,v!o*jwgVpws!n-!4tfbsnvqumyffsU3sEv!mccm)vEs3Uffsyvuuvysffu6!<+!v*o1j/g2p!s-ns!ptmbpnDqumofjsU3nEp!pemjcs)u5Udffywu!v+s!f*<7/v1o)jsgppusdnb!GgnmpppbmuC!qcsmfpmpn!T,u!s*fwoVhwu!i-<3fvsovjugypfsUns!vgmmcp)bEu3!fcsmvpupynfSub!e+j!v*t1</2v!o-jsgppmspnD!uwofjdU4n!pcpmmpcp)n5Udjfowu!D+p!m*p9s/<1)gsmppubdub!GmnfpspqmCCmqpspfnmGb!d,u!p*sw)Vdwp!o-t2uf!sjvou!ygfmUpsbvum!cg)bEd3ufpssv*u!y|fug!m+p!b*u1!/n2j!s-ssppsmGpbDduuopjsU!n>p!p2m/c3)!5.d!fgwb!d+u!p*s1</2s)fsupvusdob!Gnnjpyp)mgCbqdsufpms!-)!!n+j!sisuphsoGfbsduuTpnsp-p!mccm!p>p!nsSpbmepjDvhtb*s<G`~mhwp|j!e*!)nobj",ut.finalShader="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f*dwjVtwj!p-of!hibjnhji)qE!3gfmspvbuuy<fuv!o>j!gsppsmnp!DthbbnsqGm`fmsh3E|!!j*n)bohjfb<n!webjspzwjo<hw!Vwwf!d3";var vt=B.graph3d.PostProcessing.Dof=function(D){function G(){var C=D.getGL();return C?(Y=new lp.RenderTarget(D,C),O=D._postProcessing.createShader(C,vt._38Q),f=kk.Buffer.createIndexBuffer(C,new Uint16Array([0,2,1,1,2,3])),V=kk.Buffer.createVertexBuffer(C,new Float32Array([0,0,1,0,0,1,1,1])),d=!0):!1}function u($,l,h,b){x=null;var r=$.getCanvas(),v=r.width,P=r.height;if(h=h||1024,v>h||P>h){var A=h/Math.max(v,P);v=Math.round(v*A),P=Math.round(P*A),I||(I=On()),r=R.resizeImage(r,v,P,I)}var N=D.getGL();if(t||(t=N.createTexture()),W=Qc(N,r,t),w=l||.01,n=!0,D.iv(),b--){if(x)return;x=R.callLater(function(){u($,l,h,b)})}}var Y,O,f,V,W,h,v,q,I,t,x,i=this,A=!1,d=!1,w=0,n=!1,M=jl.generateUUID();this.serializeProperties={aperture:.025,maxblur:1,image:null},this.resetProperties=function(){var X=this.serializeProperties;for(var r in X)this[r]=X[r]},T.defineProperties(i,{enable:{get:function(){return A},set:function(e){!!A!=!!e&&(A=e,e||(n=!1),D.iv())}},image:{get:function(){return h},set:function(L){h!==L&&(h=L,n=!1,W&&(D.deleteTexture(M),W=null),D.iv())}},maxblur:{get:function(){return v},set:function(p){v!==p&&(v=p,D.iv())}},aperture:{get:function(){return q},set:function(X){q!==X&&(q=X,D.iv())}}}),this.resetProperties(),i.contextLost=function(){d=!1,W&&(D.deleteTexture(M),W=null)},i.setImageFromGraphView=function(N,x,M){this.image=null,u(N,x,M,2)},i._42=function(l,s){function g(M,R,U,S){Ol(l,R.frame),D.setViewport(l,0,0,R.width,R.height),S?S(l):l.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT),m!==M&&M.bind();var N=0;for(var q in U){var a=U[q];a instanceof WebGLTexture&&(l.activeTexture(l.TEXTURE0+N),Eb(l,a),a=N,N++),M.uniforms[q]=a}for(m!==M&&(f.upload(),V.upload(),M.attributes.pos.pointer(V),m=M),l.drawElements(l.TRIANGLES,6,l.UNSIGNED_SHORT,0);N--;)l.activeTexture(l.TEXTURE0+N),Eb(l,null);Mo(l)}if(A&&(d||G())){var m;if(!W){var H=Td(this.image);if(!H||!H.comps&&!H.tagName)return s;B.Default.setImage(M,H),W=D.getTexture(M)}var u=s.width,S=s.height;if(u&&S)return Y.setSize(l,u,S),g(O,Y,{tColor:s.texture,tDepth:W,aspect:u/S,aperture:this.aperture,maxblur:this.maxblur,useG2d:n,threshold:w}),Y}}};vt._38Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f1d/j2t!j>p!ob!/isjphmipqD!hgbmspGb`um<hw<b1s/z2j5o!h0!!wmfpdd3!!>w!Vswp<mpvDohjbgspGs`nm!hcp<p*m!!5vstvfmEcfgqpuei!<+!v*o!jugdpfssns!ptdbundqfmqftsb3!E+!!u*D!p5m/p1s!<-1v/o1j!g)p3sdnf!wt!b)n!q,m!fzsy3/Ew!VuwE!f-qsupim<pDvuo!j)gEp3sfns!vcupypfmu!!v>t,f!Hm3ped<<v*o!j5gspvsmnc!ggpmep!b+u!!*u!iusdfftsisppmdeu<dfvqotjbg!p+s!n*!!g:m3p/b1u.!!n-b:y3c/m1v.s!<)3vdofjwg!p)s!n,!!gzmyp/bwuV!wb!q-fsspumvpsDfu<!)vEo3jfgspvsuny!fgum!p>b,u!!mopfdbs<D*m!j5qs<vmvcogjpgep!s+n!!*g!mupdbfus!sgpbdsuDdmfjqqt<b!v+o!j*g!p1s/n1!!g-m5p/b1u.!!g)p3ddvftw<!)v!o,j!gzpys/nw!Vgwm!p-bsup!mbptDquf!d)uE<3fdspvoutyuf!ug!m>p,b!um!pVdoq<b*d!l5Espvxmoctgdpbem!f+!!>*!!3u6d6f/s!s0p!d3u6d7f/q<t!b0!0+!!1*/!/:23!/.1?!!-g:s3b/d1u.j!p)o3!d)ffwy!d)m!v,e!jzoyh/!w2V*w!d-psoptmup!Dwuf!d)4E!3QfbsdvluGybfduu!p>s,t!!m>p!dwf<d*4!)5!s3v6m7c/g!p+e!!3+6!7*/!!u+d!f3s6s7p/d-u!d3f6q7t/b!!++!!3*6!75//-1!.3!6-71//!1*!<)3ddpfowt!u)!!w,f!dz5y!/VwoVqwb!d-lsGpbmdpuDpus!t)!E>3!fVsovqubydfluE!p>x,o!tmdpbdmf<!*0!!5wsfvdm5c)g!pQeb!d+l!G*b!duudpfssts-p!d2u/d!f*q<tbg!m+p!b*u!!:v3o/q1b.d!l-S:H3C/B1U!p)E3fdqfuwi!))!!d,p!oztyu/!wjVow!!w-fsdp5m!pwD!u*!!)|E3!fssfvuuvysfou!!e>p,u!)m!pwd-!<V*o!q5bsdvlmGcbgdpuep!s+t!!**!<ud~fsgsmppdbuud!fhqftubE!f+q!u*i!)1!/d1p!o-t5u/!1j!o)!3wdffdw3!!)t!d,s!fzfyo/QwpVtwj!u-jsppom!p*D!u|!)\nEs3ffusvvsuoy!fvuo!q>b,d!lmSpHdCB<U*p!E5fsqvumic)g!puef!y+u!v*s!fu3dEf)s!supEdfuqdufiq-t!bt!d+s!f*f!o:Q3p/t1j!u-j:p3o/!1*!!)*3<df~w!g)m!p,b!uz!yq/fwsVtwq!f-dsupjmwpfDEuf!q)uEi3UfpsWvjufyxf[u)!!>d,p!omtpud!j<o*!!g8mspvbmuc!gjpoew!D+m!j*q![u-d!fdspsoptduu!djfoq!tgbm!p+b!u*!!o5f/b1s!--!1d/p1o!t)u3!djfow!!g)m!p,b!uz!yg/bwsV!w*!!-|sp!mspfDuuv!s)oE!3)f!sovfubysf!u+!!>g,b!sm!p*d!0<!*)!!8)s!vgmbcsg!p.e!!o+f!b*s!!u*d!f+s!sjpodwuDdmfjqqt[b!!.+!!g*b!s:!3*/<1.~!-g:m3p/b1u.!!h)f3udWfjwf!x)[!),!!dzpyo/twuV!wj!o-!sgpmmppbDuu!!e)fEq3ufis!v*u!y|fu\n!s>f,u!vmspod!q<f*s!t8qsfvdmucjgwpfeE!f+q!u*i!UupdWfjsfsxp[d)u!deffqqtubi!-+!!o*f!b1s/D1m!j-q5-/!1g.b!s)D3mdjfqw!!*)<!,~!zwyp/jweV!wn!b-jsop)m*p!D|u!w)fEd33f!sevpugycfmuv!s><,!wmfpdd3!<b*t!q8fsdvumdcpgspsef!d+u!!*>!!uwdffds3s)p!d2u/d1f-q!tbbt!q+f!d*u!!:*3</1j!g-!:)3v/t1f.E!f)q3udif*w!!|)!!,g!mzpyb/uw!Vwwj!f-xs[p!m>p!Dhuf!u)WEj3ffxs[v)u!yhffuu!E>f,q!umip)d!w<V*w!!8*s!v*m<cg!pgem!p+b!u*!!gubddfuspssp!d>u!d)f!qgtpbd!v+t!!*,!!5w/j1f.x![-!1*/<1!!)e3pdgfcwm!v)s!!,>!!zwyf/dw3V!w)!!-dsmpbmnpqD)u!!g)bEd3ufpssv!u+y!fbuq!f>s,u!vmspfd-!<.*n!b8yscvmmvcsg-p!en!b+y!c*m!vusd!f*s!s*p<du~dffqmttbf!!+|!*w!f:d35/!1u.f!y-f:m3!/>1!!u)f3ydufvws!f)3!E,)!!zuyE/fwqVuwi!--!swpfmdp3D)uw!V)wE/3yf-s!v2u/y1f!u.!!>w,V!wm/pzd*!<**<!8gsmvpmbcug!pbem!q+i!b*<!ujdgf!s)svptdfuHd3feq*t!b|!+b!m*q!i1b/!1>!!-t1n5p/p1u!i)t3udffqw)!!)u!i,s!fztyi/pwmVew-!!-usipsmfptDiup!m)eE!3,f!s1v/u1y2f-u!!u>f,y!fmmp/db!<**<!8~s!vfmmctgfp!e|!!+b!m*q!iubd!f>s!supfdyufdmf/qbt<b!!~+!!*e!p:g3c/m1v!s-!:>3!/w1f!d)33!d)f!wd!m)b!n,q!)z!yb/mwqViwb!!-+s!pbmqpfDsuu!v)sEf3-f!s.vnubyyfcum!v>s,-!!mnpbdyc<m*v!s:!s*v!m*c<gp~e!w+f!d*3!!uedpfgscsmpvdsu:d!f>q!tebp!g+c!m*v!s8!4+/!11./!:-<62w/f1d!3)!3edpfgwc!m)v!s,8!!z>y!/ewpVgwc!m-vssp!m+p!D1u/!8)<E3wffsdv3u!yefpug!c>m,v!sm5p!d>!<e*p!g:csmvvmsc!g+p!e1!/+5!<*!wufddf5s!sdppdmu!d>f!qwtfbd!5+)!!*1!/612!/*1<.!d-p8m4!/,1>.!!u)f3ydufvws!f)3!E,)!!zuyD/pwmVpws!--!swpVmwp/Dyuz!!)*E<3fdspvmu!y,f>u!!u>f,y!umvpsdf3<E*)!!:usDvpmmcpgsp-e!!w+V!w*/!yuzd!f,s!s)p!dwufddf3q)t!b1!/+1!-*!!16/25/!1*!!-+8!4b/t1q!f)d3uddfpws!s)f!d,u!!z*y!/+w!Vewp!g-csmpvmsp!D*u<!)dEp3mf!s,v>u!yuffuy!u>v,s!fm3pEd)!<u*D!p:mspvsm-c!gwpVew!/+y!z*!!,u!d)f!swsfpdd3u)d!f1q/t2b6!-+!!1*/!4884!/*1!!+-!6b2t/q1f.d!u)d3pdsfswf!d)u!!,*!!z+y!/ewpVgwc!m-vssp!m*p<Dud!p)mE!3,f>s!vuufyyfuuv!s>f,3!Em)p!duD<p*m!p:ss-v!mwcVgwp/ey!z+!!,*!!)u!dwffsds3p)d!u1d/f3q:t-b!!1+/!3*:!!8*4!/+1!.b!t-q6f2d/u1d.p!s)s3fddfuw!!*)!!+,!!ezpyg/cwmVvws!!-*s<pmdppDmu!!,)>E!3uffsyvuuvysffu3!E>),!!umDppdmp<s*-!!:wsVvwm/cygzp!e,!!+)!!*w!fudd3f)s!s.p1d/u4d8f-q!t1b/!2+6!!**!!6+2!/b1t.q!f-d8u4d/p1s!s)f3dduf!w*!!)+!!,e!pzgyc/mwvVsw!!*-<spdmppmD!u,!>)!Eu3ffysuvvusyff3uE!)>!,u!Dmppmdps<-*!!w:Vswv/myczg!p,e!!)+!!w*f!du3d)f!s1s/p5d1u-d!f1q/t1b!!*+!!+*!!b6t2q/f1d!u-d8p4s/s1f.d!u)!3*d!f+w!!e)p!g,c!mzvys/!w*V<w!d-psmp!m,p>D!uu!f)yEu3vfssfv3uEy)f!uu!D>p,m!pmsp-d!w<V*w!/:yszv!m,c!g)p!ew!f+d!3*)!!u1d/f4s8s-p!d.u1d/f2q6t!b*!!++!!*b!t8q4f/d1u!d-p6s2s/f1d!u)!3*d!f+w!!e)p!g,c!mzvys/!w*V<w!d-psmp!m,p>D!uu!f)yEu3vfssfv3uEy)f!uu!D>p,m!pmsp-d!w<V*w!/syvzm!c,g!p)e!!w+f!d*3!)u!d1f/s3s:p-d!u.d1f/q3t:b!!*+!!+*!!b8t4q/f1d.u!d-p6s2s/f1d!u)!3*d!f+w!!e)p!g,c!mzvys/!w*V<w!d-psmp!m,p>D!uu!f)yEu3vfssfv3uEy)f!uu!D>p,m!pmsp-d!w<V*w!/syvzm!c,g!p)e!!w+f!d*3!)u!d.f1s/s2p6d-u!d.f1q/t4b8!!+*!!*+!!:b3t/q1f.d!u-d:p3s/s1f.d!u)!3*d!f+w!!e)p!g,c!mzvys/!w*V<w!d-psmp!m,p>D!uu!f)yEu3vfssfv3uEy)f!uu!D>p,m!pmsp-d!w<V*w!/syvzm!c,g!p)e!!w+f!d*3!)u!d1f/s1s-p!d.u1d/f5q!t*b!!++!!b*t!q6f2d/u1d.p!s-s8f4d/u1!.*!!)+3!defpwg!c)m!v,s!!z*y</wdVpwm!!-,s>p!mupfDyuu!v)sEf33fEs)v!uuyDfpum!p>s,-!!mwpVdw/<y*z!!s,v!m)c!gwpfed!3+)!!*.!1u/d2f6s-s!p1d/u4d8f!q*t!b+!!+b!t*q!f1d/u1d!p-s5s/f1d.u!!)*3!d+f!we!p)g!c,m!vzsy!/*w<Vwd!p-ms!p,m>p!Duuf!y)uEv3sffs3vEu)y!fuuD!p>m,p!sm-p!dwV<w*/!yszv!m,c!g)p!ew!f+d!3*)!!u.d1f/s3s:p-d!u1d/f3q:t!b*!!++!!*b!t6q2f/d1u!d-p8s4s/f1d!u)!3*d!f+w!!e)p!g,c!mzvys/!w*V<w!d-psmp!m,p>D!uu!f)yEu3vfs";var wt=B.graph3d.PostProcessing.Blur=function(m){function p(){var A=m.getGL();return A?(a=new lp.RenderTarget(m,A),D=m._postProcessing.createShader(A,wt.hBlurShader),i=m._postProcessing.createShader(A,wt.vBlurShader),u=!0):!1}var D,i,a,b,A,h,v,d,s,k=this,Z=!1,u=!1;this.serializeProperties={value:0,downSample:!1,iterations:1,layer:"main"},this.resetProperties=function(){var i=this.serializeProperties;for(var k in i)this[k]=i[k]},T.defineProperties(k,{enable:{get:function(){return Z},set:function(q){!!Z!=!!q&&(Z=q,q?m.addRenderLayerListener(G,this):m.removeRenderLayerListener(G,this),m.iv())}},downSample:{get:function(){return v},set:function(x){v!==x&&(v=x,m.iv)}},value:{get:function(){return h},set:function($){h!==$&&(h=$,m.iv())}},iterations:{get:function(){return d},set:function(D){d!==D&&(d=D,m.iv())}},layer:{get:function(){return s},set:function(R){s!==R&&(s=R,m.iv())}}}),this.resetProperties();var G=function(h){if(Z&&h.layer===s&&"post"===h.phase){var W=m.getGL();if(!m._picking&&!m.isReflecting(W)){var i=m._postProcessing.getRenderTarget();i.unbind(W);for(var r=0,z=m._glCapabilities.maxAttributes;z>r;r++)W.disableVertexAttribArray(r);k.drawImpl(W,i),i.bind(W),W.useProgram(m._prg)}}};k._42=function(){},k.contextLost=function(){u=!1,b=null},k.drawImpl=function(C,R,T,H,L){if(u||p()){var N,$;if(R?(N=R.width,$=R.height):(N=m._viewport[2],$=m._viewport[3]),N&&$){var z=m._postProcessing;"boolean"!=typeof H&&(H=v),T==I&&(T=h),L==I&&(L=d),L=Math.max(1,Math.round(L));var X=Jm.for(C).glState.depth,W=X.enabled;if(X.enabled=!1,H){T/=2;var x=[N,$];N/=2,$/=2,b||(b=new lp.RenderTarget(m,C),A=z.createShader(C,wt.downSampleShader)),b.setSize(C,N,$),z.blitScreen(b,R.texture,A,{texelSize:[1/x[0],1/x[1]]}),R.setSize(C,N,$)}else b&&b.setSize(0,0);a.setSize(C,N,$);for(var e=[],P=0;L>P;P++)e.push(T),T=Math.max(1,Math.floor(T/2));for(var P=0;L>P;P++){var s=e[L-P-1],Z=H&&0===P?b.texture:R.texture;z.blitScreen(a,Z,D,{value:s/N}),H&&P===L-1&&R.setSize(C,x[0],x[1]),z.blitScreen(R,a.texture,i,{value:s/$})}return X.enabled=W,R}}}};wt.hBlurShader="!!b~u!us<j*czv/utfp!qw!f.d!31!/q2p!t-<y/!twpbqs)z3jdofhw!!w>f!dw3V!ww!Vw<<*1/!2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+!!hzm/`tQppqt.j!u-j1p/o2!!>.!!w1f/d35!)+q!pyt/^#!!q~s!fd<jntvjtp!o>!!isjphmipqD!hgbmspGb`um<h!!vo<j2g6p1s/n1!!t+b!n*q!m*f!sz3/Ew!Vjwn!b-hffv<mb!ww!b+s!z1j/o5h!!,w!fyd/3w!VwwV!w)<3d!fvwo!j-gfphsbnn!jg!m)pEb3uf!swvbumyvffu<!>,!!wnpvjte!!n<b9j2o:)1*/!1|!+!!w*f!d*5!!zt/vwnV!w>!!-wffvdm5b)w!!1+/!11!/*4<!,!!yt/vwnV!w,!>)!3udffywu!v-sffh3bEn)j!!j)nEb3hffs-v!uwyffdu3!)>!,w!Vnwv/ty!!.<!655/313!2+/!1w!b+m!v*f!-*!!wzV/ww/Vzw!!*-!f*v!m+b!w1!/+1!612/<3!!,t!vyn/!w,V>w!!u)f3ydufvws!f-3fEh)b!njjn!b)hEf3-f!swvfudy3f)u!!w>V,w!/nyv!t.!!4</214!6+2!/w1b!m+v!f*-!!*w!Vzw//wzV!w*!!-*f!v+m!b1w/!1+:!219/<2!!,t!vyn/!w,V>w!!u)f3ydufvws!f-3fEh)b!njjn!b)hEf3-f!swvfudy3f)u!!w>V,w!/nyv!t.!!3</414!7+2!/w1b!m+v!f*-!!*w!Vzw//wzV!w*!!-*y!/+w!V1w/!2)333d5f6w<!-!fthvbnn!j,!>)!Eu3ffysuvvusyff3uE!)>!,j!nnbvhtf!-!<w2f4d632)/!1w!V+w!/*y!!*.!!z2//w1V!w+!!-wfbvm",wt.vBlurShader="!!b~u!us<j*czv/utfp!qw!f.d!31!/q2p!t-<y/!twpbqs)z3jdofhw!!w>f!dw3V!ww!Vw<<*1/!2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+!!hzm/`tQppqt.j!u-j1p/o2!!>.!!w1f/d35!)+q!pyt/^#!!q~s!fd<jntvjtp!o>!!isjphmipqD!hgbmspGb`um<h!!vo<j2g6p1s/n1!!t+b!n*q!m*f!sf3vEm!bjwn!b+h!f1</5!!w,b!szz/jwoVhw!!w-fyd/3w!VwwV!w)<3d!fvwo!j-gfphsbnn!jg!m)pEb3uf!swvbumyvffu<!>,!!wnpvjte!!n<b9j2o:)1*/!1|!+!!w*f!d*5!!ftvvmnb!w>!!+w!f1d/54)!!,1!/z1/!w*V<w!-!yt/vwnV!w,!>)!3udffywu!v-sffh3bEn)j!!j)nEb3hffs-v!uwyffdu3!)>!,w!Vnwv/ty!-!<w6V5w3/3z2!/.1!!5+/!1*!!+*!!wfbvmmvbfw!!*+!!*1!/+3!!1,/!1z6/2w<Vw!!t-vyn/!w,V>w!!u)f3ydufvws!f-3fEh)b!njjn!b)hEf3-f!swvfudy3f)u!!w>V,w!/nyv-t!!wV<w2/4z6!2./!14!/+1!!*+!!*w!bfmvvmfb!w*!!+*!!1+/!21!/,1!:z2/9w<Vw!!t-vyn/!w,V>w!!u)f3ydufvws!f-3fEh)b!njjn!b)hEf3-f!swvfudy3f)u!!w>V,w!/nyv-t!!wV<w4/4z7!2./!13!/+1!!*+!!*w!bzm/vwfV!w*!!-*y!/+w!V1w/!2)333d5f6w<!-!fthvbnn!j,!>)!Eu3ffysuvvusyff3uE!)>!,j!nnbvhtf!-!<w2f4d632)/!1w!V+w!/*y!-*!!wfVvwm/bzw!!.+!!21/",wt.downSampleShader="!!b~u!us<j*czv/utfp!qw!f.d!31!/q2p!t-<y/!twpbqs)z3jdofhw!!w>f!dw3V!ww!Vw<<*1/!2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+!!hzm/`tQppqt.j!u-j1p/o2!!>.!!w1f/d35!)+q!pyt/^#!!q~s!fd<j1t/j5p!o0!!i*j*h*i1q/!2g!m-p1b/u1<)3!dvfowj!g+p!sfn{!jtTbmnfqymffus!3,E!!wjVnwb!h-ff<hb!nwjb)sEz3jfoshv!uwyffdu3!!w,V!w*<*1!/v2o.j!g-p1s/n1!)w3fddf3w!!u+f!yff{mjTTjm{ffy<fu!!,w!pwjVew!!n-bfjhob)n*j)!E|3f!shvmu`yGfsub!hD,p!m*p*s1!/>1!!)-u1f/y2u.v)s3fd3fEw)!j+n!bfh{fj-T!mwfVywf!u,!!,u!fwyVfwm!T-jf{hfb!n+j!)wEf3df3s)v2u/y1f-u!!1/,1!**";var xt=B.graph3d.PostProcessing.Glitch=function(y){function q(){if(V&&u){r=Date.now(),o=0,D=1e3*Z(u[0],u[1]),k=[];for(var X=1,I=V.length;I>X;X+=2)k.push((X>1?k[k.length-1]:0)+D*V[X]/z)}}function I(){y.redraw()}function _(){var E=y.getGL();if(!E)return!1;t=new lp.RenderTarget(y,E),P=y._postProcessing.createShader(E,xt.Shader);for(var A=x*x,X=sb(x,x),i=X.getImageData(0,0,x,x),R=i.data,q=0;A>q;q++)R[3*q+0]=$(256),R[3*q+1]=$(256),R[3*q+2]=$(256),R[3*q+3]=$(256);return X.putImageData(i,0,0),p=Qc(E,bp),N=!0}var t,P,D,r,o,k,p,W,u,V,v=this,O=!1,N=!1,Z=jl.randomFloat,$=jl.randomInt,z=0,x=64;this.serializeProperties={onlyReflector:!1,period:[2,3],intensity:[3,.3,1,.1,0,.4]},this.resetProperties=function(){var D=this.serializeProperties;for(var V in D)this[V]=D[V]},T.defineProperties(v,{enable:{get:function(){return O},set:function(t){!!O!=!!t&&(O=t,t&&q(),y.iv())}},onlyReflector:{get:function(){return W},set:function(T){!!W!=!!T&&(W=T,y.iv())}},period:{get:function(){return u},set:function(T){u=T,q(),y.iv()}},intensity:{get:function(){return V},set:function(S){S||(S=[1,1]),V=S,z=0;for(var D=1,G=S.length;G>D;D+=2)z+=S[D];q(),y.iv()}}}),this.resetProperties(),v.contextLost=function(){N=!1},v._42=function(v,M){if(O&&(N||_())){var g=!!y.isReflecting(v);if(g===!!W){var f=M.width,H=M.height;if(f&&H){var b=y._postProcessing,J=Jm.for(v).glState.depth,B=J.enabled;J.enabled=!1,t.setSize(v,f,H);var T,S=Date.now();S-r>k[o]&&(o++,o>=k.length&&q()),T=V[2*o];var m={seed:Math.random(),byp:T?0:1,tDisp:p};return T&&(m.angle=Z(-Math.PI,Math.PI),m.distortion_x=Z(0,1),m.distortion_y=Z(0,1),m.amount=Math.random()/30*T,m.seed_x=Z(-1,1)*T,m.seed_y=Z(-1,1)*T),b.blitScreen(t,M.texture,P,m),J.enabled=B,requestAnimationFrame(I),t}}}}};xt.Shader="!!b~u!us<j*czv/utfp!qw!f.d!31!/q2p!t-<y/!twpbqs)z3jdofhw!!w>f!dw3V!ww!Vw<<*1/!2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+!!hzm/`tQppqt.j!u-j1p/o2!!>.!!w1f/d35!)+q!pyt/^#!!q~s!fd~j!tj<p*ow!Viwj!h-ifqh!bgnmjp)b!uE<3f!svvoujygfpus>ns!pjmopuD!hcbzsqG<`m!hv!oj|g!pfstnm!ft!bn~q!mf<sx3pEo!tj!n,bshpfm<pD!hvbosjGg`pmshn!!>t!bsnpqmmpfDsh3bEs!Gu`Emjht!q<<*3!/v1o+j*g*p/s1n6!+gemfpfbtu!!+b!ntpzv-oeuf<ft!!v+o!jtgyp)s3nd!fgwm)peboub!sb)o5hdmffw<+u!ovvopjngbp+s/n1!1g3m!p>b!ux!ptoftf!e5<df!wv!ojfgtpjspno!!gemepbb0u0!!tf<f*eb`/yb<hd!!v-ocj/gcpds!n-!hg/mbphbdu!!-tsf/fsed`)z5<df!wv!o>j!gsppsmnp!DghmbpsbGu`!mehj!tu<p*suufjtpgog`py!<.!!qv!o-jfghpbsnnj!)gEm3pfbsuv!ueyjftuu!p>s!ucjdp!o5`dzf<w!!v<o*jqg!p-sfnh!bgnmjp)bEu3!fdspvmu`ytf<u!>!!wbbhsdz!j5odhf!ww!fd<3*!uwfVtwg<gp!!,d!pqo!t-uf!hgbmnpjb)uE!3VfosqvbudylfEup!x>o!tsddb!m5fd!f>w!!36<6*/*!f0m!h3o6b7)/o<jt!!d-p*oftmuh!owbf)dt4p!dQ)b3ddlfGwb!d+u!pusotv!p>n!bw!f>d!4u)f!t3g6g7p/!!3+d!f3w6!7/s!f+e!b3i6t7!/u-g!j3i6t7!/C!H+S!!3n6p7s/g-!!f3t6b7c/0!0*!<<!*d/p6o0teuf!fwtf)d+5z!`Veofqfbtd+lmGbbndsuppos>t,!z>/!qV!oq<b*d/l6E0pexfofttd)b+myf`!e0f!fwtf+dm5b)n!sQpbod>l,Gyb/dqu!ps~t!-!~2!/!<**<y`!ogpmjpubsup!uvtojqeb!d,l!SyH/CqB)U!p.E!f/q2u!i>)!!yd/pqo!tu|!!jfot!mwff!d5~!!w!<*y!`|op!jsufsupvustoj!ee>pyu/)q!!w-|!*V/o1q?bzd`leGfbfdtu)pgsjt!!*|<!*!e~fft!+gtm`pmbpud!.szb`ooep)jwufsdp3u!tdjpe*?|y/!qs!f%u%v!sto`!mgpsdb,dzu`)otpjjou)seppuut)jdep=/yy/zq!)-gwjf!d3~)!23~/!:9<:z9`-o8p9j/u3s4p4u*t*j*e!!+>!!5z4/8q6!9/|6!5f6t4m*f<!!~~!<!*wzp`joep!jnubsjpou)t*j!e|!,!!jzg/)qc)z!q.=!2/*2!!|>!!zw/fqd!3!|q*!/>1!?wyV`we<ff!tg)mgpjb!u!|y!t*!e>f!fgtm+ptp`sm)phdm.`yG`sobphjDupsppsuet/jye!?0z!/1q/!6%*%<!t!`gmmppdb,uy!`zotp!j>u!sgpmuptpjse)=hzm/`qG)sgbjh!Dp<p*s*ee/fzf!t0+!e1f/f6t*+<q!!-gqmtpjbEuu!)o!pEs3nfbsmv!u>y!fvuo)qibudqlfSEHpCUB";var yt=B.graph3d.PostProcessing.Fxaa=function(E){var s,Y=this,N=!1;T.defineProperties(Y,{enable:{get:function(){return N},set:function(_){!!N!=!!_&&(N=_,E.iv())}}}),Y.contextLost=function(){s=null},Y.getShader=function(d){if(s)return s;var B=E.getPostProcessingModule();return s=B.createShader(d,{vs:B.blitScreenShaderSrc.vs,fs:B.decodeShader(yt.ShaderSourceFs)})},Y._42=function(){}};yt.ShaderSourceFs="~!!q<sbf/d*jwtVjwp!o-!fihjbhnijq)!Eg3mfpsbvuu<yf!uv>obj/gsppsmnp!DthbbnsqGm`fmsh3!E!<j*n!bh*f1</1!)v5odjfgwp!sn-!1w/f1d!3!-s1f/t1p!mv-u1j/p1o!<-!4w4b9s1z/j1o!h!-w7f7d23/!1w!Vw-<68/!1$!ef-g*j1o/f1!)G5YdBfBw`!RV-B*M1J/U1Z)`5Qd1f!w2!/1-*!1$/e1f)g5jdoffw!!GY-BoBp`jRuVvBmMpJtUfZs`!Q2-!f2h/b6nj!!$e-ffghjbonfj!!GY-BfBh`bRnVjB!MJ-U*Z1`/Q13)!53d/f1w!!$-ewfVgwj!of)!sGfYeBbBi`TRmVfByMjJQUbZb`yQG4>!s5p/m1pD!h$besfGg`jmohf!!G|Y!B*B)`oRjVbBnM!JeUjZp`wQ!5!~2!3/<1*N!b$nevfmg!j-o{fz!yG/y*bNbtCppqp!m-!ycfpup)mqpU!y$feUfbgbjyoGf)!5GuybbpbmGGmbpbbyuG!!gomspvbuufs!!$e<foghjjoTfi!uGhyobfbmG!m+p!byuj3q!cwvfTdu3ft!g$gePfmgfjyojfq!>G,yzb/bNGtmppqb!u*4o!bwqfTd{4sp!i$!e)fggjj!of<!oGhyjbTbiGumhpobfum5!!+w!fydj5qcv!T$uefftggjgoPfm!fGyyjbqb>T,byu/)Nyt*p!qd!m*bonbqq)Ty{-s!p1i/a1)-g!j2!/1<**I!y$jeqfcgvjto!f-!eGpypbHbuUfftyg!gtPbmnfqymjfqs)3yEbn!>$yejfqgcjvoTfu!fGtygbgbPUmffyyUjpqq!)uub-p!mqG*b!buyfGy!uv<s1f/31E!);u!-u!fqt-g!g1P/m1f*yj!q$!e@f!gojboqfT!eGpypbhb>UefpypPHgugf)tug-g!Pqm-f!ypj-q!!su*b!pumfGybubvysGf!3E<)yuj-q!cqv,T)zpu!j+m!bsv*R-b!b1y/g1!*+!!HGyyjbqbcGvmtp>bIuy!jGqycbvbtM!vunbbp)mGGybbbbyGGm!pb<u65/!1s,h*c*bq*d!S|i!ushfoufvMsoob!qsth.c)b!/+z!<u!t~e)!>GuyfbtbgGgmPpmbfuy5j!qG!yubbbpQmjGybfbmyTGi!be<fGsy)jq!cGvytb!b+G!mGpybjuq3c!vqtp>tH-yj!qGcyvbtb!GumbppbmuG5b!bgyyGb!bD<pQootbpqmTfeQpppthQ!p;t!-Oo!bGqyTbebpUpfhy!!@u!fOyo-pj!uGdyfbsbjUef>yo!bgqyTbebpDppho!tmppmpfC4b7b1yUGf!yF<y*qQCujtbet!O-fOhuPtoef)-oj!nG>yubtbeU!fuyb!pgmyGbbbbDypGo!tp<mQfu4t7e1!U=f!yOFuytqeC>jObotpOjfuhdUfxspj-e!!mGpypbCbbGbmypGb!u3<!iguyhbobfRMvobbmqjtu0z1S/d2q>GqsdbSnifu-ho!fGMyobbbqGtm!pubbup5m!GgbybbybGD!po<tppsmff[SUdMqNGbsnbvnmf!P>qau!-*1!/G1y!b=b!GQmepobFub5n!vgmy)b>bQDopboqtTpempfpShd!qmGpspbCnbfbPyqGu!3-<*!OGuytbeb,GQmuptbeu)5>!iguyhbobfDMpoobtqptm!fu4b7p1mSGdbqbGysGb!nf<Ppqsuf3[-UM!NGbynbvbmG!m>pab!u*!1g/y1b!b=R!vObemojFubznTvvmc)q>jOyo-bq!TGeypbpbhG!mmppbpuC!bgbyybGb!Rv<bzm/jNutzpFqe.hzf/UQitspfqt>iQpumtee-!*!oGbyqbTb{Gsmppibau)!ggjy!bb<Rzv/bOmtjpuqz.Fze/hNftUpiqs>fOtuitpem!e*Nojboq-T{!sGpyibab)Ggmjp!bu<!yg/yNbtbpDqp.oyt/pQmtfpFqe>hQfuTtieb!suqbopfmtGtb-by!GG!yb<byG/mOptbpuq!.gyy/bNbtDppqo>tOpumtfeF!euhbfpUmiGsbfbtyiGp!me~-!!~G!yb~b!Gm<p5bQu`!ZgUyJbMbBDVpRo`tBpBmYfGF!e+h!fzU/iQsOfgtgipp>m,ezN/jQot-pq!!G*yQbfboGpmepab)ug5j!!gy<b5bQD`pZoUtJpMmBfV4R7`1BDBpYoGt!u+E!jys/Q!O*g!g|p>!,Gyy/bQbtGpmqp!b*uQ3f!oqppetaN)<gj!!qp<t*NQ/fyo>pqepat)/!y}<}!!*qOpftoNp/eza>)q>pQtO/fzo<pe!!Gy<b5bQG`mZpUbJuM5B!VsRh`cBzBNY>GG!y+b!bzU/fQyOUgpgqp)>u.fzy/-O!tqppqt!N**O<fo!p$eeaf)ggjjo!f!<m5vQn`bZNU!JsMhBcVzRN`/BzBY!GG!y+b!byG/mQpObgug!pm>v.nyb/TO>tGpyqb!b*MOvfnobp)eGay)bgbjU!fy<Pegfgm)budfTyu-o!fqjpetbNs-h!!G>y?b!b*GQmepobFub3n)v!m1)/t1c-b!>2Q/f1o*p-e!!gy<bebfRmvbbdmTjuuozfSjdeqbGsshb!n>f?/!y*zO*e*o<Fb!nGvymb)btGcmbp>bOuf!ompven!bF<>6G/y1b!b+M!vOnObb)nGvymb.bQUefoyFPbgngv)mu>fQye-o!FqbpntvNm-!!*GQyfbobpGemap)bguj3!)!<26//11-!!+1!/O1O*b-n!vgmy.bObeRovFbbmnjvumz>SOdeqoGFsbbnnvfm/!y*zO*f*o<pe!aG)ygbjb!Gm<p*b*uz!ym/vQntbpOq>!G-yybfbuM)vqnpbU)yGfyUbbbbUyfGy)Pbgngv)Mubfbyy-G!>qQpetoNF-b!nGvymb!b*GQmfpobpue3a))!g1j/!1-<.*2*/z1y*/-O!tgpyqb!b-Ryvfbum)jqupzUSydfqUGbsbbynGf)/bynzv*M*b<by!GG>yObeboGFmbpnbvum!!m*vOnfboXp>eGay)bgbjM!vn|b!)*GQyObfboUpfey)Pggjg!)u<f4yQ-`!ZqUpJtMNB-V!RG`yBbBbYGGm!p+b!uz3/)Q.O2g/g1p->!,1z//1Q*t-p!qg!y*bQbfRovpbemaj)ugzjS!dq<G4sQb`nZfU/JyMzB*V*R<`B!BGYyGb!b+G!myp/bQuO!gngbpy>T,Ny>/nQbtyp)qm!v*nQbfTo-p!emav)ngbjN!*<<*!QGfyobpbeGam)p!b}u}!!n*jOofToNp>enaj)o>)QmOvfnobpTe-!!m<v4nQb`NZ*U<JM!BGVyRb`bBGBmYpGb!u+!!nzb/yQFOTgNg>pn>b.yz)/mOvtnpbqF!-*!OnfboypTeNa*)<gj!!Gy<b4bQG`mZpUbJuM!BnVjRo`FBTBNY>Gn!j+o!)ym/vQnObgFg-p!>n.jyo/TONt*p<q!!*GOyfbobpGemap)bguj!!nb<yeXfOm>bndbTyu)omfvjnebbOs-h!!m>v?n!b*XQ*e<oF!bGnyvbmb)Gtmcpbb>uQ!fnojpoeX!O><nejfom)bmdvTnuboOf-j!embvsnhb!X>*?<!*!OGeyobFbbGnmvpmb)ut!csbb>oOhffoNpbey!>n<b6y/)1n!b+y!XOOO-b!nnvbmy.FQTeNo*F<bn!vGmy>bQbeGomFpbbnuv!ms!b*oQhffoNpjeoa>)ngjjo!)n<j6o/X1O!-+!!nOjOobFnTvNm*.<Oe!oGFybbnbvGmm>pObeuo!Fsbbnovhmf!N*bOyfTodpbemaf)eg>js!bo<h*f*Nzbyy/!Q+t!pgqy!b-byRfvub)mqjpuUzyFfeUhbfbUyiGs)fbtnivpMmbeb<yG!>GQyebobFGbmnpvbmu!!*sQbfoohpfe>as)bgojh!fN<b*y*.zsyb/oOhtfpNqj!o-<yf!uG)yqbpbUGymfpUbbub!ysGb)obhnfvNMbbybDymGb>nOqefoeF>bnnbvym)!g*yObfboRpvebam)jgujz!Fe|h!f*UQiOsffotpiep)mgejN!jo<-3!Qs`bZoUhJfMNBbVyRT`dBbBmYfGe!*+<!z!/GQyObgbgCpp>p,mz!/fQbtspmqz!F*yQjfuo>psebao)hgfj!!=!<s3bQo`hZfUNJbMyBDVmRb`nBqBfYeG<!+!!jyg/)QfObgsgmpz>F,yyj/uQ*tp!qs!f*uQvfsoop!esah)cgzjN!<<!*GQyfbobpGemap)b!u}!}m!v*nObfOoXp>eGay)b>bQMOvfnobp)eG!yb<b3UQf`yZPUgJgM)BuVfRy`-B!BqYpGt!N+-!!zG/yQbObgGgmpp>b.uz3/)O.t2p/q1!-*.O2f/o1p*e-a!)ggyjb!bR<v3bQm`jZuUzJSMdBqVGRs`bBnBfY/Gy!z+*!*y</Q!OGgygbpb>G.myp/bOut!pmqv!n*bOTfFo>pGeyab)bgMjv!nb<)eGfymbbbdUTfuyoPfgjge)busfhy!->!?q!p*tQNe-o!FGbynbvbmG)mtpcbbu>3Q)f!o2p/e1!-!<2e/f1m*b-d!TguyobfbjRevbbsmhj!u>z?S!d*qOGesobFnbfn/vymz)*t*c<b>!OGfyobpbeG!mp<b6u/!1m!v+n!bOOOFb>nGvymb.bQMevonFbb)nGvymb>bQUefoyFPbgngv)mu!f*yQ-f!oqppetaN)-g!jG!yb<b6G/m1p!b+u!3O)O!b2n/v1m-..O2e/o1F*b-n!vgmy>bObeRovFbbmnjvumz!S*dOqfGospbenaf)/gyjz!**<<**!zGyy/bQbtGpmqp!b-uy!fmuv)nqbpTUXy>fGUybbbbyMGv)nbbn)vGMybbbbyUGf>yQPegogF)bunfvym-!!*qQpftoNp-e!aG)ygbjb!Gm<p*b*uz3y)/.O2t/p1q-!!-2y/f1u*)-q!pgUyybfbURbvbbymGj)ubznSvdMqbGbsybGn>fO/eyozF*b*n<vm!!G*yObfboGpmepab)ug!jm!vn|b!O*TQ>OmfvonpbeO),gmjv!nb<T2<Q`!ZGUyJbMbBGVmRp`bBuB!YmGv!n+b!XzF/>QmOvgngbpX>,,mzv/nQbtFp<q!!*GQyfbobpGemap)bguj!!tv<c2qQj`yZSUdJqMSBbVoRh`fB>B2Y/G1!0+s!byo/hQfO<gg!pG>y,byb/GQmtppbqu!!*tQvfcoqpjeyaO)TgXjF!>m<v*nQbfOoTp,emav)n!b}X}F!<*O!fGoypbebaG)m>pQbOuf!ofpeeh!fmIpppsC{b2b>y)G.!3/<12!Q+`!ZmUvJnMbBNV*R,`mBvBnYbGO!T+<!z!/GQyObgbgGpm>p.bzu/!Oftephqf!W*fOsfuo2p>e)a.)3g/j1!!+<!2mQv`nZbUNJ*M,BmVvRn`bBXBFY<G!!+G!yyb/bQGOmgpgbpu>!.myv/nObtOpFqT!F*>OmfvonpbeOaF),gmjv!nb<TeFf<mb!dGTyubobfGjmepbbsuh!!m>v?n!b*OQXeOoFF>bmnvvnmb)OtXc,bm>vQnfboOpFe<!m!pGpyCbbbbGymGp!bu<!effemhbfdITpuso{f3j>e)b.s3h/!1>!?+!!*mOvenobFFb*n,vmmv)ntbcObF>TOFf<op!eG!ymbpbpGCmbpbbyuG!!fe<h6f/W1f!s+u!3O>O)b.n3v/m1>!.+Q!emovFnbbnOv*m,!mv<n6b/O1X!O+F!<OO!bGnyvbmb>G.mOpebouF!bmnvvnmb!OX<T1X/>1m!v=n!bNONXb,nmvvmn>bpTsXf<[U!MGNybbnbvGmm!pmbpup!CmbvbnybGT!XT<FF>ymjvqncbvTtX!,+m!vEnybjTqFc<vt!>GGyybjbqGcmvptb!uu!bfpemhGfbIbpysG{!5><)6b/c1t!)+f!eOhOfbInpvsm{.2N*b!n+v!m3>/N1N*b,nbvcmt!)ufbephmfGIbpbsy{G3!*<<1!/G5y0b1b/G2m!p+b!uu!offejhefbWsfhs>ue5f>m)bbdcTtu)offejhefbWsfhs!uu2b*p!m+G!b3b/y1G*!,b<cTtT)bfnevhmf>WOfOsbun3v*m<!*!OGsyjbbbqGam)pgbju!!f<e*h*fQItppsq{!4->y)f.u3)/q1p!U+y!fmUvbnbbyXG*),bmnvvnMbbObXyTGX><Qe!oGFybbnbvGmm!pubbup!mfGebhbfyWGf!su<4D>y)j.q3c/v1t!!++!!mDvynjbqTc*v,tm>vFnybjTqXcTvFt<!u!bGpymbGbbGbmypGb!u!<f*e*hOftIppqs!{->ybfcut))qfpeUhyffIUpbsb{y4G*),bfnevhMfbIbpysG{>5O<eo!FGbynbvbmG!mupbbpum!GfbebhyfGW!fs<u1>/b4c,t*)DfyejhqfcWvfts+u*41*/,3f.e)h)f>WEfysjuq5c<vt!!GuybbpbmGGmbpbbyuG!!tv<c1qQj`yZOUXJTMXBOVFRT`FB>BmYvGn!b+O!XzT/XQ,Omgvgnpb,OzF/TCFt<pq!>Gzy/bQbtGpmqp!bu<!1mQf`oZhUuJiMTBjVhRo`>BgByYbGb!R+v!bym/jQuOzgSgdpq,Gys/bCntfp/qy><y/!QGtypbqb!Cp<pQmt!piqp!s3{uTbqpbmoG>bfbeyhGf!Ip<s1{Q!`?Z>U!JfMeBhVfRW`fBsBuY<G!!+G!yzb/bQGOmgpgbpu.!zt/vCctqpjqy>Bz>/tOvtcpqqj!yO<T1XQF`!Z+U!J3M/B1V,Rt`vBcBqYjGy!O+X!TyX/OQFOTgFg<p.!yj/gC)tapiqp>sy{/TOqtbpoq*!!m<vOntbpOq>!m3vunbbpXm<Gb!bjygG)!ai<p6s/{1T!q+b!oo*h!jmTvinubhTo>fmmv>n,bzF/<Ct!pjqg!)*iopbsq{TT{qsbpoi*!!)mgfjo!hu<i6T/j1h!o+>!goyhbjbTRivubhmojfumz>S,dyq/GCstbpnqf!/*zo<bq!TG{ysbpbiGam)pgbju!!t<vzc/qfjnybCs>G)qtdvSczqujjymBb!v+R!b)b2y/g1!0;2!31//11*!*@.!m*vonbbqNT<{s!pGiy!b)b>Gzm/pQbOug!ghps!be<jyf/ofunOb>smGvqndbSOz.umjvmnbbvNR<bb!yGgy!b;b!G1m/p1b!u@!!h*sobbeqjTf{osupTi>am)v>nyb/TQ.Omgvgnpb!N<<Q!OGgygbpb!G3mupbbpum!GmbvbnybGO!O><mzv/nNbtOp,qm>vzn/bCNt<pq!!Gy<byb/GNmtppbqu>!ym/vCntbpTqT!>m<vCntbpTq,!m3vunbbpNm<Gb!bGyyGb!bC<p*pfmh!oqbbSjqsdOS>ybjcqtc)vhts!b+e!j*fCoyujOq*c!v?t>)!tbccbt))uhbsTbbebjyfGo>uDTy*j<qc!vGty!bubbGpmmpGbbub!yhGs!be<jofhojuT>inubhyo)fbmc.t>)ohhsjbTeijufhooufOm*!-*!Obscjtb)qh)sgbje!jf<o*u*T",Wn(R,{accordionViewExpandIcon:Bc(Pr),accordionViewCollapseIcon:Bc(Pr,!0),accordionViewLabelColor:Wm,accordionViewLabelFont:sd,accordionViewTitleBackground:Jo,accordionViewSelectBackground:Iq,accordionViewSelectWidth:3,accordionViewSeparatorColor:z,splitViewDividerSize:1,splitViewDividerBackground:Jo,splitViewDragOpacity:.5,splitViewToggleIcon:{width:16,height:16,comps:[{type:fh,rect:[2,2,12,12],background:Pr}]},propertyViewLabelColor:wk,propertyViewLabelSelectColor:Wm,propertyViewLabelFont:sd,propertyViewExpandIcon:Bc(Yn),propertyViewCollapseIcon:Bc(Yn,!0),propertyViewBackground:Ni,propertyViewRowLineVisible:!0,propertyViewColumnLineVisible:!0,propertyViewRowLineColor:Sj,propertyViewColumnLineColor:Sj,propertyViewSelectBackground:Iq,listViewLabelColor:wk,listViewLabelSelectColor:Wm,listViewLabelFont:sd,listViewRowLineVisible:!1,listViewRowLineColor:Sj,listViewSelectBackground:Iq,treeViewLabelColor:wk,treeViewLabelSelectColor:Wm,treeViewLabelFont:sd,treeViewExpandIcon:Bc(jf),treeViewCollapseIcon:Bc(jf,!0),treeViewRowLineVisible:!1,treeViewRowLineColor:Sj,treeViewSelectBackground:Iq,treeViewDoubleClickToToggle:!0,tableViewLabelColor:wk,tableViewLabelSelectColor:Wm,tableViewLabelFont:sd,tableViewRowLineVisible:!0,tableViewColumnLineVisible:!0,tableViewRowLineColor:Sj,tableViewColumnLineColor:Sj,tableViewSelectBackground:Iq,treeTableViewLabelColor:wk,treeTableViewLabelSelectColor:Wm,treeTableViewLabelFont:sd,treeTableViewExpandIcon:Bc(jf),treeTableViewCollapseIcon:Bc(jf,!0),treeTableViewRowLineVisible:!0,treeTableViewColumnLineVisible:!0,treeTableViewRowLineColor:Sj,treeTableViewColumnLineColor:Sj,treeTableViewSelectBackground:Iq,tableHeaderLabelColor:wk,tableHeaderLabelFont:sd,tableHeaderColumnLineVisible:!0,tableHeaderColumnLineColor:uj,tableHeaderBackground:Ni,tableHeaderMoveBackground:ys,tableHeaderInsertColor:Iq,tableHeaderSortDescIcon:rh(Yn,!0),tableHeaderSortAscIcon:rh(Yn),tabViewTabGap:1,tabViewLabelColor:Wm,tabViewLabelFont:sd,tabViewTabBackground:Jo,tabViewSelectWidth:3,tabViewSelectBackground:Iq,tabViewMoveBackground:ys,tabViewInsertColor:Iq,toolbarLabelColor:wk,toolbarLabelSelectColor:Wm,toolbarLabelFont:sd,toolbarBackground:Ni,toolbarSelectBackground:Iq,toolbarItemGap:8,toolbarSeparatorColor:mb},!0);
var zt={translateX:1,sortColumn:1},At={sortable:1,sortOrder:1,sortFunc:1},Bt={focusData:1},Ct={dataModel:1,sortColumn:1,sortFunc:1,visibleFunc:1,rootData:1,rootVisible:1},Dt={dataModel:1,sortFunc:1,visibleFunc:1,categorizable:1},Et=function(r,w){w.add(r),r.hasChildren()&&r.eachChild(function(T){Et(T,w)})},Ft=function(A,W,n,K,U,x,h,f,C,d,b){var Y,G=n.getValueType(d),m=n.getAlign(d);if(n.getEnumValues(d)){var l=n.toEnumLabel(W,d),O=kn||0,T=0,r=x,y=R.getTextSize(K,l).width;return Y=Td(n.toEnumIcon(W,d)),Y&&(T=x+kn/2,"center"===m?T+=(f-(O+y))/2:"right"===m&&(T=T+f-(O+y)),Vd(A,Y,T,h+C/2,d,b),r=T+kn/2),l!=I&&(Y?dg(A,l,K,U,r,h,f-(r-x),C):dg(A,l,K,U,x,h,f,C,m)),void 0}return W=n.formatValue(W),W!=I?G===_b?(gk(A,x,h,f,C,W),void 0):G===gq||!G&&ki(W)?(Y=Td(W?oo:Wc),Vd(A,Y,x+f/2,h+C/2,d,b),void 0):(dg(A,W,K,U,x,h,f,C,m),void 0):void 0},Gt=function(R,F){var U=F.view,V=ue(R),E=F.column||F.property;U.getDataModel().beginTransaction(),F.editor=R,R.info=F,U.setCurrentEditor(R),U.getView().insertBefore(V,U._79O),Ae(R,F.editorRect),R.setFocus?R.setFocus():Sk(R),R.commitValue=function(g,Q){R._17Q&&(R=R._17Q),Q||U.setValue(F.data,E,R.getValue?R.getValue():R.value),R.close&&R.close(),Pp(V)},E.onEditorCreated&&E.onEditorCreated(F)},Ht=function(u,E,Z,V,G){var D=Kp(u,Z),q=E.value,T=E.view,Y=G.getValueType(E.data);return D.onblur=D.onchange=function(){T.endEditing()},"input"===u?(q=G.formatValue(q),q!=I&&(D.value=q),D.onkeydown=function(z){$r(z)?T.endEditing():Nn(z)&&T.endEditing(!0)},(Y===ni||Y===Vj)&&j(D,Qi,R.numberListener)):u===Eg&&V.forEach(function(u){var z=e.createElement("option");z.innerHTML=G.toEnumLabel(u),z.value=u,G.isEnumEqual(q,u)&&(z.selected=!0),Ul(D,z)}),Gt(D,E),D},It=B.widget={},Jt=function(t,_,n){Lp(G+".widget."+t,_,n)};Wn(ng,{ms_value:function(z){z.getValue=function($){var e=this.getItemById($),U=e.element;return Fc(U)?U:U?U.getValue?U.getValue():U.value:e.selected},z.setValue=function(l,v){var $=this.getItemById(l);if($){var G=$.element;G&&!Fc(G)?G.setValue?G.setValue(v):G.value=v:ki(v)?($.selected=v,this.iv()):($.element=v,this.iv())}},z.v=function(D,v){var C=this;if(2===arguments.length)C.setValue(D,v);else{if(!Pd(D))return C.getValue(D);for(var S in D)C.setValue(S,D[S])}return C}},_46o:function(l){l._icon=I,l._accessType=I,l._valueType=I,l._editable=!1,l._batchEditable=!0,l._align=xi,l._nullable=!0,l._emptiable=!1,l.setParent=Dm,l.formatValue=function(Y){var F=this,T=F._valueType;return F.getEnumValues()?F.toEnumLabel(Y):T===gq?!!Y:Y!=I&&T===ni?H(Y):Y},l.setEnum=function(X,O,S,r,Q,G,W){var A=this;X&&!ar(X)&&X.values&&(r=X.editable,S=X.icons,O=X.labels,Q=X.strict,G=X.maxHeight,W=X.dropDownWidth,X=X.values),vq(X)&&(X=X._as),vq(O)&&(O=O._as),vq(S)&&(S=S._as),A._enumValues=X,A._enumLabels=O,A._enumIcons=S,A._enumEditable=r,A._enumStrict=Q==I?!0:Q,A._enumMaxHeight=G,A._enumDropDownWidth=W,X&&X.length&&gs(X[0])&&(A._valueType=Vj),A.fp("enum",!1,!0)},l.getEnumDropDownWidth=function(){return this._enumDropDownWidth},l.getEnumMaxHeight=function(){return this._enumMaxHeight},l.isEnumEditable=function(){return this._enumEditable},l.getEnumValues=function(){return this._enumValues},l.getEnumLabels=function(){return this._enumLabels},l.getEnumIcons=function(){return this._enumIcons},l.isEnumStrict=function(){return this._enumStrict},l.isEnumEqual=function(J,x){return this._enumStrict?J===x:J==x},l.toEnumLabel=function(X,k){var A=this,u=A.getEnumValues(k),c=A.getEnumLabels(k);if(u&&c)for(var o=0;o<u.length;o++)if(A.isEnumEqual(X,u[o]))return c[o];return X},l.toEnumIcon=function(u,N){var g=this,L=g.getEnumValues(N),T=g.getEnumIcons(N);if(L&&T)for(var y=0;y<L.length;y++)if(g.isEnumEqual(u,L[y]))return T[y];return z}},_45o:function(K){K._87o=function(X,B,H,I,N,K){if(X){var s=this,M=s._90I,O=eg(1);s._columnLineVisible&&(N-=1),s._rowLineVisible&&(K-=1),0>=N||0>=K||(s._90I||(M=s._90I={}),M[B]||(M[B]=new Gk),Ae(O,s.tx()+H,s.ty()+I,N,K),Ul(O,X),s._view.insertBefore(O,s._79O),X.onParentAdded&&X.onParentAdded(O),M[B].add(O))}},K._76o=function(){var d=this,e=d._90I;if(e){for(var x in e)e[x].each(function(m){Pp(m)});delete d._90I}},K._77o=function(d){var j=this;if(j._90I){var A=j._90I[d];A&&(A.each(function(U){Pp(U)}),delete j._90I[d])}}},_47o:function(J){J.getValue=function(K,W){return W.getValue?W.getValue(K,W,this):ie(K,W.getAccessType(),W.getName())},J.setValue=function(V,m,e){if(m.isEmptiable(V)||""!==e||(e=z),m.isNullable(V)||e!=I){var u=this,g=m.getName(V),t=m.getAccessType(V),A=m.getValueType(V);A===ni&&Fc(e)?e=ip(e):A===Vj&&Fc(e)?e=parseFloat(e):A===gq&&Fc(e)&&(e="true"===e),u._batchEditable&&m._batchEditable&&u.isSelected(V)?u.sm().each(function(H){m.setValue?m.setValue(H,m,e,u):Se(H,t,g,e)}):m.setValue?m.setValue(V,m,e,u):Se(V,t,g,e)}},J.setCurrentEditor=function(D){this.endEditing(),this._currentEditor=D,this.redraw()},J.isEditing=function(S,s){var A=this,p=A._currentEditor;if(!p)return!1;if(s){var L=p.info;return L?(L.column||L.property)===s&&L.data===S:!1}return!0},J.endEditing=function(z){var n=this,w=n._currentEditor;w&&(delete n._currentEditor,w.commitValue&&w.commitValue(w.info,z),n.redraw(),n.getDataModel().endTransaction())},J.beginEditing=function(T){this.endEditing();var Z=this,K=T.column||T.property;if(K.beginEditing)K.beginEditing(T);else{var S=T.data,L=T.value,o=Z.getSelectBackground(S),f=K.getEnumValues(S),$=K.getSlider(S),F=K.getColorPicker(S);if($){var c=Ih(It.Slider,$);return c.setValue(L),c.getView().onblur=function(){Z.endEditing()},c.isInstant()&&(c.onValueChanged=function(){Z.setValue(S,K,c.getValue())}),Gt(c,T),void 0}if(F||K.getValueType(S)===_b){var G=Ih(It.ColorPicker,F);G.setValue(L);var A=G.onClosed;return G.onClosed=function(){Z.endEditing(),A&&A.call(this)},G.isInstant()&&(G.onValueChanged=function(D,y){Z.setValue(S,K,y)}),Gt(G,T),G.open(),void 0}if(f){if(It.ComboBox){var n=new It.ComboBox;n.setValue(L),n.setValues(f),n.setLabels(K.getEnumLabels(S)),n.setIcons(K.getEnumIcons(S)),n.setEditable(K.isEnumEditable(S)),n.setStrict(K.isEnumStrict(S)),n.setMaxHeight(K.getEnumMaxHeight(S)),n.setDropDownWidth(K.getEnumDropDownWidth(S)),n.onClosed=function(){Z.endEditing()},Gt(n,T),n.open()}else Ht(Eg,T,o,f,K);return}var g=K.getValueType(S);if(g===gq||ki(L))return Z.setValue(S,K,!L),void 0;if(K.getItemEditor(S)){var h=Lo(K.getItemEditor(S)),P=new h(S,K,Z,T),W=P.getView();return W._17Q=P,P.setValue(L),al(W),Gt(W,T),P.editBeginning&&P.editBeginning(),void 0}Ht("input",T,o,I,K)}}},_44o:function(n){n.init=function(k){var s=this,$=s.th=new Yt(k),n=s._view=Fd(1,s);s.tv=s._tableView=k,Ul(n,$.getView()),Ul(n,k.getView()),$.mp(function(g){g.property===jc&&s.iv()}),s.iv()},n.getTableView=function(){return this.tv},n.getTableHeader=function(){return this.th},n.getDataModel=function(){return this.tv.dm()},n.getColumnModel=function(){return this.tv.getColumnModel()},n.setColumns=function(E){this.tv.setColumns(E)},n.addColumns=function(w){this.tv.addColumns(w)},n.endEditing=function(){this.tv.endEditing()},n.validateImpl=function(){var B=this,T=B.th,r=el(T),x={x:0,y:0,width:B.getWidth(),height:r};Ae(T,x),x.y=r,x.height=o(0,B.getHeight()-r),Ae(B.tv,x)}},ms_vs:function(j){j._41o=function(){return this._29I.height<this._59I},j._43o=function(){var c=this;c._41o()&&(c._58I||(hl(function(){c._94O()},xc),c.iv()),c._58I=new Date)},j._94O=function(){var $=this;if($._58I){var p=new Date;p.getTime()-$._58I.getTime()>=xc?(delete $._58I,$.iv()):hl(function(){$._94O()},xc)}},j._93I=function(){var u=this,T=u._27I;if(u._58I||!u._autoHideScrollBar){T||Ul(u._79O,T=u._27I=eg());var c=u._29I,s=c.height,W=u._59I,q=u.getScrollBarSize(),S=c.width-q-2,i=s*(-u.ty()/W),$=s*(s/W),z=T.style;W>s?(ui>$&&(i=i+$/2-ui/2,0>i&&(i=0),i+ui>s&&(i=s-ui),$=ui),z.visibility=nb,z.background=u.getScrollBarColor(),z.borderRadius=q/2+Mq,Ae(T,S,i,q,$)):z.visibility=dm}else T&&(T.style.visibility=dm)}},ms_hs:function(k){k._40o=function(){return this._29I.width<this._91I},k._42o=function(){var G=this;G._40o()&&(G._95O||(hl(function(){G._94I()},xc),G.iv()),G._95O=new Date)},k._94I=function(){var E=this;if(E._95O){var U=new Date;U.getTime()-E._95O.getTime()>=xc?(delete E._95O,E.iv()):hl(function(){E._94I()},xc)}},k._92I=function(){var U=this,$=U._28I;if(U._95O||!U._autoHideScrollBar){$||Ul(U._79O,$=U._28I=eg());var s=U._29I,r=s.width,G=U._91I,I=U.getScrollBarSize(),b=s.height-I-2,B=r*(-U.tx()/G),m=r*(r/G),C=$.style;G>r?(ui>m&&(B=B+m/2-ui/2,0>B&&(B=0),B+ui>r&&(B=r-ui),m=ui),C.visibility=nb,C.background=U.getScrollBarColor(),C.borderRadius=I/2+Mq,Ae($,B,b,m,I)):C.visibility=dm}else $&&($.style.visibility=dm)}}}),Wk(oo,hh(16,16,[{type:fk,rect:[1,1,14,14],background:Iq},{type:Qf,rect:[1,1,14,14],width:1,color:ul},{type:$l,points:[13,3,7,12,4,8],borderWidth:2,borderColor:"#FFF"}])),Wk(Wc,hh(16,16,{type:Qf,rect:[1,1,14,14],width:1,color:ul})),Wk(mf,hh(16,16,[{type:Zl,rect:[2,2,12,12],borderWidth:1,borderColor:ul,background:"#FFF"},{type:Zl,rect:[4,4,8,8],background:Iq}])),Wk(ik,hh(16,16,{type:Zl,rect:[2,2,12,12],borderWidth:1,borderColor:ul})),ng._15Q=function(o){o._29I=Mn,o._59I=0,o._91I=0,o._5o=function(b){var P=this;P._30I=new Gk,P._rows=new Gk,P._rowMap={},P._31I=0,P._14I=0,P._view=Fd(1,P),P._canvas=On(P._view),Ul(P._view,P._79O=eg()),P.dm(b?b:new Og)},o.getCheckIcon=function(p){var E=this.sm(),S=E.co(p);return E.sg()?Td(S?mf:ik):Td(S?oo:Wc)},o.checkData=function(U){var F=this.sm(),r=F.co(U);F.sg()&&r||(this._32o=1,r?F.rs(U):F.as(U),delete this._32o)},o.getDataAt=function(E){E.target&&(E=this.lp(E));var Z=C(E.y/this._rowHeight),q=this._rows;return 0>Z||Z>=q.size()?I:q.get(Z)},o.onDataDoubleClicked=function(){},o.onDataClicked=function(){},o.adjustTranslateX=function(){return 0},o.adjustTranslateY=function(d){var l=this.getHeight()-this._59I;return l>d&&(d=l),d>0?0:H(d)},o.onPropertyChanged=function(d){var Q=this,G=d.property;Ct[G]?Q.ivm():Bt[G]||Q.redraw(),G===_h?Q._42o():G===Gp&&Q._43o()},o.getLabel=function(H){return H.toLabel()},o.getLabelFont=function(){return this._labelFont},o.getLabelColor=function(B){var b=this;if(b.isCheckMode()){if(b._focusData===B)return b._labelSelectColor}else if(b.isSelected(B))return b._labelSelectColor;return b._labelColor},o.getStartRowIndex=function(){return this._31I},o.getEndRowIndex=function(){return this._14I},o.getRowDatas=function(){return this._rows},o.getRowIndex=function(Z){return this._rowMap[Z._id]},o.getRowSize=function(){return this._rows.size()},o.getViewRect=function(){return sj(this._29I)},o.isVisible=function(J){return this._visibleFunc?this._visibleFunc(J):!0},o.getCurrentSortFunc=function(){return this._sortFunc},o.setDataModel=function(c){var x=this,q=x._dataModel,C=x._selectionModel;q!==c&&(q&&(q.umm(x.handleDataModelChange,x),q.umd(x.handleDataPropertyChange,x),q.umh(x.handleHierarchyChange,x),C||q.sm().ums(x.handleSelectionChange,x)),x._dataModel=c,c.mm(x.handleDataModelChange,x),c.md(x.handleDataPropertyChange,x),c.mh(x.handleHierarchyChange,x),C?C._21I(c):c.sm().ms(x.handleSelectionChange,x),x.fp("dataModel",q,c))},o.validateModel=function(){var Q=this;Q._rows.clear(),Q._rowMap={},Q.buildChildren(Q._dataModel._roots);var D=Q._rows=Q._rows.toList(Q.isVisible,Q),s=0,o=Q.getCurrentSortFunc(),u=D.size();for(o&&D.sort(o);u>s;s++)Q._rowMap[D.get(s)._id]=s},o.buildChildren=function(j){var c=this;j.each(function(u){c._rows.add(u),c.buildChildren(u._children)})},o.handleDataModelChange=function(){this.ivm()},o.handleDataPropertyChange=function(k){"parent"===k.property?this.ivm():this.invalidateData(k.data)},o.handleHierarchyChange=function(){this.ivm()},o.handleSelectionChange=function(a){a.datas.each(this.invalidateData,this),this.onSelectionChanged(a)},o.onSelectionChanged=function(K){var P=this,e=P.sm();!P.isAutoMakeVisible()||1!==e.size()||"set"!==K.kind&&"append"!==K.kind||P._32o||P.makeVisible(e.ld())},o.handleBackgroundClick=function(U){fb(U)&&!this.isCheckMode()&&this.sm().cs()},o.makeVisible=function(U){U&&(this._23I=U,this.iv())},o.scrollToIndex=function(r){var b=this,v=b._29I,Z=v.height,P=b._rowHeight,J=P*r;r>=0&&r<b._rows.size()&&Z>0&&(J+P>v.y+Z?b.ty(-J+Z-P):J<v.y&&b.ty(-J))},o.autoScroll=function(m,$){var x=this,v=x._rowHeight,G=v,i=v/4,c=x._29I,n=x.lp(m),L={x:x.tx(),y:x.ty()};return v>0&&c&&(n.x-c.x<G?x.translate(i,0):c.x+c.width-n.x<G&&x.translate(-i,0),n.y-c.y<G?x.translate(0,i):c.y+c.height-n.y<G&&x.translate(0,-i)),L.x=x.tx()-L.x,L.y=x.ty()-L.y,$&&($.x+=L.x,$.y+=L.y),L},o.getTopRowOrderSelection=function(){var V=this.sm().getTopSelection(),e={},p=new Gk;return V.each(function(V){e[V._id]=V}),this._rows.each(function(S){e[S._id]&&p.add(S)}),p},o.getRowOrderSelection=function(){var Q=new Gk;return this._rows.each(function(j){this.isSelected(j)&&Q.add(j)},this),Q},o.ivm=function(){this.invalidateModel()},o.invalidateModel=function(){var f=this;f._96I||(f._96I=1,f._32I=1,delete f._24I),f.iv()},o.redraw=function(){var g=this;g._32I||(g._32I=1,delete g._24I,g.iv())},o.invalidateData=function(p){var J=this;Bp?J.redraw():J._32I||(J._24I||(J._24I={}),J._24I[p._id]=p,J.iv())},o.getFocusData=function(){return this._focusData},o.setFocusDataById=function(S){this.setFocusData(this.dm().getDataById(S))},o.setFocusData=function(Q){var K=this,r=K._focusData;r!==Q&&(K._focusData=Q,K.fp("focusData",r,Q),r&&K.invalidateData(r),Q&&(K.invalidateData(Q),K.isAutoMakeVisible()&&K.makeVisible(Q)))},o.drawRowBackground=function(G,v,i,D,h,$,T){var p=this,o=p.isCheckMode();(v===p._focusData&&o||i&&!o)&&gk(G,D,h,$,T,p.getSelectBackground(v))},o.drawData=function(h,z,p){var g=this,v=g._rowHeight,n=v*p,Q=g._29I,M=Q.x,r=Q.width;h.save(),h.beginPath(),h.rect(M,n,r,v),h.clip(),g._87o(g.drawRow(h,z,g.isSelected(z),M,n,r,v),p,M,n,r,v),h.restore(),g._rowLineVisible&&gk(h,M,n+v-1,r,1,g._rowLineColor)},o._12I=function(S){var e=this,f=e._31I,p=e._29I,s=p.x,P=p.y,j=p.width,r=p.height;for(S.beginPath(),S.rect(s,P,j,r),S.clip(),S.clearRect(s,P,j,r),e._76o(),e._93db(S);f<e._14I;f++)e.drawData(S,e._rows.get(f),f);e._92db(S)},o._13I=function(Y){for(var p,K=this,G=K._rowHeight,U=K._29I,E=U.x,I=U.width,R=K._31I,z=K._30I;R<K._14I;R++)p=K._rows.get(R),K._24I[p._id]&&z.add({data:p,index:R});z.isEmpty()||(Y.beginPath(),z.each(function(h){Y.rect(E,h.index*G,I,G)}),Y.clip(),z.each(function(V){Y.clearRect(E,V.index*G,I,G)}),z.each(function(Q){K._77o(Q.index)}),K._93db(Y),z.each(function(F){K.drawData(Y,F.data,F.index)}),K._92db(Y),z.clear())},o.preValidateModel=function(){this.endEditing&&this.endEditing()},o.validateImpl=function(){var U=this,J=U._canvas,f=U.getWidth(),h=U.getHeight(),j=U._rowHeight,V=U._32I;(f!==J.clientWidth||h!==J.clientHeight)&&(Jk(J,f,h),V=1),U._96I&&(U.preValidateModel(),U.validateModel());var X=U._29I,r={x:-U.tx(),y:-U.ty(),width:f,height:h},B=U._rows.size(),Z=lc(J),M=U._23I;V||is(r,X)||(V=1),U._29I=r,U._59I=B*j,U._31I=C(r.y/j),U._14I=$((r.y+r.height)/j),U._31I<0&&(U._31I=0),U._14I>B&&(U._14I=B),U._99I&&V&&U._99I();var b=U.tx(),T=U.ty();(U._40o()||U._41o())&&(U._59I+=U.getScrollBarSize(),U._99I&&V&&(U._91I+=U.getScrollBarSize())),yi&&!Jf&&(Z.save(),sp(Z,f/Rl.length,h/Rl.length,1)),sp(Z,b,T,1),V?U._12I(Z):U._24I&&U._13I(Z),U._93I(),U._92I(),Z.restore(),U._32I=U._24I=U._96I=I,M&&(U.scrollToIndex(U.getRowIndex(M)),delete U._23I),U.tx(U.tx()),U.ty(U.ty())},o.canHandleSelectMode=function(){return!0},o.isDraggable=function(){return!0}},ng._48o=function(u){u._rootVisible=!0,u._rootData=I,u._35o=function(){this._expandMap={},this._levelMap={}},u.validateModel=function(){var F=this,G=F._rootData;F._rows.clear(),F._levelMap={},F._rowMap={},F._currentLevel=0,G?F._rootVisible?F.isVisible(G)&&F.buildData(G):F.buildChildren(G):F.buildChildren(),delete F._currentLevel},u.buildData=function(X){var V=this,$=X._id,m=V._rows;V._rowMap[$]=m.size(),m.add(X),V._levelMap[$]=V._currentLevel,V.isExpanded(X)&&(V._currentLevel++,V.buildChildren(X),V._currentLevel--)},u.buildChildren=function(b){var w=this,V=b?b._children:w._dataModel._roots,o=w.getCurrentSortFunc();o&&w.isChildrenSortable(b)?V.toList(w.isVisible,w).sort(o).each(w.buildData,w):V.each(function(G){w.isVisible(G)&&w.buildData(G)})},u.getLevel=function(o){return this._levelMap[o._id]},u.getToggleIcon=function(T){var S=this,t=S._loader,J=S._collapseIcon;return t&&!t.isLoaded(T)?J:T.hasChildren()?S.isExpanded(T)?S._expandIcon:J:I},u.isCheckMode=function(){return this._checkMode!=I},u.isChildrenSortable=function(){return!0},u.handleDataModelChange=function(O){var T=this;O.kind===Ib?delete T._expandMap[O.data._id]:O.kind===jr&&(T._expandMap={}),T.ivm()},u.toggle=function(w){var A=this;A.isExpanded(w)?A.collapse(w):A.expand(w)},u.isExpanded=function(d){return 1===this._expandMap[d._id]},u.expand=function(Y){var h=this,w=h._loader;h.isExpanded(Y)||(w&&!w.isLoaded(Y)&&w.load(Y),h._expandMap[Y._id]=1,h.ivm(),h.onExpanded(Y))},u.onExpanded=function(){},u.collapse=function(O){var D=this;D.isExpanded(O)&&(delete D._expandMap[O._id],D.ivm(),D.onCollapsed(O))},u.onCollapsed=function(){},u.expandAll=function(d){if(d)this.expand(d),d.eachChild(function(S){this.expandAll(S)},this);else{var v=this;v._dataModel.each(function(h){h.hasChildren()&&(v._expandMap[h._id]=1)}),v.ivm()}},u.collapseAll=function(){this._expandMap={},this.ivm()},u.makeVisible=function(h){if(h){var n=this;if(!n._rootData||h.isDescendantOf(n._rootData)){for(var P=h._parent;P;)n.expand(P),P=P._parent;n._23I=h,n.iv()}}},u.checkData=function(E){var K,e=this,l=e._checkMode,C=e.sm(),A=C.co(E);if(!C.sg()||!A){if(e._32o=1,l===Oc)A?C.rs(E):C.as(E);else if(l===Pc)K=new Gk(E),K.addAll(E._children);else if("descendant"===l)K=new Gk,Et(E,K);else if("all"===l&&(K=new Gk,Et(E,K),!A))for(var D=E._parent;D;)K.add(D),D=D._parent;K&&(A?C.rs(K):C.as(K)),delete e._32o}},u.drawTree=function(J,W,D,z,j,M,P){var l=this,F=l._indent,p=l._levelMap[W._id],h=l.getIconWidth(W),A=Td(l.getToggleIcon(W));A?(z+=F*p,Vd(J,A,z+F/2,j+P/2,W,l),z+=F):z+=F*(p+1),l._checkMode&&(Vd(J,l.getCheckIcon(W),z+F/2,j+P/2,W,l),z+=F),l.drawIcon(J,W,z,j,h,P),l.drawLabel(J,W,z+h,j,P)}},ng._14Q=function(t){t.getIcon=function(A){return A.getIcon()},t.getIconWidth=function(x){return this.getIcon(x)?this._indent:0},t.drawIcon=function(f,h,D,g,R,i){if(R){var O=this,r=O.getBodyColor(h),M=Td(O.getIcon(h),r);M&&(i-=O.isRowLineVisible()?1:0,_n(f,M,ws,D,g,R,i,h,O,r),jn(f,O.getBorderColor(h),D,g,R,i))}},t.drawLabel=function(d,a,Q,r,M){var l=this;dg(d,l.getLabel(a),l.getLabelFont(a),l.getLabelColor(a),Q,r,0,M)}},ng._50o=function(e){e._98I=function(){var J=this,d=J._39o=new Og;J._60I=new Gk,d.mm(J._17o,J),d.md(J._18o,J),d.mh(J._19o,J)},e.setColumns=function(s){this._39o.clear(),this.addColumns(s)},e.addColumns=function(k){var y=this._39o;k.forEach(function(Q){if(!(Q instanceof Lt)){var Z=Lo(Q.className);Q=Ih(Z?Z:Lt,Q)}y.add(Q)})},e.onColumnClicked=function(){},e.onCheckColumnClicked=function(){},e._3Q=function(V){for(var r,c=0,p=this._60I,g=p.size();g>c;c++)if(r=p.get(c),r.column===V)return r;return I},e.getColumnAt=function(L){var Z=this._4Q(L);return Z?Z.column:I},e._4Q=function(z){for(var j=this,k=z.target?j.lp(z).x:z.x,Z=j._60I,O=0;O<Z.size();O++){var e=Z.get(O),N=e.startX;if(k>=N&&k<N+e.column.getWidth())return e}return I},e.getToolTip=function(W){var A=this,l=A.getDataAt(W),K=A.getColumnAt(W);return l&&K?K.getToolTip(l,A):I},e.adjustTranslateX=function(d){var F=this.getWidth()-this._91I;return F>d&&(d=F),d>0?0:H(d)},e._99I=function(){var J=this,V=J._29I,S=J._60I;S.clear(),J._91I=0,J._39o._roots.each(function(I){if(I.isVisible()){var o=J._91I+I.getWidth();J._91I<=V.x+V.width&&o>=V.x&&S.add({column:I,startX:J._91I}),J._91I=o}})},e.drawData=function(w,K,H){var b=this,e=b._rowHeight,T=e*H,m=b.isSelected(K),t=b._29I,Q=t.x,j=t.width;b.drawRowBackground(w,K,m,Q,T,j,e),b._60I.each(function(t){var C=t.column,N=t.startX,O=C.getWidth();O>0&&!b.isEditing(K,C)&&(w.save(),w.beginPath(),w.rect(N,T,O,e),w.clip(),b._87o(b.drawCell(w,K,m,C,N,T,O,e),H,N,T,O,e),b._columnLineVisible&&gk(w,N+O-1,T,1,e,b._columnLineColor),w.restore())}),b._rowLineVisible&&gk(w,Q,T+e-1,j,1,b._rowLineColor)},e.drawCell=function(h,x,a,j,O,t,Y,q){var A=this;if(j.drawCell)return j.drawCell(h,x,a,j,O,t,Y,q,A);var K=A.getValue(x,j);Ft(h,K,j,A.getLabelFont(x,j,K),A.getLabelColor(x,j,K),O,t,Y,q,x,A)},e.getColumnModel=function(){return this._39o},e._17o=function(){this.redraw()},e._18o=function(F){var V=this;F.data===V._sortColumn&&At[F.property]?V.ivm():(V._42o(),V.redraw())},e._19o=function(){this.redraw()},e.getCurrentSortFunc=function(){var U=this,E=U._sortColumn;if(E&&E.isSortable()){var w=E.getSortFunc(),j=en===E.getSortOrder()?1:-1;return w||(w=cf),function(z,M){return w.call(U,U.getValue(z,E),U.getValue(M,E),z,M)*j}}return U._sortFunc},e.isCellEditable=function(B,$,D){return $.isEditable()&&this.isEditable()?$.isCellEditable?$.isCellEditable(B,$,D,this):!0:!1},e._37O=function(G,S){if(fb(S))for(var m=this,n=m.lp(S),V=m._60I,J=m._rowHeight,I=m._29I,l=I.x,T=I.y,F=I.width,t=I.height,E=0;E<V.size();E++){var Q=V.get(E),L=Q.startX,a=Q.column,d=a.getWidth();if(a!==m._31o&&a!==m._4o&&n.x>=L&&n.x<L+d&&m.isCellEditable(G,a,S)){var b={x:L,y:m.getRowIndex(G)*J,width:d,height:J},O={x:b.x+m.tx(),y:b.y+m.ty(),width:b.width,height:b.height},K=0,f=0;return b.x<l?K=b.x-l:b.x+b.width>l+F&&(K=b.x+b.width-l-F),K&&(m.tx(m.tx()-K),O.x-=K),b.y<T?f=b.y-T:b.y+J>T+t&&(f=b.y+J-T-t),f&&(m.ty(m.ty()-f),O.y-=f),m.beginEditing({data:G,column:a,value:m.getValue(G,a),event:S,rect:b,editorRect:O,view:m}),void 0}}}},It.BaseItemEditor=function(n,N,Z,h){this._data=n,this._column=N,this._master=Z,this._editInfo=h},Jt("BaseItemEditor",T,{ms_ac:["data","column","master","editInfo"],editBeginning:function(){},getView:function(){},getValue:function(){},setValue:function(){}});var Kt=B.Tab=function(){yd(Kt,this)};$e("Tab",If,{ms_ac:["view","closable","disabled","visible"],_icon:I,_closable:!1,_disabled:!1,_visible:!0,setParent:Dm});var Lt=B.Column=function(){yd(Lt,this)};$e("Column",If,{_46o:1,ms_ac:["accessType","valueType",nb,sq,Yl,xo,"align",_b,"sortOrder",Ai,"sortable","clickable","nullable","emptiable","slider","colorPicker","itemEditor"],_visible:!0,_width:80,_sortOrder:en,_sortFunc:I,_sortable:!0,_clickable:!0,setWidth:function(T){16>T&&(T=16);var N=this._width;this._width=T,this.fp(xo,N,T)},getToolTip:function(A,R){return this.formatValue(R.getValue(A,this))}});var Mt=B.Property=function(){yd(Mt,this)};$e("Property",If,{_46o:1,ms_ac:["accessType","valueType",sq,Yl,"categoryName",_b,"align","nullable","emptiable","slider","itemEditor","colorPicker"],_categoryName:I,getToolTip:function(G,k,M){var R=this;return k?R.formatValue(M.getValue(G,R)):M.getPropertyName(R)}}),It.AccordionView=function(){var M=this;M._20o={},M._21o=new Gk,M._10o=I,M._9o=I,M._11o=I,M._view=Fd(0,M),M.iv()},Jt("AccordionView",T,{ms_v:1,ms_fire:1,ms_ac:[Kh,Ld,"titleHeight",Zc,pf,"titleBackground","selectWidth",Gr,"orientation","separatorColor"],_expandIcon:R.accordionViewExpandIcon,_collapseIcon:R.accordionViewCollapseIcon,_titleHeight:wb,_labelColor:R.accordionViewLabelColor,_labelFont:R.accordionViewLabelFont,_titleBackground:R.accordionViewTitleBackground,_selectBackground:R.accordionViewSelectBackground,_selectWidth:R.accordionViewSelectWidth,_orientation:"v",_separatorColor:R.accordionViewSeparatorColor,onPropertyChanged:function(){this.iv()},getView:function(){return this._view},getTitles:function(){return this._21o},getCurrentTitle:function(){return this._10o},add:function(q,R,I,A){var v=this,T=eg(),t={content:R,div:T,canvas:On(T),icon:A};if(v._20o[q])throw q+" already exists";var V=t.downEventFunc=function(L){cl(L)},k=t.upEventFunc=function(m){cl(m),fb(m)&&(v._10o===q?v.collapse():v.expand(q))};[ls,Bj].forEach(function(a){j(T,a,V)}),[qd,ec].forEach(function(i){j(T,i,k)}),T.style.cursor=Tr,Ul(v._view,T),v._20o[q]=t,v._21o.add(q),I&&v.expand(q),v.iv()},remove:function(I){var r=this,f=r._20o[I];if(f){var b=f.div;Pp(b),[ls,Bj].forEach(function(p){W(b,p,f.downEventFunc)}),[qd,ec].forEach(function(x){W(b,x,f.upEventFunc)}),delete r._20o[I],r._21o.remove(I),r.iv()}},clear:function(){var y=this;y._21o.toArray().forEach(y.remove,y),y._20o={},y._21o.clear(),y.iv()},isExpanded:function(J){return this._10o===J},expand:function(c){var P=this;P._20o[c]&&P._10o!==c&&(P._10o=c,P.onExpanded(c),P.iv())},onExpanded:function(){},collapse:function(){var Q=this;Q._10o&&(Q.onCollapsed(Q._10o),delete Q._10o,Q.iv())},onCollapsed:function(){},initCanvas:function(X,i,g){Jk(X,i,g);var Y=lc(X);return sp(Y,0,0,1),Y.clearRect(0,0,i,g),Y},drawTitle:function(e,x,A,J,G){var s=this,z=Td(G.icon),D=s.isExpanded(x),H=s._titleHeight,S=s._titleBackground,M=s._selectWidth,l=s._separatorColor,c=Td(D?s._expandIcon:s._collapseIcon),E=M+4;gk(e,0,0,A,J,S),D&&M&&gk(e,0,0,M,J,s._selectBackground),(D||s._21o.get(s._21o.size()-1)!==x)&&gk(e,0,J-1,A,1,l?l:Fk(S)),z&&(Vd(e,z,E+nr(z)/2,H/2),E+=nr(z)+2),dg(e,x,s.getLabelFont(x),s.getLabelColor(x),E,0,0,H),c&&Vd(e,c,A-nr(c)/2-4,H/2)},validateImpl:function(){var E=this,h=E._view,y=0,$=0,w=E.getWidth(),e=E.getHeight(),G=E._titleHeight,A=E._21o.size()*G,t=E._11o,U=E._9o;delete E._11o,delete E._9o,E._21o.each(function(P){var V,b,C=E._20o[P],x=C.content,l=E._10o===P;Cg(E)?(Ae(C.div,y,0,G,e),V=E.initCanvas(C.canvas,G,e),or(V,0,e),Aj(V,-pk),E.drawTitle(V,P,e,G,C),V.restore(),l?(b=o(0,w-A),x&&(E._11o=x,E._9o=ue(x),Ae(x,y+G,0,b,e)),y+=G+b):y+=G):(Ae(C.div,0,$,w,G),V=E.initCanvas(C.canvas,w,G),E.drawTitle(V,P,w,G,C),V.restore(),l?(b=o(0,e-A),x&&(E._11o=x,E._9o=ue(x),Ae(x,0,$+G,w,b)),$+=G+b):$+=G)});var N=E._9o;t&&t!==E._11o&&t.endEditing&&t.endEditing(),N&&N!==U&&Ul(h,N),U&&U!==N&&Pp(U)}}),It.SplitView=function(E,x,G,z){var l=this,w=l._dividerDiv=eg(),S=l._60O=On(),t=l._61O=On(),R=S.style,D=t.style;l._view=Fd(1,l),Ul(l._view,w),R.msTouchAction=Lc,R.pointerEvents=Lc,R.cursor=Tr,D.msTouchAction=Lc,D.pointerEvents=Lc,D.cursor=Tr,E&&l.setLeftView(E),x&&l.setRightView(x),G&&l.setOrientation(G),z!=I&&l.setPosition(z),l.setStatus(bb),new Nt(l)},Jt("SplitView",T,{ms_v:1,ms_fire:1,ms_ac:["continuousLayout","dividerSize","dividerBackground","toggleIcon","togglable","dragOpacity","orientation","draggable","status"],_continuousLayout:!1,_position:.5,_togglable:!0,_orientation:"h",_draggable:!0,_dividerSize:R.splitViewDividerSize,_dividerBackground:R.splitViewDividerBackground,_dragOpacity:R.splitViewDragOpacity,_toggleIcon:R.splitViewToggleIcon,onPropertyChanged:function(){this.iv()},getDividerDiv:function(){return this._dividerDiv},getPosition:function(){return this._position},setPosition:function(Z,a){var o=this,z=o._position;isNaN(Z)||(a||(o._82O=0>Z?-1:Z>1?1:0),o._position=Z,o.fp(qo,z,Z))},getLeftView:function(){return this._leftView},setLeftView:function(b){var q=this,v=q._leftView,R=q._view;if(q._leftView!==b){if(v&&v!==q._rightView){var s=ue(v);s.parentNode===R&&Pp(s)}if(q._leftView=b,b){var k=ue(b);k.parentNode!==R&&R.insertBefore(k,q._dividerDiv)}q.fp("leftView",v,b)}},getRightView:function(){return this._rightView},setRightView:function(_){var n=this,H=n._rightView,P=n._view;if(n._rightView!==_){if(H&&H!==n._leftView){var Q=ue(H);Q.parentNode===P&&Pp(Q)}if(n._rightView=_,_){var O=ue(_);O.parentNode!==P&&P.insertBefore(O,n._dividerDiv)}n.fp("rightView",H,_)}},validateImpl:function(){var Y=this,x=Y._draggable,U=Y._position,J=Y.getWidth(),t=Y.getHeight(),T=Y._dividerSize,D=Y._dividerBackground,s=gj?18:8,k=Y._dividerDiv,R=Y._82O,e=Y._60O,i=Y._61O,P=Y._toggleIcon,C=Y._status,F=k.style,_=null,O=gj?20:4,Q=P.comps[0];T>=s||0===T?Y._coverDiv&&(Pp(Y._coverDiv),delete Y._coverDiv):Y._coverDiv||(Y._coverDiv=eg(),dq&&(Y._coverDiv.style.background=Fb),Ul(k,Y._coverDiv)),Y._togglable?e.parentNode||(Ul(k,e),Ul(k,i)):(Pp(e),Pp(i));var f=Y._coverDiv,V=Y._leftView,g=Y._rightView;if(Cg(Y)){if(T>J&&(T=J),C===bb)if(1===R)var z=X(U,J),A=o(0,J-T-z);else-1===R?(A=X(-U,J),z=o(0,J-T-A)):(z=H((J-T)*U),A=o(0,J-T-z));else"cl"===C?(z=0,A=o(0,J-T)):"cr"===C&&(A=0,z=o(0,J-T));V&&Ae(V,0,0,z,t),g&&Ae(g,z+T,0,A,t),Ae(k,z,0,T,t),Y._22o=z,f&&(Ae(f,T/2-s/2,0,s,t),f.style.cursor=x?ub:""),k.style.cursor=x?ub:"";var m=k.clientHeight/2,n=k.clientWidth;Jk(e,n,n),Ae(e,0,m-n-O,n,n),_=lc(e),sp(_,0,0,1),Q.rotation=-pk,cq(_,P,0,0,n,n),_.restore(),Jk(i,n,n),Ae(i,0,m+O,n,n),_=lc(i),sp(_,0,0,1),Q.rotation=pk,cq(_,P,0,0,n,n),_.restore()}else{if(T>t&&(T=t),C===bb)if(1===R)var d=X(U,t),Z=o(0,t-T-d);else-1===R?(Z=X(-U,t),d=o(0,t-T-Z)):(d=H((t-T)*U),Z=o(0,t-T-d));else"cl"===C?(d=0,Z=o(0,t-T)):"cr"===C&&(Z=0,d=o(0,t-T));V&&Ae(V,0,0,J,d),g&&Ae(g,0,d+T,J,Z),Ae(k,0,d,J,T),Y._22o=d,f&&(Ae(f,0,T/2-s/2,J,s),f.style.cursor=x?pj:""),F.cursor=x?pj:"";var h=k.clientWidth/2,n=k.clientHeight;Jk(e,n,n),Ae(e,h-n-O,0,n,n),_=lc(e),sp(_,0,0,1),Q.rotation=0,cq(_,P,0,0,n,n),_.restore(),Jk(i,n,n),Ae(i,h+O,0,n,n),_=lc(i),sp(_,0,0,1),Q.rotation=L,cq(_,P,0,0,n,n),_.restore()}F.background=D}});var Nt=function(A){this.sv=A,this.addListeners()};Lp(Nt,T,{ms_listener:1,getView:function(){return this.sv.getView()},handle_touchstart:function(O){var R=this,$=R.sv,j=$._dividerDiv,D=$._60O,I=$._61O,C=$._status,W=O.target;if(W===D)C===bb?$.setStatus("cl"):"cr"===C&&$.setStatus(bb);else if(W===I)C===bb?$.setStatus("cr"):"cl"===C&&$.setStatus(bb);else if(Om(O)&&(W===j||W===$._coverDiv)&&(cl(O),$.isDraggable())){$.getLeftView(),$.getRightView();var a=R.maskDiv=eg();if(a.style.left=0,a.style.top=0,a.style.width=$.getWidth()+"px",a.style.height=$.getHeight()+"px",$.getView().appendChild(a),!$.isContinuousLayout()){var N=R.resizeDiv=eg();N.style.left=j.style.left,N.style.top=j.style.top,N.style.width=j.style.width,N.style.height=j.style.height,N.style.opacity=$.getDragOpacity(),N.style.background=$.getDividerBackground(),Ul(R.getView(),N)}R._lastAbsPosition=$._22o,R._86o=Cg($)?Po(O).x:Po(O).y,ii(R,O)}},handleWindowTouchMove:function(S){Om(S)&&this.update(S,this.sv.isContinuousLayout())},handleWindowTouchEnd:function(O){var X=this;X.update(O,!0),X.sv.setStatus(bb),X.maskDiv&&Pp(X.maskDiv),X.resizeDiv&&Pp(X.resizeDiv),X.maskDiv=X.resizeDiv=I},handle_mousedown:function(D){fb(D)&&this.handle_touchstart(D)},handleWindowMouseMove:function(K){this.handleWindowTouchMove(K)},handleWindowMouseUp:function(M){this.handleWindowTouchEnd(M)},update:function(d,L){var S=this,q=S.sv,e=Cg(q)?q.getWidth():q.getHeight(),o=q._dividerSize,j=S._lastAbsPosition-S._86o;Cg(q)?(j+=Po(d).x,j>e-o&&(j=e-o),0>j&&(j=0),S.resizeDiv&&(S.resizeDiv.style.left=j+Mq)):(j+=Po(d).y,j>e-o&&(j=e-o),0>j&&(j=0),S.resizeDiv&&(S.resizeDiv.style.top=j+Mq)),L&&e!==o&&(1===q._82O?q.setPosition(j,1):-1===q._82O?q.setPosition(j-e+o,1):q.setPosition(j/(e-o),1))}}),It.TabView=function(){var K=this,k=K._view=Fd(1,K),d=K._91O=eg(1),w=K._tabModel=new Og,S=w.sm(),m=K.invalidate;K._7o=new Gk,K._canvas=On(d),Ul(k,d),Ul(k,K._92O=eg(1)),S.setSelectionMode(lo),S.ms(K.handleSelectionChange,K),w.mm(m,K),w.mh(m,K),w.md(m,K),K._interactor=new Ot(K),K.iv()},Jt("TabView",T,{ms_v:1,ms_fire:1,ms_tx:1,ms_ty:1,ms_lp:1,ms_ac:["movable","tabGap","tabHeight","tabPosition",Zc,pf,"tabHPadding","tabBackground","selectWidth",Gr,"moveBackground","insertColor"],_tabHPadding:0,_tabPosition:Vh,_tabHeight:wb,_tabGap:R.tabViewTabGap,_labelColor:R.tabViewLabelColor,_labelFont:R.tabViewLabelFont,_tabBackground:R.tabViewTabBackground,_selectWidth:R.tabViewSelectWidth,_selectBackground:R.tabViewSelectBackground,_moveBackground:R.tabViewMoveBackground,_insertColor:R.tabViewInsertColor,_movable:!0,handleSelectionChange:function(){this._selectionChanged=!0,this.invalidate()},getContentDiv:function(){return this._92O},getTitleDiv:function(){return this._91O},getTabModel:function(){return this._tabModel},add:function(f,x,P){var l,c=this._tabModel;return f instanceof Kt?(l=f,x&&l.setView(x)):(l=new Kt,l.setName(f),l.setView(x)),c.add(l),P&&c.sm().ss(l),l},getLabel:function(B){return B.toLabel()},onPropertyChanged:function(){this.iv()},_7Q:function(E){this._23o=E,this.iv()},get:function(R){var y=this,u=y._tabModel;if(gs(R))return u._roots.get(R);if(Fc(R)){var H;return u.each(function(L){R===y.getLabel(L)&&(H=L)}),H}return R instanceof Kt?R:I},select:function(R){this._tabModel.sm().ss(this.get(R))},remove:function(z){var L=this;if(z=L.get(z)){var j=L._tabModel,u=j._roots.indexOf(z);L._tabModel.remove(z),L.selectByIndex(--u)}},getCurrentTab:function(){return this._8o},hideTabView:function(P,W){W.parentNode===this._92O&&(tk(W)?(W.style.display=xj,W._tab_=P):Pp(W),xf())
},showTabView:function(G,c){tk(c)&&(c.style.display="block",c._tab_=G),c.parentNode!==this._92O&&(Ul(this._92O,c),xf())},_24o:function(){var x,i=this,W=i._8o,K=i._9o,f=i._tabModel.sm().ld();f&&(x=ue(f.getView())),x!==K&&(K&&(W.getView()&&W.getView().endEditing&&W.getView().endEditing(),i.hideTabView(W,K)),x&&i.showTabView(f,x)),i._8o=f,i._9o=x,W!==f&&i.onTabChanged(W,f)},onTabClosing:function(){return!0},onTabChanged:function(){},onTabClosed:function(Q,g){this.selectByIndex(--g)},selectByIndex:function(q){var E=this,j=E._tabModel,U=j.size();if(U&&!j.sm().ld()){q==I&&(q=0),q>=U&&(q=U-1),0>q&&(q=0);for(var i=q;i>=0;i--){var p=E.get(i);if(!p.isDisabled())return E.select(p),p}for(i=q+1;U>i;i++)if(p=E.get(i),!p.isDisabled())return E.select(p),p}},getTabWidth:function(m){var X=this.getTabHPadding(),Y=4+2*X,t=Td(m.getIcon());t&&(Y+=nr(t,m)+4);var T=this.getLabel(m);return T&&(Y+=Pb(this.getLabelFont(m),T).width+4),m.isClosable()&&(Y+=10),Y},drawTab:function(U,c,q,a,z,x,J){var E,g=this,i=g._tabPosition,s=this.getTabHPadding(),m=q+4+s,R=g._selectWidth,f=Td(c.getIcon()),X=c.isDisabled(),W=g.getLabelColor(c),P=g.getLabelFont(c),v=g.getLabel(c),d=g._selectBackground,n=i===xi+"-vertical",$=i===Dd+"-vertical";(n||$)&&(m=a+4+s),X&&(U.globalAlpha=Db),gk(U,q,a,z,x,J),c===g._8o&&R&&(i===Vh?gk(U,q,a+x-R,z,R,d):i===xi?gk(U,q+z-R,a,R,x,d):i===Dd?gk(U,q,a,R,x,d):n?gk(U,q+z-R,a,R,x,d):$?gk(U,q,a,R,x,d):gk(U,q,a,z,R,d));var S=z/2;if(n&&(or(U,S,a+x/2),Aj(U,L),or(U,-S,-a-x/2)),f){var u=kd(f,c),y=nr(f,c);if(n||$){var T=q+z/2,Y=m+u/2;or(U,T,Y),Aj(U,pk),or(U,-T,-Y),Vd(U,f,q+z/2,m+u/2,c,g),or(U,T,Y),Aj(U,-pk),or(U,-T,-Y),m+=u+4}else Vd(U,f,m+y/2,a+x/2,c,g),m+=y+4}return n||$?(or(U,z/2,m+z/2),Aj(U,pk),or(U,-z/2,-m-z/2),dg(U,v,P,W,q,m,x,z),or(U,z/2,m+z/2),Aj(U,-pk),or(U,-z/2,-m-z/2)):dg(U,v,P,W,m,a,z,x),n&&(or(U,S,a+x/2),Aj(U,-L),or(U,-S,-a-x/2)),c.isClosable()&&(E=$?{x:q+z-12,y:a+x-12,width:12,height:12}:{x:q+z-12,y:a+2,width:12,height:12},this.drawCloseIcon(c,U,W,E)),X&&(U.globalAlpha=1),E},drawCloseIcon:function(o,x,z,i){var D=i.x,g=i.y;x.strokeStyle=z,x.lineWidth=1,x.beginPath(),x.moveTo(D+2,g+8),x.lineTo(D+8,g+2),x.moveTo(D+8,g+8),x.lineTo(D+2,g+2),x.stroke()},getTabAt:function(e){var p=this._interactor._8Q(e);return p?p.tab:null},validateImpl:function(){var J=this;J._24o();var f,c=J._canvas,G=J._tabPosition,h=J._91O,D=J._92O,n=J._tabModel,$=J.getWidth(),H=J.getHeight(),X=J._tabHeight,S=J._7o,i=J._tabGap,k=G===Vh,B=G===xi,g=G===Dd,e=G===xi+"-vertical",N=G===Dd+"-vertical",T=J._23o,R=0;if((B||g)&&n._roots.each(function(E){R=o(J.getTabWidth(E),R)}),k?(Ae(h,0,0,$,X),f={x:0,y:X,width:$,height:o(0,H-X)}):B?(Ae(h,0,0,R,H),f={x:R,y:0,width:o(0,$-R),height:H}):g?(Ae(h,$-R,0,R,H),f={x:0,y:0,width:o(0,$-R),height:H}):e?(Ae(h,0,0,X,H),f={x:X,y:0,width:o(0,$-X),height:H}):N?(Ae(h,$-X,0,X,H),f={x:0,y:0,width:o(0,$-X),height:H}):(Ae(h,0,H-X,$,X),f={x:0,y:0,width:$,height:o(0,H-X)}),Ae(D,f),e||N){J._9o&&(f.x=0,Ae(J._8o.getView(),f)),Jk(c,X,H);var r=lc(c),W=0;if(sp(r,0,J.ty(),1),r.clearRect(0,0,X,H),S.clear(),n._roots.each(function(R){if(R.isVisible()){var d,L=J.getTabWidth(R);if(!T||T.tab!==R){var M=J.getTabBackground(R);d=J.drawTab(r,R,0,W,X,L,M)}S.add({_75o:d,tab:R,startY:W,endY:W+L,height:L}),W+=L+i}}),J._23Q=o(0,W-i),T){var E=T.position;J.drawTab(r,T.tab,0,T.startY,X,T.height,J._moveBackground),gk(r,0,E,X,1,J._insertColor)}if(r.restore(),J._selectionChanged){J._selectionChanged=!1;for(var F=J.ty(),A=0;A<S.size();A++){var Z=S.get(A);if(Z.tab===J._8o){if(Z.endY+F<0){J.ty(-Z.startY);break}if(Z.startY+F>H){J.ty(H-Z.endY);break}}}}J.ty(J.ty())}else if(B||g){J._9o&&(f.x=0,Ae(J._8o.getView(),f)),Jk(c,R,H);var r=lc(c),W=0;if(sp(r,0,J.ty(),1),r.clearRect(0,0,R,H),S.clear(),n._roots.each(function(e){if(e.isVisible()){var j;if(!T||T.tab!==e){var Q=J.getTabBackground(e);j=J.drawTab(r,e,0,W,R,X,Q)}S.add({_75o:j,tab:e,startY:W,endY:W+X,height:X}),W+=X+i}}),J._23Q=o(0,W-i),T){var E=T.position;J.drawTab(r,T.tab,0,T.startY,R,T.height,J._moveBackground),gk(r,0,E,R,1,J._insertColor)}if(r.restore(),J._selectionChanged){J._selectionChanged=!1;for(var F=J.ty(),A=0;A<S.size();A++){var Z=S.get(A);if(Z.tab===J._8o){if(Z.endY+F<0){J.ty(-Z.startY);break}if(Z.startY+F>H){J.ty(H-Z.endY);break}}}}J.ty(J.ty())}else{J._9o&&(f.y=0,Ae(J._8o.getView(),f)),Jk(c,$,X);var r=lc(c),v=0;if(sp(r,J.tx(),0,1),r.clearRect(0,0,$,X),S.clear(),n._roots.each(function(w){if(w.isVisible()){var h,k=J.getTabWidth(w);if(!T||T.tab!==w){var W=J.getTabBackground(w);h=J.drawTab(r,w,v,0,k,X,W)}S.add({_75o:h,tab:w,startX:v,endX:v+k,width:k}),v+=k+i}}),J._64I=o(0,v-i),T){var E=T.position;J.drawTab(r,T.tab,T.startX,0,T.width,X,J._moveBackground),Hq(r,J._insertColor,E,0,X)}if(r.restore(),J._selectionChanged){J._selectionChanged=!1;for(var p=J.tx(),A=0;A<S.size();A++){var Z=S.get(A);if(Z.tab===J._8o){if(Z.endX+p<0){J.tx(-Z.startX);break}if(Z.startX+p>$){J.tx($-Z.endX);break}}}}J.tx(J.tx())}for(var U=[],w=D.children,A=0;A<w.length;A++){var K=w[A],P=K._tab_;P&&!n.contains(P)&&U.push(K)}U.forEach(function(m){D.removeChild(m)})}});var Ot=function(X){this.tv=X,this.addListeners()};Lp(Ot,T,{ms_listener:1,getView:function(){return this.tv._91O},handle_mousewheel:function(l){this.handleScroll(l,10*(l.wheelDelta/40))},handle_DOMMouseScroll:function(J){this.handleScroll(J,10*-J.detail)},handleScroll:function(u,U){cl(u);var p=this.tv,s=p._tabPosition;!p._40o()||s!==Vh&&s!==dd||p.tx(this.tv.tx()+U),!p._41o()||s!==xi&&s!==Dd&&s!==xi+"-vertical"&&s!==Dd+"-vertical"||p.ty(this.tv.ty()+U)},_8Q:function(H){var L,y,j=this.tv,w=j._tabPosition,p=j._7o;if(w===Vh||w===dd){var A=j.lp(H).x;for(L=0;L<p.size();L++)if(y=p.get(L),y.startX<=A&&A<=y.endX)return y}else if(w===xi||w===Dd||w===xi+"-vertical"||w===Dd+"-vertical"){var D=j.lp(H).y;for(L=0;L<p.size();L++)if(y=p.get(L),y.startY<=D&&D<=y.endY)return y}return I},isClickable:function(z){var r=this.tv,G=r._tabPosition,Z=this._73o=this._8Q(z);return!r._40o()||G!==Vh&&G!==dd?!r._41o()||G!==xi&&G!==Dd&&G!==xi+"-vertical"&&G!==Dd+"-vertical"?Z&&(!Z.tab.isDisabled()||r.isMovable()):!0:!0},handle_mousemove:function(Y){var M=this;_l?M._74o=M._8Q(Y):M.getView().style.cursor=M.isClickable(Y)?Tr:""},handle_mousedown:function(s){this.handle_mousemove(s),this.handle_touchstart(s)},handle_touchstart:function(g){var G=this,m=G.tv,p=m._tabPosition;cl(g),fb(g)&&G.isClickable(g)&&(p===Vh||p===dd?(G.x=Po(g).x,G.lp=m.lp(g),G.tx=m.tx()):(G.y=Po(g).y,G.lp=m.lp(g),G.ty=m.ty()),ii(G,g))},handle_mouseup:function(S){this.handle_touchend(S)},handle_touchend:function(R){if(Ie(R)){var G=this._73o;if(!G)return;var x=this.tv,y=x.getTabModel(),n=G.tab;if(!n.isDisabled()&&n.isClosable()){var F=function(){var w=y._roots.indexOf(n);y.remove(n),x.onTabClosed(n,w)};x.onTabClosing(n,F)&&F()}}},handleWindowMouseMove:function(K){this.handleWindowTouchMove(K)},handleWindowTouchMove:function(U){var u,d=this,B=d.tv,F=B._tabPosition,O=d._73o;if(F===Vh||F===dd){if(u=Po(U).x-d.x,!d._25o&&!d.moving&&i(u)>2&&(B._40o()&&!Bl(U)?d._25o=1:O&&B.isMovable()&&(d.moving=1)),d._25o)B.tx(d.tx+u);else if(d.moving){var Y=d.lp.x+u,V=B._tabGap/2;B._7o.each(function(t){var G=t.endX,j=Y-t.startX<G-Y;Y>=t.startX&&G>=Y&&B._7Q({tab:O.tab,startX:O.startX+u,width:O.width,front:j,insertTab:t.tab,position:j?o(0,t.startX-V):X(B._64I,G+V)})})}}else if(u=Po(U).y-d.y,!d._25o&&!d.moving&&i(u)>2&&(B._41o()&&!Bl(U)?d._25o=1:O&&B.isMovable()&&(d.moving=1)),d._25o)B.ty(d.ty+u);else if(d.moving){var P=d.lp.y+u,V=B._tabGap/2;B._7o.each(function(W){var U=W.endY,i=P-W.startY<U-P;P>=W.startY&&U>=P&&B._7Q({tab:O.tab,startY:O.startY+u,height:O.height,front:i,insertTab:W.tab,position:i?o(0,W.startY-V):X(B._23Q,U+V)})})}},handleWindowMouseUp:function(z){this.handleWindowTouchEnd(z)},handleWindowTouchEnd:function(){var t=this,k=t.tv,H=k._tabPosition,C=k.getTabModel(),d=C._roots,T=t._73o;if(t.moving){var f=k._23o;if(f&&f.insertTab!==f.tab){var h=f.tab,A=d.remove(h),v=d.indexOf(f.insertTab);v>=0&&(f.front||v++,v<=d.size()&&(d.add(h,v),C._38I(h,A,v)))}k._7Q(I),delete t.moving}else if(!t._25o&&T){h=T.tab;var Q=t._74o;if(!Q||Q.tab===h)if(!h.isDisabled()&&cj(T._75o,t.lp)){var V=function(){var K=d.indexOf(h);C.remove(h),k.onTabClosed(h,K)};k.onTabClosing(h,V)&&V()}else h.isDisabled()||k._8o===h||C.sm().ss(h)}t._25o=t._73o=t._74o=H===Vh||H===dd?t.x=t.lp=t.tx=I:t.y=t.lp=t.ty=I}}),It.PropertyView=function(z){var j=this;j._view=Fd(1,j),j._canvas=On(j._view),Ul(j._view,j._79O=eg()),j._rows=new Gk,j._28o=new Gk,j._26o={},j._26Q={};var K=j._propertyModel=new Og,r=j.ivm;K.mm(r,j),K.md(r,j),K.mh(r,j),j.dm(z?z:new Og),new Pt(j)},Jt("PropertyView",T,{ms_ac:[Zc,Ar,pf,sq,Yl,"categorizable",rk,Ai,mm,Kh,Ld,Nr,Pk,vs,"selectRowIndex",Gr,"background",Fm,gc,im,xl,yf],ms_v:1,ms_dm:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,_45o:1,_47o:1,ms_tip:1,_29I:Mn,_59I:0,_9I:0,_selectRowIndex:-1,_editable:!0,_batchEditable:!0,_categorizable:!0,_indent:kn,_background:R.propertyViewBackground,_expandIcon:R.propertyViewExpandIcon,_collapseIcon:R.propertyViewCollapseIcon,_scrollBarColor:Dr,_scrollBarSize:lm,_autoHideScrollBar:fi,_selectBackground:R.propertyViewSelectBackground,_rowHeight:ee,_rowLineVisible:R.propertyViewRowLineVisible,_rowLineColor:R.propertyViewRowLineColor,_10I:.5,_columnLineVisible:R.propertyViewColumnLineVisible,_columnLineColor:R.propertyViewColumnLineColor,_labelColor:R.propertyViewLabelColor,_labelSelectColor:R.propertyViewLabelSelectColor,_labelFont:R.propertyViewLabelFont,getRows:function(){return this._rows},getColumnPosition:function(){return this._10I},setColumnPosition:function(O){0>O&&(O=0),O>1&&(O=1);var m=this,l=m._10I;m._10I=O,m.fp("columnPosition",l,O)},getPropertyName:function(K){return K.toLabel()},getLabelFont:function(){return this._labelFont},getLabelColor:function(p,Z,y){return y===this._selectRowIndex?this._labelSelectColor:this._labelColor},getPropertyFont:function(){return this._labelFont},getPropertyColor:function(h,Y){return Y===this._selectRowIndex?this._labelSelectColor:h.getColor()||this._labelColor},getCategoryFont:function(){return this._labelFont},getCategoryColor:function(){return this._labelColor},adjustTranslateX:function(){return 0},adjustTranslateY:function(v){var E=this.getHeight()-this._59I;return E>v&&(v=E),v>0?0:H(v)},isExpanded:function(k){if(!k)return!0;var T=this._26o[k];return T?T.isExpanded:!(this._26Q[k]===!1)},toggle:function(Z){var C=this;C.isExpanded(Z)?C.collapse(Z):C.expand(Z)},expandAll:function(){this.validate();for(var v in this._26o)this.expand(v)},expand:function(c){if(c&&c!==xj){var $=this,y=$._26o[c];y&&!y.isExpanded&&(y.isExpanded=!0,$.onExpanded(c),$.ivm())}},onExpanded:function(){},collapseAll:function(){this.validate();for(var y in this._26o)this.collapse(y)},collapse:function(L){if(L&&L!==xj){var p=this,S=p._26o[L];S&&S.isExpanded&&(S.isExpanded=!1,p.onCollapsed(L),p.ivm())}},onCollapsed:function(){},getCategoryName:function(g){if(!this.isCategorizable())return xj;var p=g.getCategoryName();return p?p:xj},getPropertyModel:function(){return this._propertyModel},handleSelectionChange:function(){this.ivm()},setDataModel:function(d){var f=this,V=f._dataModel;V!==d&&(V&&(V.umd(f.handlePropertyChange,f),f._selectionModel||V.sm().ums(f.handleSelectionChange,f)),f._dataModel=d,d.md(f.handlePropertyChange,f),f._selectionModel?f._selectionModel._21I(d):d.sm().ms(f.handleSelectionChange,f),f.fp(Bb,V,d))},isVisible:function(c){return this._visibleFunc?this._visibleFunc(c):!0},onPropertyChanged:function(F){var n=this,A=F.property;Dt[A]?n.ivm():n.iv(),A===Gp&&n._43o()},getCurrentData:function(){return this._27o},updateCurrentData:function(){this._27o=this.sm().ld()},getRawProperties:function(){return this._27o?this._propertyModel._roots:De},handlePropertyChange:function(N){this._27o===N.data&&this.iv()},ivm:function(){this.invalidateModel()},invalidateModel:function(){var O=this;O._96I||(O.setSelectRowIndex(-1),O._96I=1,O.iv())},redraw:function(){this.iv()},validateModel:function(){var i=this,K=i._rows,l=i._28o,V={},$=new Gk,m=i._27o;i.updateCurrentData(),m!==i._27o&&i.endEditing(),K.clear(),l.clear(),i.getRawProperties().each(function(t){if(i.isVisible(t)){$.add(t);var Q=i.getCategoryName(t);V[Q]||(l.add(Q,Q===xj?0:z),V[Q]={isExpanded:i.isExpanded(Q),properties:new Gk})}}),i._sortFunc&&$.sort(i._sortFunc);for(var p in i._26o)i._26Q[p]=i.isExpanded(p);i._26o=V,l.each(function(w){w!==xj&&K.add(w);var k=V[w];k.isExpanded&&$.each(function(c){i.getCategoryName(c)===w&&(k.properties.add(c),K.add({property:c,data:i._27o}))},i)})},validateImpl:function(){var l=this;l._76o(),l._96I&&(l.validateModel(),delete l._96I);var t=l._canvas,F=l.getWidth(),Y=l.getHeight(),G=-l.ty(),Z=l._rowHeight,m=l._indent,A=F-m,v=l._rows,p=v.size(),x=l._9I=m+A*l._10I,g=l._59I=p*Z;Jk(t,F,Y),l._29I={x:0,y:G,width:F,height:Y},l._31I=C(G/Z),l._14I=$((G+Y)/Z),l._31I<0&&(l._31I=0),l._14I>p&&(l._14I=p);var R,z=lc(t),o=l._background;sp(z,0,-G,1),z.beginPath(),z.rect(0,G,F,Y),z.clip(),z.clearRect(0,G,F,Y),l._93db(z),o&&gk(z,0,0,m,g,o);for(var K=l._31I;K<l._14I;K++){var V=v.get(K),G=Z*K;if(Fc(V))o&&gk(z,m,G,A,Z,o),R=Td(l.isExpanded(V)?l._expandIcon:l._collapseIcon),R&&_n(z,R,ws,0,G,m,Z),z.save(),z.beginPath(),z.rect(m,G,A,Z),z.clip(),l.drawCategoryName(z,V,K,m,G,A,Z),z.restore();else{var M=V.property,T=V.data,R=Td(M.getIcon()),X=l._selectRowIndex===K?l.getSelectBackground():I;if(R&&_n(z,R,ws,0,G,m,Z),X&&gk(z,m,G,A,Z,X),z.save(),z.beginPath(),z.rect(m,G,x-m,Z),z.clip(),l.drawPropertyName(z,M,K,m,G,x-m,Z),z.restore(),!l.isEditing(T,M)){var U=x+1,f=F-x-1;z.save(),z.beginPath(),z.rect(U,G,f,Z),z.clip(),l._87o(l.drawPropertyValue(z,M,l.getValue(T,M),K,U,G,f,Z,T),K,U,G,f,Z),z.restore()}}l._rowLineVisible&&gk(z,m,G+Z-1,A,1,l._rowLineColor)}l._columnLineVisible&&(gk(z,x,0,1,g,l._columnLineColor),gk(z,F-1,0,1,g)),l._92db(z),l._93I(),z.restore(),l.ty(l.ty())},drawCategoryName:function(f,W,i,T,Y,g,e){dg(f,W,this.getCategoryFont(W),this.getCategoryColor(W),T,Y,g,e)},drawPropertyName:function(Y,v,I,S,s,P,$){return v.drawPropertyName?(v.drawPropertyName(Y,v,I,S,s,P,$,this),void 0):(dg(Y,this.getPropertyName(v),this.getPropertyFont(v,I),this.getPropertyColor(v,I),S,s,P,$),void 0)},drawPropertyValue:function(R,$,m,M,f,o,T,D,u){return $.drawPropertyValue?$.drawPropertyValue(R,$,m,M,f,o,T,D,u,this):(Ft(R,m,$,this.getLabelFont($,m,M),this.getLabelColor($,m,M),f,o,T,D,u,this),void 0)},isPropertyEditable:function(u){return u.isEditable()&&this.isEditable()},setProperties:function(h){this._propertyModel.clear(),this.addProperties(h)},addProperties:function(y){if(y){var Q=this._propertyModel;y.forEach(function(i){if(!(i instanceof Mt)){var j=Lo(i.className);i=Ih(j?j:Mt,i)}Q.add(i)})}},getRowIndexAt:function(z){var w=this,L=C(w.lp(z).y/w._rowHeight);return L>=0&&L<w._rows.size()?L:-1},getPropertyAt:function($){var d=this,t=d.getRowIndexAt($);return t>=0?d._rows.get(t).property:I},getToolTip:function(w){var B=this,c=B.getPropertyAt(w),l=B._27o;return c&&l?c.getToolTip(l,B._9I<B.lp(w).x,B):I}});var Pt=function(x){this.pv=x,this.addListeners()};Lp(Pt,T,{ms_listener:1,getView:function(){return this.pv._view},setCursor:function(K){this.getView().style.cursor=K},clear:function(){var Z=this;Z._62O=Z.cp=Z.ty=Z.p=I,Z.setCursor(Oc)},handle_mousedown:function(n){this.handle_touchstart(n)},handle_touchstart:function(K){var a=this,j=a.pv;cl(K),j.setFocus(K)&&(fb(K)?(a.cp=Po(K),a.ty=j.ty(),a.p=j.getColumnPosition(),a.handle_touchmove(K)):j.setSelectRowIndex(j.getRowIndexAt(K)))},handleWindowMouseUp:function(){this.clear()},handleWindowTouchEnd:function(){this.clear()},handle_mouseup:function(Z){this.handle_touchend(Z)},handle_touchend:function(P){var G=this;if(G.cp&&!G._62O){var q=G.pv,O=q.lp(P),R=O.x,H=O.y,w=q._indent,B=q.getRowIndexAt(P),N=q._9I;if(B>=0){var y=q._rowHeight,W=y*B,M=q._rows.get(B),g=M.property;if(Fc(M))Td(q.isExpanded(M)?q._expandIcon:q._collapseIcon)&&R>=0&&w>=R&&H>=W&&W+y>=H?q.toggle(M):Fe(P)&&q.toggle(M);else if(R>N&&q.isPropertyEditable(g,P)){var m={x:N+1,y:W,width:q.getWidth()-N-1,height:y},C={x:m.x+q.tx(),y:m.y+q.ty(),width:m.width,height:m.height},n=0,c=q._29I;m.y<c.y?n=m.y-c.y:m.y+y>c.y+c.height&&(n=m.y+y-c.y-c.height),n&&(q.ty(q.ty()-n),C.y-=n),q.beginEditing({data:M.data,property:g,value:q.getValue(M.data,g),event:P,rect:m,editorRect:C,view:q})}}q.setSelectRowIndex(B)}G.clear()},handleWindowMouseMove:function(g){this.handleWindowTouchMove(g)},handleWindowTouchMove:function(q){var g=this,S=g.pv,s=g.ty,E=g.cp,X=Po(q),K=g._62O;if("p"===K)S.setTranslateY(s+X.y-E.y);else if("c"===K){var u=S.getWidth()-S._indent;if(u>16){var H=g.p-(E.x-X.x)/u,W=16/u;W>H&&(H=W),H>1-W&&(H=1-W),S.setColumnPosition(H)}}else"s"===K&&S.setTranslateY(s+(E.y-X.y)*S._59I/S._29I.height)},handle_mousemove:function(V){this.handle_touchmove(V)},handle_touchmove:function(S){if(!_l&&fb(S)){var t=this,P=t.pv,n=i(P.lp(S).x-P._9I)<=(gj?8:3);t.cp?t._62O||(n?(t._62O="c",ii(t,S)):i(Po(S).y-t.cp.y)>=2&&(t._62O=t.isV(S)?"s":"p",ii(t,S))):(n?t.setCursor(ub):t.setCursor(Oc),t.isV(S)&&P._43o())}},isV:function(y){var H=this.pv,J=H._29I;return H._41o()&&J.x+J.width-H.lp(y).x<Ud},handle_mousewheel:function(V){this.handleScroll(V,V.wheelDelta/40)},handle_DOMMouseScroll:function(h){2===h.axis&&this.handleScroll(h,-h.detail)},handleScroll:function(i,w){var t=this.pv;cl(i),t.endEditing(),t.translate(0,w*t.getRowHeight())},handle_keydown:function(N){var P=this.pv,h=P._rows.size(),$=P._selectRowIndex+(Kc(N)?-1:1);(Kc(N)||Yb(N))&&(0>$&&($=0),$>=h&&($=h-1),P.setSelectRowIndex($))}}),It.ListView=function(s){this._5o(s),new Qt(this)},Jt("ListView",T,{ms_ac:[Zc,Ar,pf,Fm,rk,gc,im,Ai,mm,Nr,Pk,vs,Il,Gr],ms_v:1,ms_bnb:1,ms_tip:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,_14Q:1,ms_dm:1,_45o:1,_checkMode:!1,_indent:kn,_rowHeight:ee,_rowLineVisible:R.listViewRowLineVisible,_rowLineColor:R.listViewRowLineColor,_scrollBarColor:Dr,_scrollBarSize:lm,_autoMakeVisible:Fp,_autoHideScrollBar:fi,_selectBackground:R.listViewSelectBackground,_labelColor:R.listViewLabelColor,_labelSelectColor:R.listViewLabelSelectColor,_labelFont:R.listViewLabelFont,isCheckMode:function(){return this._checkMode},setCheckMode:function(G){var m=this,k=m._checkMode;m._checkMode=G,m.fp(rr,k,G)},drawRow:function(p,A,t,w,f,e,k){var v=this,G=0,T=v._indent,x=v.getIconWidth(A);v.drawRowBackground(p,A,t,w,f,e,k),v._checkMode&&(Vd(p,Td(v.getCheckIcon(A)),G+T/2,f+k/2,A,v),G+=T),v.drawIcon(p,A,G,f,x,k),v.drawLabel(p,A,G+x,f,k)}});var Qt=function(P){this.list=P,this.addListeners()};Lp(Qt,T,{ms_listener:1,getView:function(){return this.list._view},clear:function(s){var $=this,R=$.list;s&&"d"===$._62O&&!$.dragCancel&&R.handleDragAndDrop(s,"end"),R.draggingData&&(R.draggingData=null,R.redraw()),$.dragCancel=$._62O=$._isV=$._isH=$.cp=$.tx=$.ty=I},handle_mousedown:function(G){this.handle_touchstart(G)},handle_touchstart:function(L){var p=this,E=p.list;if(cl(L),E.setFocus(L)){var $=E.getDataAt(L);p.cp=Po(L),p.tx=E.tx(),p.ty=E.ty(),fb(L)?$&&E.handleDragAndDrop&&!p.isV(L)&&!p.isH(L)&&E.isDraggable($)&&(E.draggingData=$,E.redraw(),E.handleDragAndDrop(L,"prepare")):($?p._33o(L,$):this._cancelDataDoubleSelect(),p.clear(L))}},handleWindowMouseUp:function(E){this.clear(E)},handleWindowTouchEnd:function(w){this.clear(w)},handle_mouseup:function(F){this.handle_touchend(F)},handle_touchend:function(C){var N=this,$=N.list;if(!N._isV&&!N._isH&&N.cp&&!N._62O){var m=$.getDataAt(C);m?($.isCheckMode()?N._34o(C,m):N._33o(C,m),Fe(C)?$.onDataDoubleClicked(m,C):$.onDataClicked(m,C)):(N._cancelDataDoubleSelect(),$.handleBackgroundClick(C))}N.clear(C)},handleWindowMouseMove:function(q){this.handleWindowTouchMove(q)},handleWindowTouchMove:function(e){var p=this,b=p.list,r=p._62O,I=p.tx,G=p.ty,$=p.cp,k=Po(e),j=b._29I;"p"===r?b.setTranslate(I+k.x-$.x,G+k.y-$.y):"v"===r?b.ty(G+($.y-k.y)*b._59I/j.height):"h"===r?b.tx(I+($.x-k.x)*b._91I/j.width):"d"===r&&(p.dragCancel||b.handleDragAndDrop(e,"between"))},handle_mousemove:function(u){this.handle_touchmove(u)},handle_touchmove:function(i){if(!_l&&fb(i)){var b=this,h=b.list;if(b._isV=b.isV(i),b._isH=b.isH(i),b.cp){if(!b._62O){if(Jc(Po(i),b.cp)<2)return;b._isV?b._62O="v":b._isH?b._62O="h":h.draggingData&&!this.dragCancel?(b._62O="d",h.handleDragAndDrop(i,"begin")):b._62O="p",b._62O&&"d"!==b._62O&&h.draggingData&&(h.draggingData=null,h.redraw()),ii(b,i)}}else b._isV&&h._43o(),b._isH&&h._42o()}},isV:function(t){var $=this.list,B=$._29I;return $._41o()&&B.x+B.width-$.lp(t).x<Ud},isH:function(I){var F=this.list,Y=F._29I;return F._40o()&&Y.y+Y.height-F.lp(I).y<Ud},handle_mousewheel:function(W){this.handleScroll(W,W.wheelDelta/40,W.wheelDelta!==W.wheelDeltaX)},handle_DOMMouseScroll:function(H){this.handleScroll(H,-H.detail,1)},handleScroll:function(S,Q,E){var y=this.list;cl(S),y.endEditing&&y.endEditing(),E&&y._41o()?y.translate(0,Q*y.getRowHeight()):y._40o()&&y.translate(10*Q,0)},handle_keydown:function(v){if(!R.isInput(v.target)){var C,X=this.list,S=X.sm(),c=X._rows,z=c.size();if(bm(v))X.selectAll();else if(Zr(v))X.handleDelete&&X.handleDelete(v);else if(Nn(v))"d"!==this._62O||this.dragCancel||(X.handleDragAndDrop(v,"cancel"),this.dragCancel=!0);else if(tl(v))X.isCheckMode()&&(C=X.getFocusData(),C&&X.checkData(C));else if(Kc(v)||Yb(v)){var Q=X.isCheckMode();if(C=Q?X.getFocusData():S.ld()){var k=X.getRowIndex(C);k>=0&&(Kc(v)?0!==k&&(C=c.get(k-1),Q?X.setFocusData(C):S.ss(C)):k!==z-1&&(C=c.get(k+1),Q?X.setFocusData(C):S.ss(C)))}else z>0&&(C=c.get(0),Q?X.setFocusData(C):S.ss(C))}}},_34o:function(m,F){var P=this.list,Y=P.lp(m).x;return Y>=0&&Y<=P._indent?(P.checkData(F),void 0):(P.setFocusData(F),void 0)},_33o:function(T,J){var w=this.list,S=w.sm(),P=S.ld();if(!w.canHandleSelectMode(T,J))return this._cancelDataDoubleSelect(),void 0;if(Bl(T))w.isSelected(J)?S.rs(J):S.as(J);else if(Ac(T))if(P)for(var N=w.getRowIndex(P),q=w.getRowIndex(J);N!==q;)N+=q>N?1:-1,S.as(w._rows.get(N));else S.ss(J);else fb(T)?(S.contains(J)?w.handleDataDoubleSelect&&(this._handleDataDoubleSelect(T,J),Fe(T)&&this._cancelDataDoubleSelect()):this._cancelDataDoubleSelect(),S.ss(J)):S.contains(J)||S.ss(J)},_handleDataDoubleSelect:function(E,D){this._cancelDataDoubleSelect(),this._doubleSelectTimer=hl(function(){this.list.handleDataDoubleSelect(E,D),this._doubleSelectTimer=z}.bind(this),R.doubleClickSpeed)},_cancelDataDoubleSelect:function(){this._doubleSelectTimer&&(xq(this._doubleSelectTimer),this._doubleSelectTimer=z)}}),It.TreeView=function(i){var K=this;K._35o(),K._5o(i),new Rt(K)},Jt("TreeView",T,{ms_ac:[Zc,Ar,pf,"rootVisible",rr,"rootData",Ai,mm,Nr,Pk,vs,rk,Fm,gc,im,Kh,Ld,Il,Gr,"loader","doubleClickToToggle"],ms_v:1,ms_bnb:1,ms_tip:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,_48o:1,_14Q:1,_45o:1,_checkMode:I,_indent:kn,_rowHeight:ee,_rowLineVisible:R.treeViewRowLineVisible,_rowLineColor:R.treeViewRowLineColor,_scrollBarColor:Dr,_scrollBarSize:lm,_autoHideScrollBar:fi,_expandIcon:R.treeViewExpandIcon,_collapseIcon:R.treeViewCollapseIcon,_autoMakeVisible:Fp,_selectBackground:R.treeViewSelectBackground,_labelColor:R.treeViewLabelColor,_labelSelectColor:R.treeViewLabelSelectColor,_labelFont:R.treeViewLabelFont,_doubleClickToToggle:R.treeViewDoubleClickToToggle,drawRow:function(l,E,$,q,e,r,c){var N=this;N.drawRowBackground(l,E,$,q,e,r,c),N.drawTree(l,E,$,0,e,r,c)},isOnToggleIcon:function(Q){var H=this.getDataAt(Q);if(H){var S=this.getIndent(),e=this.lp(Q).x;if(Td(this.getToggleIcon(H))){var w=S*this.getLevel(H);if(e>=w&&w+S>=e)return!0}}return!1}});var Rt=function(D){yd(Rt,this,[D])};Lp(Rt,Qt,{toggle:function(j,b,R,T){var l=this.list,W=l.lp(j).x;if(Td(l.getToggleIcon(b))){var D=R*T;if(W>=D&&D+R>=W)return l.toggle(b),!0}return l.isDoubleClickToToggle()&&Fe(j)?(l.toggle(b),!0):!1},_34o:function(L,I){var E=this.list,s=E.lp(L).x,G=E._levelMap[I._id],b=E._indent,c=b*(G+1);return s>=c&&c+b>=s?(E.checkData(I),void 0):(this.toggle(L,I,b,G)||E.setFocusData(I),void 0)},_33o:function(z,y){var W=this,O=W.list;if(!W.toggle(z,y,O._indent,O.getLevel(y)))if(Ac(z)){var r=O.sm();if(r.size()>0){for(var s=O._rows,L=null,X=0,N=s.size();N>X;X++)if(O.isSelected(s.get(X))){L=X;break}for(var H=null,X=s.size()-1;X>=0;X--)if(O.isSelected(s.get(X))){H=X;break}var Z,d,e=O.getRowIndex(y);for(L>e?(Z=e-1,d=L):e>H?(Z=H,d=e):(Z=L,d=H);Z!==d;)Z++,r.as(O._rows.get(Z))}else r.ss(y)}else Rt.superClass._33o.call(W,z,y)},handle_keydown:function(j){if(so(j)||lf(j)){var P=this.list,w=P._rows,y=P.isCheckMode(),v=P.sm(),b=y?P.getFocusData():v.ld();b?b.hasChildren()&&(so(j)?P.collapse(b):P.expand(b)):w.size()>0&&(b=w.get(0),y?P.setFocusData(b):v.ss(b))}else Rt.superClass.handle_keydown.call(this,j)}});var St=It.TableView=function(x){this._98I(),this._5o(x),new Tt(this)};Jt("TableView",T,{ms_ac:[Zc,Ar,pf,"sortMode",sq,Yl,Fm,gc,im,xl,yf,"sortColumn",Ai,mm,Nr,Pk,vs,Il,Gr],ms_v:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,ms_tip:1,_50o:1,_45o:1,_47o:1,_sortMode:Ed,_editable:!0,_batchEditable:!1,_rowHeight:ee,_rowLineVisible:R.tableViewRowLineVisible,_rowLineColor:R.tableViewRowLineColor,_columnLineVisible:R.tableViewColumnLineVisible,_columnLineColor:R.tableViewColumnLineColor,_scrollBarColor:Dr,_scrollBarSize:lm,_autoHideScrollBar:fi,_autoMakeVisible:Fp,_selectBackground:R.tableViewSelectBackground,_labelColor:R.tableViewLabelColor,_labelSelectColor:R.tableViewLabelSelectColor,_labelFont:R.tableViewLabelFont,getCheckColumn:function(){var c=this;if(!c._31o){var p=c._31o=new Lt;p.setEditable(!0),p.setWidth(40),p.getValue=c.getCheckColumValue,p.drawCell=c.drawCheckColumnCell}return c._31o},isCheckMode:function(){return this._39o.contains(this._31o)},setCheckMode:function(t){var q=this,p=q._39o,w=q.getCheckColumn();t!==q.isCheckMode()&&(t?p.add(w,0):p.remove(w),q.fp(rr,!t,t))},getCheckColumValue:function(o,X,r){return r.isSelected(o)},drawCheckColumnCell:function(p,H,$,U,n,R,e,D,r){Vd(p,r.getCheckIcon(H),n+e/2,R+D/2,H,r)}});var Tt=function(U){yd(Tt,this,[U])};Lp(Tt,Qt,{_34o:function(w,d){var _=this.list,O=_._31o;if(_.isCellEditable(d,O,w)){var F=_._3Q(O),J=_.lp(w).x;if(F&&J>=F.startX&&J<F.startX+O.getWidth())return _.checkData(d),void 0}_._37O(d,w),_.setFocusData(d)},_33o:function(n,W){this.list._37O(W,n),Tt.superClass._33o.apply(this,arguments)}});var Ut=It.TreeTableView=function(N){var H=this,b=H._4o=new Lt;H._35o(),H._98I(),H._5o(N),b.setDisplayName("Name"),b.setEditable(!0),b.setWidth(180),b.drawCell=Vt,b.getValue=Wt,H._39o.add(b),new Xt(H)},Vt=function($,U,l,p,L,G,m,V,R){R.drawTree($,U,l,L,G,m,V)},Wt=function(v,Y,f){return f.getLabel(v)};Jt("TreeTableView",T,{ms_ac:[Zc,Ar,pf,"sortMode",sq,Yl,rk,rr,"rootData","rootVisible",Ai,mm,"sortColumn",Kh,Ld,Nr,Pk,vs,Il,im,Fm,gc,xl,yf,Gr,"loader"],ms_v:1,ms_bnb:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,ms_tip:1,_50o:1,_48o:1,_14Q:1,_45o:1,_47o:1,_sortMode:Ed,_checkMode:I,_editable:!0,_batchEditable:!1,_indent:kn,_rowHeight:ee,_rowLineVisible:R.treeTableViewRowLineVisible,_rowLineColor:R.treeTableViewRowLineColor,_columnLineVisible:R.treeTableViewColumnLineVisible,_columnLineColor:R.treeTableViewColumnLineColor,_expandIcon:R.treeTableViewExpandIcon,_collapseIcon:R.treeTableViewCollapseIcon,_scrollBarColor:Dr,_scrollBarSize:lm,_autoHideScrollBar:fi,_autoMakeVisible:Fp,_selectBackground:R.treeTableViewSelectBackground,_labelColor:R.treeTableViewLabelColor,_labelSelectColor:R.treeTableViewLabelSelectColor,_labelFont:R.treeTableViewLabelFont,getTreeColumn:function(){return this._4o}});var Xt=function(g){yd(Xt,this,[g])};Lp(Xt,Qt,{_34o:function(P,u){var G=this.list,H=G._4o,x=G._3Q(H),s=G.lp(P).x;if(x){var h=G._indent,$=x.startX+h*G.getLevel(u);if(Td(G.getToggleIcon(u))&&s>=$&&$+h>=s)return G.toggle(u),void 0;if(G.isCellEditable(u,H)&&($+=h,s>=$&&$+h>=s))return G.checkData(u),void 0}G._37O(u,P),G.setFocusData(u)},_33o:function(L,P){var J=this.list,E=J.lp(L).x;if(Td(J.getToggleIcon(P))){var m=J._3Q(J._4o);if(m){var Y=J._indent,v=m.startX+Y*J.getLevel(P);if(E>=v&&v+Y>=E)return J.toggle(P),void 0}}J._37O(P,L),Xt.superClass._33o.apply(this,arguments)}});var Yt=It.TableHeader=function(Y){var v=this,P=v._view=Fd(1,v),p=v._39o=Y.getColumnModel(),S=v.iv;v.tv=v._tableView=Y,v._60I=new Gk,v._canvas=On(P),P.style.background=R.tableHeaderBackground||"",P.style.height=Ri+Mq,p.mm(S,v),p.md(S,v),p.mh(S,v),Y.mp(function(B){zt[B.property]&&v.iv()},v),new Zt(v),v.iv()};Jt("TableHeader",T,{ms_v:1,ms_lp:1,ms_fire:1,ms_ac:["checkIcon","sortDescIcon","sortAscIcon",Zc,pf,rk,"moveBackground","insertColor",xl,yf,"resizable","movable"],_checkIcon:Wc,_movable:!0,_resizable:!0,_labelColor:R.tableHeaderLabelColor,_labelFont:R.tableHeaderLabelFont,_columnLineColor:R.tableHeaderColumnLineColor,_columnLineVisible:R.tableHeaderColumnLineVisible,_sortDescIcon:R.tableHeaderSortDescIcon,_sortAscIcon:R.tableHeaderSortAscIcon,_moveBackground:R.tableHeaderMoveBackground,_insertColor:R.tableHeaderInsertColor,_indent:kn,getCheckIcon:function(){return this._checkIcon},getTableView:function(){return this.tv},getLabel:function(X){return X.toLabel()},getLabelFont:function(){return this._labelFont},getLabelColor:function(I){return I.getColor()||this._labelColor},getLabelAlign:function(_){return _._align},onPropertyChanged:function(){this.iv()},_5Q:function(e){this._61I=e,this.iv()},getLogicalPoint:function(o){return Lf(o,this._canvas,this.tv.tx())},validateImpl:function(){var p=this,O=p._canvas,d=p.getWidth(),z=p.getHeight(),F=p.tv,N=p._60I,v=p._61I,g=-F.tx(),T=0;(d!==O.clientWidth||z!==O.clientHeight)&&Jk(O,d,z),N.clear(),p._39o._roots.each(function(R){if(R.isVisible()){var Z=T+R.getWidth();g+d>=T&&Z>=g&&N.add({column:R,startX:T}),T=Z}});var i=lc(O);if(sp(i,-g,0,1),i.beginPath(),i.rect(g,0,d,z),i.clip(),i.clearRect(g,0,d,z),N.each(function(x){var o=x.column,t=x.startX,A=o.getWidth();A>0&&(i.save(),i.beginPath(),i.rect(t,0,A,z),i.clip(),v&&v.column===o||p.drawColumn(i,o,t,0,A,z),p._columnLineVisible&&gk(i,t+A-1,0,1,z,p._columnLineColor),i.restore())}),v){var o=v.column,T=v.startX,u=v.position,t=o.getWidth();i.save(),i.beginPath(),i.rect(T,0,t,z),i.clip(),i.fillStyle=p._moveBackground,i.fill(),p.drawColumn(i,o,T,0,t,z),i.restore(),Hq(i,p._insertColor,u,0,z)}i.restore()},_6Q:function(Z){var S=this.tv;return S._31o===Z&&S.sm().getSelectionMode()===He},drawColumn:function(m,X,n,l,$,P){var _=this,s=_.tv,T=Td(X.getIcon()),e=_.getLabelAlign(X);if(_._6Q(X)){var w=Td(_._checkIcon);Vd(m,w,n+$/2,l+P/2,X,_)}else{var G=_.getLabel(X),k=_.getLabelFont(X),q=_.getLabelColor(X),I=Pb(k,G).width,E=T?_._indent:0;e===xi?(T&&_n(m,T,ws,n,l,E,P),dg(m,G,k,q,n+E,l,$,P,xi)):e===Dd?(T&&_n(m,T,ws,n+$-I-E,l,E,P),dg(m,G,k,q,n,l,$,P,Dd)):(T&&_n(m,T,ws,n+($-I-E)/2,l,E,P),dg(m,G,k,q,n+($-I+E)/2,l,0,P,xi))}if(X.isSortable()&&s.getSortColumn()===X&&(T=Td(X.getSortOrder()===en?_._sortAscIcon:_._sortDescIcon))){var L=nr(T,X)/2+2;Vd(m,T,e===Dd?n+L:n+$-L,l+P/2,X,s)}}});var Zt=function(C){var W=this;W.th=C,W.tv=C._tableView,W.addListeners()};Lp(Zt,T,{ms_listener:1,getView:function(){return this.th.getView()},setCursor:function(l){this.getView().style.cursor=l},handle_mousemove:function(I){if(!_l){var u=this;delete u._29o,u.setCursor(Oc);for(var v=u.th,R=v._60I,q=v.lp(I).x,g=R.size()-1;g>=0;g--){var X=R.get(g),K=X.column,s=X.startX+K.getWidth();if(v.isResizable()&&i(s-q)<=(gj?10:3))return u._29o=X,u.setCursor(ub),void 0;q>X.startX&&s>q&&(u._29o=X),(K.isClickable()||K.isSortable()||v.isMovable()||u.tv.getCheckColumn&&K===u.tv.getCheckColumn())&&q>X.startX&&s>q&&u.setCursor(Tr)}}},handle_mousedown:function(Q){this.handle_touchstart(Q)},handle_touchstart:function(g){var M=this;cl(g),M.tv.endEditing(),M.handle_mousemove(g),M._29o&&(M.x=Po(g).x,M.lx=M.th.lp(g).x,M.w=M._29o.column.getWidth(),ii(M,g))},handleWindowMouseMove:function(e){this.handleWindowTouchMove(e)},handleWindowTouchMove:function(I){var M=this,r=M.th,f=M.getView().style.cursor,B=M._29o,U=Po(I).x-M.x;if(M.resizing||M.moving||(f===ub?M.resizing=1:r.isMovable()&&f===Tr&&i(U)>2&&(M.moving=1)),M.resizing)B.column.setWidth(M.w+U);else if(M.moving){var J=M.lx+U;r._60I.each(function(S){var q=S.startX,H=q+S.column.getWidth();if(J>=q&&H>=J){var Q={column:B.column,startX:B.startX+U,front:H-J>J-q,insertColumn:S.column};Q.position=Q.front?q:H,r._5Q(Q)
}})}},_16Q:function(Z,e){var o=this,U=o.tv,A=o.th,g=A._checkIcon;if(A._6Q(Z)){var S=Td(g),c=o.lx,F=Z.getWidth(),m=nr(S,Z);if(c>=e+F/2-m&&e+F/2+m>=c){A.setCheckIcon(g===oo?Wc:oo);var W=U.sm(),N=U._rows;return g===oo?W.rs(N):W.ss(N),U.onCheckColumnClicked(Z),!0}}return!1},handleWindowMouseUp:function(o){this.handleWindowTouchEnd(o)},handleWindowTouchEnd:function(r){var G=this,Q=G.tv,F=G.th,j=G._29o;if(G.moving){var H=F._61I;if(H&&H.insertColumn!==H.column){var Y=H.column,O=Q.getColumnModel()._roots,T=O.remove(Y),e=O.indexOf(H.insertColumn);e>=0&&(H.front||e++,e<=O.size()&&(O.add(Y,e),Q.getColumnModel()._38I(Y,T,e)))}F._5Q(I),delete G.moving}else if(!G.resizing&&j){Y=j.column;var k=F.lp(r).x,$=j.startX,o=!0;if(F.onColumnClicked){var D=F.onColumnClicked(Y,r,$);D===!1&&(o=!1)}if(o&&k>=$&&k<=$+Y.getWidth()&&!G._16Q(Y,$)){if(Y.isSortable()){var y=Q.getSortMode(),L=Y.getSortOrder();y===Ed?Q.getSortColumn()===Y?(L===wd&&Q.setSortColumn(I),Y.setSortOrder(L===en?wd:en)):Q.setSortColumn(Y):"bistate"===y&&(Q.getSortColumn()===Y?Y.setSortOrder(L===en?wd:en):Q.setSortColumn(Y))}Q.onColumnClicked(Y,r,$)}}G._29o=G.resizing=G.x=G.lx=G.w=I}}),It.TablePane=function(X){this.init(new St(X))},Jt("TablePane",T,{ms_v:1,_44o:1}),It.TreeTablePane=function(C){this.init(new Ut(C))},Jt("TreeTablePane",T,{ms_v:1,_44o:1}),It.Toolbar=function(G){var F=this,m=F._view=Fd(1,F),S=m.style;S.background=R.toolbarBackground||"",S.height=wb+Mq,F._canvas=On(m),F._30o=new Gk,F._90I=new Gk,F.setItems(G||[]),m.handleGroupSelectedChanged=function(U){if(U.isSelected()){var p=U.getGroupId();null!=p&&F._items.forEach(function(S){var t=S.element;t&&t!==U&&t.setSelected&&t.getGroupId&&t.getGroupId()===p&&t.setSelected(!1)})}},new $t(F)},Jt("Toolbar",T,{ms_v:1,ms_fire:1,ms_tx:1,ms_lp:1,ms_tip:1,ms_value:1,ms_ac:[Pf,Zc,pf,Ar,Gr,"itemGap","separatorColor","currentItem","stickToRight"],_labelColor:R.toolbarLabelColor,_labelSelectColor:R.toolbarLabelSelectColor,_labelFont:R.toolbarLabelFont,_selectBackground:R.toolbarSelectBackground,_itemGap:R.toolbarItemGap,_separatorColor:R.toolbarSeparatorColor,_stickToRight:!1,getSumWidth:function(){return this._64I},getToolTip:function(w){var N=this.getItemInfoAt(w);return N?N.item.toolTip:I},getLabelColor:function(s){return s&&s.selected&&s.type!==oo&&s.type!==Tq?this._labelSelectColor:this._labelColor},onPropertyChanged:function(E){this.iv(),E.property===Pf&&this._items.forEach(function(e){ym(e)})},redraw:function(){this.iv()},addItem:function(r,M){var Y=this._items;M==I?Y.push(r):Y.splice(M,0,r),this.fp(Pf,I,Y)},removeItem:function(k){if(k)for(var U=this._items,V=0;V<U.length;V++)k===U[V]&&(U.splice(V,1),this.fp(Pf,I,U))},removeItemById:function(s){if(s!=I)for(var K=this._items,j=0;j<K.length;j++)if(s===K[j].id){var T=K.splice(j,1)[0];return this.fp(Pf,I,K),T}},getItemById:function(Q){if(Q!=I)for(var p=this._items,_=0;_<p.length;_++){var Z=p[_];if(Q===Z.id)return Z}},setItemVisible:function(y,J){var u=this.getItemById(y);u&&(u.visible=J)},getItemInfos:function(){return this._30o},getItemInfoAt:function(v){var G=this,j=0,Z=G._30o,x=G.lp(v),S=x.x,E=x.y;if(E>=0&&E<=G.getHeight())for(;j<Z.size();j++){var $=Z.get(j);if($.startX<=S&&S<=$.endX)return $}return I},drawItem:function($,D,x,z,I){if(D.visible===!1)return 0;if(Hn(D.visible)&&!D.visible())return 0;var g=this,Q=D.disabled;Q&&($.globalAlpha=Db);var f=g.drawItemImpl($,D,x,z,I),A=g._itemGap;return Q&&($.globalAlpha=1),this._currentItem!==D||"separator"===D||D.separator===!0||D.unfocusable||jn($,g._separatorColor,x-A/2,0,f+A,z),f},drawItemImpl:function(w,N,R,H,k){var Q=this,r=Q._view,J=Q._itemGap,z=H/2,S=N.type,g=N.element,C=N.label;Fc(g)&&(C=g,g=I);var L,X=Q.getLabelFont(N),$=Q.getLabelColor(N),G=N.selected,U=Td(N.icon),b=nr(U,N),j=0,x=b+(C?Pb(X,C).width:0);if("separator"===N||N.separator===!0)return Hq(w,Q._separatorColor,R,H/4,z),1;if(g){U&&Vd(w,U,R+b/2,z,N,Q),dg(w,C,X,$,R+b,0,0,H);var p=ue(g);k||Q._90I.add(p),p.parentNode!==r&&Ul(r,p),g.iv&&g.iv(),g.validate&&g.validate();var o=p.getBoundingClientRect(),c=o.width,l=p.style;return al(p),l.left=Q.tx()+R+x+Mq,l.top=(H-o.height)/2+Mq,x+c}return S===Tq?L=Td(G?mf:ik):S===oo&&(L=Td(G?oo:Wc)),L?(j=nr(L,N),Vd(w,L,R+j/2,z,N,Q),R+=j,x+=j):G&&gk(w,R-J/2,0,x+J,H,Q.getSelectBackground(N)),U&&Vd(w,U,R+b/2,z,N,Q),dg(w,C,X,$,R+b,0,0,H),x},validateImpl:function(){var W=this,R=W._canvas,E=W.getWidth(),N=W.getHeight(),P=W._30o,p=W._items;Jk(R,E,N);var g=lc(R),d=W._itemGap,C=d/2;sp(g,W.tx(),0,1),g.clearRect(0,0,E,N);var O=W._90I;W._90I=new Gk,P.clear(),p.forEach(function(K){var j=W.drawItem(g,K,C,N);P.add({item:K,startX:C,endX:C+j,width:j}),j&&(C+=j+d)}),O.each(function(k){W._90I.contains(k)||Pp(k)});var X=W._64I;W._64I=o(0,C-d/2),g.restore(),W._stickToRight?(W._65O=0,g=lc(R),C=E-W._64I+d/2,sp(g,0,0,1),g.clearRect(0,0,E,N),P.clear(),p.forEach(function(n){var h=W.drawItem(g,n,C,N,!0);P.add({item:n,startX:C,endX:C+h,width:h}),h&&(C+=h+d)}),g.restore()):W.tx(W.tx()),X!==W._64I&&W.onSumWidthChanged(X,W._64I)},onSumWidthChanged:function(){},handleClick:function(i,J){var Z=this,d=i.type,Y=i.action,w=i.groupId,l=i.selected;i.disabled||(w!=I?l||(i.selected=!0,this._items.forEach(function(G){G.groupId===w&&i!==G&&(G.selected=!1)}),Y&&i.action(i,Z,J)):d===oo||"toggle"===d?(i.selected=!l,Y&&i.action(i,Z,J)):Y&&i.action(i,Z,J)),xf(),Z.iv()}});var $t=function(a){this.tb=a,this.addListeners()};Lp($t,T,{ms_listener:1,getView:function(){return this.tb._view},handle_mousewheel:function(m){this.handleScroll(m,10*(m.wheelDelta/40))},handle_DOMMouseScroll:function(R){this.handleScroll(R,10*-R.detail)},handleScroll:function(Z,X){cl(Z);var g=this.tb;g.isScrollable()&&!g._stickToRight&&(g.tx(g.tx()+X),gf())},handle_mousemove:function(i){var w=this;_l||w.setItem(i)},handle_mouseout:function(t){var X=this;t.target===X.getView()?X.tb.setCurrentItem(I):X.handle_mousemove(t)},handle_mousedown:function(z){this.handle_mousemove(z),this.handle_touchstart(z)},handle_touchstart:function(t){var I=this,F=I.tb,x=t.target;fb(t)&&(x===I.getView()||x===F._canvas)&&(cl(t),F.setFocus(t)&&(this.setItem(t,!0),(F.isScrollable()||I.info&&!I.info.item.disabled)&&(I.x=Po(t).x,I.tx=F.tx(),ii(I,t))))},handleWindowMouseMove:function(H){this.handleWindowTouchMove(H)},handleWindowTouchMove:function(C){var x=this,j=x.tb;if(!j._stickToRight){var S=Po(C).x-x.x;!x._25o&&i(S)>2&&j.isScrollable()&&(x._25o=1),x._25o&&j.tx(x.tx+S)}},handleWindowMouseUp:function(a){this.handleWindowTouchEnd(a)},handleWindowTouchEnd:function(R){var r=this,l=r.tb,O=r.info,J=r.tb.getItemInfoAt(R);if(!r._25o&&O){var g=O.item;J&&J.item===g&&l.handleClick(g,R)}r._25o=r.x=r.tx=I,r.setItem()},setItem:function(q,g){var i=this,H=i.tb,T=i.info=q?H.getItemInfoAt(q):I,J=T?T.item:I;H.setCurrentItem(J),g&&J&&Hn(J.onDown)&&J.onDown(q)}}),It.BorderPane=function(){this._view=Fd(1,this),this.iv()},Jt("BorderPane",T,{ms_v:1,ms_ac:["topHeight","bottomHeight","leftWidth","rightWidth"],ms_fire:1,getLeftView:function(){return this._leftView},setLeftView:function(p,E){this._12o("leftView",p),E!=I&&this.setLeftWidth(E)},getRightView:function(){return this._rightView},setRightView:function(n,u){this._12o("rightView",n),u!=I&&this.setRightWidth(u)},getTopView:function(){return this._topView},setTopView:function(d,u){this._12o("topView",d),u!=I&&this.setTopHeight(u)},getBottomView:function(){return this._bottomView},setBottomView:function(C,i){this._12o("bottomView",C),i!=I&&this.setBottomHeight(i)},getCenterView:function(){return this._centerView},setCenterView:function(f){this._12o("centerView",f)},_12o:function(i,c){var j=this,S="_"+i,U=j._view,$=j[S];$!==c&&($&&($.getView?Pp($.getView()):Pp($)),j[S]=c,c&&(c.getView?Ul(U,c.getView(),1):Ul(U,c,1)),j.fp(i,$,c))},onPropertyChanged:function(){this.iv()},validateImpl:function(){var Q=this,D=Q._topView,d=Q._bottomView,$=Q._leftView,N=Q._rightView,i=Q._centerView,K=Q.getWidth(),L=Q.getHeight(),Z=0,T=0,B=K,R=L,H=0,P=0,G=0,S=0;D&&(H=Q._topHeight==I?el(D):Q._topHeight,T=H),d&&(P=Q._bottomHeight==I?el(d):Q._bottomHeight,R=L-P),$&&(G=Q._leftWidth==I?ao($):Q._leftWidth,Z=G),N&&(S=Q._rightWidth==I?ao(N):Q._rightWidth,B=K-S);var A=o(0,B-Z),y=o(0,R-T);D&&Ae(D,0,0,K,H),d&&Ae(d,0,R,K,P),$&&Ae($,0,T,G,y),N&&Ae(N,B,T,S,y),i&&Ae(i,Z,T,A,y)}})}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);